/*
@license
Webix diagram v.11.3.0
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).diagram={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=function(){},r=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function a(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var o=e[n],r={},a=o.indexOf(":");if(-1===a&&(a=o.indexOf("?")),-1!==a)for(var s=0,l=o.substr(a+1).split(/[\:\?\&]/g);s<l.length;s++){var h=l[s].split("=");r[h[0]]=decodeURIComponent(h[1])}i[n]={page:a>-1?o.substr(0,a):o,params:r,isNew:!0}}return i}function s(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i];e.push("/"+o.page);var r=l(o.params);r&&e.push("?"+r)}return e.join("")}function l(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var h=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:a(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var o in e)n[o]=e[o]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=s(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,o=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(a(t));for(var r=0;r<i.length;r++)n[r]&&(i[r].view=n[r].view),o&&n[r]&&i[r].page===n[r].page?i[r].isNew=!1:i[r].isNew&&(o=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=s(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var a=s(r),l={url:r,redirect:a,confirm:Promise.resolve()},h=e?e.app:null;if(h&&!h.callEvent("app:guard",[l.redirect,e,l]))return void i(new o);l.confirm.catch((function(t){return i(t)})).then((function(){if(null!==l.redirect){if(l.redirect!==a)return h.show(l.redirect),void i(new o);n.route.path=a,n.route.url=r,t()}else i(new o)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=s(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=s(this.route.url)},t}(),u=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof r?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var o=this.getSubViewInfo(e.target);if(o){if(o.parent!==this)return o.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,o.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new h(e,0)),this._segment=e,this._parent=i,this._init_url_data();var o="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==o?(this._container=o,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,o=null,r=null,a=!1;if(this._container.tagName?r=this._container:(o=this._container).popup?(r=document.body,a=!0):r=this.webix.$$(o.id),!this.app||!r)return Promise.reject(null);var s=this._segment.current(),l={ui:{}};this.app.copyConfig(t,l.ui,this._subs),this.app.callEvent("app:render",[this,e,l]),l.ui.$scope=this,!o&&s.isNew&&s.view&&s.view.destructor();try{if(o&&!a){var h=r,u=h.getParentView();u&&"multiview"===u.name&&!l.ui.id&&(l.ui.id=h.config.id)}this._root=this.app.webix.ui(l.ui,r);var c=this._root;a&&c.setPosition&&!c.isVisible()&&c.show(),o&&(o.view&&o.view!==this&&o.view!==this.app&&o.view.destructor(),o.id=this._root.config.id,this.getParentView()||!this.app.app?o.view=this:o.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],o=this._renderFrameLock(i,n,null);o&&e.push(o)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var o=i?i.params:null;return e.params&&(o=this.webix.extend(o||{},e.params)),this._createSubView(e,this._segment.shift(o))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var r=e.view;if(!r&&e.url){if("string"==typeof e.url)return e.route=new h(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||r instanceof e.url||(r=new(this.app._override(e.url))(this.app,"")),r||(r=e.url)}if(r)return r.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(r),c=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(u),d=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),p=!0,f=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof r||"function"==typeof t&&t.prototype instanceof r)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var o in e=e||(n?[]:{}),t){var a=t[o];if("function"==typeof a&&a.prototype instanceof r&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[o]=a;else if(a instanceof Date)e[o]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(n?e.push(s):e[o]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var o=e.parentNode;o&&this.clickHandler(t,o)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:d});if(t.prototype instanceof r)return new t(this,{name:i,params:n});t=t(this)}return t instanceof r?t:new c(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var o=null;!this.$router?(p&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),p=!1),"string"==typeof e&&(e=new h(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):o="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var r=i?i.params:this.config.params||null,a=this.getSubView(),s=this._subSegment,l=s.show({url:o,params:r},a).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return l})),l},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new u(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof o))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new h(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new h(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,o=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[o]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(r),g=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var o in this.config.routes)if(this.config.routes[o]===n[0]){t=o+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),m=!1;function v(t){if(!m&&t){m=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,o=t.ui.baselayout.prototype.removeView,r={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,o={};t=i.app.copyConfig(t,{},o),n.apply(this,[t,e]);var r=function(t){i._renderFrame(t,o[t],null).then((function(){i._subs[t]=o[t]}))};for(var a in o)r(a);return t.id}return n.apply(this,arguments)},removeView:function(){if(o.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,r,!0),t.extend(t.ui.baselayout.prototype,r,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var w=function(t){function e(e){var i;return e.router=e.router||g,v((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(f),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(g),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function x(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function b(t,e,i){for(var n in t)x(t,n)&&e.call(i||t,t[n],n,t)}function _(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var k=String.prototype.replace,S=String.prototype.split,C=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},M={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:C,chinese:function(){return 0},croatian:C,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:C,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},L={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function $(t){var e,i=(e={},b(L,(function(t,i){b(t,(function(t){e[t]=i}))})),e);return i[t]||i[S.call(t,/-/,1)[0]]||i.en}function I(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var V=/\$/g,E=/%\{(.*?)\}/g;function A(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var o=t,r=n||E,a="number"==typeof e?{smart_count:e}:e;if(null!=a.smart_count&&o){var s=S.call(o,"||||");o=(s[function(t,e){return M[$(t)](e)}(i||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return o=k.call(o,r,(function(t,e){return x(a,e)&&null!=a[e]?k.call(a[e],V,"$$"):t}))}function T(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?A:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||_,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(I(e)+"(.*?)"+I(i),"g")}(e.interpolation)}T.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},T.prototype.extend=function(t,e){b(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},T.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:b(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},T.prototype.clear=function(){this.phrases={}},T.prototype.replace=function(t){this.clear(),this.extend(t)},T.prototype.t=function(t,e){var i,n,o=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof o._)i=o._;else if(this.onMissingKey){n=(0,this.onMissingKey)(t,o,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),n=t;return"string"==typeof i&&(n=A(i,o,this.currentLocale,this.tokenRegex)),n},T.prototype.has=function(t){return x(this.phrases,t)},T.transformPhrase=function(t,e,i){return A(t,e,i)};var P=T;var z=window.webix;z&&v(z);var D=function(t,e,i){var n=(i=i||{}).storage,o=n?n.get("lang")||"en":i.lang||"en";function r(e,r,a){r.__esModule&&(r=r.default);var l={phrases:r};i.polyglot&&t.webix.extend(l,i.polyglot);var h=s.polyglot=new P(l);if(h.locale(e),s._=t.webix.bind(h.t,h),o=e,n&&n.put("lang",o),i.webix){var u=i.webix[e];u&&t.webix.i18n.setLocale(u)}return a?Promise.resolve():t.refresh()}function a(e,n){if(!1!==i.path){var o=(i.path?i.path+"/":"")+e;r(e,t.require("jet-locales",o),n)}}var s={getLang:function(){return o},setLang:a,setLangData:r,_:null,polyglot:null};t.setService("locale",s),a(o,!0)},j=window;j.Promise||(j.Promise=j.webix.promise);var B=1;function H(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function N(t,e){e=e||{};var i={},n={},o=function(t,e){var o=B++;return i[o]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),o},r=[],a=!1,s=function(t,e,n,o){if(a)r.push([t,e,n,o]);else for(var s=Object.keys(i),l=0;l<s.length;l++){var h=i[s[l]];h&&("*"!==h.mask&&h.mask!==t||h.handler(n,e,t,o))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:o,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:o,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(a=!0,t(n),a=!1;r.length;){var i=r.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var o in i=i||e,t)if(t.hasOwnProperty(o)){var r=t[o];i.nested&&"object"==typeof r&&r?n[o]=N(r,i):R(n,r,o,s)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function R(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var o=e;e=t,n(i,o,t,null)}},enumerable:!0,configurable:!1})}var O={block:{angle:0,lineStyle:"solid",textAlign:"center",textVAlign:"center",lineWidth:1,fontStyle:"normal",fontWeight:400,fillOpacity:1,linkAlign:"center"},line:{lineWidth:1,lineStyle:"solid"},arrow:{lineWidth:1,fillOpacity:1},org:{lineColor:"#2d9bf0",backgroundColor:"#ffffff"},label:{fillOpacity:0}},G={material:{block:{fontColor:"#475466",fontSize:14,fontFamily:"Roboto",backgroundColor:"#F4F5F9",altBackgroundColor:"#CCD7E6",lineColor:"#CCD7E6"},line:{lineColor:"#CCD7E6"},arrow:{lineColor:"#CCD7E6",backgroundColor:"#ffffff"}},mini:{block:{fontColor:"#475466",fontSize:12,fontFamily:"Roboto",backgroundColor:"#F4F5F9",altBackgroundColor:"#CCD7E6",lineColor:"#CCD7E6"},line:{lineColor:"#CCD7E6"},arrow:{lineColor:"#CCD7E6",backgroundColor:"#ffffff"}},flat:{block:{fontColor:"#475466",fontSize:15,fontFamily:"PT Sans",lineColor:"#bbdefb",backgroundColor:"#e3f2fd",altBackgroundColor:"#bbdefb"},line:{lineColor:"#bbdefb"},arrow:{lineColor:"#bbdefb",backgroundColor:"#ffffff"}},compact:{block:{fontColor:"#475466",fontSize:13,fontFamily:"PT Sans",backgroundColor:"#e3f2fd",altBackgroundColor:"#bbdefb",lineColor:"#bbdefb"},line:{lineColor:"#bbdefb"},arrow:{lineColor:"#bbdefb",backgroundColor:"#ffffff"}},contrast:{block:{fontColor:"#ffffff",fontSize:15,fontFamily:"PT Sans",lineColor:"#ccd7e6",backgroundColor:"#393939",altBackgroundColor:"#ccd7e6"},line:{lineColor:"#ccd7e6"},arrow:{lineColor:"#CCD7E6",backgroundColor:"#393939"},org:{backgroundColor:"#393939"}},willow:{block:{fontColor:"#2C2F3C",fontSize:14,fontFamily:"Open Sans",backgroundColor:"#EBEDF0",altBackgroundColor:"#CCD7E6",lineColor:"#CCD7E6"},line:{lineColor:"#CCD7E6"},arrow:{lineColor:"#CCD7E6",backgroundColor:"#ffffff"}},dark:{block:{fontColor:"#ffffff",fontSize:14,fontFamily:"Open Sans",backgroundColor:"#20262B",altBackgroundColor:"#9FA1AE",lineColor:"#9FA1AE"},line:{lineColor:"#9FA1AE"},arrow:{lineColor:"#9FA1AE",backgroundColor:"#2A2B2D"},org:{lineColor:"#7A67EB",backgroundColor:"#2A2B2D"}}},W=["Arial","Verdana","Helvetica","Tahoma","Trebuchet MS","Times New Roman","Georgia","Garamond","Courier New","Lucida Console","Monaco","Comic Sans MS"],F=function(){function t(t){this.app=t;var e=this._style=webix.copy(O),i=G[webix.skin.$name];for(var n in e)i[n]&&webix.extend(e[n],i[n],!0);this._fonts=(-1==W.indexOf(e.block.fontFamily)?[e.block.fontFamily]:[]).concat(W),this._arrows=["","angle","triangle","triangle-fill"],this._reservedType={templateSvg:1,templateTextStart:1,templateStart:1,templateTextEnd:1,templateEnd:1},this._reservedLink={templateArrow:1,templateLine:1,templateLink:1,templateShadow:1,shadow:1}}return t.prototype.connect=function(t){this._type=t.type,this._linkType=t.linkType,this._shapes=this.app.getService("local").shapes(),this._view=t,this._dtype={type:webix.copy(this._type),linkType:webix.copy(this._linkType)}},t.prototype.setType=function(t,e){var i=this._dtype,n={};for(var o in t)this._reservedType[o]||(n[o]=t[o]);var r={};for(var o in e)this._reservedLink[o]||(r[o]=e[o]);webix.extend(n,i.type),webix.extend(r,i.linkType),this._view.type=this._type=n,this._view.linkType=this._linkType=r},t.prototype.getType=function(){return this._type},t.prototype.getLinkType=function(){return this._linkType},t.prototype.getDefaults=function(){return this._style},t.prototype.getCommonValues=function(){return n(n({},this.getLinkValues()),this.getBlockValues())},t.prototype.getBlockValues=function(t){var e=this;t=t||{};var i=["height","width"],n=this._style.block;t.id&&(i=(i=i.concat(["x","y","id","value","dx","dy"])).concat(Object.keys(n)));var o={};if(t.type){var r=this.extractTypeValues(t.type);webix.extend(o,r)}return i.forEach((function(i){var r=t[i];void 0===r&&(r=o[i]),void 0===r&&void 0===(r=n[i])&&(r=e._type[i]),o[i]=r})),"Roboto"==o.fontFamily&&500==o.fontWeight&&(o.fontWeight="bold"),void 0!==o.fillOpacity&&this._shapes.count()&&(t.type&&"text"==this._shapes.getItem(t.type).template?o.transparent=o.fillOpacity?0:1:o.fillOpacity*=100),o},t.prototype.getLinkValues=function(t){var e=this;t=t||{};var i=["arrowSize","arrow","mode","backgroundColor"],n=this._style.line;t.id&&(i=i.concat(Object.keys(n)));var o={};i.forEach((function(i){var r=t[i];void 0===r&&void 0===(r=n[i])&&(r=e._linkType[i]),o[i]=r})),t.id&&(t.from||t.to||webix.isArray(t.line))&&(o.mode="");var r=o.arrow;return r&&o.backgroundColor&&-1!=this._arrows.indexOf(r+"-fill")?r+="-fill":r&&"triangle"!=r&&(r="angle"),o.arrow=r,o},t.prototype.getFontFamilies=function(){return this._fonts},t.prototype.getArrows=function(){return this._arrows},t.prototype.extractTypeValues=function(t){var e=this._shapes.getItem(t),i={};return e&&(delete(i=webix.copy(e)).id,delete i.name,delete i.svg,delete i.group),webix.extend(i,this._style[t]||{})},t}(),U=function(){function t(t){this.app=t,this.index=-1,this.state=[],this.$ready=!1}return t.prototype.connect=function(t,e){this._master=t,this._local=e,this.$ready=!0,this.track()},t.prototype.track=function(){this.$ready&&(this.index=-1,this.state=[],this.push([["init",this.app.getValues()]]))},t.prototype.reset=function(){if(!(this.state.length<2)){this.$ready=!1,this.index=0;var t=this.state[this.index];this.state=[t],this.app.setValues({item:webix.copy(t[0].item),linkItem:webix.copy(t[0].linkItem),data:this.copy(t[0].data),links:this.copy(t[0].links),shapes:t[0].shapes}),this.$ready=!0,this.app.callEvent("UndoChange")}},t.prototype.copy=function(t){return t.map((function(t){return webix.copy(t)}))},t.prototype.parse=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];t.pull[n.id]||t.order.push(n.id),t.pull[n.id]=n}t.refresh()},t.prototype.undo=function(){var t=this;if(this.hasUndo()){this.$inProgress=!0;var e=this.state[this.index];this.index--,e.forEach((function(e){if(e.data&&e.data.length&&t.parse(t._local.data(),t.copy(e.data)),e.links&&e.links.length&&t.parse(t._local.links().data,t.copy(e.links)),"common"==e.mode)t._master.UpdateCommonValue(e.prev,e.target);else if("autoplace"!=e.mode){var i=e.link?t._local.links().data:t._local.data();"update"==e.mode?t.parse(i,[webix.copy(e.prev)]):"add"==e.mode?i.remove(e.id):"remove"==e.mode&&i.add(webix.copy(e.prev))}})),this.$inProgress=!1,this.app.callEvent("UndoChange")}},t.prototype.redo=function(){var t=this;this.hasRedo()&&(this.$inProgress=!0,this.index++,this.state[this.index].forEach((function(e){if("common"==e.mode)t._master.UpdateCommonValue(e.value,e.target);else if("autoplace"==e.mode)t._master.Autoplace();else{var i=e.link?"Link":"Block";"update"==e.mode?t._local["update"+i](e.id,webix.copy(e.value)):"add"==e.mode?t._local["add"+i](webix.copy(e.value)):"remove"==e.mode&&t._local["remove"+i](e.id)}})),this.$inProgress=!1,this.app.callEvent("UndoChange"))},t.prototype.push=function(t){if(!this.$inProgress&&this.$ready){var e=this.state[this.index];"autoplace"==t[0]&&"autoplace"==e.mode||(this.hasRedo()&&this.state.splice(this.index+1,this.state.length-(this.index+1)),this.index++,webix.isArray(t[0])||(t=[t]),t=t.map((function(t){return webix.extend(t[1],{id:t[2],link:t[3],mode:t[0]})})),this.state[this.index]=t,this.app.callEvent("UndoChange"))}},t.prototype.hasUndo=function(){return this.index>0},t.prototype.hasRedo=function(){return this.index+1<this.state.length},t}(),q=[{id:"default",template:"default",group:"common"},{id:"org",template:"org",group:"common"},{id:"text",template:"text",group:"common"},{id:"label",template:"text"},{id:"line",template:"line",group:"lines",link:!0},{id:"arrow",template:"arrow",group:"lines",link:!0},{id:"curve",template:"curve",group:"lines",link:!0},{id:"rrect",template:"rrect",group:"block"},{id:"ellipse",template:"ellipse",group:"block"},{id:"circle",template:"circle",group:"block"},{id:"square",template:"square",group:"block"},{id:"triangle",template:"triangle",group:"block"},{id:"dot",template:"dot",group:"block"},{id:"trapezoid",template:"trapezoid",group:"block"},{id:"head",template:"head",group:"block"},{id:"pentagon",template:"pentagon",group:"block"},{id:"octagon",template:"octagon",group:"block"},{id:"heptagon",template:"heptagon",group:"block"},{id:"plus",template:"plus",group:"block"},{id:"star",template:"star",group:"block"},{id:"rtriangle",template:"rtriangle",group:"block"},{id:"tail",template:"tail",group:"block"},{id:"collate",template:"collate",group:"flow"},{id:"connector",template:"connector",group:"flow"},{id:"data",template:"data",group:"flow"},{id:"database",template:"database",group:"flow"},{id:"decision",template:"decision",group:"flow"},{id:"delay",template:"delay",group:"flow"},{id:"display",template:"display",group:"flow"},{id:"document",template:"document",group:"flow"},{id:"multidoc",template:"multidoc",group:"flow"},{id:"junction",template:"junction",group:"flow"},{id:"input",template:"input",group:"flow"},{id:"internal",template:"internal",group:"flow"},{id:"looplimit",template:"looplimit",group:"flow"},{id:"note",template:"note",group:"flow"},{id:"merge",template:"merge",group:"flow"},{id:"operation",template:"operation",group:"flow"},{id:"or",template:"or",group:"flow"},{id:"output",template:"output",group:"flow"},{id:"preparation",template:"preparation",group:"flow"},{id:"process",template:"process",group:"flow"},{id:"sdata",template:"sdata",group:"flow"},{id:"sort",template:"sort",group:"flow"},{id:"start",template:"start",group:"flow"},{id:"storage",template:"storage",group:"flow"},{id:"subroutine",template:"subroutine",group:"flow"},{id:"tape",template:"tape",group:"flow"}];function X(t,e,i){var n=i?i[0]:0,o=i?i[1]:0,r=Math.cos(e),a=Math.sin(e);return[n+t[0]*r-t[1]*a,o+t[0]*a+t[1]*r]}function Z(t,e){for(var i=t.width/2,n=t.height/2,o=(t.lineWidth||1)/2,r=2*Math.PI/e,a=Math.min(i,n)-2*o,s=[[e%2?0:a*Math.tan(r/2),-a]],l=1;l<e;l++)s.push(X(s[l-1],r));return"<svg width='100%' height='100%'><polygon points='"+s.map((function(t){return t[0]+=i,t[1]+=n,t.join(",")})).join()+"'></polygon></svg>"}function Y(t,e,i,n){i=i||6;var o=n?i:-i,r=o*(e[1]-t[1])/(e[0]-t[0]),a=n?t:e,s=Math.PI/7;return[X([o,r],s,a),a,X([o,r],-s,a)]}function K(t){return t.querySelector("polyline").getAttribute("points").split(" ").map((function(t){return t.split(",")}))}var Q={default:{template:"<div class='webix_diagram_shape webix_diagram_shape_default' ></div>",svg:!1},org:{template:"<div class='webix_diagram_shape webix_diagram_shape_org'></div>",svg:!1},text:{template:"<div class='webix_diagram_shape webix_diagram_shape_text'></div>",svg:!1},rrect:{svg:!0,template:function(t){var e,i=t.width,n=t.height,o=Math.min(i,n),r=(t.lineWidth||1)/2;return void 0===t.borderRadius?(e=Math.round(o/(2*Math.PI)))<3&&(e=o/2):e=t.borderRadius,"<svg width='"+t.width+"' height='"+t.height+"'><rect x='"+r+"' y='"+r+"' height='"+(n-2*r)+"' width='"+(i-2*r)+"'  rx='"+e+"' ry='"+e+"' ></rect></svg>"}},ellipse:{svg:!0,template:function(t){var e=t.width/2,i=t.height/2,n=(t.lineWidth||1)/2;return"<svg width='100%' height='100%'><ellipse cx='"+e+"' cy='"+i+"' rx='"+(e-n)+"' ry='"+(i-n)+"' ></ellipse></svg>"}},circle:{square:!0,svg:!0,template:function(t){var e=t.width/2,i=t.height/2,n=Math.min(e,i)-(t.lineWidth||1)/2;return"<svg width='100%' height='100%'><ellipse cx='"+e+"' cy='"+i+"' rx='"+n+"' ry='"+n+"' ></ellipse></svg>"}},square:{square:!0,svg:!0,template:function(t){var e=t.width,i=t.height,n=Math.min(e,i)-(t.lineWidth||1);return"<svg width='100%' height='100%'><rect x='"+(e/2-n/2)+"' y='"+(i/2-n/2)+"' height='"+n+"' width='"+n+"' ></rect></svg>"}},triangle:{svg:!0,template:function(t){var e=t.width,i=t.height,n=t.lineWidth||1;return"<svg width='100%' height='100%'><polygon points='"+[[e/2,n],[e-n,i-n],[n,i-n]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},dot:{svg:!0,square:!0,template:function(t){var e=t.width/2,i=t.height/2,n=Math.min(e,i)-(t.lineWidth||1)/2,o=.6*n;return"<svg width='100%' height='100%'><ellipse cx='"+e+"' cy='"+i+"' rx='"+n+"' ry='"+n+"'></ellipse><ellipse cx='"+e+"' cy='"+i+"' rx='"+o+"' ry='"+o+"' class='webix_diagram_shape_alt'></ellipse></svg>"}},trapezoid:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2+1,o=e/8;return"<svg width='100%' height='100%'><polygon points='"+[[o+n,n],[e-o-n,n],[e-n,i-n],[n,i-n]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},head:{svg:!0,template:function(t){var e=t.height,i=t.width,n=t.lineWidth||1;return"<svg width='100%' height='100%'><polygon points='"+[[n,n],[i-n,e/2],[n,e-n],[i/8+n,e/2]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},pentagon:{svg:!0,square:!0,template:function(t){var e=t.width/2,i=t.height/2,n=(t.lineWidth||1)/2,o=Math.min(t.width,t.height)-2*n,r=18*Math.PI/180,a=o*Math.cos(r),s=i-a/2,l=o/2/Math.cos(r),h=l*Math.sin(r),u=l*Math.cos(r),c=a*Math.tan(r);return"<svg width='100%' height='100%'><polygon points='"+[[e,s],[e+u,i+s-h],[e+c,a+s],[e-c,a+s],[e-u,i+s-h]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},octagon:{svg:!0,square:!0,template:function(t){return Z(t,8)}},heptagon:{svg:!0,square:!0,template:function(t){return Z(t,7)}},plus:{square:!0,svg:!0,template:function(t){var e=t.width/2,i=t.height/2,n=Math.min(e,i)-(t.lineWidth||1)/2,o=n/6;return"<svg width='100%' height='100%'><polygon points='"+[[e-o,i-n],[e+o,i-n],[e+o,i-o],[e+n,i-o],[e+n,i+o],[e+o,i+o],[e+o,i+n],[e-o,i+n],[e-o,i+o],[e-n,i+o],[e-n,i-o],[e-o,i-o]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},star:{svg:!0,square:!0,template:function(t){var e=t.width/2,i=t.height/2,n=t.lineWidth||1,o=Math.min(t.width,t.height)-2*n,r=18*Math.PI/180,a=o*Math.cos(r),s=i-a/2,l=o/2/Math.cos(r),h=l*Math.sin(r),u=l*Math.cos(r),c=a*Math.tan(r),d=o/2*Math.tan(36*Math.PI/180),p=d*Math.tan(r),f=(o/2+p)*Math.sin(r),g=(o/2+p)*Math.cos(r);return"<svg width='100%' height='100%'><polygon points='"+[[e,s],[e+p,s+d],[e+u,l-h+s],[e+f,g+s],[e+c,a+s],[e,a-c*Math.tan(36*Math.PI/180)+s],[e-c,a+s],[e-f,g+s],[e-u,l-h+s],[e-p,d+s]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},rtriangle:{svg:!0,template:function(t){var e=t.width,i=t.height,n=t.lineWidth||1;return"<svg width='100%' height='100%'><polygon points='"+[[n,n],[e-n,i-n],[n,i-n]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},tail:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2+1,o=e/6;return"<svg width='100%' height='100%'><polygon points='"+[[n,n],[e-o-n,n],[e-n,i/2],[e-o-n,i-n],[n,i-n],[n+o,i/2]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},collate:{svg:!0,square:!0,template:function(t){var e=t.width,i=t.height,n=t.lineWidth||1;return"<svg width='100%' height='100%'><polygon points='"+[[n,n],[e-n,n],[e/2,i/2],[e-n,i-n],[n,i-n],[e/2,i/2]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},connector:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2;return"<svg width='100%' height='100%'><polygon points='"+[[n,n],[e-n,n],[e-n,i/2],[e/2,i-n],[n,i/2]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},data:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.round(e/10);return"<svg width='100%' height='100%'><path d='"+("M "+(n+o)+" "+n+" H "+(e-n-o)+" C "+e+" "+n+", "+e+" "+(i-n)+", "+(e-n-o)+" "+(i-n)+" H "+(n+o)+"  C 0 "+(i-n)+" , 0 "+n+", "+(n+o)+" "+n)+"'></path><path d='"+("M "+(e-n-o)+" "+n+" C "+(e-n-2*o)+" "+n+" , "+(e-n-2*o)+" "+(i-n)+", "+(e-n-o)+" "+(i-n))+"'></path></svg>"}},database:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.round(i/6);return"<svg width='100%' height='100%'><path d='"+("M "+n+" "+(n+o)+"  C 0 "+n+", "+(e-n)+" 0, "+(e-n)+" "+(n+o)+" V "+(i-n-o)+" C "+(e-n)+" "+i+", "+n+" "+i+", "+n+" "+(i-n-o)+" Z")+"'></path><path d='"+("M "+n+" "+(n+o)+" C "+n+" "+(n+2*o)+", "+(e-n)+" "+(n+2*o)+", "+(e-n)+" "+(n+o))+"'></path></svg>"}},decision:{svg:!0,template:function(t){var e=t.width,i=t.height,n=t.lineWidth||1;return"<svg width='100%' height='100%'><polygon points='"+[[e/2,n],[e-n,i/2],[e/2,i-n],[n,i/2]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},delay:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=i/2-n;return"<svg width='100%' height='100%'><path d='"+("M "+n+" "+n+" H  "+(e-n-o)+" A "+o+" "+o+", 0 0, 1 "+(e-n-o)+" "+(i-n)+" H "+n+" Z")+"'></path></svg>"}},display:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.min(e,i)/2-n;return"<svg width='100%' height='100%'><path d='"+("M "+(n+o)+" "+n+" H  "+(e-n-o)+" A "+o+" "+o+", 0 0, 1 "+(e-n-o)+" "+(i-n)+" H "+(n+o)+" L "+n+" "+i/2+" Z")+"'></path></svg>"}},document:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.round(i/6);return"<svg width='100%' height='100%'><path d='"+("M "+n+" "+n+" H "+(e-n)+" V "+(i-n-o)+" Q "+(3*e/4-n)+" "+(i-n-2*o-o/3)+","+e/2+" "+(i-n-o)+" Q "+e/4+" "+(i+o/3)+", "+n+" "+(i-n-o)+" V "+n+" Z ")+"'></path></svg>"}},multidoc:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.round(i/6),r=Math.min(Math.min(e,i)/12,5);return"<svg width='100%' height='100%'><path d='"+("M "+n+" "+(n+2*r)+" H "+(e-n-2*r)+" V "+(i-n-o)+" Q "+(3*e/4-n)+" "+(i-n-2*o-o/3)+","+e/2+" "+(i-n-o)+" Q "+e/4+" "+(i+o/3)+", "+n+" "+(i-n-o)+" V "+(n+2*r)+" H "+(n+r)+" V "+(n+r)+" H "+(e-n-r)+" V "+(i-n-o-r)+"  L "+(e-n-2*r)+" "+(i-n-o-3*r/2)+"V "+(n+2*r)+" H "+(n+r)+" V "+(n+r)+"  H "+(n+2*r)+" V "+n+"  H "+(e-n)+" V "+(i-n-o-2*r)+"L "+(e-n-r)+" "+(i-n-o-5*r/2))+"'></path></svg>"}},junction:{svg:!0,square:!0,template:function(t){var e=t.width/2,i=t.height/2,n=Math.min(e,i)-(t.lineWidth||1)/2,o=n*Math.sqrt(2)/2;return"<svg width='100%' height='100%'><ellipse cx='"+e+"' cy='"+i+"' rx='"+n+"' ry='"+n+"' ></ellipse><path d='M "+(e-o)+" "+(i+o)+" L "+(e+o)+" "+(i-o)+"'></path><path d='M "+(e-o)+" "+(i-o)+" L "+(e+o)+" "+(i+o)+"'></path></svg>"}},input:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2+1;return"<svg width='100%' height='100%'><polygon points='"+[[n,n+i/3],[e-n,n],[e-n,i-n],[n,i-n]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},internal:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.min(e,i)/4;return"<svg width='100%' height='100%'>"+("<rect x='"+n+"' y='"+n+"' height='"+(i-2*n)+"' width='"+(e-2*n)+"' ></rect>")+("<path d='M "+n+" "+(n+o)+" H "+(e-n)+"'></path><path d='M "+(n+o)+" "+n+" V "+(i-n)+"'></path>")+"</svg>"}},looplimit:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=e/6;return"<svg width='100%' height='100%'><polygon points='"+[[n+o,n],[e-n-o,n],[e-n,n+o],[e-n,i-n],[n,i-n],[n,n+o]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},merge:{svg:!0,template:function(t){var e=t.width,i=t.height,n=t.lineWidth||1;return"<svg width='100%' height='100%'><polygon points='"+[[n,n],[e-n,n],[e/2,i-n]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},note:{svg:!0,template:function(t){var e,i=t.width,n=t.height,o=t.lineWidth||1,r=Math.min(i,n),a=2*r/5;return"<svg width='100%' height='100%'><path d='"+("M "+(i-o-a)+" "+o+" V "+(o+a-(e=void 0===t.borderRadius?Math.min(Math.round(r/12),5):t.borderRadius))+" A "+e+" "+e+", 0 0, 0 "+(i-o-a+e)+","+(o+a)+" H "+(i-o)+" L "+(i-o-a)+" "+o+"H "+(o+e)+" A "+e+" "+e+", 0 0, 0 "+o+","+(o+e)+" V "+(n-o-e)+" A "+e+" "+e+", 0 0, 0 "+(o+e)+","+(n-o)+"H "+(i-o-e)+" A "+e+" "+e+", 0 0, 0 "+(i-o)+","+(n-o-e)+" V "+(o+a)+" ")+"'></path></svg>"}},operation:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=e/8;return"<svg width='100%' height='100%'><polygon points='"+[[n,n],[e-n,n],[e-n-o,i-n],[n+o,i-n]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},or:{svg:!0,square:!0,template:function(t){var e=t.width/2,i=t.height/2,n=Math.min(e,i)-(t.lineWidth||1)/2;return"<svg width='100%' height='100%'><ellipse cx='"+e+"' cy='"+i+"' rx='"+n+"' ry='"+n+"' ></ellipse><path d='M "+(e-n)+" "+i+"  L "+(e+n)+" "+i+"'></path><path d='M "+e+" "+(i-n)+" L "+e+" "+(i+n)+"'></path></svg>"}},output:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2+1,o=e/8;return"<svg width='100%' height='100%'><polygon points='"+[[n+o,n],[e-n,n],[e-n-o,i-n],[n,i-n]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},preparation:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2+1,o=e/8;return"<svg width='100%' height='100%'><polygon points='"+[[n,i/2],[n+o,n],[e-n-o,n],[e-n,i/2],[e-n-o,i-n],[n+o,i-n],[n,i/2]].map((function(t){return t.join(",")})).join()+"'></polygon></svg>"}},process:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2;return"<svg width='100%' height='100%'><rect x='"+n+"' y='"+n+"' height='"+(i-2*n)+"' width='"+(e-2*n)+"' ></rect></svg>"}},sdata:{svg:!0,square:!0,template:function(t){var e=t.width/2,i=t.height/2,n=Math.min(e,i)-(t.lineWidth||1)/2;return"<svg width='100%' height='100%'><ellipse cx='"+e+"' cy='"+i+"' rx='"+n+"' ry='"+n+"' ></ellipse>"+("<path d='M "+e+" "+(i+n)+" H "+(e+n)+" Z'></path>")+"</svg>"}},sort:{svg:!0,template:function(t){var e=t.width,i=t.height,n=t.lineWidth||1;return"<svg width='100%' height='100%'><polygon points='"+[[e/2,n],[e-n,i/2],[e/2,i-n],[n,i/2]].map((function(t){return t.join(",")})).join()+"'></polygon>"+("<path d='M "+n+" "+i/2+" H "+(e-2*n)+" Z'></path>")+"</svg>"}},start:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=i/2-n;return"<svg width='100%' height='100%'><path d='"+("M "+(n+o)+" "+n+" H "+(e-n-o)+" A "+o+" "+o+", 0 0, 1 "+(e-n-o)+" "+(i-n)+" H "+(n+o)+" A "+o+" "+o+", 0 0, 1 "+(n+o)+" "+n+" Z")+"'></path></svg>"}},storage:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.round(e/10);return"<svg width='100%' height='100%'><path d='"+("M "+(n+o)+" "+n+" H  "+(e-n)+" C "+(e-n-o)+" "+n+", "+(e-n-o)+" "+(i-n)+", "+(e-n)+" "+(i-n)+" H "+(n+o)+" C 0 "+(i-n)+", 0 "+n+", "+(n+o)+" "+n+" Z")+"'></path></svg>"}},subroutine:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.min(e,i)/4;return"<svg width='100%' height='100%'>"+("<rect x='"+n+"' y='"+n+"' height='"+(i-2*n)+"' width='"+(e-2*n)+"' ></rect>")+("<path d='M "+(n+o)+" "+n+" V "+(i-n)+"'></path><path d='M "+(e-n-o)+" "+n+" V "+(i-n)+"'></path>")+"</svg>"}},tape:{svg:!0,template:function(t){var e=t.width,i=t.height,n=(t.lineWidth||1)/2,o=Math.round(i/6);return"<svg width='100%' height='100%'><path d='"+("M "+n+" "+(n+o)+"  Q  "+(e/4-n)+" "+(n+2*o+o/3)+", "+e/2+" "+(n+o)+"Q  "+3*e/4+" "+(n-o/3)+", "+(e-n)+" "+(n+o)+" H  "+(e-n)+" V "+(i-n-o)+"Q  "+(3*e/4-n)+" "+(i-n-2*o-o/3)+" , "+e/2+" "+(i-n-o)+"Q  "+e/4+" "+(i+o/3)+", "+n+" "+(i-n-o)+" V "+(n+o)+" Z")+"'></path></svg>"}},line:{svg:!0,arrow:!1,getPoints:K,template:function(t){var e=t.width,i=t.height,n=Math.round(e/6),o=Math.round(i/2);return"<svg width='100%' height='100%' class='webix_diagram_link_shape'><polyline points='"+[[n,i-o],[e-n,o]].join(" ")+"'></polyline></svg>"}},arrow:{svg:!0,arrow:!0,getPoints:K,template:function(t){var e=t.width,i=t.height,n=Math.round(e/6),o=Math.round(i/2),r=[[n,i-o],[e-n,o]],a=Y(r[0],r[1]);return"<svg width='100%' height='100%' class='webix_diagram_link_shape'><polyline points='"+r.join(" ")+"'></polyline><polyline points='"+a.join(" ")+"'></polyline></svg>"}},curve:{svg:!0,arrow:!0,mode:"curve",getPoints:function(t){return t.querySelector("path").getAttribute("data-points").split(",").map((function(t){return t.split(" ")}))},template:function(t){var e=t.width,i=t.height,n=Math.round(e/6),o=Math.round(i/2),r=[Math.round(e/3),0],a=[e-Math.round(e/3),i],s=[[n,i-o],r,[(r[0]+a[0])/2,(r[1]+a[1])/2],a,[e-n,o]],l=Y(s[3],s[4],3);return"<svg width='100%' height='100%' class='webix_diagram_link_shape'><path d='"+s.reduce((function(t,e,i){return i?i%2&&(t+=" Q "):t="M ",t+=" "+e.join(" ")}),"")+"' data-points='"+s.map((function(t){return t.join(" ")})).join(",")+"'></path><polyline points='"+l.join(" ")+"'></polyline></svg>"}}};function J(t,e){var i=e.angle;return webix.isUndefined(i)&&(i=t.getItemValue(e.id,"angle")),1*i||0}var tt={right:0,bottom:90,left:180,top:270};function et(t,e){return(t+tt[e])%360*Math.PI/180}function it(t,e){t=(t+tt[e])%360;var i=Math.floor((t-45)/90);return(i<3?i:0)+2}function nt(t,e,i,n){return i?(i=et(i,e),[Math.round(t[0]+n*Math.cos(i)),Math.round(t[1]+n*Math.sin(i))]):"left"==e?[t[0]-n,t[1]]:"top"==e?[t[0],t[1]-n]:"bottom"==e?[t[0],t[1]+n]:"right"==e?[t[0]+n,t[1]]:void 0}function ot(t,e,i,o,r){var a=t.getItem(e.source),s=t.getItem(e.target);if(r&&a&&a.id==r.id?a=n(n({},a),r):r&&s&&s.id==r.id&&(s=n(n({},s),r)),i=i||"center",o=o||"center",webix.isArray(e.line))return function(t,e,i,n){var o=webix.copy(n.line);return n.from&&(o[0]=ht(t,e,n.from)),n.to&&(o[o.length-1]=ht(t,i,n.to)),o}(t,a,s,e);if("center"==i&&"center"==o)return function(t,e,i,n){var o=n.mode||t.linkType.mode,r=ft(ht(t,e,"center"),ht(t,i,"center"),o);return"curve"==o&&(r=rt(t,r,n,e,i)),r}(t,a,s,e);var l=t.isCurveLink(e),h=ht(t,a,i),u=ht(t,s,o),c=J(t,a),d=J(t,s);if(!l&&!c&&!d){if(h[1]==u[1]&&function(t,e){return"top"!=t&&"bottom"!=t&&"top"!=e&&"bottom"!=e}(i,o))return[h,u];if(h[0]==u[0]&&function(t,e){return"left"!=t&&"right"!=t&&"left"!=e&&"right"!=e}(i,o))return[h,u]}var p=[h];"center"!=i?(p.push(h=nt(h,i,c,t.type.listMarginX/2)),i=it(c,i)):i=0;var f=[u];"center"!=o?(f.unshift(u=nt(u,o,d,t.type.listMarginX/2)),o=it(d,o)):o=0,h[0]!=u[0]&&h[1]!=u[1]&&function(t,e,i,n,o){var r;if(n*o==0)return 2!=n&&4!=n&&1!=o&&3!=o||(e=(r=[i,e])[0],i=r[1]),t.push([e[0],i[1]]);if(n==o){if(1==n&&e[0]<i[0]||3==n&&e[0]>i[0])return t.push([i[0],e[1]]);if(2==n&&e[1]>i[1]||4==n&&e[1]<i[1])return t.push([i[0],e[1]])}else if(2==Math.abs(n-o)){if(1==n&&e[0]>i[0]||3==n&&e[0]<i[0]){var a=(e[1]+i[1])/2;return t.push([e[0],a],[i[0],a])}if(2==n&&e[1]>i[1]||4==n&&e[1]<i[1]){a=(e[0]+i[0])/2;return t.push([a,e[1]],[a,i[1]])}}else if(1==n&&e[0]<i[0]){if(2==o&&e[1]>i[1]||4==o&&e[1]<i[1])return t.push([i[0],e[1]])}else if(3==n&&e[0]>i[0]){if(2==o&&e[1]>i[1]||4==o&&e[1]<i[1])return t.push([i[0],e[1]])}else if(2==n){if(3==o&&(e[0]>i[0]||e[1]>i[1]))return t.push([i[0],e[1]]);if(1==o&&!(e[0]>=i[0]&&e[1]<=i[1]))return t.push([i[0],e[1]])}else if(4==n){if(1==o&&(e[0]<i[0]||e[1]<i[1]))return t.push([i[0],e[1]]);if(3==o&&!(e[0]<=i[0]&&e[1]>=i[1]))return t.push([i[0],e[1]])}t.push([e[0],i[1]])}(p,h,u,i,o);var g=p.concat(f);return l&&(g=rt(t,g,e,a,s,i,o)),g}function rt(t,e,i,n,o,r,a){var s=["center","right","bottom","left","top"];s[r]&&(r=s[r]),s[a]&&(a=s[a]),r||(r=at(t,n,e,1)),a||(a=at(t,o,e,-1));for(var l,h=ht(t,n,r),u=ht(t,o,a),c=[h],d=1;d<e.length-1;d++){var p=e[d],f=e[d+1];if(f=d!=e.length-2?ct(p,f):u,1==d||d==e.length-2){var g=1==d?n:o,m=1==d?r:a;if(!st(p,g,lt(t,g))){l=!0;var v=ct(c[c.length-1],f);"left"==m||"right"==m?p[0]=v[0]:p[1]=v[1]}}c.push(p,f)}return l&&(c[2]=ct(c[1],c[3])),c}function at(t,e,i,n){for(var o=t.getItem(e.id),r=lt(t,o),a="bottom",s=n>0?0:i.length-1,l=i[s+n];i[s]&&!st(l,e,r);)l=i[s],s+=n;return e.x>=l[0]?a="left":e.x+r.width<=l[0]?a="right":e.y>=l[1]&&(a="top"),a}function st(t,e,i){return t[0]<=e.x||t[0]>=e.x+i.width||t[1]<=e.y||t[1]>=e.y+i.height}function lt(t,e){var i=t.getShape(e.type||t.type.type)||{};return{width:1*e.width||i.width||t.type.width,height:1*e.height||i.height||t.type.height}}function ht(t,e,i,n){var o=lt(t,e);n=n||0;var r=1*e.x+o.width/2,a=1*e.y+o.height/2,s=J(t,e);if("center"==i)return[r,a];if(s){var l=("left"==i||"right"==i?o.width:o.height)/2+n;return s=et(s,i),[Math.round(r+l*Math.cos(s)),Math.round(a+l*Math.sin(s))]}return"left"==i?[1*e.x-n,a]:"top"==i?[r,1*e.y-n]:"bottom"==i?[r,1*e.y+o.height+n]:"right"==i?[1*e.x+o.width+n,a]:void 0}function ut(t,e,i,o){var r,a,s=e.line,l=e.from,h=e.to;s=webix.isArray(s)?s.map((function(t){return webix.isArray(t)?t:t.split(",")})):ot(t,e,l,h);var u=i?lt(t,i):t.type,c=u.width,d=u.height;if(!i||"start"!=i.linkAlign&&"end"!=i.linkAlign){var p=Math.floor(s.length/2);a={x:(r=s.length%2?s[p]:ct(s[p-1].map((function(t){return 1*t})),s[p].map((function(t){return 1*t}))))[0]-c/2,y:r[1]-d/2}}else{var f=["center","right","bottom","left","top"],g=!i||"start"==i.linkAlign,m=g?1:-1;if(e.source){var v=t.getItem(g?e.source:e.target);o&&v&&v.id==o.id&&(v=n(n({},v),o));var w=g?l:h;f[w]&&(w=f[w]),!w&&v&&(w=at(t,v,s,m)),r=ht(t,v,w),a="top"==w?{x:r[0]+10,y:r[1]-d-10}:"bottom"==w?{x:r[0]+10,y:r[1]+10}:"left"==w?{x:r[0]-c-10,y:r[1]-d-10}:{x:r[0]+10,y:r[1]-d-10}}else{var y=g?0:s.length-1,x=s[y],b=s[y+m];a={x:x[0]-10,y:x[1]-d-10},x[0]>b[0]&&(a.x-=c)}}return a}function ct(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function dt(t){for(var e=[(t=t.map((function(t){return webix.isArray(t)?t:t.split(",")})))[0].join(",")],i="M "+t[0].join(" "),n=1;n<t.length;n+=2){var o=t[n],r=t[n+1]||t[n];e.push(o.join(","),r.join(",")),i+=" Q "+o.join(" ")+" "+r.join(" ")}return{d:i,points:e.join(" ")}}function pt(t,e){var i=1*e[0];return i&&i!=t.length-1?(i&&!(i%2)&&i<t.length-1&&(t.splice(i,0,[]),t.splice(i+2,0,[]),i++),i<t.length-2&&(t[i+1]=ct(t[i+2],t[i])),i>1&&(t[i-1]=ct(t[i-2],t[i])),t):t}function ft(t,e,i){var n;if("direct"==i||t[1]==e[1]){if(n=[[t[0],t[1]],[e[0],e[1]]],"curve"==i){var o=Math.floor((e[0]-t[0])/2),r=Math.floor((e[0]-t[0])/8);n.splice(1,0,[t[0]+o-r,t[1]],[t[0]+o+r,t[1]])}}else{var a=t[1]+Math.floor((e[1]-t[1])/2);if("curve"==i&&t[0]==e[0]){var s=Math.floor((e[1]-t[1])/8);n=[[t[0],t[1]],[t[0],a-s],[e[0],a+s],[e[0],e[1]]]}else n=[[t[0],t[1]],[t[0],a],[e[0],a],[e[0],e[1]]]}return n}var gt=100,mt=40,vt={fontColor:function(t){return"color:"+t+";"},fontSize:function(t){return"font-size:"+t+"px;"},fontFamily:function(t){return"font-family:"+t+";"},fontWeight:function(t){return"font-weight:"+t+";"},fontStyle:function(t){return"font-style:"+t+";"},textAlign:function(t){var e="center";return"left"==t?e="flex-start":"right"==t&&(e="flex-end"),"justify-content:"+e+";text-align:"+t+";"},textVAlign:function(t){var e="center";return"top"==t?e="flex-start":"bottom"==t&&(e="flex-end"),"align-items:"+e+";"},angle:function(t){return"transform:rotate("+t+"deg);transform-origin:50% 50%;"},fillOpacity:function(t,e){return e?"fill-opacity:"+t+";":"opacity:"+t+";"},lineWidth:function(t,e){return e?"stroke-width:"+t+";":"border-width:"+t+"px;"},lineColor:function(t,e){return e?"stroke:"+t+";":"border-color:"+t+";"},lineStyle:function(t,e){var i=t;return e?("dotted"==t?i="2,2":"dashed"==t?i="4,4":webix.isArray(t)&&(i=t.join(",")),"stroke-dasharray:"+i+";"):"border-style:"+i+";"},backgroundColor:function(t,e){return e?"fill:"+t+";":"background:"+t+";"},altBackgroundColor:function(t){return"fill:"+t+";"}},wt={svg:!0,line:!0,arrow:!0},yt={text:["fontColor","fontFamily","fontSize","fontWeight","fontStyle","textAlign","textVAlign"],textBlock:["fillOpacity"],rotation:["angle"],block:["fillOpacity","lineWidth","lineColor","lineStyle","backgroundColor"],alt:["altBackgroundColor"],line:["lineWidth","lineColor","lineStyle"],arrow:["fillOpacity","lineWidth","lineColor","backgroundColor"]};function xt(t){return t.charAt(0).toUpperCase()+t.substring(1)}function bt(t,e,i){var n=yt[e]||[];i=i||{};for(var o="",r=0;r<n.length;r++){var a=n[r],s=t[a];webix.isUndefined(s)&&(s=i[a]),webix.isUndefined(s)||null===s||(o+=vt[a](s,wt[e]))}return o}yt.svg=yt.block;var _t=function(){function t(t,e){this.app=t,this._extraShapes=this.app.config?this.app.config.shapes:e}return t.prototype.connect=function(t,e){this._view=t,this._history=e,this._data=t.data,this._links=t.getLinks()},t.prototype.data=function(){return this._data},t.prototype.links=function(){return this._links},t.prototype.shapes=function(){var t=this;if(this._shapes)return this._shapes;if(this._shapes=new webix.DataCollection({scheme:{$change:function(e){var i=e.template;if(void 0===e.square&&"string"==typeof i){var n=t.getShapeTemplate(i);n&&n.square&&(e.square=n.square)}var o=void 0!==e.name?e.name:e.id;e.name=xt(o)}}}),this._shapes.parse(q),this.defaultGroups=["extra"],q.forEach((function(e){t.defaultGroups.indexOf(e.group)<0&&t.defaultGroups.push(e.group)})),webix.isArray(this._extraShapes)){var e=-1;this._extraShapes.forEach((function(i){if(!i.id||!t._shapes.getItem(i.id))return i.group=i.group||"Extra",e++,t._shapes.add(i,e);t._shapes.updateItem(i.id,i)}))}return this._shapes},t.prototype.getShapeTemplate=function(t){return!0===t?Q:Q[t]},t.prototype.isDefaultGroup=function(t){return this.defaultGroups.indexOf(t.toLowerCase())>-1},t.prototype.addLinkToHistory=function(t,e,i){i[t.id]||(i[t.id]=!0,e.links.push(webix.copy(t)))},t.prototype.updateCustomLinks=function(t,e,i,n){var o=this,r=!1;return this._links.find((function(e){return e.source==t||e.target==t})).forEach((function(t){webix.isArray(t.line)&&(o.addLinkToHistory(t,e,i),t.line=ot(o._view,t,t.from,t.to),r=!0),t.labels&&o.updateLinkLabels(t.id,n)})),r},t.prototype.shiftData=function(t,e,i){var n=this,o=this._data.getItem(t),r=Math.min(0,o.x),a=Math.min(0,o.y);if(r<0||a<0)return e.data=this._data.serialize(),this._data.each((function(t){t.x-=r,t.y-=a}),this,!0),this._links.data.each((function(t){webix.isArray(t.line)&&(n.addLinkToHistory(t,e,i),t.line=t.line.map((function(t){return[(t=webix.isArray(t)?t:t.split(","))[0]-r,t[1]-a]})))}),this,!0),!0},t.prototype.addBlock=function(t){var e={value:webix.copy(t),prev:null,links:[]},i=this._data.add(t);e.value.id=i;var n=[["add",e,i]];if(t.$link){var o=this._links.getItem(t.$link),r=webix.copy(o);o.labels||(o.labels=[]),o.labels.push(i);var a={value:webix.copy(o),prev:r};n.push(["update",a,o.id,!0])}return this._history.push(n),this.shiftData(i,e,{})&&this._view.render(),i},t.prototype.addLink=function(t){var e={value:webix.copy(t),prev:null},i=this._links.add(t);return this._history.push([["add",e,i,!0]]),e.value.id=i,i},t.prototype.removeBlock=function(t){var e=this,i=this._data.getItem(t);if(i){var n={value:null,prev:webix.copy(i),links:[]};this._view.$blockRender=!0;var o=[["remove",n,t]];this._links.find((function(e){return e.source==t||e.target==t})).forEach((function(t){t.labels&&t.labels.forEach((function(t){var i=e._data.getItem(t),n={value:null,prev:webix.copy(i)};o.push(["remove",n,t]),e._data.remove(t)})),n.links.push(webix.copy(t)),e._links.remove(t.id)}));var r=i.$link?this._links.getItem(i.$link):null;if(r){var a=webix.copy(r);r.labels.splice(r.labels.indexOf(t),1),r.labels.length||delete r.labels;var s={value:webix.copy(r),prev:a};this._links.updateItem(r.id,r),o.push(["update",s,r.id,!0])}this._view.$blockRender=!1,this._data.remove(t),this._history.push(o)}},t.prototype.removeLink=function(t){var e=this,i=this._links.getItem(t),n={value:null,prev:webix.copy(i)};this._links.remove(t);var o=[["remove",n,t,!0]];i.labels&&i.labels.forEach((function(t){var i=e._data.getItem(t);if(i){var n={value:null,prev:webix.copy(i)};e._data.remove(t),o.push(["remove",n,t])}})),this._history.push(o)},t.prototype.updateBlock=function(t,e){var i=this._data.getItem(t),o=webix.copy(i);if(i.$link){var r=n(n({},i),e);if(r.linkAlign!=i.linkAlign){var a=ut(this._view,this._links.getItem(i.$link),r),s=a.x,l=a.y;e.x=s,e.y=l,delete i.dx,delete i.dy}}var h={value:webix.copy(e),prev:o,links:[]};this._data.updateItem(t,e);var u=[["update",h,t]],c={},d=this.updateCustomLinks(t,h,c,u);this._history.push(u),this.shiftData(t,h,c)&&(d=!0),d&&this._view.render()},t.prototype.updateLink=function(t,e){var i=this._links.getItem(t);if(e.mode){var n=i.line;n&&!i.start?(e.line=ft(n[0],n[n.length-1],e.mode),"curve"==e.mode&&e.line.splice(2,0,ct(n[0],n[n.length-1]))):e.line=e.from=e.to=void 0}var o={value:webix.copy(e),prev:webix.copy(i)};this._links.updateItem(t,e);var r=[["update",o,t,!0]];i.labels&&this.updateLinkLabels(t,r),this._history.push(r)},t.prototype.updateLinkLabels=function(t,e){var i=this,n=this._links.getItem(t);n.labels.forEach((function(t){var o=i._data.getItem(t);if(o){var r=webix.copy(o),a=ut(i._view,n,o),s=a.x,l=a.y;if(o.dx||o.dy){var h=s+(o.dx||0),u=l+(o.dy||0);!function(t,e,i,n){var o=lt(t,i),r=o.width,a=o.height,s=t.getItem(n.source),l=lt(t,s),h=t.getItem(n.target),u=lt(t,h);return st(e,s,l)&&st(e,h,u)&&st([e[0]+r,e[1]+a],s,l)&&st([e[0]+r,e[1]+a],h,u)}(i._view,[h,u],o,n)?(delete o.dx,delete o.dy):(s=h,l=u)}o.x=s,o.y=l;var c={value:webix.copy(o),prev:r,links:[]};i._data.updateItem(o.id,o),e.push(["update",c,t])}}))},t}();var kt={start:function(t,e){t._auto_scroll_delay=webix.delay(kt.autoScroll,t,[e,webix.html.pos(e)],250)},reset:function(t,e){t._auto_scroll_delay&&(t._auto_scroll_delay=window.clearTimeout(t._auto_scroll_delay)),e&&t.snode&&(t.snode.style.minWidth="",t.snode.style.minHeight="",t.from.callEvent("onAfterAutoScroll",[]))},autoScroll:function(t,e){var i=-1!==this.direction.indexOf("y"),n=-1!==this.direction.indexOf("x"),o=webix.html.offset(this.from.$view),r=!1;i&&kt.autoYScroll.call(this,e,o,this.senseY)&&(r=!0),n&&kt.autoXScroll.call(this,e,o,this.senseX)&&(r=!0),r&&(!function(t,e){if(webix.DragControl.active){var i=webix.DragControl.getNode();e=webix.copy(e),webix.DragControl.$dragPos(e,t),i.style.top=e.y+webix.DragControl.top+"px",i.style.left=e.x+webix.DragControl.left+"px"}}(t,e),this._auto_scroll_delay=webix.delay(kt.autoScroll,this,[t,e],100))},autoYScroll:function(t,e,i){var n=this.from.getScrollState();return t.y<e.y+i?kt.autoScrollTo.call(this,n.x,n.y-i/2,"y"):t.y>e.y+e.height-i&&kt.autoScrollTo.call(this,n.x,n.y+i/2,"y")},autoXScroll:function(t,e,i){var n=this.from.getScrollState();return t.x<e.x+i?kt.autoScrollTo.call(this,n.x-i/2,n.y,"x"):t.x>e.x+e.width-i&&kt.autoScrollTo.call(this,n.x+i/2,n.y,"x")},autoScrollTo:function(t,e,i){this.snode&&(this.snode.style.minWidth=(this.from.$width+Math.ceil(t))/this.zoom+"px",this.snode.style.minHeight=(this.from.$height+Math.ceil(e))/this.zoom+"px"),this.from.scrollTo(t,e),this.from.callEvent("onAfterAutoScroll",[]);var n=this.from.getScrollState();return Math.abs(("x"===i?t:e)-n[i])<1}};function St(t,e){var i=t.config;return{x:e.x+(i.paddingX||i.padding),y:e.y+(i.paddingY||i.padding)}}var Ct={$longTouchLimit:!0,$dragCreate:function(t,e,i){var n,o=this.getContext();o.$touch="touch"===i;var r=this.locateEvent(e),a=e.target;if(r)return this.master.HideContext(),(n=a.getAttribute("webix_resizer"))?(o.submode={start:n},o.mode="resize",n.split(",").forEach((function(t){return o.submode[t]=!0}))):(n=a.getAttribute("webix_connector"))?(o.mode="links",o.submode=n):a.classList.contains("webix_de_rotate")?o.mode="rotate":o.mode="move",$t[o.mode].$dragCreate.call(this,t,e,r);var s=void 0,l=void 0;if(!(n=a.getAttribute("webix_link_path"))&&(s=a.getAttribute("webix_dg_shadow_id")||a.getAttribute("webix_dg_link_id"))&&(l=this.view.getLinks().getItem(s)),n||l&&!l.target){if(this.master.HideContext(),o.mode="path",n)o.submode=n.split(",");else{var h=Lt(a);o.id=s,o.submode=Array.from(Array(h.length).keys())}return $t[o.mode].$dragCreate.call(this,t,e)}return!1},$dragDestroy:function(t,e,i){var n=this.getContext();return n.from===this&&(n.from=this.view),$t[n.mode].dragScroll&&kt.reset(n,!0),$t[n.mode].$dragDestroy&&$t[n.mode].$dragDestroy.call(this,t,e,i),n.$render||this.view.render(),webix.html.remove(e),!1},$dragIn:function(t,e,i){var n=this.getContext();return!!$t[n.mode]&&($t[n.mode].dragScroll&&(kt.reset(n),kt.start(n,i)),!$t[n.mode].$dragIn||$t[n.mode].$dragIn.call(this,t,e,i))},$dragPos:function(t){var e=this.getContext();return $t[e.mode].$dragPos.call(this,t)},$dragOut:function(t,e,i,n){var o=this.getContext();return $t[o.mode].$dragOut?$t[o.mode].$dragOut.call(this,t,e,i,n):null},$drop:function(t,e,i){var n=this.getContext();return!!$t[n.mode]&&($t[n.mode].$drop?$t[n.mode].$drop.call(this,t,e,i):void 0)},locateEvent:function(t,e){return e&&(t=document.elementFromPoint(e.x,e.y),e.target=t),webix.html.locate(t,"webix_dg_id")},getEventContext:function(t,e){if(e.$touch){if(t.changedTouches&&(!t.touches||!t.touches[0])){var i=t.changedTouches[0];return{x:i.pageX,y:i.pageY}}return t.time?t:webix.env.touch.context(t)}return{x:t.clientX,y:t.clientY}},getContext:function(){return webix.DragControl.getContext()},getNode:function(){return webix.DragControl.getNode()}};function Mt(t,e,i,n,o){for(var r=webix.copy(t),a=0;a<e.length;a++)r[e[a]][0]+=i,r[e[a]][1]+=n;if(o){var s=[r[0]];for(a=1;a<r.length-1;a++){var l=s[s.length-1],h=r[a],u=r[a+1];l[0]==h[0]&&h[0]==u[0]||(l[1]==h[1]&&h[1]==u[1]||s.push(r[a]))}s.push(r[r.length-1]),r=s}return r}function Lt(t){if(t.points){for(var e=t.points,i=[],n=0;n<e.length;n++)i.push([e[n].x,e[n].y]);return i}return(e=t.getAttribute("data-points").split(" ")).map((function(t){return t.split(",").map((function(t){return 1*t}))}))}var $t={add:{$drop:function(t,e,i){var o=this.getContext(),r=this.getNode(),a=o.from.getItem(o.start),s=this.view.getScrollState(),l=this.State.gridStep,h=St(this.view,webix.html.offset(e)),u=this.master.app.getService("locale")._;if(!this.master.app.callEvent("diagram:beforedrop",[o,i]))return!1;var c=this.view.config.zoom,d=Math.round((parseInt(r.style.left)-h.x+s.x)/l/c)*l,p=Math.round((parseInt(r.style.top)-h.y+s.y)/l/c)*l,f="default"!==o.start?this.view.getShape(o.start):{};if(a.link){var g=n({},f);delete g.id,delete g.template,delete g.link;var m=this.Local.getShapeTemplate(a.template)||{};void 0===g.mode&&(g.mode=m.mode||"direct"),void 0===g.arrow&&(g.arrow=m.arrow);var v=a.getPoints||m.getPoints;g.line=v(r).map((function(t){return[1*t[0]+d,1*t[1]+p]}));var w=this.Local.addLink(g);this.master.SelectLink(w)}else{var y={x:d,y:p},x=this.view.type,b=x.width,_=x.height,k=x.type;"default"===o.start&&"default"===k||(y.type=o.start),"auto"===b&&(y.width=gt),"auto"===_&&(y.height=mt),a.template&&"text"!=f.template||(y.value=u(xt(f.name))),f.square&&!f.width&&(y.width=f.height||y.height||_,y.x+=Math.round((b-y.width)/2/c/l)*l),o.$render=!0;var S=this.Local.addBlock(y);this.view.select(S)}}},move:{dragScroll:{direction:"xy",senseX:100,senseY:100},$dragCreate:function(t,e,i){var n=this.getContext(),o=this.view.getItem(i),r=this.view.getItemNode(i),a=this.view.getScrollState(),s=this.getEventContext(e,n);if(webix.extend(n,{id:i,from:this.view,snode:t.querySelector(".webix_scroll_cont"),node:r,scroll:a,zoom:this.view.config.zoom,l:o.x,t:o.y,x:s.x,y:s.y},!0),$t[n.mode].dragScroll&&webix.extend(n,$t[n.mode].dragScroll),!this.master.app.callEvent("diagram:beforedrag",[n,e]))return!1;this.master.ShowLinkPath();var l=r.cloneNode(!0);return l.className+=" webix_drag_zone",webix.html.addCss(t,"webix_de_mode_"+n.mode,!0),r.style.visibility="hidden",t.style.cursor="move",t.querySelector(".webix_diagram_shapes").appendChild(l),l},$dragPos:function(t){var e=this.getContext(),i=e.l,n=e.t,o=e.x,r=e.y,a=e.scroll,s=e.zoom,l=e.id,h=this.view.getScrollState(),u=this.State.gridStep;t.x=Math.round((i+(t.x-o-a.x+h.x)/s)/u)*u,t.y=Math.round((n+(t.y-r-a.y+h.y)/s)/u)*u;var c={id:l,x:t.x,y:t.y};this.master.Action({name:"sync-links",id:l,item:c})},$drop:function(t,e,i){var n=this.getContext(),o=this.getNode(),r=n.id;if(!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;var a=parseInt(o.style.left),s=parseInt(o.style.top);n.$render=!0;var l={x:a,y:s};this.master.Action({name:"handle-move",id:n.id,item:l}),this.Local.updateBlock(r,l),this.view.select(r)},$dragDestroy:function(t){var e=this.getContext();webix.html.removeCss(t,"webix_de_mode_"+e.mode),e.node.style.visibility="",t.style.cursor=""}},links:{dragScroll:{direction:"xy",senseX:100,senseY:100},$dragCreate:function(t,e,i){var n=this.getContext(),o=this.view.getItem(i),r=this.view.getItemNode(i),a=St(this.view,webix.html.offset(t));if(webix.extend(n,{id:i,from:this.view,node:r,startNode:e.target,offset:a,zoom:this.view.config.zoom,start:ht(this.view,o,n.submode,4)},!0),$t[n.mode].dragScroll&&webix.extend(n,$t[n.mode].dragScroll),!this.master.app.callEvent("diagram:beforedrag",[n,e]))return!1;webix.html.addCss(n.startNode,"webix_de_selected_dot",!0);var s=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(s),s},$dragIn:function(t,e,i){var n=this.getContext(),o=this.getEventContext(i,n),r=this.locateEvent(i,n.$touch?o:null);if(!r)return!1;var a=this.view.getItemNode(r);return r!=n.target&&(webix.html.addCss(a,"webix_de_connect_end",!0),n.target=r),a},$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState(),n=e.offset,o=e.zoom;e.end=[(t.x-n.x+i.x)/o,(t.y-n.y+i.y)/o],this.master.Action({name:"temp-link",start:e.start,end:e.end})},$dragOut:function(t,e,i,n){var o=this.getContext(),r=this.getEventContext(n,o),a=this.locateEvent(n,o.$touch?r:null);if(o.target&&a!=o.target){var s=this.view.getItemNode(o.target);webix.html.removeCss(s,"webix_de_connect_end"),o.target=null}return null},$drop:function(t,e,i){var n=this.getContext(),o=this.getEventContext(i,n),r=n.id,a=this.locateEvent(i,n.$touch?o:null);if(!a||r==a)return!1;if(n.targetId=a,!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;var s=n.$touch?o.target:i.target,l=n.submode,h=s.getAttribute("webix_connector")||"center",u={source:r,target:a};"center"!=l||"center"!=h?(u.to=h,u.from=l):u.mode="direct",n.$render=!0;var c=this.Local.addLink(u);this.master.SelectLink(c)},$dragDestroy:function(){var t=this.getContext();webix.html.removeCss(t.startNode,"webix_de_selected_dot"),this.master.Action({name:"temp-link"})}},resize:{$dragCreate:function(t,e,i){var n=this.getContext(),o=this.view.getItem(i),r=this.view.getItemNode(i),a=this.view.getScrollState(),s=this.getEventContext(e,n);if(webix.extend(n,{id:i,from:this.view,node:r,startNode:e.target,selectNode:r.querySelector(".webix_de_selection_layer"),scroll:a,zoom:this.view.config.zoom,l:o.x,t:o.y,angle:this.view.getItemValue(i,"angle"),w:parseInt(r.style.width),h:parseInt(r.style.height),x:s.x,y:s.y,square:this.view.getItemValue(i,"square")},!0),n.angle&&function(t){var e=["bottom,right","bottom,left","top,left","top,right"],i=e.indexOf(t.submode.start),n=i%2?t.w/t.h:t.h/t.w,o=90*i+180*Math.atan(n)/Math.PI,r=Math.floor((o+t.angle)/90)%4;i!==r&&(t.submode={start:t.submode.start,invert:Math.abs(r-i)%2,direction:r%2?-1:1},e[r].split(",").forEach((function(e){return t.submode[e]=!0})))}(n),!this.master.app.callEvent("diagram:beforedrag",[n,e]))return!1;webix.html.addCss(n.startNode,"webix_de_selected_dot",!0),webix.html.addCss(t,"webix_de_mode_"+n.mode,!0);var l=n.submode;t.style.cursor=l.top&&l.left||l.bottom&&l.right?"nwse-resize":"nesw-resize";var h=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(h),h},$dragPos:function(t){var e,i=this.getContext(),n=i.x,o=i.y,r=i.scroll,a=i.zoom,s=i.node,l=i.selectNode,h=i.submode,u=i.id,c=this.view.getScrollState(),d=this.State.gridStep,p=Math.round((t.x-n-r.x+c.x)/a/d)*d,f=Math.round((t.y-o-r.y+c.y)/a/d)*d;(h.invert&&(p=(e=[h.direction*f,h.direction*p])[0],f=e[1]),i.square)&&(p*(g=i.submode.left?-1:1)>f*(m=i.submode.top?-1:1)?f=m*g*p:p=m*g*f);if(p!=i.dx||f!=i.dy){var g=i.l,m=i.t,v=i.w,w=i.h;i.dx=p,i.dy=f;var y=this.master.app.config,x=y.minItemWidth,b=y.minItemHeight;h.left?(s.style.left=Math.min(g+p,g+v-x)+"px",s.style.width=Math.max(v-p,x)+"px"):s.style.width=Math.max(v+p,x)+"px",l.style.width=parseInt(s.style.width)+10+"px",h.top?(s.style.top=Math.min(m+f,m+w-b)+"px",s.style.height=Math.max(w-f,b)+"px"):s.style.height=Math.max(w+f,b)+"px",l.style.height=parseInt(s.style.height)+10+"px";var _={id:u,x:parseInt(s.style.left),y:parseInt(s.style.top),width:parseInt(s.style.width),height:parseInt(s.style.height)};this.master.Action({name:"sync-links",id:u,item:_}),this.master.Action({name:"resize-content",id:u,item:_})}},$drop:function(t,e,i){var n=this.getContext(),o=n.node;if(!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;var r={x:parseInt(o.style.left),y:parseInt(o.style.top),width:parseInt(o.style.width),height:parseInt(o.style.height)};r.x==n.l&&delete r.x,r.y==n.t&&delete r.y,r.width==n.w&&delete r.width,r.height==n.h&&delete r.height,Object.keys(r).length&&(n.$render=!0,this.master.Action({name:"handle-resize",id:n.id,item:r}),this.Local.updateBlock(n.id,r))},$dragDestroy:function(t){var e=this.getContext();webix.html.removeCss(e.startNode,"webix_de_selected_dot"),webix.html.removeCss(t,"webix_de_mode_"+e.mode),t.style.cursor=""}},rotate:{$dragCreate:function(t,e,i){var n=this.getContext(),o=this.view.getItem(i),r=this.view.getItemNode(i),a=St(this.view,webix.html.offset(t));if(webix.extend(n,{id:i,from:this.view,node:r,offset:a,startNode:e.target,zoom:this.view.config.zoom,l:o.x,t:o.y,w:parseInt(r.style.width),h:parseInt(r.style.height)},!0),!this.master.app.callEvent("diagram:beforedrag",[n,e]))return!1;webix.html.addCss(n.startNode,"webix_de_angle_text",!0),webix.html.addCss(t,"webix_de_mode_"+n.mode,!0),t.style.cursor="move",r.style.transformOrigin="50% 50%";var s=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(s),s},$dragPos:function(t){var e=this.getContext(),i=e.l,n=e.t,o=e.w,r=e.h,a=e.offset,s=e.zoom,l=e.id,h=this.view.getScrollState(),u=i+o/2,c=n+r/2,d=(t.x-a.x+h.x)/s,p=(t.y-a.y+h.y)/s,f=Math.round(90-180*Math.atan2(d-u,p-c)/Math.PI);if(f<0&&(f+=360),f!==e.angle){e.angle=f,e.node.style.transform="rotate("+f+"deg)",e.startNode.style.transform="rotate(-"+f+"deg)",e.startNode.innerHTML=f+"&deg;";var g={id:l,angle:f};this.master.Action({name:"sync-links",id:l,item:g})}},$drop:function(t,e,i){var n=this.getContext();if(!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;this.view.getItem(n.id).angle!==n.angle&&(n.$render=!0,this.Local.updateBlock(n.id,{angle:n.angle}))},$dragDestroy:function(t){var e=this.getContext();webix.html.removeCss(e.startNode,"webix_de_angle_text"),webix.html.removeCss(t,"webix_de_mode_"+e.mode),t.style.cursor=""}},path:{$dragCreate:function(t,e){var i=this.getContext();i.id&&(this.master.SelectLink(i.id),this.master.HideContext());var n=this.State.selected.id,o=this.view.getLinkItemNode(n,"link"),r=this.view.getScrollState(),a=this.getEventContext(e,i),s=!o.points;if(webix.extend(i,{id:n,from:this.view,path:Lt(o),scroll:r,zoom:this.view.config.zoom,initial:e.target,first:e.target.previousSibling==this.master.TempLink.firstChild,last:!e.target.nextSibling,vertical:e.target.classList.contains("webix_de_link_line-v"),horizontal:e.target.classList.contains("webix_de_link_line-h"),newDot:e.target.classList.contains("webix_de_link_dot-n"),x:a.x,y:a.y,curve:s},!0),i.submode.length>1&&i.submode.length<i.path.length)i.submode[1]==i.path.length-1&&i.path.push(i.path[i.path.length-1]),0==i.submode[0]&&(i.path.unshift(i.path[0]),i.submode=i.submode.map((function(t){return++t})));else if(i.newDot){var l=Math.floor(i.submode/2)+1;i.path.splice(l,0,ct(i.path[l-1],i.path[l])),i.submode=[l]}if(!this.master.app.callEvent("diagram:beforedrag",[i,e]))return!1;i.extraCss=i.first||i.last?" webix_de_mode_connect":"",webix.html.addCss(t,"webix_de_mode_"+i.mode+i.extraCss,!0),i.first||i.last?t.style.cursor="pointer":i.vertical?t.style.cursor="ew-resize":i.horizontal?t.style.cursor="ns-resize":t.style.cursor="move",i.initial.style.visibility="hidden",t.querySelector(".webix_diagram_links").appendChild(i.initial);var h=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(h),h},$dragIn:function(t,e,i){var n=this.getContext();if(!n.first&&!n.last)return!1;var o=this.getEventContext(i,n),r=this.locateEvent(i,n.$touch?o:null);if(!r)return!1;var a=this.view.getItemNode(r);return r!=n.target&&(webix.html.addCss(a,"webix_de_connect_end",!0),n.target=r),a},$dragPos:function(t){var e=this.getContext(),i=e.x,n=e.y,o=e.scroll,r=e.zoom,a=e.id,s=this.view.getScrollState(),l=e.first||e.last?1:this.State.gridStep,h=Math.round((t.x-i-o.x+s.x)/r/l)*l,u=Math.round((t.y-n-o.y+s.y)/r/l)*l;if(e.vertical?u=0:e.horizontal&&(h=0),h!=e.dx||u!=e.dy){e.dx=h,e.dy=u;var c=Mt(e.path,e.submode,h,u);this.master.Action({name:"sync-path",id:a,path:c,submode:e.submode})}},$dragOut:function(t,e,i,n){var o=this.getContext();if(!o.first&&!o.last)return!1;var r=this.getEventContext(n,o),a=this.locateEvent(n,o.$touch?r:null);if(o.target&&a!=o.target){var s=this.view.getItemNode(o.target);webix.html.removeCss(s,"webix_de_connect_end"),o.target=null}return null},$drop:function(t,e,i){var o=this.getContext(),r=this.getEventContext(i,o),a=this.view.getLinks().getItem(o.id);if(o.first||o.last){var s=this.locateEvent(i,o.$touch?r:null),l=o.$touch?r.target:i.target,h=void 0;s&&(h=l.getAttribute("webix_connector"))&&(o.targetId=s,o.targetSide=h)}if(!this.master.app.callEvent("diagram:beforedrop",[o,i]))return!1;var u={};if(o.curve||(u.mode=void 0),webix.isArray(a.line)||(u.from=a.from||"center",u.to=a.to||"center"),o.targetId&&o.targetSide)if(u[o.first?"from":"to"]=o.targetSide,u[o.first?"source":"target"]=o.targetId,webix.isArray(a.line)){var c=n(n({},a),u);u.line=ot(this.view,c,c.from,c.to)}else u.from==u.to&&"center"==u.to&&(u.from=u.to=void 0);else o.dx||o.dy?(o.first?u.from=void 0:o.last&&(u.to=void 0),u.line=Mt(o.path,o.submode,o.dx,o.dy,!o.curve),o.curve&&(u.line=pt(u.line,o.submode))):u=!1;u&&(o.$render=!0,this.Local.updateLink(o.id,u))},$dragDestroy:function(t,e,i){var n=this.getContext();this.$drop(t,null,i),n.initial&&webix.html.remove(n.initial),webix.html.removeCss(t,"webix_de_mode_"+n.mode+n.extraCss),t.style.cursor=""}}};var It,Vt=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i,n,o,r=function(){function t(t,e,i){this._tbounds=[0,0],t?(this.nodes=[e],t.collectSubNodes(e,this.nodes),this.hash=t.hash,this.root(e,i)):(this.nodes=[],this.hash={})}return t.prototype.copy=function(){var e=this,i=new t;return i.nodes=this.nodes.map((function(t){return{id:t.id,w:t.w,h:t.h,x:t.x,y:t.y,kids:[],links:[],isn:t.isn,iss:t.iss}})),i.hash={},i.nodes.forEach((function(t){i.hash[t.id]=t})),i.nodes.forEach((function(t){t.kids=e.hash[t.id].kids.map((function(t){return i.hash[t.id]})),t.links=e.hash[t.id].links.map((function(t){return i.hash[t.id]}))})),i._tbounds=[].concat(this._tbounds),i._ybounds=[].concat(this._ybounds),i._bounds=this._bounds?this._bounds.map((function(t){return[].concat(t)})):[],i.routes=this.routes,i._root=this._root?i.hash[this._root.id]:null,i},t.prototype.collectSubNodes=function(t,e){for(var i=0;i<t.kids.length;i++){var n=t.kids[i];e.push(n),n.kids&&this.collectSubNodes(n,e)}},t.prototype.getLevelBounds=function(){return this._bounds},t.prototype.getBounds=function(t,e,i){var n;return[(n=i?this._tbounds:this._bounds[t])[0]?n[0]-e/2:0,n[1]?n[1]+e/2:0]},t.prototype.addEdge=function(t,e){var i=this.hash[t],n=this.hash[e];i.links.push(n),n.links.push(i)},t.prototype.importNodes=function(t){var e=this;t.forEach((function(t){e.hash[t.id]=t,e.nodes.push(t)}))},t.prototype.split=function(e){var i=this,n=[];if(this.nodes=this.nodes.filter((function(t){return!e(t)||(delete i.hash[t.id],n.push(t),!1)})),!n.length)return null;var o=new t;return o.importNodes(n),o},t.prototype.addNode=function(t){t.kids=[],t.links=[],this._root||(this._root=t),this.hash[t.id]=t,this.nodes.push(t)},t.prototype.getNode=function(t){return this.hash[t]},t.prototype.getRoot=function(){return this._root},t.prototype.getLevels=function(){return this._deep},t.prototype.clean=function(){this.nodes.forEach((function(t){if(t.links.length>1){var e=[];t.links=t.links.filter((function(i){return-1===e.indexOf(i)&&t!==i&&(e.push(i),!0)}))}}))},t.prototype.getNodes=function(){return this.nodes},t.prototype.getBox=function(){return[this._tbounds,this._ybounds]},t.prototype.setGlobalBox=function(){var t,e,i,n;this.nodes.length&&(t=i=1/0,e=n=-1/0,this.nodes.forEach((function(o){var r=o.x-o.w/2,a=o.x+o.w/2,s=o.y-o.h/2,l=o.y+o.h/2;r<t&&(t=r),s<i&&(i=s),a>e&&(e=a),l>n&&(n=l)})),this._tbounds=[t,e],this._ybounds=[i,n])},t.prototype.translate=function(t){if(this.nodes.forEach((function(e){e.x+=t.x,e.y+=t.y})),this._tbounds[0]+=t.x,this._tbounds[1]+=t.x,this._bounds)for(var e=0;e<this._bounds.length;e++)this._bounds[e][0]+=t.x,this._bounds[e][1]+=t.x;this._ybounds&&(this._ybounds[0]+=t.y,this._ybounds[1]+=t.y)},t.prototype.rotate=function(t){var e=t.x,i=t.y;this.nodes.forEach((function(t){var n=t.x*i-t.y*e,o=t.x*e+t.y*i;t.x=n,t.y=o}));var n=this._tbounds,o=n[0],r=n[1],a=this._ybounds,s=a[0],l=a[1];this._tbounds=[o*i-s*e,r*i-l*e].sort(),this._ybounds=[o*e+s*i,r*e+l*i].sort()},t.prototype.setBox=function(){var t=this._deep[this._deep.length-1],e=-1/0;t.forEach((function(t){var i=t.y+t.h/2;i>e&&(e=i)})),this._ybounds=[this._root.y-this._root.h/2,e]},t.prototype.mirror=function(){this.nodes.forEach((function(t){t.x=-t.x}));for(var t=0;t<this._bounds.length;t++){var e=this._bounds[t],i=e[0],n=e[1];this._bounds[t]=[-n,-i]}var o=this._tbounds,r=o[0],a=o[1];this._tbounds=[-a,-r]},t.prototype.nonLeaves=function(t){return t.kids.filter((function(t){return t.kids.length>0}))},t.prototype.toTree=function(t){return t&&this.hash[t.id]||(t=this._detectRoot()),this.nodes.forEach((function(t){return t.kids=[]})),this.setKids(t),t},t.prototype.root=function(t,e){this._deep=[[t]];var i=Math.round((e&&e.rotate?t.h:t.w)/2);this._tbounds=[-i,i],this._bounds=[[-i,i]],this._leaves=[],this._root=t,this._setLevels(t,1),this._width=1;for(var n=0;n<this._deep.length;n++){var o=this._deep[n].length;o>this._width&&(this._width=o)}},t.prototype.setKids=function(t){var e=this;t.links.forEach((function(i){i.kids.length||(t.kids.push(i),e.setKids(i))}))},t.prototype._detectRoot=function(){var t={},e=this.nodes,i=[];do{i.forEach((function(e){return t[e]=1})),i=[],e=e.filter((function(e){var n=e.links.map((function(e){return t[e.id]?0:1})).reduce((function(t,e){return t+e}),0)>1;return n||i.push(e.id),n}))}while(e.length>2&&i.length);return e[0]||this.nodes[0]},t.prototype._setLevels=function(t,e){for(var i=t.kids,n=0;n<i.length;n++){var o=i[n],r=this._deep[e];r?r.push(o):(this._deep[e]=[o],this._bounds[e]=[0,0]),o.kids.length?this._setLevels(o,e+1):this._leaves.push(o)}},t.prototype.getIString=function(){for(var t=[],e=0;e<this._leaves.length;e++)this._leaves[e].isn=0,this._leaves[e].iss="";for(e=this._deep.length-2;e>=0;e--){for(var i=this._deep[e].filter((function(t){return t.kids.length>0})),n=0;n<i.length;n++)for(var o=i[n],r=0;r<o.kids.length;r++)o.iss=o.kids.map((function(t){return t.isn})).sort().join(",");i.sort((function(t,e){return t.iss>e.iss?1:-1})),t.push(i.map((function(t){return t.iss})).join("|"));var a=i[0].iss,s=1;for(n=0;n<i.length;n++)a!==i[n].iss&&(a=i[n].iss,s++),i[n].isn=s}return t.join(";")},t}();(n=e.LineMode||(e.LineMode={}))[n.Direct=1]="Direct",n[n.Edges=2]="Edges",n[n.Child=3]="Child",n[n.Sibling=4]="Sibling",(o=e.Direction||(e.Direction={}))[o.Top=1]="Top",o[o.Bottom=2]="Bottom",o[o.Right=3]="Right",o[o.Left=4]="Left";var a=((i={})[e.Direction.Bottom]={x:0,y:1},i[e.Direction.Top]={x:0,y:-1},i[e.Direction.Right]={x:1,y:0},i[e.Direction.Left]={x:-1,y:0},i),s=function(){function t(t,e){var i=this;this._config=t,this._conns=[],this._connMap=new Map,this._shapes=[],this._shapesMap=new Map,e&&(e.forEach((function(t){return i.addShape(t.id,t.x-t.w/2,t.y-t.h/2,t.x+t.w/2,t.y+t.h/2)})),e.forEach((function(e){e.links.forEach((function(n){return i.addConnector("",e.id,n.id,t.mode)}))})))}return t.prototype.addShape=function(t,e,i,n,o){var r={cx:e+(n-e)/2,cy:i+(o-i)/2,x1:e,y1:i,x2:n,y2:o,id:t};this._shapesMap.set(t,r),this._shapes.push(r)},t.prototype.addConnector=function(t,e,i,n){var o={id:t,from:e,to:i,mode:n,line:[]};this._conns.push(o),this._connMap.set(t,o)},t.prototype.finalize=function(t){for(var e=0;e<this._conns.length;e++)this._conns[e].line.length||this.drawLine(this._conns[e],t);return this._conns},t.prototype.drawLine=function(t,i){var n=this._shapesMap.get(t.from),o=this._shapesMap.get(t.to),r=i===e.Direction.Top||i===e.Direction.Bottom,a=t.mode||this._config.mode,s=this._config.padding||8;switch(a){case e.LineMode.Direct:t.line=[[n.cx,n.cy],[o.cx,o.cy]];break;case e.LineMode.Edges:if(r?n.cy===o.cy:n.cx===o.cx)t.line=[[n.cx,n.cy],[o.cx,o.cy]];else if(r){var l=Math.floor((o.cy-n.cy)/2);t.line=[[n.cx,n.cy],[n.cx,n.cy+l],[o.cx,n.cy+l],[o.cx,o.cy]]}else{var h=Math.floor((o.cx-n.cx)/2);t.line=[[n.cx,n.cy],[n.cx+h,n.cy],[n.cx+h,o.cy],[o.cx,o.cy]]}break;case e.LineMode.Sibling:if(r){var u=Math.min(n.x1,o.x1)+s;t.line=[[n.cx+s,n.cy],[u,n.cy],[u,o.cy],[o.cx+s,o.cy]]}else t.line=[[n.cx,n.cy],[o.cx,o.cy]];break;case e.LineMode.Child:if(r){u=Math.min(n.x1,o.x1)+s;t.line=[[n.cx,n.cy],[u,n.cy],[u,o.cy],[o.cx+s,o.cy]]}else t.line=[[n.cx,n.cy],[o.cx,o.cy]]}},t}(),l=function(){function t(){}return t.prototype.layout=function(t,i){t.root(t.toTree(t.hash[i.root])),i.levelPadding=i.levelPadding||this._getStep(t.getNodes())+i.itemPadding,i.dir=i.dir||e.Direction.Bottom,i.rotate=i.dir===e.Direction.Right||i.dir===e.Direction.Left;var n=a[i.dir];this._layout(t,i),t.setBox(),i.dir!==e.Direction.Bottom&&t.rotate(n);var o=t.getBox();return t.translate({x:-1*o[0][0],y:-1*o[1][0]}),t.setBox(),t},t.prototype._layout=function(t,e){var i=this,n=t.getRoot();if(n.x=n.y=0,1==t.getLevels().length)return t._symmetry=!0,"0";var o=n.kids.map((function(i){return new r(t,i,e)})),a={};o.forEach((function(t){var n=i._layout(t,e);a[n]?a[n].push(t):a[n]=[t]}));for(var s=Object.keys(a).sort((function(t,e){var i=a[t][0],n=a[e][0],o=i._width,r=n._width;if(o>r)return-1;if(o<r)return 1;var s=i.getLevels().length,l=n.getLevels().length;return s>l?-1:s<l||t<e?1:-1})),l=0,h=0,u=0;u<s.length;u++)a[s[u]].length%2==1&&(l++,h=u);var c=!1,d=!1;1==l?(a[s[h]][0]._symmetry&&(d=!0),c=!0,0!==h&&(s.unshift(s[h]),s.splice(h+1,1))):0===l&&(d=!0);return t._symmetry=d,this._layout_place(t,a,s,c,e),t.getIString()},t.prototype._layout_place=function(t,e,i,n,o){for(var r={x:0,y:o.levelPadding},a=!0,s=0;s<i.length;s++){e[i[s]].forEach((function(e){if(n){n=!1,e.translate(r);for(var i=0,s=0,l=e.getLevelBounds(),h=0;h<l.length;h++){var u=l[h],c=u[0],d=u[1];t._bounds[h+1]=[c,d],c<i&&(i=c),d>s&&(s=d)}t._tbounds=[i,s]}else{var p=a?1:0,f=a?0:1;a&&e.mirror();var g=void 0,m=void 0;m=g=999999*(a?-1:1);for(var v=o.itemPadding,w=0;w<e._bounds.length;w++){var y=t.getBounds(w+1,v,o.wide)[p]-e.getBounds(w,v,o.wide)[f];(a&&y>m||!a&&y<m)&&(m=y)}e.translate({x:m,y:r.y});for(var x=0;x<t._bounds.length;x++){var b=void 0;b=0==x||x>e._bounds.length?t._bounds[x][p]:t._bounds[x][p]=e._bounds[x-1][p],(a&&b>g||!a&&b<g)&&(g=b)}t._tbounds[p]=g,a=!a}}))}},t.prototype._getStep=function(t){var e=0;return t.forEach((function(t){e=Math.max(e,t.w,t.h)})),e},t}(),h=function(){function t(){}return t.prototype.layout=function(t,e){var i=t.getRoot(),n={minSpaceBetweenGen:e.levelPadding||20,minSpaceBetweenSibling:e.itemPadding||5,minAngleBetweenSibling:-1},o=d(t,i,e,n,n.minSpaceBetweenGen,[],0,!0),r=o.subAngle,a=o.count,s=o.firstGenOffset,l=o.maxRadius,h=o.genOffset;n.minAngleBetweenSibling=c(n.minSpaceBetweenSibling,n.minSpaceBetweenGen+s);var m=n.minSpaceBetweenGen;r+a*n.minAngleBetweenSibling>360?m=f(r+n.minAngleBetweenSibling*a,l)/(2*Math.PI)-h.reduce((function(t,e){return t+e}),0)-n.minSpaceBetweenGen*(h.length-1):n.minSpaceBetweenSibling=f((360-r)/a,o.maxRadius);var v=-m;return n.minAngleBetweenSibling=(360-d(t,i,e,n,m).subAngle)/a,function t(e,i,n,o,r,a,s,l,h){var d,f,m,v=i.kids;h&&(i.x=0,i.y=0);var w,y=0;if(v.length){f=m=l;for(var x=0;x<v.length;x++)d=v[x],y=Math.max(y,g(d));y=y/2+g(i)/2;for(x=0;x<v.length;x++){d=v[x];var b=h?0+y:o.minSpaceBetweenGen+y;m=t(e,d,n,o,r+b,a-b,s-b,m,!1)}if(!h)w=u(_=(f+m)/2,r,a,s),i.x=w.x,i.y=w.y}else{var _=c(p(g(i),r),r)+o.minAngleBetweenSibling;w=u(l+_/2,r,a,s),i.x=w.x,i.y=w.y,m=l+_}return m}(t,i,e,n,m,v,v,0,!0),t.translate({x:1e3,y:1e3}),t},t}();function u(t,e,i,n){var o,r={x:i+e,y:n};if(0===t)o=r;else{var a=t,s=a<=180;s||(a=360-a);var l=(180-a)/2,h=90-l,u=2*e*Math.sin(Math.PI*a/180/2),c=u*Math.sin(Math.PI*h/180),d=u*Math.sin(Math.PI*l/180);o={x:r.x+(s?d:-d),y:r.y+c}}return o}function c(t,e){return Math.ceil(t/e*180/Math.PI)}function d(t,e,i,n,o,r,a,s){r||(r=[]);var l=e.kids,h=0,u=0,f=0;if(l.length){for(var m=void 0,v=0,w=0;w<l.length;w++)m=l[w],v=Math.max(v,g(m));v=v/2+g(e)/2;for(w=0;w<l.length;w++){var y=d(t,m=l[w],i,n,s?o+v:o+n.minSpaceBetweenGen+v,r,a?a+1:1,!1),x=y.subAngle,b=y.count,_=y.maxRadius;h+=x,u+=b,f=Math.max(f,_)}return r[a-1]||r.push(v),{subAngle:h,count:u,maxRadius:f,firstGenOffset:v,genOffset:r}}return{subAngle:c(p(g(e),o),o),count:1,maxRadius:o}}function p(t,e){return 2*e*Math.asin(t/(2*e))}function f(t,e){return e*Math.PI*t/180}function g(t){var e=t.w,i=t.h;return Math.ceil(Math.sqrt(e*e+i*i))}var m=[1,2,4,8,0,16,32,64,128],v=function(){function t(){this._map={}}return t.prototype.getRoute=function(t,e){var i=this._map[t];return i&&i.map[e]||null},t.prototype.addRoute=function(t,e,i,n){this.addPath(t,e,i,n),this.addPath(e,t,-i,-n)},t.prototype.hasRoute=function(t,e,i){var n=this._map[t];return!!n&&(n.dir&this._code(e,i))>0},t.prototype.isAligned=function(t){return!!this._map[t]},t.prototype.isAxisAligned=function(t,e,i){var n=this._map[t];if(!n)return null;for(var o in n.map){var r=n.map[o];if(e&&r.dy||i&&r.dx)return!1}return!0},t.prototype.addPath=function(t,e,i,n,o){var r=this._map[t];r||(r=this._map[t]={map:{},dir:0}),r.map[e]={dx:i,dy:n,points:o},r.dir=r.dir|this._code(i,n)},t.prototype._code=function(t,e){return m[Math.sign(t)+1+3*(Math.sign(e)+1)]},t}();function w(t,e){var i=new r;return i.importNodes(t),{g:i,root:e}}var y=function(){function t(){}return t.prototype.layout=function(t,e){if(t.routes=new v,!e.full){var i=x(t,e);return e.preserveLocation||_(i.n,i.size),S(i.mx,i.n,i.n,i.size),i.n,t.setGlobalBox(),t}var n=function(t){var e=t.getNodes();if(e.length<3)return[{g:t}];for(var i=e[0],n=[],o=e.length+1;o!=e.length;)o=e.length,e=e.filter((function(e){if(1==e.links.length){var i=t.hash[e.links[0].id];return i&&(i.links=i.links.filter((function(t){return t.id!=e.id}))),n.push(e),!1}return!0}));if(e.length<2)return n.filter((function(t){return t.links.length>0})).forEach((function(t){t.links[0].links.push(t)})),t.root(t.toTree(i)),[{g:t}];var r={};n.forEach((function(t){return r[t.id]=t}));var a=n.filter((function(t){return!r[t.links[0].id]})).map((function(t){return[t]}));n.forEach((function(t){var e=r[t.links[0].id];e&&e.links.push(t)}));var s=a.map((function(t){for(var e,i=0;e=t[i++];){var n=e.links.length;if(n>1)for(var o=1;o<n;o++){var r=e.links[o];t.push(r)}}var a=t[0].links.splice(0,1)[0].id;return w(t,a)}));return[w(e,null)].concat(s)}(t);if(1==n.length&&null!==n[0].root)return(new l).layout(n[0].g,e);(t=n[0].g).routes=new v;var o=x(t,e);return e.preserveLocation||_(o.n,o.size),S(o.mx,o.n,o.n,o.size),e.full&&(!function(t,e,i,n){i.length,i.forEach((function(t){return t.iss=""}));var o=[].concat(i).filter((function(t){return t.links.length>=3})).sort((function(t,e){return t.links.length>e.links.length?-1:t.links.length==e.links.length?0:1}));if(o.map((function(t){var e=[];t.links.forEach((function(i){var n=Math.atan2(i.x-t.x,i.y-t.y)+Math.PI;var o=Math.ceil(n/(2*C))*2*C;var r=Math.floor(n/(2*C))*2*C;e.push([i,o,Math.abs(n-o)]);e.push([i,r,Math.abs(n-r)])}));e.sort((function(t,e){return t[2]>e[2]?1:-1}));return[t,e]})).forEach((function(e){var i=e[0],o=e[1],r=i.x,a=i.y;i.x=Math.round(i.x/n)*n,i.y=Math.round(i.y/n)*n;for(var s=0;s<o.length;s++){var l=o[s],h=l[0];if(!t.getRoute(i.id,h.id)){var u=L(i,h,l[1],n,r,a),c=u[0],d=u[1],p=u[2],f=u[3];t.hasRoute(i.id,p,f)||t.isAligned(h.id)||(h.x+=c,h.y+=d,t.addRoute(i.id,h.id,p,f))}}})),S(e,i,i.filter((function(e){return!t.isAligned(e.id)})),n),o.forEach((function(e){t.isAligned(e.id)||(e.x=Math.round(e.x/n)*n,e.y=Math.round(e.y/n)*n),e.links.forEach((function(i){2==i.links.length&&M(e,i,t,n)}))})),0===o.length){var r=i[0],a=i[0].links[0];a.x=Math.round(a.x/n)*n,a.y=Math.round(a.y/n)*n,M(r,a,t,n)}}(t.routes,o.mx,o.n,o.size),t=function(t,e,i,n,o){var r=t.getNodes().length;return i.forEach((function(i){var a=i.g,s=i.root,h={root:a.getNodes()[0].id,itemPadding:n.itemPadding,levelPadding:n.levelPadding};(new l).layout(a,h);var u=function(t,e,i,n,o,r,a){return e.map((function(e){if(!e[2]&&!e[3]&&i.routes.hasRoute(o,e[0],e[1]))return null;var s=n.copy(),l=i.copy(),h=s.getRoot(),u=l.hash[o];s.rotate({x:-e[0],y:e[1]});var c=s.getBox(),d=c[0][1]-c[0][0],p=c[1][1]-c[1][0];!function(t,e,i,n,o,r,a,s){var l,h,u,c,d,p,f=e.x+(s[2]||s[0])*a,g=e.y+(s[3]||s[1])*a;if(E(t,f-a/2,f+a/2,g-a/2,g+a/2))return void V(t,f-a/2*s[0],g-a/2*s[1],i,n,s,a);if((s[0]?i:n)/a-1<=0)return;var m=.45*a;s[0]?(u=f+a/2*s[0],c=u+i*s[0],p=(d=g-n/2-m-r)+n+2*m):(c=(u=f-i/2-m-o)+i+2*m,d=g+a/2*s[1],p=d+n*s[1]);d>p&&(d=(l=[p,d])[0],p=l[1]);u>c&&(u=(h=[c,u])[0],c=h[1]);E(t,u,c,d,p)&&V(t,f,g,i,n,s,a)}(l,u,d,p,h.x-c[0][0]-d/2,h.y-c[1][0]-p/2,r,e),function(t,e,i,n,o,r){var a=i.x+o*(r[0]||r[2])-n.x,s=i.y+o*(r[1]||r[3])-n.y;e.translate({x:a,y:s}),t.importNodes(e.getNodes())}(l,s,u,h,r,e);var f=function(t,e){for(var i,n=e.length,o=0,r=0;r<n;r++){i=0,0;for(var a=e[r],s=t[a.isn],l=0;l<n;l++)if(a.isn!=l){var h=e[l],u=s[h.isn],c=.5/(u*u),d=a.x-h.x,p=a.y-h.y,f=Math.sqrt(Math.pow(d,2)+Math.pow(p,2));f&&(i+=c*(d-u*d/f),i+=c*(p-u*p/f))}o+=Math.sqrt(Math.pow(i,2)+Math.pow(0,2))}return o}(t,l.getNodes().slice(0,a));return{g:l,s:f,dir:e}})).reduce((function(t,e){return!t||e&&e.s<t.s?e:t}))}(e,I,t,a,s,o,r);if(u){t=u.g;var c=a.getRoot().id;return u.dir[2]||u.dir[3]||t.routes.addRoute(s,a.getRoot().id,u.dir[0],u.dir[1]),t.hash[s].links.push(t.hash[c]),void t.hash[c].links.push(t.hash[s])}console.log("Can't position sub tree")})),t}(t,o.mx,n.slice(1).sort(A),e,o.size)),t.setGlobalBox(),t},t}();function x(t,e){var i=t.getNodes(),n=0,o=0;return i.forEach((function(t,e){t.isn=e,n=Math.max(n,t.w,t.h),o+=t.w+t.h})),e.itemPadding=e.itemPadding||Math.round(o/(2*i.length)),n+=e.itemPadding,{n:i,mx:function(t){for(var e=[],i=t.getNodes(),n=0;n<i.length;n++){var o=e[n]=[];o[i[n].isn]=0,b(i[n],o,n,1)}return e}(t),size:n}}function b(t,e,i,n){for(var o=[t],r=[];o.length;){for(var a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.links.length;l++){var h=s.links[l],u=h.isn;u==i||e[u]||(e[u]=n,r.push(h))}n++,o=r,r=[]}}function _(t,e){var i=2*Math.PI/t.length,n=0,o=5*e;t.forEach((function(t,e){t.x=Math.round(Math.cos(n)*o),t.y=Math.round(Math.sin(n)*o),n+=i}))}function k(t,e,i,n){for(var o,r,a=0,s=0,l=0,h=0,u=e.length,c=i.length,d=0;d<c;d++){o=0,r=0;for(var p=i[d],f=t[p.isn],g=0;g<u;g++)if(p.isn!=g){var m=.5/((L=f[(M=e[g]).isn])*L),v=p.x-M.x,w=p.y-M.y;($=Math.sqrt(Math.pow(v,2)+Math.pow(w,2)))&&(o+=m*(v-n*L*v/$),r+=m*(w-n*L*w/$))}var y=Math.sqrt(Math.pow(o,2)+Math.pow(r,2));y>s&&(a=p.isn,s=y,l=o,h=r)}var x,b=0,_=0,k=0,S=e[a],C=t[a];for(g=0;g<u;g++)if(a!=g){m=.5/((L=C[(M=e[g]).isn])*L);var M,L,$,I=(v=S.x-M.x)*v,V=(w=S.y-M.y)*w;($=Math.sqrt(Math.pow(I+V,3)))&&(b+=m*(1-n*L*V/$),_+=m*n*L*w*v/$,k+=m*(1-n*L*I/$))}return[a,s,x=(-l/b+_*h/(k*b))/(1+_*_/(k*b)),(-h-_*x)/k]}function S(t,e,i,n){for(var o=0;o++<100;){var r=k(t,e,i,n),a=r[0],s=r[1],l=r[2],h=r[3];if(s<10)break;e[a].x+=l,e[a].y+=h}}var C=Math.PI/4;function M(t,e,i,n){for(;;){var o=e.links[0];if(o==t&&(o=e.links[1]),t=e,(e=o).links.length>2)break;for(var r=Math.atan2(e.x-t.x,e.y-t.y)+Math.PI,a=2*Math.ceil(r/(2*C))*C,s=2*Math.floor(r/(2*C))*C,l=Math.abs(r-a)<Math.abs(r-s)?[a,s]:[s,a],h=0;h<l.length;h++){var u=L(t,e,l[h],n,t.x,t.y),c=u[0],d=u[1],p=u[2],f=u[3];if(!i.hasRoute(t.id,p,f)){if(i.isAligned(e.id))return;e.x+=c,e.y+=d,i.addRoute(t.id,e.id,p,f);break}}}}function L(t,e,i,n,o,r){return i<=C||i>7*C?[t.x-e.x,$(t.y,e.y,r,n),0,-1]:i<=3*C&&i>C?[$(t.x,e.x,o,n),t.y-e.y,-1,0]:i<=5*C&&i>3*C?[t.x-e.x,$(t.y,e.y,r,n),0,1]:[$(t.x,e.x,o,n),t.y-e.y,1,0]}function $(t,e,i,n){var o=Math.sign(i-e);return t-e-(Math.round((i-e)/n)||o)*n}var I=[[0,1,0,0],[1,0,0,0],[-1,0,0,0],[0,-1,0,0]].concat([[0,1,-1,1],[-1,0,-1,1],[0,1,1,1],[1,0,1,1],[1,0,1,-1],[0,-1,1,-1],[-1,0,-1,-1],[0,-1,-1,-1]]);function V(t,e,i,n,o,r,a){t.getNodes().forEach((function(t){r[1]?Math.sign(t.y-i)==r[1]&&(t.y+=(o+a/2)*r[1]):r[0]&&Math.sign(t.x-e)==r[0]&&(t.x+=(n+a/2)*r[0])}))}function E(t,e,i,n,o){for(var r=t.getNodes(),a=0;a<r.length;a++){var s=r[a];if(s.x>=e&&s.x<=i&&s.y>=n&&s.y<=o)return!0}return!1}function A(t,e){var i=t.g.getNodes().length,n=e.g.getNodes().length;return i>n?-1:i===n?0:1}e.Graph=r,e.Hola=y,e.RadialTree=h,e.Router=s,e.SymmetricTree=l,e.compose=function(t,e){if(t.length<2)return t[0]||null;var i=t[0].getBox(),n=e.padding,o=t.reduce((function(t,o){var r=o.getBox();return o.translate({x:i[0][1]-r[0][0]+n,y:i[1][0]-r[1][0]}),t.importNodes(o.getNodes()),n+=e.padding+r[0][1]-r[0][0],t}));return t.length&&o.setGlobalBox(),o},e.decompose=function(t){for(var e=[],i=function(){var i={},n=t.getNodes();if(!n.length)return{value:e};!function t(e,i){i[e.id]=1,e.links.forEach((function(e){i[e.id]||t(e,i)}))}(n[0],i);var o=t.split((function(t){return!i[t.id]}));if(e.push(t),!o)return{value:e};t=o};;){var n=i();if("object"==typeof n)return n.value}}})),Et=(It=Vt)&&It.__esModule&&Object.prototype.hasOwnProperty.call(It,"default")?It.default:It;Vt.LineMode,Vt.Direction,Vt.Graph,Vt.Hola,Vt.RadialTree,Vt.Router,Vt.SymmetricTree,Vt.compose,Vt.decompose;webix.protoUI({name:"diagram",defaults:{zoom:1,scroll:"auto",autoplace:!0,treePadding:120,padding:20},$init:function(t){var e=this;this._html=document.createElement("DIV"),this.$view.className+=" webix_diagram",this._destroy_with_me=[],this.data.provideApi(this,!0),this.serialize=this._serialize,this._initLinks(t.links),this._initShapes(t.shapes),t.scheme=this._setScheme(t.scheme),this._dataobj=this.$view.querySelector(".webix_scroll_cont"),this._dataobj.innerHTML='\n\t\t\t<div class="webix_diagram_shapes" style="position:absolute;"></div>\n\t\t\t<svg class="webix_diagram_links" width="100%" height="100%" style="overflow:visible"></svg>',this._links_layer=this._dataobj.querySelector(".webix_diagram_links"),this._shapes_layer=this._dataobj.querySelector(".webix_diagram_shapes"),this.$blockRender=!0,webix.promise.all([this.data.waitData,this._links.waitData]).then((function(){e.$blockRender=!1,e.data.callEvent("onStoreUpdated",[])})),this.data.attachEvent("onStoreUpdated",(function(){return e.render()})),this.types||(this.types={default:this.type},this.type.name="default"),this.type=webix.clone(this.type),this.linkType=webix.clone(this.linkType),this.$ready.push(this._afterInit)},_id:"webix_dg_id",on_click:{webix_diagram_item:function(t){if(this.config.select){var e=this.locate(t);return"multiselect"==this.config.select||this.config.multiselect?this.select(e,!1,t.ctrlKey||t.metaKey||"touch"==this.config.multiselect,t.shiftKey):this.select(e),!1}}},on_context:{},on_dblclick:{},_line_modes:{direct:1,edges:2,child:3,sibling:4,curve:2},links_setter:function(t){t&&!this._skipLinksSetter&&this._loadLinks(t),this._skipLinksSetter=!1},_afterInit:function(){var t=this.config;this._dataobj.style.position="relative",this._dataobj.style.margin=(t.paddingY||t.padding)+"px "+(t.paddingX||t.padding)+"px",this.attachEvent("onDestruct",(function(){this._dataobj=this._html=this._htmlmap=this._links_layer=this._shapes_layer=null,this._shapes=this._links=this._links_map=this._shapeTemplates=null;for(var t=0;t<this._destroy_with_me.length;t++)this._destroy_with_me[t].destructor()}))},getItemNode:function(t){if(this._htmlmap)return this._htmlmap[t];this._htmlmap={};for(var e=this._shapes_layer.childNodes,i=0;i<e.length;i++){var n=e[i].getAttribute(this._id);n&&(this._htmlmap[n]=e[i])}return this.getItemNode(t)},locate:function(t){return webix.html.locate(t,this._id)},_toHTMLObject:function(t){return this._html.innerHTML=this._toHTMLItem(t),this._html.firstChild},$getSize:function(t,e){var i=this.config;return i.autowidth&&(t=this._dataobj.offsetWidth+(i.paddingX||i.padding)+(this._dataobj.offsetHeight>e&&!i.autoheight?webix.env.scrollSize:0)),i.autoheight&&(e=this._dataobj.offsetHeight+2*(i.paddingY||i.padding)+(this._dataobj.offsetWidth>t&&!i.autowidth?webix.env.scrollSize:0)),webix.ui.baseview.prototype.$getSize.call(this,t,e)},$setSize:function(t,e){webix.ui.baseview.prototype.$setSize.call(this,t,e)&&this.render()},_set_dataobj_size:function(t){var e=this.config,i=t[0][1],n=t[1][1];i=e.zoom>1?i+(e.paddingX||e.padding)/e.zoom:i*e.zoom,e.autoheight||(n=e.zoom>1?n+(e.paddingY||e.padding)/e.zoom:n*e.zoom),this._dataobj.style.width=i+"px",this._dataobj.style.height=n+"px",this._dataobj.style.transform="scale("+e.zoom+")"},linkItem_setter:function(t){this.linkType_setter(t)},linkType_setter:function(t){if(t&&"object"==typeof t)for(var e in t)0===e.indexOf("template")?this.linkType[e]=webix.template(t[e]):this.linkType[e]=t[e]},_link_id:"webix_dg_link_id",_arrow_id:"webix_dg_arrow_id",_shadow_id:"webix_dg_shadow_id",getLinkItemNode:function(t,e){var i;if(this._links_map||(this._links_map={}),this._links_map[t])i=this._links_map[t];else{var n=this._links_layer;(i=this._links_map[t]={link:n.querySelector("["+this._link_id+'="'+t+'"]'),arrow:n.querySelector("["+this._arrow_id+'="'+t+'"]')}).shadow=this.linkType.shadow?n.querySelector("["+this._shadow_id+'="'+t+'"]'):null}return e?i[e]:i},linkType:{css:"",mode:"edges",shadow:!1,arrow:!1,arrowCss:"",arrowSize:6,classname:function(t,e,i){var n="css"==i?"webix_diagram_link":"webix_diagram_arrow";e[i]&&(n+=" "+e[i]),t[i="$"+i]&&("object"==typeof t[i]&&(t[i]=webix.html.createCss(t[i])),n+=" "+t[i]);var o=this.getLinks().data.getMark(t.id,"$css");return o&&(n+=o),n},getStyle:function(t,e,i){return bt(t,e,i)},templateLine:function(t){if(!t.line||!t.line.length)return"";var e=t.diff||0,i=t.line.map((function(t){return webix.isArray(t)?[Math.ceil(t[0]+e),Math.ceil(t[1]+e)].join(","):t})).join(" ");return"<"+(t.type||"polyline")+" "+(t.attrs||"")+' points="'+i+'" '+(t.css?'class="'+t.css+'" ':"")+" "+(t.style?'style="'+t.style+'"':"")+"/>"},templateCurve:function(t){if(!t.line||!t.line.length)return"";var e=t.line.map((function(t){return webix.isArray(t)?t:t.split(",")})),i=dt(e),n=i.d,o=i.points,r=e[e.length-1].join(",");return"<path "+(t.attrs||"")+' d="'+n+'" data-points="'+o+'"  data-point="'+r+'"'+(t.css?'class="'+t.css+'" ':"")+" "+(t.style?'style="'+t.style+'"':"")+"/>"},templateShadow:function(t,e,i){webix.isArray(t.line)&&(i=t.line);var n=this.getLinks().data.getMark(t.id,"$css")||"",o={line:i,diff:e.shadow/2,attrs:this._shadow_id+'="'+t.id+'"',css:"webix_diagram_link_shadow"+n,style:"stroke-width:"+((t.lineWidth||1)+e.shadow)+";"};return this.isCurveLink(t)?e.templateCurve.call(this,o,e):e.templateLine.call(this,o,e)},templateLink:function(t,e,i){webix.isArray(t.line)&&(i=t.line);var n={line:i,attrs:this._link_id+'="'+t.id+'"',css:e.classname.call(this,t,e,"css"),style:e.getStyle.call(this,t,"line",e)};return this.isCurveLink(t)?e.templateCurve.call(this,n,e):e.templateLine.call(this,n,e)},templateArrow:function(t,e,i){webix.isArray(t.arrow)&&(i=t.arrow);var n={line:i,attrs:this._arrow_id+'="'+t.id+'"',css:e.classname.call(this,t,e,"arrowCss"),style:e.getStyle.call(this,t,"arrow",e)};return"triangle"==(webix.isUndefined(t.arrow)?e.arrow:t.arrow)&&(n.type="polygon"),e.templateLine.call(this,n,e)}},autoPlace:function(t){this.config.autoplace||(this._links.data.each((function(t){["line","from","to"].forEach((function(e){return delete t[e]})),webix.isArray(t.arrow)&&(t.arrow=!0)})),this._renderGraph(!0,t))},template_setter:function(t){this.type.template=webix.template(t)},customize:function(t){webix.type(this,t)},item_setter:function(t){return this.type_setter(t)},type_setter:function(t){return this.types[t]?(this.type=webix.clone(this.types[t]),this.type.css&&(this.$view.className+=" "+this.type.css)):this.customize(t),this.type.on_click&&webix.extend(this.on_click,this.type.on_click),t},type:{width:gt,height:mt,margin:20,marginX:0,marginY:0,listMarginX:20,type:"default",classname:function(t,e){var i="webix_diagram_item",n=this.getItemValue(t.id,"$css");n&&("object"==typeof n&&(n=webix.html.createCss(n)),i+=" "+n);var o=t.type||e.type||"default",r=this.getShape(o);r&&r.template&&this._shapeTemplates[r.template]&&o!=r.template&&(i+=" webix_diagram_item_"+r.template),i+=" webix_diagram_item_"+o,e.css&&("function"==typeof e.css?i+=" "+e.css.call(this,t,e):i+=" "+e.css);var a=this.data.getMark(t.id,"$css");return a&&(i+=a),i},getStyle:function(t,e,i){return bt(t,e,this.getShape(t.type||i.type))},template:function(t){return t.value||""},templateShape:function(t,e){var i,o=this.getShape(t.type||e.type),r="";if(o&&o.template){var a=o.template,s=this._shapeTemplates[a];if(s&&(a=s.template),"function"==typeof a){var l=n({height:e.height,width:e.width-(t.$list?e.listMarginX:0)},o);delete l.name,r=a(n(n({},l),t))}else a&&(r=a);var h=(s||o).svg;if(void 0===h&&(h=r.toLowerCase().includes("<svg")),h)(i=e.getStyle.call(this,t,"svg",e))&&(r=r.replace(/(<\s*svg)/i,"$1 style='"+i+"'")),(i=e.getStyle.call(this,t,"alt",e))&&(r=r.replace(/(class='webix_diagram_shape_alt')/gi,"$1 style='"+i+"'"));else{var u=-1!=r.indexOf("webix_diagram_shape_text")?"textBlock":"block";(i=e.getStyle.call(this,t,u,e))&&(r=r.replace(/(<\s*\w+)/i,"$1 style='"+i+"'"))}}return r},templateTextStart:function(t,e){return"<div class='webix_diagram_text' style='"+e.getStyle.call(this,t,"text",e)+"'><span class='webix_diagram_text_inner'>"},templateStart:function(t,e){var i=this._getItemSize(t,!0),n=t.$list?e.listMarginX:0,o="width:"+i.width+"px;height:"+i.height+"px;";return o+="top:"+1*t.y+"px;left:"+(1*t.x+n)+"px;",o+=e.getStyle.call(this,t,"rotation",e),'<div webix_dg_id="'+t.id+'" class="'+e.classname.call(this,t,e)+'" style="'+o+'">'+e.templateShape.call(this,t,e)+e.templateTextStart.call(this,t,e)},templateTextEnd:webix.template("</span></div>"),templateEnd:webix.template("{common.templateTextEnd()}</div>")},_initLinks:function(t){var e=this;t&&(this._skipLinksSetter=!0),t&&t.getItem?this._links=t:(this._links=new webix.DataCollection({scheme:this._setScheme()}),this._destroy_with_me.push(this._links),this._loadLinks(t)),this._links.data.attachEvent("onStoreUpdated",(function(){return e.render()}))},_loadLinks:function(t){t&&"string"==typeof t?this._links.load(t,this.config.datatype):this._links.parse(t||[],this.config.datatype)},getLinks:function(){return this._links},_toHTMLItem:function(t){return this.callEvent("onItemRender",[t]),this.type.templateStart.call(this,t,this.type)+this.type.template.call(this,t,this.type)+this.type.templateEnd.call(this,t,this.type)},render:function(t,e,i){if(this.isVisible(this.config.id)&&!this.$blockRender){if("update"==i){var n=this.getItemNode(t),o=this._htmlmap[t]=this._toHTMLObject(e);return webix.html.insertBefore(o,n),webix.html.remove(n),!0}return this._renderGraph(),!0}},_renderGraph:function(t,e){var i={full:!0,root:e||this.config.root,preserveLocation:!t&&!this.config.autoplace,itemPadding:this.type.marginX||this.type.margin};if(this.callEvent("onBeforeRender",[this.data])){this._htmlmap=this._links_map=null;var n=this._buildGraph(i);n.clean();var o=this._layoutGraph(n,i);this._showGraph(o[0],o[1],i);var r=o[0].getNodes().length?o[0].getBox():[[0,0],[0,0]];this._set_dataobj_size(r),this.callEvent("onAfterRender",[])}},getItemValue:function(t,e){var i=this.getItem(t),n=i[e=e||"value"];webix.isUndefined(n)&&(n=(this.getShape(i.type||this.type.type)||{})[e]);return n},_getItemSize:function(t,e){var i=this.type.width;e&&t.$list&&(i-=this.type.listMarginX);var n="auto"===t.width?t.width:1*t.width,o="auto"===t.height?t.height:1*t.height,r=this.getShape(t.type||this.type.type)||{};return{width:n||r.width||i,height:o||r.height||this.type.height}},adjustItem:function(t,e){e="width"==e?e:"height";var i=this.data.getItem(t);i[e]="auto",this._calcItemSize(i),this.data.updateItem(t)},_calcItemSize:function(t){var e=this.getShape(t.type||this.type.type)||{},i=this._getItemSize(t);i.width==i.height&&"auto"==i.width&&(webix.isUndefined(e.height)||"auto"==e.height?"auto"!=this.type.height?t.height=i.height=this.type.height:t.height=i.height=this.type.__proto__.height:t.height=i.height=e.height);var n="auto"==i.width?"width":"auto"==i.height?"height":null;if(n){var o=webix.html.create("DIV",{class:"webix_view webix_diagram_measure_size "+this.type.classname.call(this,t,this.type),style:"visibility:hidden;position:absolute;top:0px;left:0px;width:"+i.width+"px;height:"+i.height+"px"});o.style[n]="auto",document.body.appendChild(o);var r=this.type.template.call(this,t,this.type);o.innerHTML=r?this.type.templateTextStart.call(this,t,this.type)+r+this.type.templateTextEnd.call(this,t,this.type):this.type.templateShape.call(this,t,this.type),t[n]=i[n]=o["width"==n?"offsetWidth":"offsetHeight"]+1,webix.html.remove(o)}return i},_buildGraph:function(t){var e=this,i=new Et.Graph,n=0,o=0;t.preserveLocation&&(this._links.data.each((function(t){t.line&&t.line.forEach((function(t){n=Math.min(t[0],n),o=Math.min(t[1],o)}))})),(n||o)&&this._links.data.each((function(t){t.line&&t.line.forEach((function(t){t[0]-=n,t[1]-=o}))})));var r=0;return this.data.each((function(a){var s=e._calcItemSize(a),l={id:String(a.id),w:s.width,h:s.height};r=Math.max(r,s.width,s.height),t.preserveLocation&&(a.x-=n,a.y-=o,webix.extend(l,{x:1*a.x+l.w/2,y:1*a.y+l.h/2})),i.addNode(l),delete a.$list})),t.levelPadding=r+(this.type.marginY||this.type.margin),this._links.data.each((function(t){i.hash[t.source]&&i.hash[t.target]&&i.addEdge(t.source,t.target)})),i},_layoutGraph:function(t,e){var i,n=this;if(e.preserveLocation)(i=t).setGlobalBox();else{var o=new Et.Hola(e);i=Et.compose(Et.decompose(t).map((function(t){return t=o.layout(t,e),e.full||t.setGlobalBox(),t})),{padding:this.config.treePadding})}if(!i)return[t,[]];if(!e.preserveLocation){var r=i.getBox();i.translate({x:-r[0][0],y:-r[1][0]})}var a=new Et.Router({mode:1==this._line_modes[this.linkType.mode]?1:2,padding:this.type.listMarginX/2});return i.nodes.forEach((function(t){return a.addShape(String(t.id),t.x-t.w/2,t.y-t.h/2,t.x+t.w/2,t.y+t.h/2)})),this._links.data.each((function(t){i.hash[t.source]&&i.hash[t.target]&&(a.addConnector(String(t.id),String(t.source),String(t.target),n._line_modes[t.mode]),4==n._line_modes[t.mode]?(n.data.getItem(t.source).$list=!0,n.data.getItem(t.target).$list=!0):3==n._line_modes[t.mode]&&(n.data.getItem(t.target).$list=!0))})),[i,a.finalize(Et.Direction.Bottom)]},_showGraph:function(t,e,i){var n=this,o="";this.data.each((function(e){if(!i.preserveLocation){var r=t.getNode(e.id);e.x=r.x-r.w/2,e.y=r.y-r.h/2}o+=n._toHTMLItem(e)})),this._shapes_layer.innerHTML=o,o="";var r=this._links.data.find((function(t){return!(t.source&&t.target)&&t.line}))||[];(e=e.concat(r)).forEach((function(t){var e=n._links.getItem(t.id);(e.from||e.to||n.isCurveLink(e))&&!webix.isArray(e.line)&&(t.c_line=t.line=ot(n,e,e.from,e.to)),n.linkType.shadow&&(o+=n.linkType.templateShadow.call(n,e,n.linkType,t.line)),o+=n.linkType.templateLink.call(n,e,n.linkType,t.line),e.labels&&n._arrangeLinkLabel(e,t)})),e.forEach((function(t){var e=n._links.getItem(t.id);if(webix.isUndefined(e.arrow)?n.linkType.arrow:e.arrow){var i={correction:1,width:0,height:0,mode:null},r=t.line;webix.isArray(e.line)&&e.line.length>1?(i.correction=0,r=e.line.map((function(t){return(t=webix.isArray(t)?t:t.split(",")).map((function(t){return 1*t}))}))):t.c_line&&(i.correction=0);var a=r.length,s=r[--a],l=r[--a];if(n.isCurveLink(e)&&(i.mode="curve",l=function(t,e,i,n){for(var o=[],r=0;r<2;)o[r]=(1-n)*(1-n)*t[r]+2*(1-n)*n*e[r]+n*n*i[r],r++;return o}(r[a-1]||l,l,s,.9)),i.correction){var h=n.getItem(e.target);for(webix.extend(i,n._getItemSize(h,!0),!0);l&&!n._check_point(l,h,i);)s=l,l=r[--a]}i.x=s[0],i.y=s[1],l?"curve"==i.mode&&Math.round(l[0])!=Math.round(s[0])?(i.x0=l[0],i.y0=l[1]):l[0]==s[0]?(i.mode="height",i.k=l[1]<s[1]?-1:1):l[1]==s[1]?(i.mode="width",i.k=l[0]<s[0]?-1:1):(i.mode="direct",i.x0=l[0],i.y0=l[1]):i.mode=null,o+=n.linkType.templateArrow.call(n,e,n.linkType,i.mode&&n._get_arrow(e,i))}})),this._links_layer.innerHTML=o},_check_point:function(t,e,i){return t[0]<e.x||t[0]>e.x+i.width||t[1]<e.y||t[1]>e.y+i.height},_get_arrow:function(t,e){var i=t.arrowSize||this.linkType.arrowSize,n=Math.ceil(i/Math.sqrt(3));if("height"==e.mode)return e.y+=e.correction*e.k*e[e.mode]/2,[[e.x-n,e.y+e.k*i],[e.x,e.y],[e.x+n,e.y+e.k*i]];if("width"==e.mode)return e.x+=e.correction*e.k*e[e.mode]/2,[[e.x+e.k*i,e.y-n],[e.x,e.y],[e.x+e.k*i,e.y+n]];if("direct"==e.mode||"curve"==e.mode){var o,r,a,s,l,h,u,c,d,p,f,g=void 0,m=void 0;return r=e.height/2,o=(s=Math.abs(e.x-e.x0)/(Math.abs(e.y-e.y0)||1))*r,g=e.x,m=e.y,"direct"==e.mode&&(g+=o*(e.x<e.x0?1:-1),m+=r*(e.y<e.y0?1:-1)),l=-n,h=(d=e.y0<e.y?-1:1)*i,u=n,c=d*i,a=Math.atan(s),p=d*(e.x<e.x0?1:-1),f=d*(e.x<e.x0?-1:1),"direct"==e.mode&&(g<e.x-e.width/2?(g=e.x-e.width/2,m=e.y+d*e.width/2*Math.tan(Math.PI/2-a)):g>e.x+e.width/2?(g=e.x+e.width/2,m=e.y+d*e.width/2*Math.tan(Math.PI/2-a)):t.line||(m+=e.y<e.y0?1:-1,g+=(e.x<e.x0?1:-1)*s)),[[g+l*Math.cos(a)+p*h*Math.sin(a),m+h*Math.cos(a)+f*l*Math.sin(a)],[g,m],[g+u*Math.cos(a)+p*c*Math.sin(a),m+c*Math.cos(a)+f*u*Math.sin(a)]]}},_arrangeLinkLabel:function(t,e){var i=this;"string"==typeof t.labels&&(t.labels=t.labels.split(",").map((function(t){return t.trim()})));var o=[];t.labels.forEach((function(r){var a=i.getItem(r);if(a){o.push(r),a.$link=t.id,a.type=a.type||"label";var s=ut(i,n(n({},t),{line:e.line}),a);a.x=s.x+(a.dx||0),a.y=s.y+(a.dy||0),i.render(r,a,"update")}})),t.labels=o},_initShapes:function(t){var e;this.$scope&&this.$scope.app&&"diagram-editor"===this.$scope.app.config.view?(e=this.$scope.app.getService("local"),this._shapes=e.shapes()):(e=new _t({},t),this._shapes=e.shapes(),this._destroy_with_me.push(this._shapes)),this._shapeTemplates=e.getShapeTemplate(!0)},addShape:function(t,e){return this.getShape(t)?null:(e.id=t,e.name=t,this._shapes.add(e))},setShape:function(t,e){this.getShape(t)&&this._shapes.updateItem(t,e)},getShape:function(t){return this._shapes.getItem(t)},getShapes:function(){return this._shapes},_serialize:function(t){return t?{data:this.data.serialize(),shapes:this._shapes.serialize(),links:this._links.serialize(),item:webix.copy(this.type),linkItem:webix.copy(this.linkType)}:this.data.serialize()},$onLoad:function(t){return t.data&&(t.shapes&&this._shapes.parse(t.shapes),t.links&&this._links.parse(t.links),webix.extend(this.type,t.item||{},!0),webix.extend(this.linkType,t.linkItem||{},!0)),!1},_exportScheme:function(t){var e={};for(var i in t)if(i.indexOf("$")<0||"$link"==i){if(webix.isUndefined(t[i]))continue;webix.isArray(t[i])?e[i]=webix.copy(t[i]):e[i]=t[i]}return e},_setScheme:function(t){return t||(t={}),t.$serialize=t.$serialize||this._exportScheme,t.$export=t.$export||this._exportScheme,t},isCurveLink:function(t){return"curve"==(t.mode||this.linkType.mode)}},webix.AutoTooltip,webix.DataMarks,webix.SelectionModel,webix.MouseEvents,webix.Scrollable,webix.DataLoader,webix.ui.baseview,webix.EventSystem),webix.protoUI({name:"diagram-icon-toggle",$cssName:"icon",defaults:{icons:["dgi-shape-square-plus","dgi-ray-start-arrow"]},$init:function(){this.attachEvent("onItemClick",(function(){this.toggle("user")}))},$prepareValue:function(t){var e=this.config.icon=this.config.icons[t?1:0],i=this.$view.querySelector(".webix_icon");return i&&(i.className="webix_icon "+e),t},toggle:function(t){this.setValue(!this.getValue(),t)}},webix.ui.icon);var At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"window",head:!1,autofit:!1,body:{padding:4,margin:4,cols:[{view:"icon",batch:"all",icon:"dgi-content-copy",click:function(){return t.CallAction("clone")}},{view:"diagram-icon-toggle",batch:"all",localId:"mode",on:{onItemClick:function(){return t.CallAction("mode",t.$$("mode").getValue())}}},{view:"icon",icon:"wxi-trash",click:function(){return t.CallAction("remove")}}]}}},e.prototype.init=function(t){this.Window=t},e.prototype.CallAction=function(t,e){var i={name:t,value:e};this.app.callEvent("context:action",[i])},e.prototype.Show=function(t,e,i,n){var o;if(this.Window.getBody().showBatch(e||i.linkLabel?"none":"all"),e)if(i.e){var r=webix.html.offset(i.view);o={x:(o=webix.html.pos(i.e)).x-r.x+i.scroll.x+16,y:o.y-r.y+i.scroll.y+4}}else{var a=void 0;if(i.node.points){var s=i.node.points;a=s[2==s.length?1:s.length-1]}else{var l=i.node.getAttribute("data-point").split(",");a={x:l[0],y:l[1]}}o={x:a.x*n+i.px-8-this.Window.$width,y:a.y*n+i.py+4}}else{this.$$("mode").setValue(i.value,"auto");a=this.GetBlockPosition(t,i);o={x:Math.max(2,a.x*n+i.px),y:Math.max(2,a.y*n+i.py-a.dy)}}this.Window.show(o)},e.prototype.Hide=function(){this.Window.hide()},e.prototype.GetBlockPosition=function(t,e){var i,n={x:t.x-5,y:t.y-5,dy:this.Window.$height+8};if(e.angle){var o=parseInt(e.node.style.width)/2,r=parseInt(e.node.style.height)/2,a=t.x+o,s=t.y+r;Math.floor(e.angle/90)%2&&(o=(i=[r,o])[0],r=i[1]);var l=Math.sqrt(Math.pow(o+5,2)+Math.pow(r+5,2)),h=1.5*Math.PI-Math.atan(o/r)+e.angle%90*Math.PI/180;3==Math.floor(e.angle%360/90)&&(h+=Math.PI,n.dy=-8),n.x=a+l*Math.cos(h),n.y=s+l*Math.sin(h)}return n},e}(u),Tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.app.getState(),this._=this.app.getService("locale")._;var e=webix.skin.$active,i={view:"diagram",css:"webix_de_diagram"+(webix.env.touch?" webix_de_touch_diagram":""),padding:e.inputHeight+34,autoplace:!1,select:!0,data:this.app.config.data,links:this.app.config.links,shapes:this.app.config.shapes,scheme:this.app.config.scheme,type:{template:function(e,i){return t.TemplateValue(e,i)},templateTextEnd:function(e,i){return t.TemplateSelection(e,i)}},linkType:{shadow:2},on:{onAfterSelect:function(e){t.State.selected={id:e}}},onClick:{webix_window:function(){return!1},webix_c_scroll_x:function(){return!1},webix_c_scroll_y:function(){return!1},webix_diagram:function(e,i){i||(t.State.selected=null)},webix_diagram_link:function(e){var i=webix.html.locate(e,"webix_dg_link_id");return t.SelectLink(i,e),!1},webix_diagram_arrow:function(e){var i=webix.html.locate(e,"webix_dg_arrow_id");return t.SelectLink(i,e),!1},webix_diagram_link_shadow:function(e){var i=webix.html.locate(e,"webix_dg_shadow_id");return t.SelectLink(i,e),!1}}};return this.app.config.type&&webix.extend(i.type,this.app.config.type),i},e.prototype.init=function(t){var e=this;this.View=t;var i=this.app.config,n=i.minItemWidth,o=i.minItemHeight;this.UpdateCommonValue({width:Math.max(n,t.type.width),height:Math.max(o,t.type.height)},"type",!0),this.app.getService("styles").connect(t),this.History=this.app.getService("history"),this.Local=this.app.getService("local"),this.Local.connect(t,this.History),this.History.connect(this,this.Local),this.on(t,"onAfterUnSelect",(function(e){t.removeCss(e,"webix_de_connect_start")})),this.on(t,"onAfterRender",(function(){return e.AfterRender()})),this.on(this.app,"toolbar:autoplace",(function(){return e.Autoplace()})),this.Context=this.ui(At,{container:t.$view}),this.on(this.app,"context:action",(function(t){return e.Action(t)})),this.on(this.State.$changes,"selected",(function(t){return e.TrackSelection(t)})),this.on(this.app,"form:update",(function(t,i){return e.ApplyChanges(t,i)})),this.on(this.app,"form:action",(function(t){var i=e.State.selected.id;"swap"==t?e.SwapLinkDirection(i):"addLabel"==t&&e.AddLinkLabel(i)})),this.on(this.State.$changes,"zoom",(function(t,i){return e.Zoom(t,i)})),this.on(this.State.$changes,"gridStep",(function(t){return e.DrawGrid(t)})),this.on(this.app,"toolbar:preview",(function(t){return e.DrawGrid(e.State.gridStep,t)})),this._scroll_handler=webix.event(this.View.$view,"scroll",(function(){e.SetGridBgPosition()})),this.InitTempLink(),function(t,e){var i=webix.copy(Ct);i.view=e,i.master=t,i.State=t.app.getState(),i.Local=t.Local,webix.DragControl.addDrag(e.$view,i),webix.DragControl.addDrop(e.$view,i,!0)}(this,t),this.AddHotkeys(),this._md_handler=webix.event(this.View.$view,"mousedown",(function(t){return e.MouseDownHandler(t)})),this._wheel_handler=webix.event(this.View.$view,"wheel",(function(t){return e.WheelHandler(t)}),{passive:!1})},e.prototype.destroy=function(){this._scroll_handler=webix.eventRemove(this._scroll_handler),this._md_handler=webix.eventRemove(this._md_handler),this._wheel_handler=webix.eventRemove(this._wheel_handler)},e.prototype.AfterRender=function(){var t=this.State.selected;if(t){var e=this.GetItem(t.id,t.link);if(!e)return this.State.selected=null;this.ShowContext(e,t.link),t.link&&this.ShowLinkPath(t.id),this.app.callEvent("diagram:syncform",[e])}else this.app.callEvent("values:defaults",[])},e.prototype.ShowContext=function(t,e,i){if(!t){var n=this.State.selected;if(!n)return;e=n.link,t=this.GetItem(n.id,e)}var o=this.GetContextConfig(t,e,i);this.Context.Show(t,e,o,this.State.zoom)},e.prototype.GetContextConfig=function(t,e,i){var n=this.View.config,o={e:i,px:n.paddingX||n.padding||0,py:n.paddingY||n.padding||0};return e?o.e?(o.view=this.View.$view,o.scroll=this.View.getScrollState()):o.node=this.View.getLinkItemNode(t.id,"link"):(o.value=this.View.data.getMark(t.id,"webix_de_connect_start"),o.angle=this.View.getItemValue(t.id,"angle"),o.angle&&(o.node=this.View.getItemNode(t.id)),t.$link&&(o.linkLabel=!0)),o},e.prototype.HideContext=function(){this.Context.Hide()},e.prototype.TemplateSelection=function(t,e){var i=this.View.getShape(t.type||e.type)||{},n=1*t.width||i.width||e.width,o=1*t.height||i.height||e.height,r=2*Math.ceil(5/Math.max(.5,this.View.config.zoom));return'</span></div>\n\t\t<div class="webix_de_selection_layer" style="'+("width:"+(n+r)+"px;height:"+(o+r)+"px;")+'">\n\t\t\t<div webix_resizer="top,left" class="webix_de_resize webix_de_top_left"></div>\n\t\t\t<div webix_connector="left" class="webix_de_connect webix_de_left"></div>\n\t\t\t<div webix_resizer="bottom,left" class="webix_de_resize webix_de_bottom_left"></div>\n\t\t\t<div webix_connector="top" class="webix_de_connect webix_de_top"></div>\n\t\t\t<div webix_connector="center" class="webix_de_connect webix_de_center"></div>\n\t\t\t<div webix_connector="bottom" class="webix_de_connect webix_de_bottom"></div>\n\t\t\t<div webix_resizer="top,right" class="webix_de_resize webix_de_top_right"></div>\n\t\t\t<div webix_connector="right" class="webix_de_connect webix_de_right"></div>\n\t\t\t<div webix_resizer="bottom,right" class="webix_de_resize webix_de_bottom_right"></div>\n\t\t\t<div class="webix_de_rotate"></div>\n\t\t</div>'},e.prototype.GridTemplate=function(t,e){e||(e="contrast"==webix.skin.$name||"dark"==webix.skin.$name?"#777":"#c4c4c4");var i=t<3?.2:.5;return'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><pattern id="webixDiagramPattern"  width="'+t+'" height="'+t+'" patternUnits="userSpaceOnUse"><circle cx="0" cy="0" r="'+i+'" fill="'+e+'" /><circle cx="'+t+'" cy="0" r="'+i+'" fill="'+e+'" /><circle cx="0" cy="'+t+'" r="'+i+'" fill="'+e+'" /><circle cx="'+t+'" cy="'+t+'" r="'+i+'" fill="'+e+'" /></pattern><rect x="0" y="0" width="100%" height="100%" fill="url(#webixDiagramPattern)" /></svg>'},e.prototype.TemplateValue=function(t,e){var i=this.app.config,n=i.template||(i.type?i.type.template:null);return n?n.call(this,t,e):t.value||""},e.prototype.InitTempLink=function(){var t=this.TempLink=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS(null,"width","100%"),t.setAttributeNS(null,"height","100%"),t.classList.add("webix_de_temp_line"),t.innerHTML="<polyline points='' />",this.View.$view.querySelector(".webix_scroll_cont").appendChild(t)},e.prototype.TrackSelection=function(t){if(t){var e=t.id,i=t.link,o=n({},this.GetItem(e,i));i?this.View.unselectAll():this.UnselectLink(),this.ShowContext(o,i,t.e),this.app.callEvent("diagram:select",[o,i])}else this.View.unselectAll(),this.UnselectLink(),this.HideContext(),this.app.callEvent("diagram:select",[])},e.prototype.SelectLink=function(t,e){var i=this.SelectedLink;if(t&&t!=i){this.UnselectLink(),this.SelectedLink=t;var n=this.View.getLinkItemNode(t);n.link&&n.link.classList.add("webix_selected"),n.arrow&&n.arrow.classList.add("webix_selected"),n.shadow&&n.shadow.classList.add("webix_selected"),this.View.getLinks().data.addMark(t,"webix_selected",!0,!0,!0),this.State.selected={id:t,e:e,link:!0},this.ShowLinkPath(t,n.link.points)}},e.prototype.UnselectLink=function(){var t=this.SelectedLink;if(t){var e=this.View.getLinks();if(e.exists(t)){var i=this.View.getLinkItemNode(t);i.link&&i.link.classList.remove("webix_selected"),i.arrow&&i.arrow.classList.remove("webix_selected"),i.shadow&&i.shadow.classList.remove("webix_selected"),e.data.removeMark(t,"webix_selected",!0,!0)}this.SelectedLink=null,this.ShowLinkPath()}},e.prototype.ShowLinkPath=function(t,e){var i="<polyline points='' />",n=this.View.getLinks();if(t&&n.exists(t)){var o=this.View.getLinkItemNode(t,"link").points;if(!o)return this.ShowCurveLinkPath(t,e);(e=e||o)[0]&&webix.isArray(e[0])&&(e=e.map((function(t){return{x:t[0],y:t[1]}})));var r=!n.getItem(t).source,a=0;i+=this.TemplateLinkDots(0,e[0],"dot","webix_de_first_dot");for(var s=1;s<e.length;s++){a++;var l=e[s],h=e[s-1];if(r){var u=ct([l.x,l.y],[h.x,h.y]);i+=this.TemplateLinkDots(a,{x:u[0],y:u[1]},"dot-n"),a++}else{var c=void 0,d=void 0,p=void 0;l.x==h.x&&(p=Math.abs(l.y-h.y))>=30?(c="line-v",d={x:l.x-4,y:Math.min(l.y,h.y)+p/2-8}):l.y==h.y&&(p=Math.abs(l.x-h.x))>=30&&(c="line-h",d={x:Math.min(l.x,h.x)+p/2-8,y:l.y-4}),c&&(i+=this.TemplateLinkDots([s-1,s].join(","),d,c))}var f=s==e.length-1?"webix_de_last_dot":"";i+=this.TemplateLinkDots(s,l,"dot",f)}}this.TempLink.innerHTML=i},e.prototype.ShowCurveLinkPath=function(t,e){var i,n="<polyline points='' />";i=e||(i=this.View.getLinkItemNode(t,"link").getAttribute("data-points")).split(" ").map((function(t){return t.split(",").map((function(t){return 1*t}))}));for(var o=0,r=0;r<i.length;r++){var a=i[r],s="";r==i.length-1?s="webix_de_last_dot":r%2?s="webix_de_curve_dot1":(s=" webix_de_curve_dot0",r||(s+=" webix_de_first_dot")),s&&(n+=this.TemplateLinkDots(o,{x:1*a[0],y:1*a[1]},"dot",s),o++)}this.TempLink.innerHTML=n},e.prototype.TemplateLinkDots=function(t,e,i,n){var o,r,a=this.View.linkType.shadow/2;return"dot"==i||"dot-n"==i?(o="circle",r='cx="'+(e.x+a)+'" cy="'+(e.y+a)+'"'):(o="rect",r='x="'+(e.x+a)+'" y="'+(e.y+a)+'"'),"<"+o+" "+r+' webix_link_path="'+t+'" class="webix_de_link_'+i+" "+(n||"")+'" />'},e.prototype.Action=function(t){var e=this;if("clone"==t.name){var i=this.State.selected.id,o=this.CloneBlock(i);this.View.select(o)}else if("remove"==t.name){if(this.State.selected){var r=this.State.selected;i=r.id;(a=r.link)?this.Local.removeLink(i):this.Local.removeBlock(i)}}else if("mode"==t.name){i=this.State.selected.id;t.value?this.View.addCss(i,"webix_de_connect_start"):this.View.removeCss(i,"webix_de_connect_start")}else if("temp-link"==t.name){var a=this.TempLink.firstChild;if(t.start){var s=t.start.join(",")+" "+t.end.join(",");a.setAttribute("points",s)}else a.setAttribute("points","")}else if("sync-links"==t.name){this.View.getLinks().find((function(e){return e.source==t.id||e.target==t.id})).forEach((function(i){var o=ot(e.View,i,i.from,i.to,t.item),r=e.View.getLinkItemNode(i.id);if(r.link&&e.SetCustomLine(r.link,o),r.shadow&&r.shadow.classList.contains("webix_selected")){var a=e.View.linkType.shadow/2;e.SetCustomLine(r.shadow,o,a)}r.arrow&&webix.html.remove(r.arrow),i.labels&&e.UpdateLabelsPosition(i.labels,n(n({},i),{line:o}),t.item)}))}else if("sync-path"==t.name){var l=this.View.getLinkItemNode(t.id),h=t.path;if(l.link&&!l.link.points&&(h=pt(h,t.submode)),l.link&&this.SetCustomLine(l.link,h,0),l.shadow){var u=this.View.linkType.shadow/2;this.SetCustomLine(l.shadow,h,u)}l.arrow&&webix.html.remove(l.arrow),this.ShowLinkPath(t.id,h),(a=this.View.getLinks().getItem(t.id)).labels&&this.UpdateLabelsPosition(a.labels,n(n({},a),{line:t.path}))}else if("copy"==t.name){var c=this.State.selected;(i=c?c.id:null)&&(!c.link&&!this.View.getItem(i).$link||c.link&&!this.View.getLinks().getItem(i).target)?(this.CopyId=i,this.CopyLink=c.link):this.CopyId=this.CopyLink=null}else if("paste"==t.name)this.CopyId&&this.GetItem(this.CopyId,this.CopyLink)&&(this.CopyLink?this.CloneLink(this.CopyId):this.CloneBlock(this.CopyId));else if("undo"==t.name)this.History.undo();else if("redo"==t.name)this.History.redo();else if("resize-content"==t.name){var d=n(n({},this.View.getItem(t.id)),t.item),p=this.View.getShape(d.type||this.View.type.type);if("function"==typeof(("string"==typeof p.template?this.Local.getShapeTemplate(p.template):null)||p).template){var f=this.View.type.templateShape.call(this.View,d,this.View.type),g=this.View.getItemNode(t.id);g.removeChild(g.children[0]);var m=webix.html.create("div",null,f);g.insertBefore(m.children[0],g.children[0])}}else if("handle-resize"==t.name){(d=this.View.getItem(t.id)).dx||d.dy||!d.$link||this.UpdateLabelPosition(t.id,t.item)}else if("handle-move"==t.name){(d=this.View.getItem(t.id)).$link&&this.UpdateLabelPosition(t.id,t.item,!0)}else"zoom-in"==t.name?this.app.callEvent("workspace:zoom",[1]):"zoom-out"==t.name?this.app.callEvent("workspace:zoom",[-1]):"zoom-reset"==t.name&&this.app.callEvent("workspace:zoom",[0])},e.prototype.SetCustomLine=function(t,e,i){if(i=i||0,t.points)t.setAttribute("points",e.map((function(t){return t=webix.isArray(t)?t:t.split(","),[Math.ceil(1*t[0]+i),Math.ceil(1*t[1]+i)].join(",")})).join(" "));else{var n=dt(e),o=n.d,r=n.points;t.setAttribute("d",o),t.setAttribute("data-points",r)}},e.prototype.CloneBlock=function(t){var e=webix.copy(this.View.getItem(t));delete e.id;var i="auto"===this.View.type.width?e.width:this.View.type.width,n="auto"===this.View.type.height?e.height:this.View.type.height;return e.x=e.x+i+20,e.y=e.y+n+20,this.Local.addBlock(e)},e.prototype.CloneLink=function(t){var e=webix.copy(this.View.getLinks().getItem(t));delete e.id;for(var i=e.line,n=0;i&&n<i.length;n++)i[n][0]+=30,i[n][1]+=30;return this.Local.addLink(e)},e.prototype.Autoplace=function(){var t={data:this.Local.data().serialize(),links:this.Local.links().serialize()};this.View.autoPlace(),this.History.push([["autoplace",t]])},e.prototype.UpdateCommonValue=function(t,e,i){var n={value:webix.copy(t),prev:{},target:e};for(var o in t)n.prev[o]=this.View[e][o],this.View[e][o]=t[o];i||this.History.push([["common",n]]),this.View.render()},e.prototype.SwapLinkDirection=function(t){var e=this.View.getLinks().getItem(t),i={source:e.target,target:e.source};(e.from||e.to)&&(i.from=e.to,i.to=e.from),webix.isArray(e.line)&&(i.line=e.line.slice().reverse()),this.Local.updateLink(t,i)},e.prototype.AddLinkLabel=function(t){var e=this.View.getLinks().getItem(t),i=this._("Text"),o=this.State.gridStep,r=webix.html.getTextSize(i,"webix_diagram_text"),a=r.width,s=r.height,l={value:i,$link:t,linkAlign:"center",type:"label",width:Math.round((a+10)/o)*o,height:Math.round(s/o)*o},h=ut(this.View,e,l),u=h.x,c=h.y,d=this.Local.addBlock(n(n({},l),{x:u,y:c}));this.View.select(d)},e.prototype.UpdateLabelsPosition=function(t,e,i){var o=this;t.forEach((function(t){var r=o.View.getItem(t);if(r){e=webix.isArray(e)?{line:e}:e;var a=ut(o.View,e,r,i),s=a.x,l=a.y;o.View.render(r.id,n(n({},r),{x:s+(r.dx||0),y:l+(r.dy||0)}),"update")}}))},e.prototype.UpdateLabelPosition=function(t,e,i){var o=this.View.getItem(t),r=this.View.getLinks().getItem(o.$link);if(o&&r){var a=n(n({},o),e),s=ut(this.View,r,a),l=s.x,h=s.y;this.View.render(o.id,n(n({},o),{x:l,y:h}),"update"),i&&(e.dx=e.x-l,e.dy=e.y-h)}},e.prototype.DrawGrid=function(t,e){if(e)this.View.$view.style.backgroundImage="none";else{var i=this.GridTemplate(t);this.View.$view.style.backgroundImage="url('data:image/svg+xml;UTF8,"+encodeURIComponent(i)+"')",this.SetGridBgPosition()}},e.prototype.SetGridBgPosition=function(){var t=this.State.gridStep,e=this.View.config,i=this.View.getScrollState(),n=i.x,o=i.y,r=-n+(e.paddingX||e.padding)%t,a=-o+(e.paddingY||e.padding)%t;this.View.$view.style.backgroundPosition=r+"px "+a+"px"},e.prototype.Zoom=function(t){this.View.$view.className=this.View.$view.className.replace(/ webix_de_scale_\d+/,""),webix.html.addCss(this.View.$view,this.GetScaleCss(t)),this.View.config.zoom=t,this.View.render()},e.prototype.GetScaleCss=function(t){return"webix_de_scale_"+(t<=.3?"03":t<=.5?"05":t<.9?"07":Math.round(t))},e.prototype.GetItem=function(t,e){return(e?this.View.getLinks():this.View).getItem(t)},e.prototype.ApplyChanges=function(t,e){for(var i in t){var n=parseFloat(t[i]);isNaN(n)||(t[i]=n)}var o=this.State.selected;o?o.link?this.Local.updateLink(o.id,t):this.Local.updateBlock(o.id,t):this.UpdateCommonValue(t,e)},e.prototype.AddHotkeys=function(){for(var t=this,e=this.GetHotkeyData(),i=function(i){var o;n.on({attachEvent:function(t,e){return webix.UIManager.addHotKey(t,e,o),{key:t,handler:e}},detachEvent:function(t){var e=t.key,i=t.handler;return webix.UIManager.removeHotKey(e,i,o)}},e[i].key,(function(n,o){t.CheckHotkeyView(n)&&(t.Action({name:e[i].action}),webix.html.preventEvent(o))}))},n=this,o=0;o<e.length;++o)i(o)},e.prototype.GetHotkeyData=function(){if(!this._hotkeys){var t=webix.env.isMac?"COMMAND":"CTRL";this._hotkeys=[{key:"DELETE",action:"remove"},{key:"BACKSPACE",action:"remove"},{key:t+"+C",action:"copy"},{key:t+"+V",action:"paste"},{key:t+"+Z",action:"undo"},{key:t+"+SHIFT+Z",action:"redo"},{key:t+"+Y",action:"redo"},{key:t+"+add",action:"zoom-in"},{key:t+"+=",action:"zoom-in"},{key:t+"+subtract",action:"zoom-out"},{key:t+"+0",action:"zoom-reset"}]}return this._hotkeys},e.prototype.CheckHotkeyView=function(t){return t==this.View||t==this.Context.getRoot()},e.prototype.MouseDownHandler=function(t){var e=this;if(this.CheckCtrl(t))var i={scroll:this.View.getScrollState(),x:t.clientX,y:t.clientY},n=webix.html.offset(this.View.$view),o=webix.event(document,"mousemove",(function(t){if(i)if(e.CheckCtrl(t)&&t.clientX>n.x){webix.html.addCss(e.View.$view,"webix_de_drag_scroll",!0);var o=i.scroll,r=i.x,a=i.y,s=Math.max(0,o.x-(t.clientX-r)),l=Math.max(0,o.y-(t.clientY-a));e.View.scrollTo(s,l),webix.callEvent("onReconstruct",[])}else e.View.callEvent("onAfterAutoScroll",[])})),r=webix.event(document,"mouseup",(function(){i=null,webix.html.removeCss(e.View.$view,"webix_de_drag_scroll"),webix.eventRemove(o),webix.eventRemove(r)}))},e.prototype.WheelHandler=function(t){if(this.CheckCtrl(t)){var e=-1*Math.sign(t.deltaY);this.app.callEvent("workspace:zoom",[e]),t.stopPropagation(),t.preventDefault()}},e.prototype.CheckCtrl=function(t){return t.ctrlKey||t.metaKey},e}(u);webix.protoUI({name:"diagram-counter",$cssName:"counter webix_de_control_counter",$init:function(){var t=this;this.attachEvent("onAfterRender",(function(){t.$setValue(t.config.value),t.getInputNode().readOnly=!0,webix.event(t.$view.firstChild,"keydown",(function(t){return webix.html.preventEvent(t)}))}))},$setValue:function(t){this.getInputNode().value=parseInt(100*t,10)+"%"},getValue:function(){return this.config.value},shift:function(t,e){var i=this.config.value,n=this.config.numbers,o=n.indexOf(i)+t;this.setValue(n[o]||i,e)}},webix.ui.counter),webix.protoUI({name:"diagram-toggle",$cssName:"toggle webix_de_toggle",$prepareValue:function(t){return t&&1!==t&&!0!==t?t===this.config.onValue?1:0:t},getValue:function(){return this.config.value?this.config.onValue:this.config.offValue},toggle:function(t){this.setValue(!this.config.value,t)}},webix.ui.toggle);var Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){this.State=this.app.getState(),this._=this.app.getService("locale")._;var t=webix.skin.$active.layoutPadding.space,e=webix.skin.$active.layoutMargin.form;return{view:"toolbar",localId:"toolbar",padding:t,elements:[{width:430,margin:e,cols:this.LeftGroupConfig()},{},{margin:e,cols:this.CenterGroupConfig()},{},{margin:e,width:430,cols:this.RightGroupConfig()}]}},e.prototype.init=function(){var t=this;this.History=this.app.getService("history"),this.on(this.app,"UndoChange",(function(){t.$$("undo").define("disabled",!t.History.hasUndo()),t.$$("redo").define("disabled",!t.History.hasRedo()),t.$$("reset").define("disabled",t.History.state.length<2)})),this.SetValues(),this.on(this.app,"workspace:zoom",(function(e){return t.ChangeZoom(e)}))},e.prototype.LeftGroupConfig=function(){var t=this,e=this.State,i=this._,n=webix.skin.$active;return[{view:"button",label:i("Reset"),localId:"reset",autowidth:!0,click:function(){return t.History.reset()}},{view:"icon",icon:"dgi-undo",localId:"undo",click:function(){return t.History.undo()}},{view:"icon",icon:"dgi-redo",localId:"redo",click:function(){return t.History.redo()}},{view:"diagram-counter",name:"zoom",width:108,numbers:this.GetZoomNumbers(),on:{onChange:function(t,i,n){"user"==n&&(e.zoom=t)}}},{view:"diagram-grid",css:"webix_de_control_grid",width:80,name:"grid",min:1,format:this.GridStepFormat(),inputLabel:"<span class='webix_icon dgi-grid'></span>",on:{onChange:function(t,i,n){"user"==n&&(e.gridStep=t)}}},{view:"diagram-toggle",name:"preview",css:"webix_de_control_preview",offLabel:"<span class='webix_icon dgi-preview'></span>",onLabel:"<span class='webix_icon dgi-preview-off'></span>",onValue:1,offValue:0,width:n.inputHeight-2,on:{onChange:function(e){return t.app.callEvent("toolbar:preview",[e])}}}]},e.prototype.CenterGroupConfig=function(){var t=this;return[{view:"button",label:(0,this._)("Autoplace"),css:"webix_primary",autowidth:!0,align:"center",click:function(){return t.app.callEvent("toolbar:autoplace",[])}}]},e.prototype.RightGroupConfig=function(){return[{},{view:"button",label:(0,this._)("Apply"),css:"webix_primary",autowidth:!0,align:"right",click:this.app.config.save}]},e.prototype.SetValues=function(){var t=this.State;this.$$("toolbar").setValues({zoom:t.zoom,grid:t.gridStep})},e.prototype.GridStepFormat=function(){return{edit:function(t){return parseInt(t,10)||1},parse:function(t){return parseInt(t,10)||1}}},e.prototype.GetZoomNumbers=function(){return[.25,.5,.75,.9,1,1.1,1.25,1.5,1.75,2,3,4]},e.prototype.ChangeZoom=function(t){var e=this.getRoot().elements.zoom;t?e.shift(t,"user"):e.setValue(1,"user")},e}(u),zt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this._=this.app.getService("locale")._,this.State=this.app.getState(),this.Local=this.app.getService("local"),this.Shapes=this.Local.shapes();var e=webix.skin.$active;this.headerH=e.inputHeight-2*e.inputPadding;var i="willow"==webix.skin.$name||"dark"==webix.skin.$name?8:0,n={view:"scrollview",width:260+2*i,body:{margin:i/4,padding:i,css:"webix_de_accordion",multi:!0,rows:[]}},o=[];return this.Shapes.data.each((function(t){t.group&&-1===o.indexOf(t.group)&&o.push(t.group)})),o.forEach((function(e){var o=t.Shapes.find((function(t){return t.group==e}));n.body.rows.push(t.GetPanelConfig(o,e,!!i))})),n},e.prototype.init=function(){var t=this;this.AdjustDragPos(),this.on(this.Shapes.data,"onStoreUpdated",(function(){return t.refresh()}))},e.prototype.AdjustDragPos=function(){this.getRoot().queryView("dataview","all").forEach((function(t){t.$dragPos=function(t){var e=webix.DragControl.getNode().firstChild,i=webix.html.offset(e);t.x=t.x-Math.round(i.width/2),t.y=t.y-Math.round(i.height/2)}}))},e.prototype.GetPanelConfig=function(t,e,i){var n=this.Local.isDefaultGroup(e),o=xt(e);return{header:n?this._(o):o,headerHeight:this.headerH,headerAltHeight:this.headerH,css:"webix_de_panel",borderless:i,body:{padding:10,cols:[this.GetDataviewConfig(t,e)]}}},e.prototype.GetDataviewConfig=function(t,e){var i=this;return{view:"dataview",localId:e+"View",css:"webix_de_shapes",autoheight:!0,template:function(t,e){return i.ItemTemplate(t,e)},tooltip:function(t){return t.name?i._(t.name):""},xCount:3,type:{width:80,height:50,css:"webix_diagram_item"},data:t,drag:"source",on:{onBeforeDrag:function(t){return t.mode="add",t.html=i.CreateDnDShape(t),!0}}}},e.prototype.ItemTemplate=function(t,e,i){var o,r="",a=n(n({},t),{height:i?i.height:e.height-12,width:i?i.width:e.width-12});delete a.name,i||(t.width<a.width&&(a.width=t.width),t.height<a.height&&(a.height=t.height));var s=t.template,l=this.Local.getShapeTemplate(s),h=-1!=(r="function"==typeof(s=l?l.template:s)?s(n({},a)):s).indexOf("webix_diagram_shape_text");h&&(r='<div class="webix_de_item_text">'+this._(t.name)+"</div>");var u=(l||t).svg;return void 0===u&&(u=r.toLowerCase().includes("<svg")),u?((o=bt(a,"svg",e))&&(r=r.replace(/(<svg)/i,"$1 style='"+o+"'")),(o=bt(a,"alt",e))&&(r=r.replace(/(class='webix_diagram_shape_alt')/gi,"$1 style='"+o+"'"))):(o=(h?"":bt(a,"block",e))+bt(a,"text",e))&&(r=r.replace(/(<\s*\w+)/i,"$1 style='"+o+"'")),r},e.prototype.CreateDnDShape=function(t){var e=t.from.getItem(t.start),i=this.app.getService("styles").getBlockValues(),n=e.width||i.width,o=e.height||i.height;"auto"===n&&(n=gt),"auto"===o&&(o=mt);return'<div class="webix_diagram_item" style="width:'+n+"px;height:"+o+"px;line-height:"+o+'px;">\n\t\t\t\t'+this.ItemTemplate(e,t.from.type,{width:n,height:o})+"\n\t\t\t</div>"},e}(u);webix.protoUI({name:"diagram-grid",$cssName:"text webix_diagram_control_text",$init:function(){var t=this;this._inputSpacing=webix.skin.$active.inputSpacing,this.attachEvent("onAfterRender",(function(){t.getInputNode().min=t.config.min}))},defaults:{min:0,icon:!0,type:"number"},$prepareValue:function(t){return t=parseFloat(t||0),this.config.min>=0?Math.abs(t):t},$renderIcon:function(t){var e=t.aheight-2*t.inputPadding,i=(e-18)/2-1,n=this._inputSpacing/2,o="";return t.inputLabel&&(o+="<span style='right:"+n+"px;height:"+(e-i)+"px;' class='webix_de_input_label'><span>"+t.inputLabel+"</span></span>"),o}},webix.ui.text),webix.protoUI({name:"diagram-text",$allowsClear:!1,$init:function(){this.attachEvent("onBlur",this._applyChanges),this.attachEvent("onEnter",this._applyChanges)},_applyChanges:function(){var t=this.getValue(),e=this.config.max,i=this.config.min;1*t<i&&(t=i,this.getInputNode().value=t),e&&1*t>e&&(t=e,this.getInputNode().value=t),this.setValue(t,"user")}},webix.ui["diagram-grid"]);var Dt={"triangle-fill":"<svg width='35' height='10' viewBox='0 0 35 10' fill='none' xmlns='http://www.w3.org/2000/svg'>\n<path d='M35 5L24.9632 9.33013L24.9632 0.669873L35 5Z' fill='#94A1B3'/><path d='M0 5L32.5746 5' stroke='#94A1B3'/></svg>",angle:"<svg width='36' height='8' viewBox='0 0 36 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M35.3536 4.35356C35.5488 4.15829 35.5488 3.84171 35.3536 3.64645L32.1716 0.464469C31.9763 0.269207 31.6597 0.269206 31.4645 0.464469C31.2692 0.659731 31.2692 0.976313 31.4645 1.17158L34.2929 4L31.4645 6.82843C31.2692 7.02369 31.2692 7.34027 31.4645 7.53554C31.6597 7.7308 31.9763 7.7308 32.1716 7.53554L35.3536 4.35356ZM-4.09794e-08 4.5L35 4.5L35 3.5L4.09794e-08 3.5L-4.09794e-08 4.5Z' fill='#94A1B3'/></svg>",triangle:"<svg width='35' height='10' viewBox='0 0 35 10' fill='none' xmlns='http://www.w3.org/2000/svg'>\n<path d='M0 5L32.5746 5' stroke='#94A1B3'/><path d='M35 5L24.9632 9.33013L24.9632 0.669873L35 5Z' class='webix_diagram_arrow_icon' fill='#fff'  stroke='#94A1B3' /></svg>",solid:"<svg width='74' height='8' viewBox='0 0 90 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M0 4.857117L80 4.857117' stroke='#94A1B3'/></svg>",dashed:"<svg width='74' height='8' viewBox='0 0 90 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M0 4.857117L80 4.857117' stroke='#94A1B3' stroke-dasharray='4,4'/></svg>",dotted:"<svg width='74' height='8' viewBox='0 0 90 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M0 4.857117L80 4.857117' stroke='#94A1B3' stroke-dasharray='2,2'/></svg>"},jt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return this._=this.app.getService("locale")._,this.Styles=this.app.getService("styles"),this.Local=this.app.getService("local"),this.MarginX=6,{width:300,cells:[{localId:"common",view:"form",scroll:!0,elementsConfig:{on:{onChange:this.ChangeHandler}},elements:this.GetCommonConfig()},{localId:"block",view:"form",scroll:!0,elementsConfig:{on:{onChange:this.ChangeHandler}},elements:this.GetBlockConfig()},{localId:"link",view:"form",scroll:!0,elementsConfig:{on:{onChange:this.ChangeHandler}},elements:this.GetLinkConfig()}]}},e.prototype.init=function(){var t=this;this.Mode="common",this.ShowForm("common"),this.SetCommonValues(),this.on(this.app,"diagram:syncform",(function(e){var i="link"==t.Mode?t.Styles.getLinkValues(e):t.Styles.getBlockValues(e);t.Form.setValues(i,!0)})),this.on(this.app,"diagram:select",(function(e,i){e?(t.Mode=i?"link":"block",t.ShowForm(t.Mode),i?t.SetLinkValues(e):t.SetBlockValues(e)):(t.Mode="common",t.ShowForm("common"),t.SetCommonValues())})),this.on(this.app,"values:defaults",(function(){t.SetCommonValues()}))},e.prototype.ShowForm=function(t){this.Form=this.$$(t),this.Form.show(null,!1)},e.prototype.ChangeHandler=function(t,e,i){"user"==i&&this.$scope.UpdateValue(this.config.name,t,e)},e.prototype.SetCommonValues=function(){var t=this.Form;this.ShowBatch(t,"common"),t.setValues(this.Styles.getCommonValues())},e.prototype.SetBlockValues=function(t){var e=this.Form,i="shape,block";t.type&&"text"==this.Local.shapes().getItem(t.type).template&&(i="text,block",t.$link&&(i="text,label")),this.ShowBatch(e,i),e.setValues(this.Styles.getBlockValues(t))},e.prototype.SetLinkValues=function(t){var e=this.Form;this.ShowBatch(e,"link"),e.setValues(this.Styles.getLinkValues(t))},e.prototype.GetCommonConfig=function(){var t=this._,e=this.MarginX,i=this.app.config,n=i.minItemWidth,o=i.minItemHeight;return[{rows:[{label:t("Default block size"),view:"label",css:"webix_de_sublabel"},{margin:e,cols:[{view:"diagram-text",inputLabel:"W",min:n,name:"width"},{view:"diagram-text",inputLabel:"H",min:o,name:"height"}]}]},this.GetLinkArrowConfig(!0),this.GetLinkModeConfig(!0),{}]},e.prototype.GetBlockConfig=function(){var t=this._,e=this.MarginX,i=this.app.config,n=i.minItemWidth,o=i.minItemHeight,r=webix.skin.$active;return[{rows:[{label:t("Block settings"),view:"label",css:"webix_de_sublabel"},{margin:e,cols:[{view:"diagram-text",inputLabel:"W",min:n,name:"width"},{view:"diagram-text",inputLabel:"H",min:o,name:"height"}]},{batch:"block",margin:e,cols:[{view:"diagram-text",inputLabel:"X",name:"x"},{view:"diagram-text",inputLabel:"Y",name:"y"}]},{margin:e,cols:[{view:"diagram-text",inputLabel:"<span class='webix_de_degree'>&deg;</span>",name:"angle",format:this.AngleFormat()},{}]}]},{batch:"label",rows:[{label:t("Position shift"),view:"label",css:"webix_de_sublabel"},{batch:"label",margin:e,cols:[{view:"diagram-text",inputLabel:"X",name:"dx",min:-1e4},{view:"diagram-text",inputLabel:"Y",name:"dy",min:-1e4}]}]},{batch:"label",rows:[{label:t("Alignment relative to link"),view:"label",css:"webix_de_sublabel"},{cols:[{view:"segmented",name:"linkAlign",optionWidth:r.inputHeight-2*r.inputPadding,value:"edges",css:"webix_de_segmented",options:[{id:"start",value:this.IconTemplate("dgi-ray-start")},{id:"center",value:this.IconTemplate("dgi-ray-vertex")},{id:"end",value:this.IconTemplate("dgi-ray-end")}]},{}]}]},{rows:[{label:t("Content"),view:"label",css:"webix_de_sublabel"},{view:"textarea",name:"value",height:1.5*r.inputHeight}]},{batch:"shape",rows:[{label:t("Fill"),view:"label",css:"webix_de_sublabel"},{margin:e,cols:[{view:"colorpicker",name:"backgroundColor",suggest:{padding:0,type:"colorselect",body:{button:!0}}},{view:"diagram-text",width:88,inputLabel:"%",name:"fillOpacity",step:1,min:0,max:100}]}]},{batch:"shape",rows:[{label:t("Border style"),view:"label",css:"webix_de_sublabel"},this.GetLineConfig()]},{rows:[{label:t("Font"),view:"label",css:"webix_de_sublabel"},{margin:r.layoutMargin.form,rows:[{margin:e,cols:[{view:"colorpicker",name:"fontColor",suggest:{padding:0,type:"colorselect",body:{button:!0}}},{view:"diagram-toggle",name:"fontWeight",label:"<span class='webix_icon dgi-format-bold'></span>",onValue:"bold",offValue:"normal",width:r.inputHeight-2},{view:"diagram-toggle",name:"fontStyle",label:"<span class='webix_icon dgi-format-italic'></span>",onValue:"italic",offValue:"normal",width:r.inputHeight-2}]},{margin:e,cols:[{view:"combo",name:"fontFamily",css:"webix_diagram_editor_select",options:this.GetFontFamilyOptions()},{view:"combo",name:"fontSize",width:80,css:"webix_diagram_editor_select",options:this.GetFontSizeOptions()}]},{margin:r.layoutMargin.form,cols:[{view:"segmented",name:"textAlign",optionWidth:r.inputHeight-2*r.inputPadding,value:"edges",css:"webix_de_segmented",options:[{id:"left",value:this.IconTemplate("dgi-format-align-left")},{id:"center",value:this.IconTemplate("dgi-format-align-center")},{id:"right",value:this.IconTemplate("dgi-format-align-right")}]},{view:"segmented",name:"textVAlign",optionWidth:r.inputHeight-2*r.inputPadding,value:"edges",css:"webix_de_segmented webix_diagram_right_align",options:[{id:"top",value:this.IconTemplate("dgi-format-vertical-align-top")},{id:"center",value:this.IconTemplate("dgi-format-vertical-align-center")},{id:"bottom",value:this.IconTemplate("dgi-format-vertical-align-bottom")}]}]}]}]},{batch:"text",rows:[{label:t("Background"),view:"label",css:"webix_de_sublabel"},{view:"checkbox",name:"transparent",labelWidth:0,labelRight:t("Transparent")}]},{}]},e.prototype.GetLinkConfig=function(){var t=this,e=this._;return[this.GetLinkArrowConfig(),this.GetLinkModeConfig(),{rows:[{label:e("Line style"),view:"label",css:"webix_de_sublabel"},this.GetLineConfig()]},{view:"button",label:e("Add label"),click:function(){return t.app.callEvent("form:action",["addLabel"])}},{}]},e.prototype.GetLinkModeConfig=function(t){var e=this._,i=webix.skin.$active;return{rows:[{label:e(t?"Default link mode":"Link mode"),view:"label",css:"webix_de_sublabel"},{cols:[{view:"segmented",name:"mode",optionWidth:i.inputHeight-2*i.inputPadding,value:"edges",css:"webix_de_segmented",options:[{id:"edges",value:this.IconTemplate("dgi-subdirectory-arrow-right")},{id:"direct",value:this.IconTemplate("dgi-arrow-bottom-right")},{id:"curve",value:this.IconTemplate("dgi-arrow-right-bottom")}]},{}]}]}},e.prototype.GetLinkArrowConfig=function(t){var e=this,i=this._,n=this.MarginX,o=webix.skin.$active;return{rows:[{label:i(t?"Default link arrow":"Link arrow"),view:"label",css:"webix_de_sublabel"},{margin:n,cols:[{view:"richselect",name:"arrow",optionWidth:o.inputHeight-2*o.inputPadding,placeholder:this.NoneTemplate(),css:"webix_diagram_editor_select",options:this.GetArrowOptions()},{view:"button",batch:"link",width:o.inputHeight,label:"<span class='webix_icon dgi-swap-vertical'></span>",css:"webix_de_icon_button",click:function(){return e.app.callEvent("form:action",["swap"])}},{view:"diagram-text",icon:!1,name:"arrowSize",width:60,value:6}]}]}},e.prototype.GetLineConfig=function(){return{margin:this.MarginX,cols:[{view:"colorpicker",name:"lineColor",css:"webix_de_colorpicker",width:webix.skin.$active.inputHeight,suggest:{padding:0,type:"colorselect",body:{button:!0}}},{view:"richselect",name:"lineStyle",css:"webix_diagram_editor_select",options:[{id:"solid",value:this.SelectOptionTemplate("solid")},{id:"dashed",value:this.SelectOptionTemplate("dashed")},{id:"dotted",value:this.SelectOptionTemplate("dotted")}]},{view:"diagram-text",icon:!1,name:"lineWidth",width:60,value:6}]}},e.prototype.GetFontSizeOptions=function(){return[11,12,13,14,15,16,17,18,20,21].map((function(t){return{id:t}}))},e.prototype.GetArrowOptions=function(){var t=this;return this.Styles.getArrows().map((function(e){return e?{id:e,value:t.SelectOptionTemplate(e)}:{$empty:!0,value:t.NoneTemplate()}}))},e.prototype.GetFontFamilyOptions=function(){return this.Styles.getFontFamilies().map((function(t){return{id:t,value:"<span style='font-family: "+t+"'>"+t+"</span>"}}))},e.prototype.IconTemplate=function(t){return"<span class='webix_icon "+t+"'></span>"},e.prototype.NoneTemplate=function(){return"<span class='webix_diagram_option_none'>"+this._("None")+"</span>"},e.prototype.SelectOptionTemplate=function(t){return Dt[t]},e.prototype.AngleFormat=function(){return{edit:function(t){return t%360+""},parse:function(t){return t%360+""}}},e.prototype.ShowBatch=function(t,e){var i=this;t.getChildViews&&t.getChildViews().forEach((function(t){t.config.batch&&(e.split(",").find((function(e){return t.config.batch.indexOf(e)>-1}))?t.show():t.hide());i.ShowBatch(t,e)}))},e.prototype.UpdateValue=function(t){var e,i=this.Form.getValues(),n=null,o=i[t],r=null;"common"==this.Mode&&(n="width"==t||"height"==t?"type":"linkType"),"arrow"==t||"lineColor"==t&&"link"==this.Mode&&i.arrow.includes("-fill")?r=this.ApplyArrow(t,o,n):"fontWeight"==t||"fontFamily"==t?r=this.ApplyFontWeight(t,o):!i.square||"width"!=t&&"height"!=t?"fillOpacity"==t?o/=100:"transparent"==t&&(r={fillOpacity:o?0:1}):r=this.ApplySquare(t,o),r=r||((e={})[t]=o,e),this.app.callEvent("form:update",[r,n])},e.prototype.ApplyFontWeight=function(t,e){var i,n=this.Form.elements,o=((i={})[t]=e,i);if("fontWeight"==t&&"bold"==e&&"Roboto"==n.fontFamily.getValue())o.fontWeight=500;else if("fontFamily"==t){var r=n.fontWeight.getValue();"500"!=r&&"bold"!=r||(o.fontWeight="Roboto"==e?500:"bold")}return o},e.prototype.ApplyArrow=function(t,e,i){var n;if("arrow"==t){var o=null;e.includes("-fill")?(e=e.replace(/-fill/,""),o=i?this.Styles.getDefaults().line.lineColor:this.Form.elements.lineColor.getValue()):"none"==e&&(e=!1),n={arrow:e,backgroundColor:o}}else n={lineColor:e,backgroundColor:e};return n},e.prototype.ApplySquare=function(t,e){var i="width"==t?"height":"width",n={};return n[t]=n[i]=e,this.Form.elements[i].setValue(e),n},e}(u),Bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[Pt,{localId:"editor",type:"wide",padding:{top:4},cols:[zt,Tt,{$subview:jt,name:"form"}]}]}},e.prototype.init=function(){var t=this;this.on(this.app,"toolbar:preview",(function(e){var i=t.$$("editor").getChildViews();e?(i[0].hide(),i[2].hide()):(i[0].show(),i[2].show())}))},e}(u),Ht={JetView:u};Ht.editor=Bt,Ht.form=jt,Ht.shapes=zt,Ht.toolbar=Pt,Ht["windows/context"]=At,Ht.workspace=Tt;var Nt=function(t){function e(e){var i=this,o=N({selected:null,zoom:1,gridStep:10});e=e||{};var r={router:y,version:"11.3.0",debug:!0,start:"/editor",params:{state:o},minItemWidth:10,minItemHeight:10};(i=t.call(this,n(n({},r),e))||this).use(D,i.config.locale||{lang:"en",webix:{en:"en-US"}});var a=function(t){return i.config.override&&i.config.override.get(t)||t};return i.setService("styles",new(a(F))(i)),i.setService("history",new(a(U))(i)),i.setService("local",new(a(_t))(i)),i}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?Ht[e]:"jet-locales"===t?Ot[e]:null},e.prototype.getState=function(){return this.config.params.state},e.prototype._prepareLinks=function(t){t=t||[];for(var e=0;e<t.length;e++)"child"!=t[e].mode&&"sibling"!=t[e].mode||(t[e].from=t[e].to="left",delete t[e].mode);return t},e.prototype.setValues=function(t){this.getService("styles").setType(t.item,t.linkItem),this.callEvent("values:defaults",[]);var e=this.getService("local");e.shapes().clearAll(),e.shapes().parse(t.shapes||[]),e.links().clearAll(),e.links().parse(this._prepareLinks(t.links)),e.data().clearAll(),e.data().importData(t.data),this.getService("history").track()},e.prototype.getValues=function(){var t=this.getService("local"),e=this.getService("styles");return{data:t.data().serialize(),links:t.links().serialize(),shapes:t.shapes().serialize(),linkItem:e.getLinkValues(),item:e.getBlockValues()}},e}(w);webix.protoUI({name:"diagram-editor",app:Nt,defaults:{borderless:!0},$init:function(){var t=this;this.name="diagram-editor",this.$view.className+=" webix_diagram_editor";var e=this.$app.getState();for(var i in e)H(e,this.config,i);this.$app.attachEvent("diagram:beforedrag",(function(e,i){return t.callEvent("onBeforeDrag",[e,i])})),this.$app.attachEvent("diagram:beforedrop",(function(e,i){return t.callEvent("onBeforeDrop",[e,i])}))},getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},setValues:function(t){return this.$app.setValues(t)},getValues:function(){return this.$app.getValues()}},webix.ui.jetapp);var Rt={Styles:F,LocalData:_t,History:U},Ot={en:{"Link arrow":"Link arrow","Default link arrow":"Default link arrow","Link mode":"Link mode","Default link mode":"Default link mode",Fill:"Fill",Size:"Size","Block settings":"Block settings","Default block size":"Default block size",Font:"Font","Line style":"Line style","Border style":"Border style",Content:"Content",None:"None",Reset:"Reset",Autoplace:"Autoplace",Apply:"Apply",Background:"Background",Transparent:"Transparent",Block:"Block",Flow:"Flow",Common:"Common",Extra:"Extra",Lines:"Lines",Circle:"Circle",Dot:"Dot",Ellipse:"Ellipse",Head:"Head",Heptagon:"Heptagon",Join:"Join",Junction:"Junction",Octagon:"Octagon",Pentagon:"Pentagon",Plus:"Plus",Rrect:"Rounded rectangle",Rtriangle:"Right triangle",Square:"Square",Star:"Star",Tail:"Tail",Trapezoid:"Trapezoid",Triangle:"Triangle",Action:"Action",Collate:"Collate",Connector:"Connector",Data:"Data",Database:"Database",Decision:"Decision",Delay:"Delay",Display:"Display",Document:"Document",Input:"Input",Internal:"Internal",Looplimit:"Loop limit",Merge:"Merge",Multidoc:"Multiple documents",Note:"Note",Operation:"Operation",Or:"Or",Output:"Output",Preparation:"Preparation",Process:"Process",Sdata:"Sequential data",Sort:"Sort",Start:"Start / End",Storage:"Storage",Subroutine:"Subroutine",Tape:"Tape",Default:"Default",Org:"Organization",Text:"Text","Add label":"Add label","Alignment relative to link":"Alignment relative to link","Position shift":"Position shift"}};t.App=Nt,t.locales=Ot,t.services=Rt,t.views=Ht,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=diagram.min.js.map
