/*
@license
Webix FileManager v.11.3.0
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).fileManager={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function a(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],o={},a=r.indexOf(":");if(-1===a&&(a=r.indexOf("?")),-1!==a)for(var s=0,c=r.substr(a+1).split(/[\:\?\&]/g);s<c.length;s++){var l=c[s].split("=");o[l[0]]=decodeURIComponent(l[1])}i[n]={page:a>-1?r.substr(0,a):r,params:o,isNew:!0}}return i}function s(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var o=c(r.params);o&&e.push("?"+o)}return e.join("")}function c(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var l=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:a(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=s(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(a(t));for(var o=0;o<i.length;o++)n[o]&&(i[o].view=n[o].view),r&&n[o]&&i[o].page===n[o].page?i[o].isNew=!1:i[o].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=s(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,o=this._join(t.url,i);return this.setParams(o,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var a=s(o),c={url:o,redirect:a,confirm:Promise.resolve()},l=e?e.app:null;if(l&&!l.callEvent("app:guard",[c.redirect,e,c]))return void i(new r);c.confirm.catch((function(t){return i(t)})).then((function(){if(null!==c.redirect){if(c.redirect!==a)return l.show(c.redirect),void i(new r);n.route.path=a,n.route.url=o,t()}else i(new r)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=s(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=s(this.route.url)},t}(),u=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof o?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new l(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,o=null,a=!1;if(this._container.tagName?o=this._container:(r=this._container).popup?(o=document.body,a=!0):o=this.webix.$$(r.id),!this.app||!o)return Promise.reject(null);var s=this._segment.current(),c={ui:{}};this.app.copyConfig(t,c.ui,this._subs),this.app.callEvent("app:render",[this,e,c]),c.ui.$scope=this,!r&&s.isNew&&s.view&&s.view.destructor();try{if(r&&!a){var l=o,u=l.getParentView();u&&"multiview"===u.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,o);var h=this._root;a&&h.setPosition&&!h.isVisible()&&h.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new l(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),h=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(u),p=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),f=!0,d=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var a=t[r];if("function"==typeof a&&a.prototype instanceof o&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[r]=a;else if(a instanceof Date)e[r]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(n?e.push(s):e[r]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:p});if(t.prototype instanceof o)return new t(this,{name:i,params:n});t=t(this)}return t instanceof o?t:new h(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;!this.$router?(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),f=!1),"string"==typeof e&&(e=new l(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var o=i?i.params:this.config.params||null,a=this.getSubView(),s=this._subSegment,c=s.show({url:r,params:o},a).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return c})),c},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new u(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof r))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new l(this.config.start,0),t.current().view=n}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),t=new l(o,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),v=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),g=!1;function w(t){if(!g&&t){g=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var o=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var a in r)o(a);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var m=function(t){function e(e){var i;return e.router=e.router||v,w((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(d),b=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _(t,e,i){for(var n in t)y(t,n)&&e.call(i||t,t[n],n,t)}function x(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var S=String.prototype.replace,$=String.prototype.split,k=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},C={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:k,chinese:function(){return 0},croatian:k,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:k,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},T={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function I(t){var e,i=(e={},_(T,(function(t,i){_(t,(function(t){e[t]=i}))})),e);return i[t]||i[$.call(t,/-/,1)[0]]||i.en}function P(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var A=/\$/g,F=/%\{(.*?)\}/g;function V(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,o=n||F,a="number"==typeof e?{smart_count:e}:e;if(null!=a.smart_count&&r){var s=$.call(r,"||||");r=(s[function(t,e){return C[I(t)](e)}(i||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return r=S.call(r,o,(function(t,e){return y(a,e)&&null!=a[e]?S.call(a[e],A,"$$"):t}))}function M(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?V:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||x,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(P(e)+"(.*?)"+P(i),"g")}(e.interpolation)}M.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},M.prototype.extend=function(t,e){_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},M.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},M.prototype.clear=function(){this.phrases={}},M.prototype.replace=function(t){this.clear(),this.extend(t)},M.prototype.t=function(t,e){var i,n,r=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof r._)i=r._;else if(this.onMissingKey){n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),n=t;return"string"==typeof i&&(n=V(i,r,this.currentLocale,this.tokenRegex)),n},M.prototype.has=function(t){return y(this.phrases,t)},M.transformPhrase=function(t,e,i){return V(t,e,i)};var E=M;var L=window.webix;L&&w(L);var R=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function o(e,o,a){o.__esModule&&(o=o.default);var c={phrases:o};i.polyglot&&t.webix.extend(c,i.polyglot);var l=s.polyglot=new E(c);if(l.locale(e),s._=t.webix.bind(l.t,l),r=e,n&&n.put("lang",r),i.webix){var u=i.webix[e];u&&t.webix.i18n.setLocale(u)}return a?Promise.resolve():t.refresh()}function a(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;o(e,t.require("jet-locales",r),n)}}var s={getLang:function(){return r},setLang:a,setLangData:o,_:null,polyglot:null};t.setService("locale",s),a(r,!0)},D=window;D.Promise||(D.Promise=D.webix.promise);var j=1;function O(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function z(t,e){e=e||{};var i={},n={},r=function(t,e){var r=j++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},o=[],a=!1,s=function(t,e,n,r){if(a)o.push([t,e,n,r]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var l=i[s[c]];l&&("*"!==l.mask&&l.mask!==t||l.handler(n,e,t,r))}};for(var c in t)if(t.hasOwnProperty(c)){var l=t[c];e.nested&&"object"==typeof l&&l?n[c]=z(l,e):B(n,l,c,s)}return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(a=!0,t(n),a=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),n}function B(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}var U=!1;function W(t,e,i){var n=e.$width,r=e.$height;t.config._fillApp?t.define({width:n,height:r}):t.define({left:(n-t.$width)/2,top:(r-t.$height)/2}),i||t.resize()}function H(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=e.attachEvent("view:resize",(function(){W(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(n)}))}function G(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,n=e.handler;return webix.UIManager.removeHotKey(i,n,t)}}}var N="<span class='webix_icon wxi-folder'></span>",q="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>",K="<span class='webix_fmanager_icon fmi-view-list webix_fmanager_mode_icon'></span>",X="<span class='webix_fmanager_icon fmi-view-grid webix_fmanager_mode_icon'></span>",Z=function(t){function e(e,i){var n=t.call(this,e)||this;return n.compact=!!i.compact,n.tree=!!i.tree,n}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("state"),n=[{id:"download",value:e("Download"),icon:"wxi-download",show:96,hotkey:"Ctrl+D"},{$template:"Separator",show:96},{id:"toggle-preview",value:e("Preview"),icon:"wxi-eye",show:40},{id:"locate",value:e("Open item location"),icon:"wxi-folder",hotkey:"Ctrl+Alt+O",show:80},{id:"open",value:e("Open"),icon:"wxi-folder-open",hotkey:"Ctrl+O",show:68},{$template:"Separator",show:68},{id:"copy",value:e("Copy"),hotkey:"Ctrl+C",icon:"fmi-content-copy",show:384},{id:"cut",value:e("Cut"),hotkey:"Ctrl+X",icon:"fmi-content-cut",show:384},{id:"paste",value:e("Paste"),hotkey:"Ctrl+V",icon:"fmi-content-paste",show:1},{$template:"Separator",show:384},{id:"rename",value:e("Rename"),icon:"fmi-rename-box",hotkey:"Ctrl+R",show:320},{id:"delete",value:e("Delete"),icon:"wxi-close",hotkey:"Del / &#8592;",show:256}];return this.app.config.editor&&n.splice(5,0,{id:"edit",value:e("Edit"),icon:"wxi-pencil",hotkey:"Ctrl+E",show:2}),{view:"menu",css:"webix_fmanager_menu",layout:"y",autoheight:!0,data:n,template:function(t){return(t.icon?'<span class="webix_list_icon webix_icon '+t.icon+'"></span>':"")+t.value+(t.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+t.hotkey+"</span>":"")},on:{onMenuItemClick:function(e){"toggle-preview"===e?i.preview=!i.preview:t.app.callEvent("app:action",[e,t.Files]),t.app.callEvent("app:filemenu:click")}}}},e.prototype.FilterOptions=function(t){var e=this;this.Files=t;var i=t[0],n=t.length>1,r=["image","audio","video","code","pdf"],o=-1!=r.indexOf(i.type)||-1!=r.indexOf(i.$ext),a=this.app.getState(),s=!(!a.search&&!a.filter),c="empty"===i.type,l="folder"===i.type;this.getRoot().define("width",!s||n||c?200:270),this.getRoot().filter((function(t){return!(1&t.show&&(n||s||e.tree)||64&t.show&&n||32&t.show&&(l||c)||2&t.show&&"code"!==i.type||4&t.show&&!o||8&t.show&&!e.compact||128&t.show&&e.tree||256&t.show&&c||16&t.show&&!s)}))},e}(u),J=function(t){function e(e,i){var n=t.call(this,e)||this;return n._config=i,n}return i(e,t),e.prototype.config=function(){var t=this;return{view:"context",body:{$subview:new(this.app.dynamic(Z))(this.app,n({},this._config)),name:"options"},on:{onBeforeShow:function(e){var i=t._Locate(e);if(!i)return!1;t.getSubView("options").FilterOptions(i)}}}},e.prototype.init=function(){var t=this;this.on(this.app,"app:filemenu:click",(function(){return t.getRoot().hide()}))},e.prototype.AttachTo=function(t,e){this._Locate=e,this.getRoot().attachTo(t)},e.prototype.Show=function(t){this.getRoot().show(t,{x:-t.offsetX,y:t.target.offsetHeight-t.offsetY})},e.prototype.Hide=function(){this.getRoot().hide()},e}(u),Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.Local=this.app.getService("local"),this._Track=!0,this.WTable.attachEvent("onAfterSelect",(function(){return t.ShiftFocus()})),this.WTable.attachEvent("onSelectChange",(function(){return t.HandleSelect()})),this.on(this.State.$changes,"path",(function(e,i){return t.HandlePath(e,i)})),this.on(this.WTable.data,"onStoreUpdated",(function(e,i,n){!n&&t.WTable.count()&&t.State.selectedItem.length&&t.SelectActive()})),this.AddHotkeys();var e=this.getParam("compact",!0);this.Menu=this.ui(new(this.app.dynamic(J))(this.app,{compact:e,state:this.State})),this.Menu.AttachTo(this.WTable.$view,(function(e){return t.ShowMenu(e)})),this.on(this.WTable,"onAfterScroll",(function(){return t.Menu.Hide()})),this.on(this.WTable,"onBeforeDrag",(function(){return t.Menu.Hide()})),this.on(this.State.$changes,"search",(function(e,i){return t.HandleSearch(e,i)})),this.on(this.State.$changes,"filter",(function(e){return t.HandleFilter(e)})),this.on(this.State.$changes,"selectedItem",(function(){t.State.search||t.State.filter||t.SelectActive()}))},e.prototype.HandleSelect=function(){var t=this;if(this._Track){var e=[].concat(this.WTable.getSelectedId(!0).map((function(e){return t.WTable.getItem(e)})));(e.length||this.State.selectedItem.length)&&(e.length||(e.$noSelect=!0),this.State.selectedItem=e.filter((function(t){return".."!==t.value})))}},e.prototype.HandlePath=function(t,e){var i=this;this.State.search||this.State.filter?e&&this.State.$batch({search:"",filter:null,searchStats:null}):"files"===this.State.source&&(e?this.Local.folders().then((function(n){var r=i.GetPrevLocation(n,t,e);r&&(i.State.selectedItem=r),i.LoadData(t)})):this.LoadData(t))},e.prototype.ShowMenu=function(t){var e=this,i=this.WTable.locate(t);if(!i)return!this.State.search&&!this.State.filter&&[{type:"empty"}];if(i.header)return!1;var n=this.WTable.getItem(i);if(".."==n.value)return!1;this.WTable.isSelected(i)||this.WTable.select(i);var r=this.WTable.getSelectedId(!0);return 1===r.length?[n]:r=r.map((function(t){return e.WTable.getItem(t)})).filter((function(t){return".."!=t.value}))},e.prototype.HandleSearch=function(t,e){if((t||e)&&((t=t.trim())||e)&&this.ReloadIsNecessary()){var i=this.State;i.selectedItem=[],this.LoadData(i.path,t,i.filter)}},e.prototype.HandleFilter=function(t){if(t&&this.ReloadIsNecessary()){var e=this.State;e.selectedItem=[],this.LoadData(e.path,e.search,t)}},e.prototype.ReloadIsNecessary=function(){var t=this.getUrl()[0].page;return"list"===t&&(t="grid"),-1!==("search"===this.State.mode?"search-cards":this.State.mode).indexOf(t)},e.prototype.ShiftFocus=function(){this.getParam("trackActive",!0)&&(this.State.isActive=!0)},e.prototype.Activate=function(t){if(t.length)if(1===t.length){var e=t[0];if("folder"===e.type)this.ShowSubFolder(".."===e.value?e.value:e.id);else{var i="code"===e.type&&this.app.config.editor?"edit":"open";this.app.callEvent("app:action",[i,t])}}else{i=this.app.config.editor?"edit":"open";this.app.callEvent("app:action",[i,t])}},e.prototype.ShowSubFolder=function(t){var e;if(".."==t){var i=this.State.path.split("/");e="/"+i.slice(1,i.length-1).join("/")}else e=t;this.State.path=e},e.prototype.GetPrevLocation=function(t,e,i){if("/"===i||!t.exists(i))return null;var n;for("/"===e&&(e="../files");i;)if(n=i,(i=t.getParentId(i))===e){var r=t.getItem(n);return[{id:r.id,value:r.value,type:"folder",date:new Date(r.date)}]}return null},e.prototype.GetTargetFolder=function(t){var e=t?this.WTable.getItem(t):null;return!e||"folder"!==e.type||".."===e.value?this.State.path:e.id},e.prototype.SelectActive=function(){var t=this.WTable;if(!1!==this.State.isActive&&!t.getSelectedId()){for(var e=this.State.selectedItem,i=0;i<e.length;i++)t.exists(e[i].id)&&t.select(e[i].id,!0);if(!e.$noSelect&&!t.getSelectedId()){var n=t.getFirstId();n&&(t.select(n),e.$noSelect=!1)}webix.delay((function(){return webix.UIManager.setFocus(t)}))}},e.prototype.GetSelection=function(){var t=this;return this.WTable.getSelectedId(!0).map((function(e){return t.WTable.getItem(e)}))},e.prototype.LoadData=function(t,e,i){var n=this;this._Track=!1;var r=this.WTable;e||i?this.app.getService("backend").search(t,e,i).then((function(t){if(n.app){for(var e=0;e<t.length;++e)n.Local.prepareData(t[e]);r.clearAll(),r.parse(t),n.GetSearchStats(t)}})):r.data.url!==t&&(r.clearAll(),this.Local.files(t).then((function(t){n.app&&(n.RenderData(t),n.SelectActive())}))),this._Track=!0},e.prototype.MoveFiles=function(t,e){return this.app.getService("operations").move(t,this.GetTargetFolder(e)),!1},e.prototype.Icon=function(t){return'<img class="webix_fmanager_file-type-icon" src="'+this.app.getService("backend").icon(t)+'" />'},e.prototype.DragMarker=function(t){var e=this.WTable,i=e.find((function(t){return".."===t.value}),!0);if(i){var n=t.source.indexOf(i.id);-1!==n&&t.source.splice(n,1)}var r=t.source.length;if(!r)return!1;1===r&&e.select(t.source[0]);var o=e.getItem(t.source[0]),a="<div class='webix_fmanager_grid_drag_zone_list'>";if(a+='<div class="webix_fmanager_inner_drag_zone_list">'+("folder"===o.type?N:this.Icon(o))+o.value+"</div>",a+="</div>",r>1){a="<div class='webix_drag_main'>"+a+"</div>";var s="<div class='webix_drag_multiple'></div>";r>2&&(s="<div class='webix_drag_multiple_last'></div>"+s),a=s+(a+="<div class='webix_badge'>"+r+"</div>")}t.html=a},e.prototype.AddHotkeys=function(){var t=this,e=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete"},{key:"BACKSPACE",oper:"delete"},{key:e+"+C",oper:"copy"},{key:e+"+X",oper:"cut"},{key:e+"+V",oper:"paste"},{key:e+"+R",oper:"rename"},{key:e+"+O",oper:"open"},{key:e+"+D",oper:"download"},{key:e+"+Alt+O",oper:"locate"}];this.app.config.editor&&i.push({key:e+"+E",oper:"edit"});for(var n=function(e){r.on(G(r.getRoot()),i[e].key,(function(n,r){var o=[i[e].oper];t.app.callEvent("app:action",o),webix.html.preventEvent(r)}))},r=this,o=0;o<i.length;++o)n(o);this.on(G(this.getRoot()),e+"+A",(function(e,i){t.WTable.selectAll(),webix.html.preventEvent(i)}))},e.prototype.GetSearchStats=function(t){var e=t.length,i=t.filter((function(t){return"folder"===t.type}));this.State.searchStats={folders:i?i.length:0,files:e-i.length}},e.prototype.EmptyClick=function(){!1!==this.State.isActive?this.WTable.unselectAll():this.ShiftFocus()},e}(u),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.getParam("compact",!0),i="mini"===webix.skin.$name||"compact"===webix.skin.$name;return{view:"dataview",localId:"cards",drag:!e,select:!0,multiselect:!0,css:"webix_noselect webix_fmanager_cards",template:function(e){return t.CardTemplate(e)},type:n(n({},i?{height:149,width:181,padding:16}:{height:197,width:236,padding:20}),{type:"tiles"}),on:{onItemDblClick:function(){return t.Activate(t.GetSelection())},onEnter:function(){return t.Activate(t.GetSelection())},onBeforeDrag:function(e){return t.DragMarker(e)},onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)}},onClick:{webix_fmanager_menu_icon:function(e){t.Menu.Show(e)},webix_dataview:function(e,i){i||t.EmptyClick()}},onContext:{webix_dataview:function(e,i){i||t.EmptyClick()}}}},e.prototype.init=function(){this.WTable=this.$$("cards"),t.prototype.init.call(this)},e.prototype.RenderData=function(t){var e=this;this.WTable.sync(t,(function(){return e.WTable.filter((function(t){return".."!==t.value}))}))},e.prototype.CardTemplate=function(t){var e,i,n=this.app.getService("locale")._;if("folder"===t.type)e="<div class=\"webix_fmanager_card_preview\"><span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",i='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+n("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+this.SearchTemplate(t.value)+"</span>"+q+"\n\t\t</div>";else{var r=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],o=this.app.getService("backend").previewURL(t,r[0],r[1]);e='<div class="webix_fmanager_card_preview file">'+('<img height="'+r[1]+'" width="'+r[0]+'" src="'+o+'" onerror=\'this.style.display="none"\'/>')+"</div>",i='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(t)+'<span class="file_name_text">'+this.SearchTemplate(t.value)+"</span></span>"+q+"\n\t\t</div>"}return e+i},e.prototype.SearchTemplate=function(t){if(this.State.search){var e=new RegExp("("+this.State.search+")","gi");return t.replace(e,"<span class='webix_fmanager_search_mark'>$1</span>")}return t},e}(Y);function tt(t){var e=t.value.lastIndexOf(".");e>-1?t.setSelectionRange(0,e):t.select()}function et(t,e,i){if(!((i=i||{i:0,cancel:!1}).i>=t.length))return e(t[i.i],i.i).then((function(){if(i.i+=1,!i.cancel)return et(t,e,i)}))}function it(t,e){return t>=1e9?(t/1e9).toFixed(1)+" "+e("GB"):t>=1e6?(t/1e6).toFixed(1)+" "+e("MB"):t>=1e3?(t/1e3).toFixed(1)+" "+e("kB"):t+" "+e("B")}function nt(t){return t.length?t[t.length-1]:{type:"empty",value:"Nothing is selected"}}function rt(t){for(t=t.replace(/[/\\:*?"<>|]/g,"").trim();"."===t[0];)t=t.substr(1).trim();return t}function ot(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}webix.protoUI({name:"codemirror-editor",defaults:{mode:"javascript",lineNumbers:!0,matchBrackets:!0,theme:"default"},$init:function(t){this.$view.innerHTML="<textarea style='width:100%;height:100%;'></textarea>",this._textarea=this.$view.firstChild,this._waitEditor=webix.promise.defer(),this.$ready.push(this._render_cm_editor)},complex_types:{php:{mode:["xml","javascript","css","htmlmixed","clike"]},htmlembedded:{mode:["xml","javascript","css","htmlmixed"],addon:["mode/multiplex"]},htmlmixed:{mode:["xml","javascript","css"]},dockerfile:{addon:["mode/simple"]}},_render_cm_editor:function(){if(!1!==this.config.cdn){var t=this.config.cdn||"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/",e=[t+"/codemirror.css",t+"/codemirror.js"],i=this.config.mode?this.config.mode:"javascript",n=this.complex_types[i];n&&(n.mode&&n.mode.forEach((function(i){var n="/mode/"+i+"/"+i+".js";e.push(t+n)})),n.addon&&n.addon.forEach((function(i){var n="/addon/"+i+".js";e.push(t+n)}))),e.push(t+"/mode/"+i+"/"+i+".js"),this.config.theme&&"default"!==this.config.theme&&e.push(t+"/theme/"+this.config.theme+".css"),this.config.matchBrackets&&e.push(t+"/addon/edit/matchbrackets.js"),webix.require(e).then(webix.bind(this._render_when_ready,this)).catch((function(t){console.log(t)}))}else this._render_when_ready},_render_when_ready:function(){this._editor=CodeMirror.fromTextArea(this._textarea,{mode:this.config.mode,lineNumbers:this.config.lineNumbers,matchBrackets:this.config.matchBrackets,theme:this.config.theme}),this._waitEditor.resolve(this._editor),this.setValue(this.config.value),this._focus_await&&this.focus()},_set_inner_size:function(){this._editor&&this.$width&&(this._updateScrollSize(),this._editor.scrollTo(0,0))},_updateScrollSize:function(){var t=this._editor.getWrapperElement(),e=(this.$height||0)+"px";t.style.height=e,t.style.width=(this.$width||0)+"px";var i=this._editor.getScrollerElement();i.style.height!=e&&(i.style.height=e,this._editor.refresh())},$setSize:function(t,e){webix.ui.view.prototype.$setSize.call(this,t,e)&&this._set_inner_size()},setValue:function(t){t||0===t||(t=""),this.config.value=t,this._editor&&(this._editor.setValue(t),this.config.preserveUndoHistory||this._editor.clearHistory(),this._updateScrollSize())},getValue:function(){return this._editor?this._editor.getValue():this.config.value},focus:function(){this._focus_await=!0,this._editor&&this._editor.focus()},getEditor:function(t){return t?this._waitEditor:this._editor},undo:function(){this._editor.undo()},redo:function(){this._editor.redo()},undoLength:function(){return this._editor.historySize().undo}},webix.ui.view);var at={css:["css","less"],go:["go"],htmlmixed:["html","xml","svg"],javascript:["js","mjs","json","ts","coffee"],markdown:["md"],php:["php","phtml","php3","php4","php5","php7","php-s","pht","phar"],python:["py","pyc","pyd","pyo","pyw","pyz"],sql:["sql","sqlite3","sqlite","db"],yaml:["yaml","yml"],shell:["sh"]},st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this._=this.app.getService("locale")._,this.Files=this.getParam("files");var e={view:"tabbar",localId:"tabbar",css:"webix_fmanager_editor_tabs",borderless:!0,tabMinWidth:170,moreTemplate:"<span class='webix_icon webix_tabbar_more fmi-format-list-bulleted'></span>",tooltip:function(t){return t.id},options:[],on:{onChange:function(e){return t.OpenDoc(e)},onBeforeTabClick:function(e,i){return t.TabAction(e,i)}},tabbarPopup:{css:"webix_fmanager_editor_popup"}},i=webix.skin.$active,n={view:"toolbar",css:"webix_fmanager_editor_bar",padding:{left:4,right:4,top:0,bottom:0},height:i.toolbarHeight+!(i.toolbarHeight%2),cols:webix.env.mobile?this.GetMobileControls():[e]};return webix.env.mobile?n.cols.push(this.GetCloseAll(!0)):n.cols.push({width:12},this.GetCloseAll()),{type:"wide",rows:[n,{view:"codemirror-editor",localId:"editor",theme:"contrast"==webix.skin.$name||"dark"===webix.skin.$name?"monokai":"default"}]}},e.prototype.GetMobileControls=function(){var t=this;return[{view:"button",localId:"saveBtn",type:"icon",label:this._("Save"),icon:"wxi-check",css:"webix_primary webix_fmanager_editor_save",width:90,click:function(){return t.Save()}},{view:"label",label:" ",localId:"name",css:"webix_fmanager_editor_name"}]},e.prototype.GetCloseAll=function(t){var e=this;return{view:"icon",icon:t?"wxi-close":"fmi-exit-to-app",click:function(){return e.ConfirmAll()},tooltip:this._("Close the editor")+" (Esc)"}},e.prototype.init=function(){var t=this,e=this.$$("editor");if(webix.env.mobile){var i=this.Files[0];this.$$("name").setValue(this.GetFileLabel(i))}this._oldValue={},this._changed={},this._buffers={},e.getEditor(!0).then((function(i){webix.extend(e,webix.ProgressBar),e.showProgress({type:"top"}),et(t.Files,(function(e){return t.app.getService("operations").read(e.id).then((function(i){return t.AddDoc(e,i)}))})).then((function(){if(!webix.env.mobile){for(var e=t.$$("tabbar"),i=0;i<t.Files.length;++i)t.AddTab(e,t.Files[i]);e.setValue(e.config.options[0].id)}t.OpenDoc(t.Files[0].id)})).finally((function(){e.hideProgress()})),t.HandleChanges(i)}));var n=webix.env.isMac?"COMMAND":"CTRL";this.on(G(),n+" + S",(function(e,i){t.Save(),webix.html.preventEvent(i)})),this.on(G(),n+" + Shift + S",(function(){return t.SaveAll()})),this.on(G(),"ESC",(function(){return t.ConfirmAll()}))},e.prototype.HandleChanges=function(t){var e=this;t.on("changes",(function(){e.TextChanged(e.GetActiveFile())}))},e.prototype.AddDoc=function(t,e){this._oldValue[t.id]=e,this._buffers[t.id]=CodeMirror.Doc(e,this.GetFileType(t))},e.prototype.GetFileLabel=function(t,e){return'<div class="filename">'+this.ClipName(e?t.value:t.id)+'</div><span class="extension">.'+t.$ext+"</span>"},e.prototype.ClipName=function(t){if(!t)return"";var e=t.split(".");return e.slice(0,e.length-1).join(".")},e.prototype.AddTab=function(t,e){var i='<span class="webix_fmanager_tab_action webix_icon wxi-close" webix_tooltip="'+this._("Close this file")+'"></span>',n='<div class="tab_content">'+this.GetFileLabel(e,!0)+i+"</div>",r=webix.html.getTextSize(e.value,"webix_item_tab").width+90;t.addOption({id:e.id,value:n,css:"webix_fmanager_editor_tab",width:r>250?250:r})},e.prototype.OpenDoc=function(t){var e=this;this.$$("editor").getEditor(!0).then((function(i){i.swapDoc(e._buffers[t]),i.focus()}))},e.prototype.Back=function(){this.show("/top",{params:{state:this.getParam("state")}})},e.prototype.ConfirmAll=function(){var t=this;this.CheckChanges()?webix.confirm({container:this.app.getRoot().$view,text:this._("Are you sure you want to exit without saving?")}).then((function(){return t.Back()})):this.Back()},e.prototype.TabAction=function(t,e){if(e){var i=e.target.className,n=-1!==i.indexOf("webix_icon")&&t==this.$$("tabbar").getValue();return n&&(-1!==i.indexOf("close")?this.CloseTab(t):-1!==i.indexOf("circle")&&this.ConfirmOne(t)),!n}return!0},e.prototype.ConfirmOne=function(t){var e=this;webix.confirm({container:this.app.getRoot().$view,text:this._("Save before closing?")}).then((function(){e.Save(t).then((function(){return e.CloseTab(t)}))})).catch((function(){e.CloseTab(t)}))},e.prototype.CheckChanges=function(){for(var t in this._changed)if(this._changed[t])return!0;return!1},e.prototype.SaveAll=function(){var t=this,e=this.Files.filter((function(e){return t._changed[e.id]}));e.length&&et(e,(function(e){return t.WriteFileContent(e.id)})).then((function(){t.ChangeTextState(!1)}))},e.prototype.Save=function(t){var e=this;return t||(t=this.GetActiveFile()),this._changed[t]?this.WriteFileContent(t).then((function(){e.ChangeTextState(!1,t)})):webix.promise.resolve()},e.prototype.WriteFileContent=function(t){var e=this,i=this._buffers[t].getValue();return this.app.getService("operations").write(t,i).then((function(){e._oldValue[t]=i}))},e.prototype.GetActiveFile=function(){return webix.env.mobile?this.Files[0].id:this.$$("tabbar").getValue()},e.prototype.GetFileType=function(t){if("Dockerfile"===t.value)return"dockerfile";if(t.$ext)for(var e in at)if(-1!==at[e].indexOf(t.$ext))return e;return"htmlmixed"},e.prototype.TextChanged=function(t){var e=this._buffers[t]==this._oldValue[t];this.ChangeTextState(!e,t)},e.prototype.ChangeTextState=function(t,e){e&&t===!!this._changed[e]||(e?this._changed[e]=t:this._changed={},webix.env.mobile?this.ChangeButtonState(t):this.ChangeTabsState(t,e))},e.prototype.ChangeButtonState=function(t){var e=this.$$("saveBtn");e.config.icon=t?"webix_fmanager_icon fmi-circle":"wxi-check",e.refresh()},e.prototype.ChangeTabsState=function(t,e){var i=this.$$("tabbar");if(e){var n=i.getOption(e);this.ChangeTabState(n,t)}else for(var r=i.config.options,o=0;o<r.length;++o)this.ChangeTabState(r[o],t);i.refresh()},e.prototype.ChangeTabState=function(t,e){t.value=t.value.replace(e?"wxi-close":"webix_fmanager_icon fmi-circle",e?"webix_fmanager_icon fmi-circle":"wxi-close")},e.prototype.CloseTab=function(t){var e=this.$$("tabbar");if(e.removeOption(t),!e.getValue())return this.Back();delete this._buffers[t],delete this._changed[t],delete this._oldValue[t]},e}(u);webix.protoUI({name:"toolbar-filter",defaults:{css:"webix_fmanager_filterbar"},$setSize:function(){webix.ui.toolbar.prototype.$setSize.apply(this,arguments),this.config.compact||this.getChildViews().forEach((function(t){return t.refresh()}))}},webix.ui.toolbar);var ct={setInput:function(t){var e=this.getInputNode();if(e.innerHTML)if(this.config.compact)e.innerHTML=this.config.innerLabel+"<span class='webix_fmanager_filter-badge'></span>";else{var i=e.innerHTML;"info"===t?i=i.replace(/\s\([a-zA-Z\d\s&gt;-]*\)/g,""):"html"===t&&(i=i.replace(/<[^>]*>/g,"")),e.innerHTML=this.config.innerLabel+" ("+i+")"}else e.innerHTML=""+this.config.innerLabel;this.setInputSize(e)},setInputSize:function(t){t||(t=this.getInputNode()),webix.html.addCss(document.body,"webix_fmanager_filter");var e=webix.html.getTextSize(t.innerHTML,"webix_inp_static").width+22;webix.html.removeCss(document.body,"webix_fmanager_filter");var i=Math.floor(this.getParentView().$width/4);this.define({width:Math.min(e,i)}),this.adjust()}};function lt(){var t=this.count(),e=this.config.autoheight;t>7&&e?(this.define({autoheight:!1,yCount:7,scrollY:!0}),this.refreshColumns()):t<=7&&!e&&(this.define({autoheight:!0,yCount:0}),this.refreshColumns())}webix.protoUI({name:"multiselect-fm",defaults:{icon:"wxi-angle-down",css:"webix_fmanager_filter"},$setValue:function(){webix.ui.multiselect.prototype.$setValue.apply(this,arguments),this.setInput("info")}},ct,webix.ui.multiselect),webix.protoUI({name:"richselect-fm",$cssName:"richselect",defaults:{icon:"wxi-angle-down",css:"webix_fmanager_filter"},$setValue:function(t){var e=t.split(":");this.config.subvalue=e[1],webix.ui.richselect.prototype.$setValue.apply(this,[e[0]]),this.setInput("html")},$prepareValue:function(t){return"custom"===t?t+":"+this.getSubValue():webix.ui.richselect.prototype.$prepareValue.apply(this,arguments)},$compareValue:function(t,e){return(0!==t.indexOf("custom")||0!==e.indexOf("custom"))&&webix.ui.richselect.prototype.$compareValue.apply(this,arguments)},getSubValue:function(){return this.config.subvalue}},ct,webix.ui.richselect),webix.protoUI({name:"daterangepicker-fm",defaults:{icon:"wxi-angle-down",css:"webix_fmanager_filter"},$setValue:function(){webix.ui.daterangepicker.prototype.$setValue.apply(this,arguments),this.setInput()}},ct,webix.ui.daterangepicker),webix.protoUI({name:"checksuggest-fm",defaults:{css:"webix_fmanager_filter-checksuggest",selectAll:!0},$init:function(t){t.body.rows[1].yCount=8,t.body.rows.push({view:"label",label:t.innerLabel,css:"webix_fmanager_multilist-label"})}},webix.ui.checksuggest),webix.protoUI({name:"daterangesuggest-fm",defaults:{css:"webix_fmanager_filter-daterangesuggest",body:{button:!1,icons:!0}},$init:function(t){var e=t.body;t.body={rows:[{cols:[{view:"label",label:t.innerLabel,css:"webix_fmanager_daterange-label",height:22},{view:"button",value:t.buttonLabel,autowidth:!0,height:22,css:"webix_secondary webix_fmanager_daterange-button",click:function(){this.getTopParentView().hide()}}]},e]}},getRange:function(){return this.getBody().queryView("daterange")},getList:function(){return this.getRange()},getButton:function(){return this.getBody().queryView("button")}},webix.ui.daterangesuggest),webix.protoUI({name:"richsuggest-fm",defaults:{css:"webix_fmanager_filter-richsuggest"},$init:function(t){var e=this,i={view:"label",label:t.innerLabel,css:"webix_fmanager_richsuggest-label"},n={view:"list",data:t.data,select:!0,navigation:!0,autoheight:!0,borderless:!0,template:function(t){return'<span class="webix_icon '+(t.$checked?"wxi-radiobox-marked":"wxi-radiobox-blank")+'"></span>'+t.value},on:{onAfterSelect:function(t){this.data.each((function(e){e.id===t?e.$checked=!0:e.$checked=!1})),this.refresh();var e=this.getTopParentView(),i=e.queryView({localId:"folders"});if("custom"===t)i.show(),e.getInput().focus();else{i.hide();var n=e.getTree();n&&n.unselect()}}}},r={view:"text",localId:"input",placeholder:t.inputPlaceholder,on:{onTimedKeyPress:function(){var t=e.getTree(),i=e.getInput().getValue().trim().toLowerCase();i?t.filter((function(t){return-1!==t.value.toLowerCase().indexOf(i)})):t.filter()}}},o={view:"treetable",localId:"tree",borderless:!0,select:!0,header:!1,scrollX:!1,autoheight:!0,rowHeight:webix.skin.$active.propertyItemHeight,type:{folder:function(t){return"<div class='webix_icon wxi-"+(t.icon||"folder")+"'></div>"}},columns:[{id:"value",fillspace:!0,template:function(e,i){return""+i.space(e)+i.icon(e)+i.folder(e)+" <span>"+(1===e.$level?t.rootName:e.value)+"</span>"}}],data:[],on:{onAfterSelect:function(t){var i=webix.copy(e.getList().getItem("custom"));i.id=i.id+":"+t.id,e.setMasterValue(i,!1,"fm-path")},onAfterOpen:function(){lt.call(this)},onAfterClose:function(){lt.call(this)}}};t.body={rows:[i,n,{localId:"folders",hidden:!0,padding:{right:12,left:12},rows:[r,o]}],padding:{bottom:12}},this.attachEvent("onShow",(function(){var t=webix.$$(e.config.master).getSubValue();if(t){var i=e.queryView({localId:"tree"});i.blockEvent(),i.select(t),i.unblockEvent()}}))},getList:function(){return this.queryView("list")},setMasterValue:function(t,e,i){0===t.id.indexOf("custom")&&"fm-path"!==i&&(e=!0),webix.ui.suggest.prototype.setMasterValue.apply(this,[t,e,i])},getMasterValue:function(){return webix.ui.suggest.prototype.getMasterValue.apply(this).split(":")[0]},getTree:function(){return this.queryView({localId:"tree"})},getInput:function(){return this.queryView({localId:"input"})},parseSubData:function(t){this.getTree().parse(t)}},webix.ui.suggest);var ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){this._=this.app.getService("locale")._;var t=this.getParam("compact",!0);return{view:"toolbar-filter",localId:"toolbar",borderless:!0,compact:t,cols:[{view:"multiselect-fm",name:"type",innerLabel:this._("Type"),compact:t,stringResult:!1,options:{view:"checksuggest-fm",innerLabel:this._("Type"),data:this.GetFileTypes(),width:200,fitMaster:!1}},{view:"daterangepicker-fm",name:"date",innerLabel:this._("Date"),compact:t,suggest:{view:"daterangesuggest-fm",innerLabel:this._("Date"),buttonLabel:this._("Apply"),body:{calendarCount:t?1:2}}},{view:"multiselect-fm",localId:"size",name:"size",innerLabel:this._("Size"),compact:t,stringResult:!1,options:{view:"checksuggest-fm",innerLabel:this._("Size"),data:this.GetSizes(),width:250,fitMaster:!1}},{view:"richselect-fm",localId:"location",value:"folder",name:"location",innerLabel:this._("Location"),compact:t,options:{view:"richsuggest-fm",rootName:this.app.getService("backend").getRootName(),innerLabel:this._("Location"),inputPlaceholder:this._("Search files and folders"),fitMaster:!1,width:280,data:this.GetLocations()}}]}},e.prototype.init=function(){var t=this;this.app.getService("local").folders().then((function(e){t.$$("location").getPopup().parseSubData(e)}));var e=this.getParam("state",!0),i=this.$$("toolbar");this.on(e.$changes,"filter",(function(e){return t.StateToFilter(e)})),this.on(i,"onChange",(function(t,e,i){if("user"===i||"fm-path"===i){var n=this.$scope.CleanEmptyValues(this.getValues());this.$scope.SetFilters(n)}}))},e.prototype.GetFileTypes=function(){return[{id:"archive",value:this._("Archives")},{id:"audio",value:this._("Audio")},{id:"code",value:this._("Code")},{id:"document",value:this._("Documents")},{id:"video",value:this._("Video")},{id:"image",value:this._("Images")},{id:"folder",value:this._("Folders")},{id:"file",value:this._("Other")}]},e.prototype.GetSizes=function(){return[{id:"tiny",value:this._("Tiny")+" (0 - 16 "+this._("kB")+")",range:{start:0,end:16384}},{id:"small",value:this._("Small")+" (16 "+this._("kB")+" - 1 "+this._("MB")+")",range:{start:16385,end:1048576}},{id:"medium",value:this._("Medium")+" (1 "+this._("MB")+" - 128 "+this._("MB")+")",range:{start:1048577,end:134217728}},{id:"huge",value:this._("Huge")+" (128 "+this._("MB")+" - 4 "+this._("GB")+")",range:{start:134217729,end:1073741824}},{id:"gigantic",value:this._("Gigantic")+" (> 4 "+this._("GB")+")",range:{start:1073741825,end:null}}]},e.prototype.StateToFilter=function(t){var e=this.$$("toolbar");if(!t&&e.isDirty())e.setValues({location:"folder"});else if(t&&!e.isDirty()){var i=n({},t);i.size&&(i.size=this.SetSizesFromState(i.size)),i.location&&0===i.location.indexOf("/")&&(i.location="custom:"+i.location),e.setValues(i)}},e.prototype.SetSizesFromState=function(t){var e=this.GetSizes();return t.map((function(t){var i=e.find((function(e){return e.range.start===t.start}));return i?i.id:null})).filter((function(t){return t}))},e.prototype.GetLocations=function(){return[{id:"global",value:this._("Global Search")},{id:"folder",value:this._("This Folder")},{id:"custom",value:this._("Custom Location")}]},e.prototype.SetFilters=function(t){var e=this.getParam("state",!0);if(0===t.location.indexOf("custom")&&(t.location=t.location.split(":")[1]),t.size){var i=this.$$("size").getList();t.size=t.size.map((function(t){return i.getItem(t).range}))}e.filter=t},e.prototype.CleanEmptyValues=function(t){var e={};for(var i in t)t[i]&&("object"==typeof t[i]?Array.isArray(t[i])?t[i].length&&(e[i]=t[i]):t[i].start&&(e[i]=webix.copy(t[i])):e[i]=t[i]);return e},e}(u);function ht(t,e){var i=new webix.promise.defer;return webix.ui(e.getService("jet-win").updateConfig({view:"window",css:"webix_fmanager_prompt",head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,elements:[{view:"label",label:t.text},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){i.reject("prompt cancelled"),this.getTopParentView().close()}}]},body:{view:"form",padding:{top:0,left:12,right:12,bottom:12},rows:[{margin:10,cols:[{view:"text",name:"name",value:t.value,maxWidth:230,validate:rt,css:"webix_fmanager_prompt_input"},{view:"button",value:t.button,css:"webix_primary",width:100,hotkey:"enter",click:function(){var t=this.getTopParentView(),e=t.getBody();if(e.validate()){var n=e.getValues().name;i.resolve(n),t.close()}else webix.UIManager.setFocus(e)}}]}]},on:{onShow:function(){var e=this.getBody().elements.name.getInputNode();e.focus(),t.selectMask?t.selectMask(e):e.select()}}})).show(),i}var pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",width:198,body:{view:"menu",autoheight:!0,layout:"y",css:"webix_fmanager_add_new_menu",data:[{id:"makefile",value:e("Add new file"),icon:"webix_fmanager_icon fmi-file-plus-outline"},{id:"makedir",value:e("Add new folder"),icon:"webix_fmanager_icon fmi-folder-plus-outline"},{$template:"Separator"},{id:"upload",value:e("Upload file"),icon:"webix_fmanager_icon fmi-file-upload-outline"},{id:"uploaddir",value:e("Upload folder"),icon:"webix_fmanager_icon fmi-folder-upload-outline"}],on:{onMenuItemClick:function(e){return t.StartAction(e)}}}}},e.prototype.Show=function(t){this.getRoot().show(t,{x:20})},e.prototype.StartAction=function(t){var e=this;if("makefile"===t||"makedir"===t){var i=this.app.getService("locale")._;ht({text:i("Enter a new name"),button:i("Add"),selectMask:tt,value:"New "+("makefile"===t?"file.txt":"folder")},this.app).then((function(i){e.app.callEvent("app:action",[t,rt(i)])}))}else this.app.callEvent("app:action",[t]);this.getRoot().hide()},e}(u),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"proxy",body:{rows:[{view:"button",value:e("Add New"),inputWidth:210,css:"webix_primary",align:"center",click:function(){this.$scope.Menu.Show(this.$view)}},{view:"tree",localId:"tree",css:"webix_fmanager_tree",select:!0,drag:"target",type:{template:function(t,i){return""+i.icon(t)+i.folder(t)+" <span>"+(1===t.$level?e(t.value):t.value)+"</span>"},folder:function(t){return"<div class='webix_icon wxi-"+(t.icon||"folder")+"'></div>"}},borderless:!0,on:{onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)},onBeforeContextMenu:function(e){if(".."===e.substr(0,2))return!1;t.Tree.select(e)},onItemClick:function(){setTimeout((function(){t.app.callEvent("app:action",["toggle-folders"])}),50)}}},{localId:"fs:stats",borderless:!0,height:68,css:"webix_fmanager_fsstats",template:function(t){return'<svg width="100%" height="20px">\n<rect y="1" rx="4" width="100%" height="8" style="fill:#DFE2E6;" />\n<rect y="1" rx="4" width="'+(Math.floor(t.used/t.total*100)||0)+'%" height="8" style="fill:'+webix.skin.$active.timelineColor+';" /></svg>'+('<div class="webix_fmanager_fsstats_label">'+it(t.used||0,e)+" "+e("of")+" "+it(t.total||0,e)+" "+e("used")+"</div>")}}],padding:{top:8,bottom:4}}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.Tree=this.$$("tree"),this.app.getService("local").folders().then((function(e){t.Tree.sync(e),t.Subscribe(),t.GetFsStats()})),this.Menu=this.ui(pt),this.ContextMenu=this.ui(new(this.app.dynamic(J))(this.app,{compact:!1,tree:!0})),this.ContextMenu.AttachTo(this.Tree,(function(e){var i=t.Tree.locate(e);return i?[t.Tree.getItem(i)]:null})),this.on(this.app,"reload:fs:stats",(function(){return t.GetFsStats(!0)}))},e.prototype.Subscribe=function(){var t=this;this.Tree.attachEvent("onAfterSelect",(function(){var e=t.Tree.getSelectedId();".."==e.substr(0,2)?t.State.$batch({source:e.slice(3),path:"/"}):t.State.$batch({source:t.GetRootId(e).slice(3),path:e}),t.TreeState=t.Tree.getState()})),this.Tree.attachEvent("onAfterOpen",(function(){t.TreeState=t.Tree.getState()})),this.on(this.State.$changes,"path",(function(e){if(t.State.path=e,t.Tree.exists(e)){t.Tree.select(e);var i=t.Tree.getParentId(e);i&&t.Tree.open(i),t.Tree.showItem(e)}else t.Tree.select("../"+t.State.source)})),this.app.getService("local").folders().then((function(e){t.on(e.data,"onStoreUpdated",(function(e){!e&&t.Tree.count()&&t.Tree.setState(t.TreeState)}))}))},e.prototype.GetFsStats=function(t){var e=this;this.app.getService("backend").getInfo(t).then((function(t){e.$$("fs:stats").setValues(t.stats)}))},e.prototype.MoveFiles=function(t,e){return"../files"===e&&(e="/"),this.app.getService("operations").move(t,e),!1},e.prototype.GetRootId=function(t){for(var e;t;)e=t,t=this.Tree.getParentId(t);return e},e}(u),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n={view:"datatable",localId:"table",css:"webix_noselect webix_header_border webix_fmanager_filelist",select:"row",multiselect:!0,drag:!0,resizeColumn:{headerOnly:!0},sort:"multi",type:{backIcon:function(){return"<span class='webix_icon wxi-angle-double-left webix_fmanager_back_icon'></span>"},backLabel:function(){return e("back to parent folder")}},on:{onItemDblClick:function(){return t.Activate(t.GetSelection())},onEnter:function(){return t.Activate(t.GetSelection())},onBeforeDrag:function(e){return t.DragMarker(e)},onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)},"data->onStoreLoad":function(){t.WTable.markSorting()}},onClick:{webix_ss_center_scroll:function(){return t.EmptyClick()},webix_column:function(){return!1}},onContext:{webix_ss_center_scroll:function(e,i){i||t.EmptyClick()}},columns:[{id:"value",header:"",template:function(e){return t.NameTemplate(e)},sort:vt("value"),fillspace:!0},{id:"size",header:e("Size"),template:function(t){return"folder"!==t.type?it(t.size,e):""},sort:vt("size")},{id:"date",header:e("Date"),sort:vt("date"),format:function(t){return t instanceof Date&&!isNaN(t)?webix.i18n.longDateFormatStr(t):""},width:150}]};return i&&n.columns.splice(1,2),n},e.prototype.init=function(){var e=this;this.WTable=this.$$("table"),t.prototype.init.call(this),this.on(this.State.$changes,"isActive",(function(t){t?(e.SelectActive(),webix.delay((function(){return webix.UIManager.setFocus(e.WTable)}))):(e.Menu.Hide(),e._Track=!1,e.WTable.unselect(),e._Track=!0)})),this.on(G(this.getRoot()),"TAB",(function(){e.getParam("trackActive",!0)&&(e.State.isActive=!1)}))},e.prototype.RenderData=function(t){this.WTable.sync(t)},e.prototype.NameTemplate=function(t){return"folder"===t.type?N+t.value:this.Icon(t)+'<span class="file-name">'+t.value+"</span>"},e}(Y);function vt(t){return function(e,i){return".."===e.value||".."===i.value||"folder"===e.type&&"folder"!==i.type||"folder"===i.type&&"folder"!==e.type?0:"value"===t?e.value.localeCompare(i.value,void 0,{ignorePunctuation:!0,numeric:!0}):e[t]<i[t]?-1:e[t]>i[t]?1:0}}var gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",width:198,body:{view:"menu",autoheight:!0,layout:"y",css:"webix_fmanager_add_new_menu",data:[{id:"reload",value:e("Reload folder"),icon:"webix_fmanager_icon wxi-sync"},{id:"fullLoad",value:e("Reload without limit"),icon:"webix_fmanager_icon wxi-sync"}],on:{onMenuItemClick:function(e){return t.StartAction(e)}}}}},e.prototype.Show=function(t){this.getRoot().show(t)},e.prototype.StartAction=function(t){"reload"===t?this.app.getService("local").refresh(this.app.getState().path):"fullLoad"===t&&this.app.getService("local").refresh(this.app.getState().path,!0),this.getRoot().hide()},e}(u),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return this.app.getService("jet-win").updateConfig({view:"window",borderless:!0,head:!1,fullscreen:!0,body:{$subview:!0,branch:!0,name:"preview"}})},e.prototype.IsVisible=function(){return this.getRoot().isVisible()},e.prototype.Show=function(t){this.show("preview",{target:"preview",params:{state:t.state,compact:!0}}),this.getRoot().show()},e.prototype.Hide=function(){this.show("_blank",{target:"preview"}),this.getRoot().hide()},e}(u),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"sidemenu",css:"webix_files_sidemenu",width:300,animate:!1,state:function(e){var i=webix.skin.$active.toolbarHeight+14;e.left=t.Parent.left,e.top=t.Parent.top+i,e.height=t.Parent.height-i},body:ft}},e.prototype.init=function(){var t=this;this.on(this.app,"view:resize",(function(){t.getRoot().isVisible()&&t.Show(!0)}))},e.prototype.Toggle=function(){this.getRoot().isVisible()?this.getRoot().hide():this.Show()},e.prototype.Show=function(t){!t&&this.getRoot().isVisible()||(this.Parent=this.app.getRoot().$view.getBoundingClientRect(),this.getRoot().show())},e}(u),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{type:"wide",cols:[{$subview:!0,branch:!0,name:"left"},{view:"resizer"},{$subview:!0,branch:!0,name:"right"}]}},e.prototype.init=function(){this.State=this.getParam("state");var t=z({selectedItem:[].concat(this.State.selectedItem),path:this.State.path,source:this.GetSource("left"),mode:"list",isActive:!0,loadStatus:this.State.loadStatus});t.selectedItem.$noSelect=this.State.selectedItem.$noSelect;var e=z({selectedItem:[],path:this.State.path,source:this.GetSource("right"),mode:"list",isActive:!1,loadStatus:this.State.loadStatus});this.on(this.State.$changes,"loadStatus",(function(i){i&&(t.loadStatus=e.loadStatus=n({},i))})),this._TrackChanges(t,e),this._TrackChanges(e,t),this.on(this.State.$changes,"path",(function(i){t.isActive?t.path=i:e.isActive&&(e.path=i)})),this.on(this.State.$changes,"selectedItem",(function(i){t.isActive?t.selectedItem=i:e.isActive&&(e.selectedItem=i)})),this.show("panel/list",{target:"left",params:{trackActive:!0,state:t}}),this.show("panel/list",{target:"right",params:{trackActive:!0,state:e}})},e.prototype._TrackChanges=function(t,e){var i=this;this.on(t.$changes,"path",(function(e){t.isActive&&(i.State.path=e)})),this.on(t.$changes,"source",(function(e){t.isActive&&(i.State.source=e)})),this.on(t.$changes,"selectedItem",(function(e){t.isActive&&(i.State.selectedItem=e)})),this.on(t.$changes,"isActive",(function(n){e.isActive=!n,n&&i.State.$batch({path:t.path,source:t.source})})),this.on(this.app,"pathChanged",(function(e,i){t.isActive||t.path!==e&&0!==t.path.indexOf(e+"/")||(t.path=t.path.replace(e,i))}))},e.prototype.GetSource=function(){return this.State.source},e}(u),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state");var e=this.app.getService("locale")._;return this.LoadWarning=this.app.getService("loadWarning"),this.Backend=this.app.getService("backend"),{rows:[{view:"toolbar",padding:{right:12},cols:[{view:"icon",icon:"wxi-angle-left",click:function(){return t.Back()}},{localId:"header",type:"header",borderless:!0,css:"webix_fmanager_path",template:function(i){return t.PathTemplate(i,e)}},{},this.GetModeSwitch(e)]},{$subview:!0,params:{state:this.State}}]}},e.prototype.init=function(){var t=this,e=this.$$("header");e.setValues({path:this.State.path}),webix.TooltipControl.addTooltip(e.$view);var i=this.$$("modes");this.on(i,"onChange",(function(e){e&&(t.State.mode="search-"+e)})),this.on(this.State.$changes,"mode",(function(t){if("search"===t||0===t.indexOf("search-")){var e=t.split("-")[1]||"cards";i.getOption(e)&&i.setValue(e)}})),this.on(this.State.$changes,"filter",(function(e){return t.HandleFilter(e)})),this.app.config.limit&&this.HandleLoadLimit()},e.prototype.Back=function(){this.State.$batch({search:"",searchStats:null,filter:null})},e.prototype.GetModeSwitch=function(t){return{view:"segmented",width:84,optionWidth:40,localId:"modes",value:"cards",tooltip:function(e){switch(e.id){case"grid":return t("Table");case"cards":return t("Cards");default:return ot(e.id+"")}},options:[{value:K,id:"grid"},{value:X,id:"cards"}]}},e.prototype.PathTemplate=function(t,e){var i=e("Search results in"),n=this.Backend.getRootName(),r="";return t&&t.path&&"/"!==t.path&&(r=webix.template.escape(t.path)),this.app.config.limit&&t.total&&(r+=this.LoadWarning.getSvgIcon(t,!0)),i+" "+n+r},e.prototype.UpdateStatus=function(t,e){return t&&t.total-t.loaded>0&&(e.total=t.total),e},e.prototype.HandleFilter=function(t){if(t){var e=this.State.path;"global"===t.location||"../files"===t.location?e="/":"folder"!==t.location&&(e=t.location),this._searchPath=e,this.$$("header").setValues(this.UpdateStatus(t["s-"+this._searchPath],{path:e}))}},e.prototype.HandleLoadLimit=function(){var t=this,e=this.$$("header");this.on(this.State.$changes,"loadStatus",(function(i){i&&t._searchPath&&e.setValues(t.UpdateStatus(i["s-"+t._searchPath],{path:t._searchPath}))}))},e}(u),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.LoadWarning=this.app.getService("loadWarning"),this.Local=this.app.getService("local");var e={view:"template",type:"header",localId:"path",borderless:!0,css:"webix_fmanager_path",template:function(e){return t.RenderPath(e)},onClick:{webix_fmanager_path_chunk:function(e){return t.ChangePath(e)}}};return{rows:[{view:"toolbar",paddingX:4,cols:[{view:"button",localId:"refresh",type:"icon",icon:"wxi-sync",css:"webix_transparent webix_fmanager_spec_icon",width:webix.skin.$active.inputHeight+2,click:function(){return t.HandleRefresh()}},e]},{$subview:!0,params:{state:this.getParam("state")}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.on(this.State.$changes,"path",(function(e){return t.ProcessPath(e)})),this.app.config.limit&&(webix.TooltipControl.addTooltip(this.$$("path").$view),this.on(this.State.$changes,"loadStatus",(function(e){return t.HandleLoadStatus(e)})),this.Menu=this.ui(gt));var e=this.app.getService("upload").getUploader();e.addDropZone(this.getRoot().$view),this.on(e,"onBeforeFileDrop",(function(i,n){t.getRoot().$view.contains(n.target)&&(e.config.tempUrlData={id:t.State.path})}))},e.prototype.ProcessPath=function(t){var e=this;this.app.getService("local").folders().then((function(i){var n=["/"];if("/"!==t)for(var r=t.split("/"),o=1,a="";o<r.length;++o)a+="/"+r[o],n.push(i.getItem(a).value);e.$$("path").setValues({path:n}),e.app.config.limit&&e.State.loadStatus&&e.RefreshButtonWarning(e.State.loadStatus[t])}))},e.prototype.RenderPath=function(t){if(t.path&&t.path.length){var e=this.app.getService("backend").getRootName(),i="";return t.path.forEach((function(n,r){i+='<span class="webix_fmanager_path_chunk" data-path="'+r+'">'+(r?n:e)+"</span>",r<t.path.length-1&&(i+="<span class='webix_icon wxi-angle-right'></span>")})),i}return""},e.prototype.ChangePath=function(t){var e=1*t.target.getAttribute("data-path"),i=this.State.path.split("/");i.splice(e+1,i.length-1);var n=i.join("/")||"/";this.State.path=n},e.prototype.HandleRefresh=function(){var t=this.State.loadStatus&&this.State.loadStatus[this.State.path];this.NotAllLoaded(t)?this.Menu.Show(this.$$("refresh").$view):this.Local.refresh(this.State.path,!(!t||!t.forced))},e.prototype.HandleLoadStatus=function(t){t&&this.State.path&&this.RefreshButtonWarning(t[this.State.path])},e.prototype.NotAllLoaded=function(t){return t&&t.total-t.loaded>0},e.prototype.RefreshButtonWarning=function(t){var e="",i=(0,this.app.getService("locale")._)("Refresh");this.NotAllLoaded(t)&&(e=this.LoadWarning.getSvgIcon(),i=this.LoadWarning.getWarningTooltip(t));var n=this.$$("refresh");n.define({label:e,tooltip:i}),n.refresh()},e}(u),xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this.app.getService("locale")._,e={localId:"search:counter",css:"webix_fmanager_preview_info",height:104,borderless:!0,template:function(e){return"<div>"+("<div class='key_col search'>"+["Folders","Files"].map((function(e){return"<div class='key_value_cell'>"+t(e)+"</div>"})).join("")+"</div>")+('<div class="value_col search">'+[e.folders,e.files].map((function(t){return"<div class='key_value_cell'>"+(t||0)+"</div>"})).join("")+"</div>")+"</div>"}};return{localId:"info:tabs",view:"tabview",css:"webix_fmanager_info_tab",cells:[{header:t("Information"),body:{padding:14,margin:14,rows:[this.GetMainInfo(),this.GetExtraInfo(),{}]}},{header:t("Search results"),body:{padding:14,margin:14,rows:[e,{}]}}]}},e.prototype.init=function(){var t=this;this.Tabview=this.$$("info:tabs"),this.State=this.getParam("state"),this.on(this.State.$changes,"selectedItem",(function(e){t.ShowInfo(nt(e))})),this.on(this.State.$changes,"searchStats",(function(e){e?t.$$("search:counter").setValues(e):t.State.selectedItem.length||t.Tabview.hide()}))},e.prototype.GetMainInfo=function(){var t=this,e=this.app.getService("locale")._,i=webix.Date.dateToStr("%M %j, %Y&nbsp;&nbsp;&nbsp;&nbsp;%H:%i:%s");this.Local=this.app.getService("local");var n={type:{label:"Type",template:function(t){return ot(e(t))}},size:{label:"Size",template:function(t){return it(t,e)}},date:{label:"Date",template:i},id:{label:"Location",template:function(e){return t.LocationTemplate(e)}}},r=["type","date","id"],o=["type","size","date","id"];return{css:"webix_fmanager_preview_info",localId:"info",borderless:!0,autoheight:!0,tooltip:{overflow:!0},template:function(t){return t.id?"<div>"+("<div class='key_col'>"+("folder"===t.type?r:o).map((function(t){return"<div class='key_value_cell'>"+e(n[t].label)+"</div>"})).join("")+"</div>")+('<div class="value_col">'+("folder"===t.type?r:o).map((function(e){return"<div class='key_value_cell'>"+n[e].template(t[e])+"</div>"})).join("")+"</div>")+"</div>":""},onClick:{search:function(e){return t.OpenLocation(e)}}}},e.prototype.LocationTemplate=function(t){var e=this.Local.getParentId(t);return'<div webix_tooltip="'+e+'"><span class="webix_fmanager_info_location'+(this.State.search||this.State.filter?" search":"")+'">'+e+"</span></div>"},e.prototype.OpenLocation=function(t){this.State.$batch({path:t.target.innerHTML,search:"",filter:null})},e.prototype.GetExtraInfo=function(){return{css:"webix_fmanager_preview_info extra",localId:"extra:info",hidden:!0,autoheight:!0,template:function(t){for(var e=Object.keys(t),i="<div class='key_col'>",n=0;n<e.length;++n)i+="<div class='key_value_cell key'>"+e[n]+"</div>";i+="</div>";var r="<div class='value_col'>";for(var o in t){var a=t[o].trim();r+="<div class='key_value_cell'>"+(a&&"0"!=a?a:"<span class='webix_fmanager_id3tags-unknown'>Unknown</span>")+"</div>"}return'<div><div class="webix_fmanager_info_header">\n<span class="webix_fmanager_icon fmi-information-outline"></span>\n<span class="webix_fmanager_info_title">Extra info</span>\n</div>'+i+(r+="</div>")+"</div>"}}},e.prototype.ShowInfo=function(t){var e=this,i=this.Tabview.getTabbar(),n=i.config.options[0].id,r=i.config.options[1].id;if("empty"!==t.type){this.SetInfo(this.$$("info"),t),this.SwitchTabs(i,r,n);var o=this.$$("extra:info"),a=this.app.getService("backend").getMeta(t);a?a.then((function(t){return e.SetExtraInfo(o,t)})).catch((function(){return o.hide()})):o.hide()}else this.State.search||this.State.filter?this.SwitchTabs(i,n,r):this.Tabview.hide()},e.prototype.SetExtraInfo=function(t,e){!function t(e){for(var i in e){if("object"==typeof e[i])return t(e[i]);if(e[i]&&"0"!==e[i])return!1}return!0}(e)?this.SetInfo(t,e):t.hide()},e.prototype.SetInfo=function(t,e){t.setValues(e),t.show()},e.prototype.SwitchTabs=function(t,e,i){t.hideOption(e),t.setValue(i),t.showOption(i),this.Tabview.show()},e}(u);var St=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact"),n=this.getParam("state");return{margin:.1,rows:[{view:"toolbar",localId:"toolbar",padding:{right:6},elements:[{view:"label",localId:"filename:label",css:"webix_fmanager_preview_name"},{view:"icon",icon:"wxi-download",css:"webix_fmanager_spec_icon",localId:"download",tooltip:e("Download file"),click:function(){t.app.callEvent("app:action",["download",[t.FileInfo]])}},{view:"icon",icon:"wxi-close",hidden:!i,click:function(){n.preview=!n.preview}}]},{view:"scrollview",borderless:!0,body:{type:"wide",margin:10,rows:[{view:"proxy",minHeight:413,borderless:!0,body:{$subview:!0,name:"preview"}},xt]}}]}},e.prototype.init=function(){var t=this;this.on(this.getParam("state").$changes,"selectedItem",(function(e){var i=nt(e);t.ShowInfo(i),t.FileInfo=i;var n=t.$$("download");"folder"===i.type?n.hide():n.show()}))},e.prototype.ShowInfo=function(t){var e="preview.template";!this.app.config.player||"audio"!==t.type&&"video"!==t.type||(e="preview.media"),"empty"!==t.type?(this.$$("filename:label").setValue(t.value),this.$$("toolbar").show()):this.$$("toolbar").hide(),this.show(e,{target:"preview",params:{info:t}})},e}(u);webix.protoUI({name:"plyr-player",defaults:{config:{},source:{}},$init:function(){this.$view.innerHTML='<div class="webix_player_parent"><audio></audio></div>',this._container=this.$view.firstChild.firstChild,this.$view.style.overflow="visible",this._waitView=webix.promise.defer(),this.$ready.push(this.render)},getPlayer:function(t){return t?this._waitView:this._player},render:function(){if(!1===this.config.cdn||window.Plyr)this._initPlyr();else{var t=this.config.cdn?this.config.cdn:"https://cdn.plyr.io/3.5.10";webix.require([t+"/plyr.js",t+"/plyr.css"]).then(webix.bind(this._initPlyr,this)).catch((function(t){console.log(t)}))}},_initPlyr:function(){if(this.$view){var t=webix.extend({},this.config.config);this._player=new Plyr(this._container,t),this._player.elements.container.setAttribute("tabindex","-1"),this.attachEvent("onDestroy",(function(){this._player&&this._player.destroy()})),this._waitView.resolve(this._player),this._player.on("canplay",webix.bind((function(){this._player.media&&(this._player.media.setAttribute("tabindex","-1"),this._normalizeRatio())}),this)),this._player.on("ready",webix.bind((function(){this.$view&&(this.$view.querySelector(".plyr--full-ui").style["min-width"]="0px",this._normalizeRatio())}),this))}},$setSize:function(t,e){this.$view.firstChild.style.width=t+"px",this.$view.firstChild.style.height=e-2+"px",this._player&&this._normalizeRatio(t,e)},source_setter:function(t){this._waitView.then((function(e){t&&(e.source=t)}))},getPlyr:function(t){return t?this._waitView:this._player},_gcdRatio:function(t,e){for(t=Math.abs(t),e=Math.abs(e);e;){var i=e;e=t%e,t=i}return t},_normalizeRatio:function(t,e){if(this.$view){t=t||this.$view.clientWidth,e=e||this.$view.clientHeight;var i=this._gcdRatio(t,e),n=(t/i).toString()+":"+(e/i).toString();this._player.ratio=n}}},webix.ui.view,webix.EventSystem);var $t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[{localId:"albumArt",hidden:!0,css:"webix_fmanager_preview",template:'<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"audio"},"big")+'" />'},{view:"plyr-player",css:"webix_fmanager_player",localId:"player",config:{controls:["play-large","play","progress","current-time","mute","volume"]}}]}},e.prototype.init=function(){var t=this,e=this.$$("albumArt").$view;webix.event(e,"dblclick",(function(){var e=t.getParam("info");t.app.callEvent("app:action",["open",[e]])}))},e.prototype.urlChange=function(){var t=this.getParam("info");this.ShowPreview(t)},e.prototype.ShowPreview=function(t){if(t){var e=this.app.getService("backend").directLink(t.id);this.SetMedia(e,t.type,t.$ext);var i=this.$$("albumArt"),n=this.$$("player");"audio"===t.type?(n.config.height=52,i.show()):(n.config.height=0,i.hide())}},e.prototype.SetMedia=function(t,e,i){this.$$("player").define({source:{type:e,sources:[{src:t,type:e+"/"+i}]}})},e}(u),kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"template",localId:"preview",css:"webix_fmanager_preview"}},e.prototype.init=function(){var t=this,e=this.getRoot().$view;webix.event(e,"dblclick",(function(){var e=t.getParam("info");"code"===e.type&&t.app.config.editor?t.app.callEvent("app:action",["edit",[e]]):"folder"!==e.type&&"empty"!==e.type&&t.app.callEvent("app:action",["open",[e]])}))},e.prototype.urlChange=function(){var t=this.getParam("info");this.ShowPreview(t)},e.prototype.ShowPreview=function(t){var e=this.$$("preview");if("folder"===t.type)e.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"folder"},"big")+'" />');else if("empty"===t.type)e.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"none"},"big")+'" />');else{var i=this.app.getService("backend").previewURL(t,464,407);e.setHTML("<img style='width:100%; height:100%;' src='"+i+"' onerror='this.style.display=\"none\"'>")}},e}(u),Ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return this.Config=this.getParam("config"),this.app.getService("jet-win").updateConfig({view:"window",css:"webix_fmanager_progress",head:{template:this.Config.head,css:"webix_fmanager_progress_head",height:54},body:{padding:{top:0,bottom:20,left:20,right:20},margin:10,rows:[{template:function(t){return'<div class="webix_fmanager_progress_bar">\n<div class="webix_fmanager_progress_counter">'+t.done+" of "+t.total+' items</div>\n<div class="webix_fmanager_progress_name">'+t.file+"</div></div>"},localId:"counter",borderless:!0,height:59},{view:"button",value:"Stop",css:"webix_fmanager_progress_cancel",click:function(){t.State.cancel=!0,t.getRoot().disable()}}]}})},e.prototype.ready=function(){var t=this;this.WaitClose=webix.promise.defer(),this.Counter=this.$$("counter"),this.Counter.setValues({done:0,total:this.Config.files.length,file:this.Config.files[0]}),webix.extend(this.Counter,webix.ProgressBar),this.State=z({i:0,cancel:!1}),et(this.Config.files,this.Config.code,this.State).finally((function(){return t.Close()})),this.on(this.State.$changes,"i",(function(e){return e&&t.Step(e)}))},e.prototype.Close=function(){this.Counter.showProgress({type:"bottom",position:1,delay:100}),this.show("_hidden",{target:"popup"}),this.WaitClose.resolve()},e.prototype.Step=function(t){var e=this.Counter.getValues().done;this.Counter.setValues({done:t,file:this.Config.files[t-1]},!0),e=(e+1)/this.Config.files.length,this.Counter.showProgress({type:"bottom",position:Math.min(1,e),delay:100})},e}(u),Tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.getParam("compact"),i=webix.skin.$active,n=this.app.getService("locale")._,r=this.getParam("state"),o={view:"button",hidden:!this.app.config.enableFilter,label:e?"":n("Filter"),localId:"filterButton",type:"icon",icon:"fmi-filter",css:"webix_secondary"+(e?" webix_fmanager_filter_compact":""),click:function(){return t.ToggleFilterBar()}};return e?o.width=40:o.autowidth=!0,{view:"toolbar",margin:e?0:20,paddingY:9,paddingX:e?4:12,cols:[{rows:[{cols:[{view:"icon",icon:"webix_fmanager_icon fmi-file-tree",click:function(){return t.app.callEvent("app:action",["toggle-folders"])},hidden:!e},{view:"label",label:n("Files"),autowidth:!0,hidden:e}]}]},{margin:8,rows:[{cols:[{margin:e?0:12,cols:[{view:"search",width:e?0:300,localId:"search",placeholder:n("Search files and folders")},o]},{hidden:e},{view:"toggle",css:"webix_fmanager_preview_toggle",type:"icon",icon:"wxi-eye",tooltip:n("Preview"),width:i.toolbarHeight<37?48:60,localId:"previewMode",on:{onChange:function(t,e,i){"user"===i&&(r.preview=!r.preview)}},hidden:e},{view:"segmented",width:124,optionWidth:40,localId:"modes",tooltip:function(t){switch(t.id){case"grid":return n("Table");case"cards":return n("Cards");case"double":return n("Total");default:return ot(t.id+"")}},options:[{value:K,id:"grid"},{value:X,id:"cards"},{value:"<span class='webix_fmanager_icon fmi-view-array webix_fmanager_mode_icon'></span>",id:"double"}]}]},{localId:"filterBar",view:"proxy",borderless:!0,hidden:!0,body:{$subview:!0}}]}]}},e.prototype.init=function(){var t=this,e=this.getParam("state"),i=this.$$("modes");this.on(i,"onChange",(function(t){t&&e.$batch({mode:t,search:"",filter:null})})),this.on(e.$changes,"mode",(function(t){i.getOption(t)?i.setValue(t):i.setValue()}));var n=this.$$("search");this.on(n,"onTimedKeyPress",(function(){e.search=n.getValue().trim()})),this.on(e.$changes,"search",(function(t){t=t.trim(),n.setValue(t)})),this.on(e.$changes,"filter",(function(e){t.CountFilters(e)})),this.on(e.$changes,"preview",(function(e){t.$$("previewMode").setValue(1*e)})),this.on(G(),(webix.env.isMac?"COMMAND":"CTRL")+" + F",(function(t,e){n.focus(),webix.html.preventEvent(e)}))},e.prototype.ToggleFilterBar=function(){var t=this.$$("filterBar");t.isVisible()?(this.show("_blank"),t.hide()):(this.show("filterbar"),t.show())},e.prototype.CountFilters=function(t){var e=this.$$("filterButton"),i=0;t&&(i=Object.keys(t).length,"folder"===t.location&&(i-=1)),e.config.badge=i||"",e.refresh()},e}(u),It=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){U||(U=!0,webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactHandler=e,this._app=t;var n=t.config;this._forceCompact=void 0!==n.params.forceCompact,this._compactWidth=n.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){(this._forceCompact||this._checkTrigger(t,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,t,e),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout));var t=this.getParam("forceCompact");webix.isUndefined(t)||this.setParam("compact",t),this.Compact=this.getParam("compact");var e={view:"proxy",batch:"tree",width:240,minWidth:240,maxWidth:400,hidden:!0,borderless:!0,body:ft},i={type:"wide",localId:"folders",cols:[{$subview:!0,name:"center",branch:!0},{view:"proxy",borderless:!0,width:470,hidden:!0,localId:"r-side",body:{$subview:"",branch:!0,name:"r-side"}}]};return this.Compact||i.cols.unshift(e,{view:"resizer",batch:"tree"}),{view:"r-layout",type:"wide",css:"webix_files_main_layout",rows:[Tt,i,{$subview:!0,popup:!0,name:"popup"}]}},e.prototype.init=function(){var t=this;this.getRoot().sizeTrigger(this.app,(function(e){return t.SetCompactMode(e)}),!!this.Compact);var e=this.getParam("state");this.State=e,this.Compact?(this.SideTree=this.ui(mt),this.PreviewPopup=this.ui(wt)):this.SideTree=this.PreviewPopup=null,this.on(this.app,"app:action",(function(e){switch(e){case"toggle-folders":t.SideTree&&t.SideTree.Toggle()}})),this.on(e.$changes,"mode",(function(e,i){return t.ShowMode(e,i)})),this.on(e.$changes,"search",(function(i){return t.ShowSearch(i,e.filter)})),this.on(e.$changes,"filter",(function(i){return t.ShowSearch(e.search,i)})),this.on(e.$changes,"preview",(function(e){return t.TogglePreview(e)})),this.app.getService("progress").handle(this.getRoot(),this.ShowProgress.bind(this))},e.prototype.ShowMode=function(t,e){var i=this.$$("folders"),n={target:"center",params:{state:this.getParam("state"),compact:this.Compact}};switch(t){case"grid":case"cards":i.showBatch("tree"),this.show("panel/"+this.PathToFileview(t),n);break;case"double":i.showBatch(""),this.show("panel-double",n);break;case"search":case"search-cards":case"search-grid":this.PrevMode=this.PrevMode||e,i.showBatch("");var r=t.split("-")[1]||"cards";this.show("panel-search/"+this.PathToFileview(r),n)}},e.prototype.PathToFileview=function(t){return"grid"===t?"list":t},e.prototype.ShowProgress=function(t){var e=this;return this.show("./progress",{target:"popup",params:t}).then((function(){return e.getSubView("popup")}))},e.prototype.TogglePreview=function(t){if(this.Compact)t?this.PreviewPopup.Show({state:this.State}):this.PreviewPopup.Hide();else{var e=this.$$("r-side");t?(this.show("preview",{target:"r-side",params:{state:this.State}}),e.show()):(this.show("_blank",{target:"r-side"}),e.hide())}},e.prototype.ShowSearch=function(t,e){t||e?"search"!==this.State.mode&&-1===this.State.mode.indexOf("search-")&&(this.State.mode="search-cards"):("search"!==this.State.mode&&0!==this.State.mode.indexOf("search-")||(this.State.mode=this.PrevMode||"grid"),this.PrevMode="")},e.prototype.SetCompactMode=function(t){this.setParam("compact",t),this.refresh()},e}(u),Pt={JetView:u};Pt.cards=Q,Pt.editor=st,Pt.filterbar=ut,Pt.folders=ft,Pt.list=dt,Pt["menus/addnewmenu"]=pt,Pt["menus/contextmenu"]=J,Pt["menus/menubody"]=Z,Pt["menus/refreshmenu"]=gt,Pt["mobile/previewpopup"]=wt,Pt["mobile/sidetree"]=mt,Pt["panel-double"]=bt,Pt["panel-search"]=yt,Pt.panel=_t,Pt.preview=St,Pt["preview/info"]=xt,Pt["preview/media"]=$t,Pt["preview/template"]=kt,Pt.progress=Ct,Pt["sections/dataview"]=Y,Pt.top=It,Pt.topbar=Tt;var At=function(){function t(t,e){this.app=t,this._url=e,this._features={preview:{},meta:{}},this.loadWarning=this.app.getService("loadWarning")}return t.prototype.url=function(t){return this._url+t},t.prototype.search=function(t,e,i){void 0===t&&(t="/"),void 0===i&&(i=null);var n={id:t,search:e};if(this.app.config.limit&&(n.limit=this.app.config.limit),i){var r=webix.copy(i);if(r.location&&("global"===i.location||"../files"===r.location?n.id="/":"folder"!=r.location&&(n.id=r.location),delete r.location),r.date&&r.date.start){r.date.end=webix.Date.add(r.date.end||r.date.start,1,"day",!0);var o=this.outDateFormat();r.date.start=o(r.date.start),r.date.end=o(r.date.end)}Object.keys(r).length&&(n.filter=r)}return this._files(this.url("files"),n)},t.prototype.files=function(t,e){var i={id:(t=t||"/")||"/"};return this.app.config.limit&&!e&&(i.limit=this.app.config.limit),this._files(this.url("files"),i)},t.prototype._files=function(t,e){var i=this,n=webix.ajax(t,e).then((function(t){var n=t.json();return n.files?(i.loadWarning.setLoadStatus(n,e),n.files):n}));return this.getInfo().then((function(){return n}))},t.prototype.folders=function(t){return t=t||"/",webix.ajax(this.url("folders"),{id:t}).then((function(t){return t.json()}))},t.prototype.icon=function(t,e){var i=webix.skin.$name;return this.url("icons/"+i+"/"+(e||"small")+"/"+t.type+"/"+t.$ext+".svg")},t.prototype.upload=function(){return this.url("upload")},t.prototype.readText=function(t){return webix.ajax(this.url("text"),{id:t}).then((function(t){return t.text()}))},t.prototype.writeText=function(t,e){return webix.ajax().post(this.url("text"),{id:t,content:e}).then((function(t){return t.json()}))},t.prototype.directLink=function(t,e){return this.url("direct?id="+encodeURIComponent(t)+(e?"&download=true":""))},t.prototype.previewURL=function(t,e,i){return this._features.preview[t.type]?this.url("preview?width="+e+"&height="+i+"&id="+encodeURIComponent(t.id)):this.icon(t,"big")},t.prototype.remove=function(t){return webix.ajax().post(this.url("delete"),{id:t}).then((function(t){return t.json()}))},t.prototype.makedir=function(t,e){return webix.ajax().post(this.url("makedir"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.makefile=function(t,e){return webix.ajax().post(this.url("makefile"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.copy=function(t,e){return webix.ajax().post(this.url("copy"),{id:t,to:e}).then((function(t){return t.json()}))},t.prototype.move=function(t,e){return webix.ajax().post(this.url("move"),{id:t,to:e}).then((function(t){return t.json()}))},t.prototype.rename=function(t,e){return webix.ajax().post(this.url("rename"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.getRootName=function(){return(0,this.app.getService("locale")._)("My Files")},t.prototype.getMeta=function(t){return!!this._features.meta[t.type]&&webix.ajax(this.url("meta"),{id:t.id}).then((function(t){return t.json()}))},t.prototype.getInfo=function(t){var e=this;return this._info&&!t?this._info:this._info=webix.ajax(this.url("info")).then((function(t){return t=t.json(),e._features=t.features,t}))},t.prototype.outDateFormat=function(){return webix.Date.dateToStr("%Y-%m-%d")},t}(),Ft=function(){function t(t){this._store=new Map,this._limit=t,this._i=1}return t.prototype.each=function(t){this._store.forEach((function(e){return t(e.obj)}))},t.prototype.set=function(t,e){this._store.size>=this._limit&&this.prune(),this._store.set(t,{obj:e,key:t,t:this._i++})},t.prototype.get=function(t){var e=this._store.get(t);return e?(e.t=this._i++,e.obj):null},t.prototype.prune=function(){var t=[];this._store.forEach((function(e){return t.push(e)})),t=t.sort((function(t,e){return t.t>e.t?-1:1}));for(var e=Math.floor(this._limit/2);e<t.length;e++)this._store.delete(t[e].key)},t.prototype.delete=function(t){this._store.has(t)&&this._store.delete(t)},t.prototype.clear=function(){this._store.clear()},t}(),Vt=function(){function t(t,e){this.app=t,this.fscache=new Ft(e),this.hierarchy=new webix.TreeCollection,this.folders_ready=null}return t.prototype.defaultDir=function(t){var e=[];return"/"!==t&&e.push({type:"folder",value:"..",$row:function(t,e){return e.backIcon()+"<span class='webix_fmanager_back'>"+e.backLabel()+"</span>"}}),e},t.prototype.files=function(t,e){var i=this.fscache.get(t);return e?i:i?Promise.resolve(i):(i=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(t,i),this.reload(i,t))},t.prototype.serializeData=function(t){if(".."==t.value)return!1;var e={};for(var i in t)0!==i.indexOf("$")&&(e[i]=t[i]);return e},t.prototype.prepareData=function(t){"number"==typeof t.date&&(t.date=new Date(1e3*t.date)),"folder"===t.type?t.$css=t.type:t.$ext=function(t){if(!t)return"";var e=t.split(".");return e.length<2?"":e[e.length-1]}(t.value)},t.prototype.reload=function(t,e,i){var n=this;return this.app.getService("backend").files(e,i).then((function(i){return t.clearAll(),t.parse(n.defaultDir(e).concat(i)),t}))},t.prototype.refresh=function(t,e){var i=this.fscache.get(t);if(i)return this.reload(i,t,e)},t.prototype.addFile=function(t,e,i){var n=this,r=this.fscache.get(t);r&&(r.exists(e.id)||r.add(e,this.getFsPosition(r,e))),"folder"===e.type&&("/"===t&&(t="../files"),this.hierarchy.add(e,null,t),i&&this.app.getService("backend").folders(e.id).then((function(t){return t.length&&n.hierarchy.parse({parent:e.id,data:t})})))},t.prototype.getFsPosition=function(t,e){if("folder"!==e.type)return-1;var i=t.data;return i.order.findIndex((function(t){return"folder"!==i.getItem(t).type}))},t.prototype.deleteFile=function(t){var e=this.fscache,i=this.hierarchy;e.each((function(e){e&&e.exists(t)&&e.remove(t)})),e.delete(t),i.exists(t)&&i.remove(t)},t.prototype.updateFile=function(t,e,i){var n=this.hierarchy;this.fscache.each((function(n){n&&n.exists(t)&&(n.updateItem(t,e),i&&t!=i&&n.data.changeId(t,i))})),n.exists(t)&&(n.updateItem(t,e),i&&t!=i&&n.data.changeId(t,i))},t.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0}]},t.prototype.folders=function(t){var e=this,i=this.hierarchy;return!t&&this.folders_ready||(this.folders_ready=this.app.getService("backend").folders().then((function(t){return i.clearAll(),i.parse(e.defaultTree()),i.parse({parent:"../files",data:t}),i}))),this.folders_ready},t.prototype.getParentId=function(t){var e=t.lastIndexOf("/");return t.slice(0,e)||"/"},t}(),Mt=function(){function t(t,e){this.initUploader(t),this.initEvents(t,e)}return t.prototype.initEvents=function(t,e){var i=this;t.attachEvent("app:action",(function(t,n){"upload"!=t&&"uploaddir"!=t||(n||(n=e.path||"/"),i.openDialog(t,n))}))},t.prototype.initUploader=function(t){this.uploader=this.createUploader(t),this.dirUploader=this.createUploader(t,!0)},t.prototype.createUploader=function(t,e){var i=webix.ui({view:"uploader",directory:e,apiOnly:!0,upload:t.getService("backend").upload(),on:{onAfterFileAdd:function(t){t.urlData=this.config.tempUrlData},onUploadComplete:function(){if(t.getService("progress").end(),t.callEvent("reload:fs:stats",[]),e){var i=this.config.tempUrlData.id,n=t.getService("local");n.refresh(i),n.folders(!0)}}}});return e||i.attachEvent("onFileUpload",(function(e,i){t.getService("local").addFile(e.urlData.id,i)})),i.$updateProgress=function(e,i){var n=i/100;n&&t.getService("progress").start(n)},i},t.prototype.openDialog=function(t,e){var i="upload"==t?this.uploader:this.dirUploader;i.config.tempUrlData={id:e},i.fileDialog()},t.prototype.getUploader=function(){return this.dirUploader},t}(),Et=function(){function t(){this.view=null,this.popup=null}return t.prototype.handle=function(t,e){this.view=t,webix.extend(t,webix.ProgressBar),this.popup=e},t.prototype.start=function(t){var e=this.view;e&&!e.$destructed&&e.showProgress({type:"top",delay:3e3,hide:!0,position:t})},t.prototype.end=function(){var t=this.view;t&&!t.$destructed&&t.hideProgress()},t.prototype.files=function(t,e,i){var n=this;if(e.length)return 1==e.length?(this.start(),i(e[0],0).finally((function(){return n.end()}))):this.popup?this.popup({config:{head:t,files:e,code:i}}).then((function(t){return t.WaitClose})):void 0},t}(),Lt=function(){function t(t,e){this.app=t,this.state=e,this.initEvents()}return t.prototype.backend=function(){return this.app.getService("backend")},t.prototype.local=function(){return this.app.getService("local")},t.prototype.initEvents=function(){var t=this;this.app.attachEvent("app:action",(function(e,i){switch(e){case"open":t.open(i);break;case"download":t.download(i);break;case"edit":t.edit(i);break;case"delete":t.remove(i);break;case"makefile":t.makeFile(i);break;case"makedir":t.makeFolder(i);break;case"rename":t.rename(i);break;case"copy":case"cut":t.addToClipboard(e);break;case"paste":t.paste(i);break;case"locate":t.goUp(i)}}))},t.prototype.write=function(t,e){var i=this;return this.backend().writeText(t,e).then((function(e){return i.local().updateFile(t,{size:e.size,date:e.date})}))},t.prototype.read=function(t){return this.backend().readText(t)},t.prototype.makeFile=function(t){var e=this,i=this.state.path||"/";this.backend().makefile(i,t).then((function(t){t.invalid||e.local().addFile(i,t)}))},t.prototype.makeFolder=function(t){var e=this,i=this.state.path||"/";this.backend().makedir(i,t).then((function(t){t.invalid||e.local().addFile(i,t)}))},t.prototype.edit=function(t){var e=this.state;t||(t=e.selectedItem),(t=t.filter((function(t){return"code"===t.type}))).length&&this.app.show("/editor",{params:{files:t,state:e}})},t.prototype.open=function(t){t||(t=this.state.selectedItem);for(var e=0;e<t.length;++e)"folder"!=t[e].type&&window.open(this.backend().directLink(t[e].id),"_blank")},t.prototype.download=function(t){t||(t=this.state.selectedItem),window.open(this.backend().directLink(t[0].id,!0),"_self")},t.prototype.remove=function(t){var e=this,i=this.state,n=this.extractIds(t||i.selectedItem);if(!n.length)return webix.promise.reject();var r=this.app.getService("locale")._;return webix.confirm({title:r("Delete files"),text:this.removeConfirmMessage(t||i.selectedItem),container:this.app.getRoot().$view,css:"webix_fmanager_confirm"}).then((function(){return e.app.getService("progress").files(r("Deleting..."),n,(function(t){return e.backend().remove(t).then((function(n){n.invalid||(e.local().deleteFile(t),i.path===t&&(i.path="/"),e.app.callEvent("pathChanged",[t,"/"]),e.app.callEvent("reload:fs:stats",[]))}))})).then((function(){i.clipboard&&(i.clipboard.files=i.clipboard.files.filter((function(t){return!n.includes(t.id)})))}))})).then((function(){e.relaunchSearch(i)}))},t.prototype.relaunchSearch=function(t){t.search&&(t.search=t.search+" "),t.filter&&(t.filter=n({},t.filter))},t.prototype.removeConfirmMessage=function(t){for(var e=this.app.getService("locale")._,i='<div class="question">'+e("Are you sure you want to delete")+" "+(t.length>1?e("these items:"):e("this item:"))+"</div>",n=0,r="&#9679;&nbsp;",o=t.length<6?t.length:5;n<o;++n)i+='<div class="item">'+r+t[n].value+"</div>";return n<t.length&&(i+="<div>"+r+e("and")+" "+(t.length-n)+" "+e("more file(s)")+"</div>"),i},t.prototype.rename=function(t){var e=this,i=this.state,n=t?t[0]:i.selectedItem[0];if(n){var r=this.app.getService("locale")._,o=n.id;ht({text:r("Enter a new name"),button:r("Rename"),value:n.value,selectMask:"folder"!==n.type?tt:null},this.app).then((function(t){(t=rt(t))&&t!==n.value&&e.backend().rename(o,t).then((function(t){e.local().updateFile(o,{value:t.id.split("/").pop()},t.id),"folder"===n.type&&e.reloadBranch(t.id).then((function(){i.path===o&&(i.path=t.id),e.app.callEvent("pathChanged",[o,t.id])})),e.relaunchSearch(i),i.clipboard&&i.clipboard.files.forEach((function(e){e.id===o&&(e=t)}))}))}))}},t.prototype.reloadBranch=function(t){var e=this.local().hierarchy;return this.app.getService("backend").folders(t).then((function(i){var n=[];e.data.eachChild(t,(function(t){return n.push(t.id)})),e.parse({parent:t,data:i}),e.remove(n)}))},t.prototype.copy=function(t,e){var i=this;if(!t.length)return webix.promise.reject();var n=this.local(),r=this.app.getService("locale")._;return this.app.getService("progress").files(r("Copying..."),t,(function(t){return i.backend().copy(t,e).then((function(t){t.invalid||n.addFile(e,t,!0)}))}))},t.prototype.move=function(t,e){var i=this;if(!t.length||!e)return webix.promise.reject();var n=this.local(),r=n.files(e,!0);if(r&&(t=t.filter((function(t){return!r.exists(t)}))),!(t=t.filter((function(t){return t!=e}))).length)return webix.promise.reject();var o=this.app.getService("locale")._;return this.app.getService("progress").files(o("Moving..."),t,(function(t){return i.backend().move(t,e).then((function(r){r.invalid||(n.deleteFile(t),n.addFile(e,r,!0),i.state.path===t&&(i.state.path=r.id),i.app.callEvent("pathChanged",[t,r.id]))}))})).then((function(){i.state.clipboard&&(i.state.clipboard.files=i.state.clipboard.files.filter((function(e){return!t.includes(e.id)})))}))},t.prototype.extractIds=function(t){if(!t.length||"string"==typeof t[0])return t;for(var e=[],i=0;i<t.length;++i)".."!==t[i].value&&e.push(t[i].id);return e},t.prototype.addToClipboard=function(t){var e=this.state.selectedItem;e.length&&(this.state.clipboard={files:e,mode:t})},t.prototype.clearClipboard=function(){this.state.clipboard=null},t.prototype.paste=function(t){var e=this.state;if(e.clipboard){var i=this.extractIds(e.clipboard.files),n=e.path;t||(t=e.selectedItem),!t||t.$noSelect||"folder"!=t[0].type||i.includes(t[0].id)||(n=t[0].id),"copy"===e.clipboard.mode?this.copy(i,n):"cut"===e.clipboard.mode&&this.move(i,n),this.clearClipboard()}},t.prototype.goUp=function(t){var e=this.state;if(e.search||e.filter){var i=t?t[0]:e.selectedItem[0];if(!i)return;var n=i.id.split("/"),r="/"+n.slice(1,n.length-1).join("/");e.$batch({search:"",filter:null,searchStats:null,path:r})}},t}(),Rt=function(){function t(t,e){this.app=t,this.state=e}return t.prototype.setLoadStatus=function(t,e){var i,r,o=this.app.getState(),a=(e.search||e.filter?"s-":"")+e.id;if(void 0!==t.total)o.loadStatus=n(n({},o.loadStatus),((i={})[a]={total:t.total,loaded:t.files.length},i));else if(o.loadStatus&&o.loadStatus[a]){var s=Array.isArray(t)?t.length:t.files.length;o.loadStatus=n(n({},o.loadStatus),((r={})[a]={total:s,loaded:s,forced:!0},r))}},t.prototype.getWarningTooltip=function(t,e){var i=this.app.getService("locale")._;return i("Uploaded")+" "+this.app.config.limit+" "+i("files out of")+" "+t.total+(e?". "+i("There are too many results for this search.<br/> Try your search with more specific keywords."):"")},t.prototype.getSvgIcon=function(t,e){var i=this.getIconColors();return'<span class="webix_fmanager_load_status" '+(e?'webix_tooltip="'+this.getWarningTooltip(t,e)+'"':"")+'>\n<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g id="icons/warning">\n<g id="Vector">\n<path d="M2.75949 17.2917C2.60796 17.2917 2.47511 17.2573 2.36095 17.1885C2.24692 17.1198 2.15817 17.0292 2.0947 16.9167C2.02525 16.8056 1.994 16.6806 2.00095 16.5417C2.00789 16.4028 2.04609 16.2708 2.11553 16.1458L9.7822 3.35417C9.85164 3.22917 9.9456 3.13889 10.0641 3.08333C10.1824 3.02778 10.3039 3 10.4287 3C10.5532 3 10.6746 3.02778 10.7926 3.08333C10.9107 3.13889 11.0044 3.22917 11.0739 3.35417L18.7405 16.1458C18.81 16.2708 18.8482 16.4028 18.8551 16.5417C18.8621 16.6806 18.8308 16.8056 18.7614 16.9167C18.6919 17.0278 18.6016 17.1181 18.4905 17.1875C18.3794 17.2569 18.2481 17.2917 18.0966 17.2917H2.75949Z" fill="'+i.danger+'"/>\n<path d="M11.3555 14.0002C11.3555 14.442 10.9973 14.8002 10.5555 14.8002C10.1137 14.8002 9.7555 14.442 9.7555 14.0002C9.7555 13.5584 10.1137 13.2002 10.5555 13.2002C10.9973 13.2002 11.3555 13.5584 11.3555 14.0002Z" fill="'+i.font+'"/>\n<path d="M9.75526 9.0002C9.75526 8.55837 10.1134 8.2002 10.5553 8.2002C10.9971 8.2002 11.3553 8.55837 11.3553 9.0002V11.4002C11.3553 11.842 10.9971 12.2002 10.5553 12.2002C10.1134 12.2002 9.75526 11.842 9.75526 11.4002V9.0002Z" fill="'+i.font+'"/>\n</g>\n</g>\n</svg>\n</span>'},t.prototype.getIconColors=function(){var t=webix.skin.$name;return"material"==t||"mini"==t?{font:"#313131",danger:"#FDBF4C"}:"flat"==t||"compact"==t?{font:"#4A4A4A",danger:"#FFD21A"}:"contrast"==t?{font:"#191919",danger:"#FFD21A"}:{font:"#2C2F3C",danger:"#FCBA2E"}},t}(),Dt=function(t){function e(e){var i,r,o,a=this,s=z({mode:e.mode||"grid",selectedItem:[],search:"",searchStats:null,filter:null,path:e.path||"/",source:e.source||"files",clipboard:null,preview:!1,loadStatus:null}),c={router:b,version:"11.3.0",debug:!0,start:"/top",params:{state:s,forceCompact:e.compact},editor:!0,player:!0,compactWidth:!1===e.enableFilter?640:670,enableFilter:!0};return(a=t.call(this,n(n({},c),e))||this).setService("loadWarning",new(a.dynamic(Rt))(a,s)),a.setService("backend",new(a.dynamic(At))(a,a.config.url)),a.setService("local",new(a.dynamic(Vt))(a,10)),a.setService("progress",new(a.dynamic(Et))(a)),a.setService("upload",new(a.dynamic(Mt))(a,s)),a.setService("operations",new(a.dynamic(Lt))(a,s)),o={updateConfig:function(t){var e=i.getRoot(),n=e.$view;r?r&&!n.id&&(n.id=r):(n.id?r=n.id:n.id=r="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+r+"{ position: relative; }"),webix.html.addStyle("#"+r+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+r+" .webix_disabled{ z-index:1 !important; }")),t.container=r,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var o=!0,a=t.on.onShow;return t.on.onShow=function(){var t=this;a&&a.apply(this,arguments),o&&(this.$setSize=function(i,n){W(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,n])},H(this,i),o=null),webix.callEvent("onClick",[]),webix.html.addCss(n,"webix_win_inside"),e.disable(),W(this,e)},t}},(i=a).setService("jet-win",o),a.use(R,a.config.locale||{lang:"en",webix:{en:"en-US",zh:"zh-CN"}}),a}return i(e,t),e.prototype.dynamic=function(t){return this.config.override&&this.config.override.get(t)||t},e.prototype.require=function(t,e){return"jet-views"===t?Pt[e]:"jet-locales"===t?Ot[e]:null},e.prototype.getState=function(){return this.config.params.state},e.prototype.selectFile=function(t){var e=this.getService("local"),i=e.getParentId(t),n=this.getState();return n.path=i,e.files(i).then((function(e){var i=e.getItem(t);return n.selectedItem=[i],i}))},e}(m);webix.protoUI({name:"filemanager",app:Dt,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},selectFile:function(t){return this.$app.selectFile(t)},$init:function(){this.$view.className+=" webix_files";var t=this.$app.getState();for(var e in t)O(t,this.config,e)}},webix.ui.jetapp);var jt={Backend:At,LocalData:Vt,Upload:Mt,Progress:Et,Operations:Lt,LoadWarning:Rt},Ot={en:{Save:"Save","Save all":"Save all",Rename:"Rename",Open:"Open",Edit:"Edit",Delete:"Delete",Folder:"Folder","Add New":"Add New","My Files":"My Files",Size:"Size",Date:"Date","back to parent folder":"back to parent folder",Download:"Download",Type:"Type",Information:"Information",Files:"Files",Table:"Table",Cards:"Cards",Total:"Total","Are you sure ?":"Are you sure ?",Details:"Details","Enter a new name":"Enter a new name",Add:"Add","Select something":"Select something","Download file":"Download file",Preview:"Preview",Refresh:"Refresh","Are you sure you want to exit without saving?":"Are you sure you want to exit without saving?","Save before closing?":"Save before closing?",Copy:"Copy",Cut:"Cut",Paste:"Paste","Deleting...":"Deleting...","Copying...":"Copying...","Moving...":"Moving...",Folders:"Folders","Search results":"Search results","Search results in":"Search results in","Search files and folders":"Search files and folders","Add new file":"Add new file","Add new folder":"Add new folder","Upload file":"Upload file","Upload folder":"Upload folder",folder:"folder",file:"file",archive:"archive",audio:"audio",image:"image",video:"video",code:"code",document:"document",of:"of",used:"used","Open item location":"Open item location","Are you sure you want to delete":"Are you sure you want to delete","these items:":"these items:","this item:":"this item:","Delete files":"Delete files",and:"and","more file(s)":"more file(s)","Close the editor":"Close the editor","Close this file":"Close this file",Filter:"Filter",Archives:"Archives",Audio:"Audio",Code:"Code",Images:"Images",Video:"Videos",Documents:"Documents",Other:"Other",Apply:"Apply",Tiny:"Tiny",Small:"Small",Medium:"Medium",Huge:"Huge",Gigantic:"Gigantic",Location:"Location","Global Search":"Global Search","This Folder":"This Folder","Custom Location":"Custom Location",Uploaded:"Uploaded","files out of":"files out of","There are too many results for this search.<br/> Try your search with more specific keywords.":"There are too many results for this search.<br/> Try your search with more specific keywords.","Reload folder":"Reload folder","Reload without limit":"Reload without limit",B:"B",kB:"kB",MB:"MB",GB:"GB"}};t.App=Dt,t.locales=Ot,t.services=jt,t.views=Pt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=filemanager.min.js.map
