/*
@license
Webix SpreadSheet v.11.3.0
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";const e={1:"#ERROR",2:"#ERROR",3:"#REF!",4:"#SPILL!"};function t(e,t,n){return n+64*t+64*e*4096}function n(e){return[e<2147483648?e>>18:e/262144&16777215,e>>6&4095,63&e]}function r(e){return e<2147483648?e>>18:e/262144&16777215}function i(e){return 63&e}function o(e,t,r){const[i,o]=n(e),[a,l]=n(t),s=a-i,u=l-o;for(let t=0;t<=s;t++)for(let n=0;n<=u;n++)r(e+64*n+4096*t*64)}function a(e,t,n,r){let i=0;for(let o=0;o<n;o++)for(let n=0;n<t;n++)r(e+64*n+4096*o*64,i),i++}function l(e,t){const r=e.code,o=e.source;let a,l,c,h,d,f="";const m=r.length;for(let g=0;g<m;g+=3)switch(r[g]){case 5:{let n;9===r[g+6]&&(n=t.pageName(i(r[g+7]))),f+=u(n||e.source.substr(r[g+1],r[g+2]))+"!";break}case 7:[a,c,d]=n(r[g+4]),t.z!==d&&5!==r[g-3]&&(f+=u(t.pageName(d))+"!"),f+=s(a,c,r[g+5]);break;case 4:f+=o.substr(r[g+1],r[g+2]).toUpperCase();break;case 8:[a,c,d]=n(r[g+4]),[l,h]=n(r[g+7]),t.z!==d&&5!==r[g-3]&&(f+=u(t.pageName(d))+"!"),f+=s(a,c,r[g+5]),f+=":",f+=s(l,h,r[g+8]);break;case 9:break;case 2:f+="{{"+o.substr(r[g+1],r[g+2])+"}}";break;case 3:f+="#REF!";break;case 1:f+='"'+o.substr(r[g+1],r[g+2])+'"';break;case 13:{f+="{";const e=r[g+1],t=r[g+2];g+=3;for(let n=0;n<t;n++){for(let t=0;t<e;t++){t>0&&(f+=",");const e=r[g];1===e?f+='"'+o.substr(r[g+1],r[g+2])+'"':11===e&&(f+=o.substr(r[g+1],r[g+2])),g+=3}n<t-1&&(f+=";")}g-=3,f+="}";break}default:f+=o.substr(r[g+1],r[g+2])}return f}function s(e,t,n){let r="";2&n&&(r+="$");let i="";for(t+=1;t>0;){let e=t%26;0===e&&(e=26),i=String.fromCharCode(64+e)+i,t=(t-e)/26}return r+=i,1&n&&(r+="$"),r+=e+1,r}function u(e){return(/[\s\-&.!%()+*=^~,;@#$"`|{}<>]/.test(e)||/^[0-9]/.test(e)||/^[A-Za-z]{1,3}[0-9]{1,7}$/.test(e))&&(e=`'${e}'`),e}let c;function h(e){return e<=122}function d(e){return e<=122?e>=65&&94!=e||35===e||36===e||46===e:e>191}function f(e){return e>=97}function m(e){const t=e.charCodeAt(0);return t>=48&&t<=57}function g(e,t){for(let n=t;n<e.length;n++){const t=e[n];if(","===t||";"===t||"}"===t)return n}return e.length}function v(e,t){let n;do{t++,n=e.charCodeAt(t)}while(n>=48&&n<=57);return t}function p(e,t){let n;do{n=e[++t]}while('"'!==n);return t}function w(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function b(e,t){let n;do{n=e[++t]}while(w(n));return t}function _(e,t){if("<"===e[t]){const n=e[t+1];">"!==n&&"="!==n||t++}else">"===e[t]&&"="===e[t+1]&&t++;return t+1}function x(e,t,n){const r=e.length;let i=!0,o=t,a=!1,l=!1,s=!1,u=0;for(;o<r;o++){const t=e[o];if("'"!==t){if(!a){s=!0;const e=t.charCodeAt(0);if(d(e)){h(e)?f(e)&&(l=!0):i=!1,1==u&&u++;continue}if(m(t)){0==u&&u++;continue}break}}else{if(s)break;if(a){o++;break}a=!0}}const g=e[o];let v=t,p=o-t;return a&&(p-=1+("'"===e[o-1]?1:0),p<0&&(p=0),v++,n=5),0===n&&(":"===g&&i?1!==u?n=3:(n=8,l&&(c=!0)):"!"===g?n="#"===e[v]?3:5:"("===g?(function(e,t,n){const r=e.substr(t,n);return r.toUpperCase()!==r}(e,v,p)&&(c=!0),n=4):"}"===g&&"}"===e[o-1]?n=2:1===u&&i?(n=7,l&&(c=!0)):n=6),[v,p,o,n]}function y(e,n,r){let i=0,o=0,a=1,l=1,s=0,u=!1;for(let e=n.length-1;e>=0;e--){const t=n[e].charCodeAt(0);36!==t?t<58?(o+=(t-48)*a,a*=10):(u||(a=1,i=o,o=0,u=!0,l+=1),o+=(t-(t>96?96:64))*a,a*=26):s+=l}o>4095?e.push(3,0,0):e.push(9,t(i-1,o-1,r),s)}function C(e,t){const n=[];c=!1;let o=-1,a=-1,s=0;for(let l=0;l<e.length;l++){const c=e[l];if(a>-1){if("}"==c){const e=n[a+2]+=1,t=n[a+1]=s/e;t-Math.round(t)!=0&&n.push(3,0,0),a=-1}else if('"'===c){const t=p(e,l);l++,n.push(1,l,t-l),s++,l=t}else if("-"===c){const t=v(e,l+1);n.push(11,l,t-l),s++,l=t-1}else if(m(c)){const t=v(e,l);n.push(11,l,t-l),s++,l=t-1}else if(" "===c||"\t"===c||","===c);else if(";"===c)n[a+2]+=1;else{const t=g(e,l);n.push(3,l,t-l),s++,l=t-1}continue}if('"'==c){o>-1?(n.push(1,o+1,l-o-1),o=-1):o=l;continue}if(o>-1)continue;if("{"==c){if("{"==e[l+1]){const[t,r,i]=x(e,l+2,2);n.push(2,t,r),l=i+2-1;continue}a=n.length,s=0,n.push(13,0,0);continue}if("'"==c||((u=c.charCodeAt(0))<=122?u>=65&&94!=u||35===u||36===u:u>191)){let o,[a,s,u,c]=x(e,l,0);const h=n.length;if(7!==c&&8!==c||5!==n[n.length-3])o=t.z,n.push(c,a,s);else{const r="'"===e[a-2]?1:0,i=n[h-2],l=n[h-1];o=t.page(e.substr(i,l)),void 0===o&&(n.push(3,0,0),o=0),n.push(c,a-l-2*r-1,s+l+2*r+1)}if(l=u-1,6===c)t.name(n,e,t);else if(8===c){const h=n.length;if(y(n,e.substr(a,s),o),[a,s,u,c]=x(e,l+2,0),5===c){const r=e.substr(a,s);o=t.page(r),void 0===o&&(n.push(3,0,0),o=0),[a,s,u,c]=x(e,u+1,0)}if(7!==c){n[h-3]=7;continue}y(n,e.substr(a,s),o),i(n[n.length-2])!=i(n[n.length-5])&&n.push(3,0,0);const d=n[h+1],f=n[h+4];(d>f||r(d)>r(f))&&(n[h+1]=f,n[h+4]=d),n[h-1]+=s+1,l=u-1}else 7===c?y(n,e.substr(a,s),o):3!==c&&5!==c||l++;continue}if(w(c)){const t=b(e,l);n.push(12,l,t-l),l=t-1;continue}if(m(c)){const t=v(e,l);n.push(11,l,t-l),l=t-1;continue}const h=_(e,l);n.push(10,l,h-l),l=h-1}var u;const h={code:n,source:e,exec:null,broken:0,triggers:null};return c&&(h.source=l(h,t)),h}function S(e){return"            ".substr(0,10-e.length)}const $=[">","<","=","+"];function E(e,t){const n=function(e,t){const n=e.code,r=e.source;let i="",o=0;const a=[],l=n.length;for(let s=0;s<l;s+=3)switch(n[s]){case 4:i+=`ctx.m["${r.substr(n[s+1],n[s+2]).toUpperCase()}"]`;break;case 1:i+='"'+r.substr(n[s+1],n[s+2])+'"';break;case 2:i+=`ctx.p("${r.substr(n[s+1],n[s+2])}")`;break;case 6:case 7:{let e,t;if(10===n[s-3]?e=s-3:12===n[s-3]&&10===n[s-6]&&(e=s-6),10===n[s+6]?t=s+6:12===n[s+6]&&10===n[s+9]&&(t=s+9),e||t){const o=e?r[n[e+1]]:null,a=t?r[n[t+1]]:null;if("&"==o||"&"==a){i+=`(ctx.v(${n[s+4]}) === null ? "" : ctx.v(${n[s+4]}))`;break}if(-1!=$.indexOf(o)||-1!=$.indexOf(a)){i+=`(ctx.v(${n[s+4]}) === null ? 0 : ctx.v(${n[s+4]}))`;break}}i+=`ctx.v(${n[s+4]})`;break}case 8:i+=`ctx.r(${n[s+4]}, ${n[s+7]})`;break;case 10:if(1===n[s+2]){const e=r[n[s+1]];"&"===e?i+='+""+':t&&"+"==e?i+="*1+1*":"="===e?i+="==":";"===e?i+=",":"{"===e?i+="[":"}"===e?i+="]":"^"===e?i+="**":"%"===e?n[s+3]&&10!==n[s+3]?i+=t?"/0+":e:i+=("/"==a[o]?"*":"/")+"100":("("==e?(o++,a.push("+")):")"==e&&(o--,a.pop()),i+=e),"+"!=e&&"-"!=e&&"*"!=e&&"/"!=e&&"&"!=e||(a[o]=e)}else if(2===n[s+2]){const e=r.substr(n[s+1],n[s+2]);i+="<>"===e?"!=":e}else i+=r.substr(n[s+1],n[s+2]);break;case 11:i+=r.substr(n[s+1],n[s+2]);break;case 3:return"";case 9:case 5:case 12:break;case 13:{i+="ctx.a([";const t=n[s+1],o=n[s+2];s+=3;const a=s+t*o*3;let l=!1;for(;s<a;s+=3){l&&(i+=",");const t=n[s];if(11===t)i+=r.substr(n[s+1],n[s+2]);else if(1===t)i+='"'+r.substr(n[s+1],n[s+2])+'"';else if(3===t)return e.broken=3,"";l=!0}s-=3,i+=`],${t}, ${o})`;break}}return i}(e,t);if(!n)return e.broken=3,void(e.exec=null);try{e.exec=new Function("ctx",`return ${n}`)}catch(t){e.broken=1,e.exec=null}}const R={null:"#NULL!",div0:"#DIV/0!",value:"#VALUE!",ref:"#REF!",name:"#NAME?",num:"#NUM!",na:"#N/A",data:"#GETTING_DATA"};function A(e){const t=new Date(e.getFullYear(),0,0),n=e.valueOf()-t.valueOf()+60*(t.getTimezoneOffset()-e.getTimezoneOffset())*1e3;return Math.floor(n/864e5)}function T(e){const t=new Date(Math.round(86400*(e-25569)*1e3));return new Date(t.getTime()+6e4*t.getTimezoneOffset())}function k(e){return 25569+(e.getTime()-6e4*e.getTimezoneOffset())/864e5}function O(e){return!(!e&&0!==e||(e*=1,isNaN(e)))&&e}function I(e){if(1===e.length){const t=e[0];return"object"==typeof t?t:[t]}let t=[];for(let n=0;n<e.length;n++)t=t.concat(e[n]);return t}function V(e){return!e&&0!==e}function N(e){return"string"==typeof e?"TRUE"===e:!!e}function M(e){const t="string"==typeof e?new Date(e):T(e);if(t.getTime())return t;throw`${e} is invalid date`}function D(e){const t=O(e);if("number"!=typeof t)throw`${e} is not a number`;return t}function q(e,t,n,r,i){let o=O(e);o<0&&8==i&&(t=null);let a,l=t?O(t):null;if("number"!=typeof o||"boolean"==typeof l)throw R.value;if(o<n&&(o=n),o>r&&(o=r),l<-1)throw R.num;l&&(l=Math.floor(+l));const s=e<0&&16===i?"FF":"";if(a=r<2147483648?(o>>>0&r-n).toString(i):(o>>>0).toString(i),l&&a.length>l)throw R.num;return(s+a).padStart(l,"0").toUpperCase()}const z={int:function(e,t){return(n,r)=>{let i=n[t],o=r[t];return o||0===o?i||0===i?("0"===i&&(i=0),"0"===o&&(o=0),i="number"==typeof i?i:parseFloat(i.toString())||e*(1/0),o="number"==typeof o?o:parseFloat(o.toString())||e*(1/0),(i>o?1:i==o?0:-1)*e):1:-1}},str:function(e,t){return(n,r)=>{if(!r[t])return-1;if(!n[t])return 1;const i=n[t].toString().toLowerCase(),o=r[t].toString().toLowerCase();return(i>o?1:i==o?0:-1)*e}}};function P(e,t){return e.sort((n,r)=>{for(const i of t){const{index:t,dir:o}=i,a=isNaN(parseFloat(String(e[0][t-1])))?"str":"int",l=z[a](o,t-1)(n,r);if(0!==l)return l}return 0}),e}function F(e){return e[0].map((t,n)=>e.map(e=>e[n]))}function U(e){const t=[];for(let n=0;n<e.$height;n++){const r=[];for(let t=0;t<e.$width;t++)r.push(e[n*e.$width+t]);t.push(r)}return t}function L(e,t,n){return Object.assign([].concat(...e.map(e=>e.slice(0,t)).slice(0,n)),{$width:t,$height:n})}function B(e,t=0,n=0){let r=[];if(n)for(let t=0;t<e.$width;t++)for(let n=0;n<e.$height;n++)r.push(e[t+e.$width*n]);else r=e;return t&&(r=r.filter(e=>{switch(t){case 1:return e||0===e;case 2:return!("string"==typeof e&&-1!=Object.values(R).indexOf(e));case 3:return(e||0===e)&&!("string"==typeof e&&-1!=Object.values(R).indexOf(e))}})),r}function H(e,t){const n=+qe(e),r=+ze(e),i=+qe(t),o=+ze(t);return Re(n*i-r*o,n*o+r*i)}function j(e,t){const n=+qe(e),r=+ze(e);return Re(n+ +qe(t),r+ +ze(t))}function W(e){return e>0?Math.floor(e):Math.ceil(e)}function X(e){return e<0?Math.floor(e):Math.ceil(e)}function K(...e){let t=0;const n=I(e);for(let e=0;e<n.length;e++){const r=O(n[e]);"number"==typeof r&&(t+=r)}return t}function Y(...e){let t=0,n=0;const r=I(e);for(let e=0;e<r.length;e++){const i=O(r[e]);"number"==typeof i&&(t+=i,n++)}return n?t/n:0}function G(...e){const t=I(e);let n=0,r=0;for(let e=0;e<t.length;e++){const i=t[e],o=O(t[e]);"number"==typeof o?(n+=o,r++):(!0===i&&n++,(i||!1===i)&&r++)}return r?n/r:0}function Q(...e){let t=0;const n=I(e);for(let e=0;e<n.length;e++)"number"==typeof O(n[e])&&t++;return t}function Z(...e){let t=0;const n=I(e);for(let e=0;e<n.length;e++)n[e]&&1*n[e]!=0&&t++;return t}function J(...e){let t=-1/0;const n=I(e);for(let e=0;e<n.length;e++){const r=O(n[e]);"number"==typeof r&&r>t&&(t=r)}return t===-1/0?0:t}function ee(...e){let t=1/0;const n=I(e);for(let e=0;e<n.length;e++){const r=O(n[e]);"number"==typeof r&&r<t&&(t=r)}return t===1/0?0:t}function te(...e){let t=!1,n=1;const r=I(e);for(let e=0;e<r.length;e++){const i=O(r[e]);"number"==typeof i&&(t=!0,n*=i)}return t?n:null}function ne(...e){const t=e[0].length;for(const n in e)if(e[n].length!==t)return;let n=0;for(let t=0;t<e[0].length;t++){let r=!1,i=1;for(const n in e){const o=O(e[n][t]);"number"==typeof o&&(i*=o,r=!0)}r&&(n+=i)}return n}function re(e,t,n){const r=I(e);let i=t?0:-1;const o=n?G(...e):Y(...e);let a=0;for(let e=0;e<r.length;e++){const t=r[e];let l=O(r[e]);if("number"!=typeof l){if(!n||"boolean"!=typeof t&&!t)continue;l=!0===t?1:0}i++,a+=Math.pow(l-o,2)}return i?a/i:0}function ie(...e){return re(e,!1,!1)}function oe(...e){return re(e,!1,!0)}function ae(...e){return re(e,!0,!1)}function le(...e){return re(e,!0,!0)}function se(...e){return Math.sqrt(ie(...e))}function ue(...e){return Math.sqrt(ae(...e))}function ce(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return Math.pow(n,r)}function he(e){const t=O(e);if("number"==typeof t&&t>=0)return Math.sqrt(t)}function de(e){const t=O(e);if("number"==typeof t)return Math.abs(t)}function fe(){return Math.random()}function me(e){const t=O(e);if("number"==typeof t)return Math.floor(t)}function ge(e,t){const n=O(e),r=O(t)||0;if("number"==typeof n&&"number"==typeof r)return r<0?Math.round(n/Math.pow(10,Math.abs(r)))*Math.pow(10,Math.abs(r)):parseFloat(n.toFixed(r))}function ve(e,t){const n=O(e),r=O(t)||0;if("number"==typeof n&&"number"==typeof r)return Math.floor(n*Math.pow(10,r))/Math.pow(10,r)}function pe(e,t){const n=O(e),r=O(t)||0;if("number"==typeof n&&"number"==typeof r)return Math.ceil(n*Math.pow(10,r))/Math.pow(10,r)}const we={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};function be(e,t=1,n=0){const r=O(e);let i=O(t);const o=O(n);if("number"==typeof r&&"number"==typeof i&&"number"==typeof o)return 0===i?0:(i=Math.abs(i),r>=0?Math.ceil(r/i)*i:0===n?-1*Math.floor(Math.abs(r)/i)*i:-1*Math.ceil(Math.abs(r)/i)*i)}const _e=[];function xe(e){const t=O(e);if("number"==typeof t&&t>-1){const e=Math.floor(t);return 0===e||1===e?1:(_e[e]>0||(_e[e]=xe(e-1)*e),_e[e])}}function ye(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return xe(n)/(xe(r)*xe(n-r))}function Ce(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r){const e=Math.abs(r);return n>=0?Math.floor(n/e)*e:-1*Math.ceil(Math.abs(n)/e)*e}}function Se(e,t=10){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return Math.log(n)/Math.log(r)}function $e(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n+Math.ceil((r-n+1)*Math.random())-1}const Ee=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"];function Re(e,t,n="i"){const r=O(e),i=O(t);if("number"!=typeof r&&"number"!=typeof i)throw R.num;let o="",a="";return e&&(o=e.toString()),t&&1!==t?a=t+n:1===t&&(a=n),t>0?`${o?`${o}+`:""}${a}`:o+a}function Ae(e,t=null){return q(e,t,-512,511,2)}function Te(e,t=null){return q(e,t,-274877906944,274877906943,16)}function ke(e,t=null){return q(e,t,-536870912,536870911,8)}const Oe=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17];function Ie(e){const t=e<0;let n,r=0,i=0;const o=2/(2+(e=Math.abs(e))),a=4*o-2;for(let e=Oe.length-1;e>0;e--)n=a*r-i+Oe[e],i=r,r=n;const l=o*Math.exp(-e*e+.5*(Oe[0]+a*r)-i);return t?l-1:1-l}function Ve(e,t){const n=O(e),r=O(t);if("number"==typeof n)return"number"==typeof r?Ie(r)-Ie(n):Ie(n);throw R.value}function Ne(e){const t=O(e);if("number"==typeof t)return Math.exp(t);throw R.value}const Me=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7],De=Math.pow(2,39);function qe(e){if("string"!=typeof e)throw R.value;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0)return 0;let t=e.indexOf("+"),n=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===n&&(n=e.indexOf("-",1));const r=e.substring(e.length-1,e.length),i="i"===r||"j"===r;if(t>=0||n>=0){if(!i)throw R.num;if(t>=0){if(isNaN(+e.substring(0,t))||isNaN(+e.substring(t+1,e.length-1)))throw R.num;return Number(e.substring(0,t))}if(isNaN(+e.substring(0,n))||isNaN(+e.substring(n+1,e.length-1)))throw R.num;return Number(e.substring(0,n))}if(i){if(isNaN(+e.substring(0,e.length-1)))throw R.num;return 0}if(isNaN(+e))throw R.num;return+e}function ze(e){if("string"!=typeof e)throw R.value;if(["i","j"].indexOf(e)>=0)return 1;let t=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),n=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===n&&(n=e.indexOf("-",1));const r=e.substring(e.length-1,e.length),i="i"===r||"j"===r;if(t>=0||n>=0){if(!i)throw R.num;if(t>=0){if(isNaN(+e.substring(0,t))||isNaN(+e.substring(t+1,e.length-1)))throw R.num;return Number(e.substring(t+1,e.length-1))}if(isNaN(+e.substring(0,n))||isNaN(+e.substring(n+1,e.length-1)))throw R.num;return-Number(e.substring(n+1,e.length-1))}if(i){const t=+e.substring(0,e.length-1);if(isNaN(t))throw R.num;return t}if(isNaN(+e))throw R.num;return 0}function Pe(e){const t=+qe(e),n=+ze(e);return Re(Math.cos(t)*Math.cosh(n),-Math.sin(t)*Math.sinh(n))}function Fe(e){const t=+qe(e),n=+ze(e);return Re(Math.cos(n)*(Math.exp(t)+Math.exp(-t))/2,Math.sin(n)*(Math.exp(t)-Math.exp(-t))/2)}function Ue(e,t){const n=+qe(e),r=+ze(e),i=+qe(t),o=+ze(t),a=Math.pow(i,2)+Math.pow(o,2);return Re((n*i+r*o)/a,(r*i-n*o)/a)}function Le(e){const t=+qe(e),n=+ze(e);return Re(Math.sin(t)*Math.cosh(n),Math.cos(t)*Math.sinh(n))}function Be(e){const t=+qe(e),n=+ze(e);return Re(Math.cos(n)*(Math.exp(t)-Math.exp(-t))/2,Math.sin(n)*(Math.exp(t)+Math.exp(-t))/2)}const He=Math.pow(2,29);function je(e,t,n){const r=O(t);if("number"!=typeof r||t<0||t>1||n&&(0===t||1===t))throw R.value;let i=I(e).sort((e,t)=>e-t);n&&(i=[0,...i]);const o=(i.length+(n?0:-1))*r,a=Math.floor(o);if(void 0===i[a+1])return i[a];const l=i[a+1]-i[a];return i[a]+l*(o-a)}function We(e,t,n){const r=O(t);if("number"!=typeof r)throw R.value;switch(r){case 0:if(n)throw R.value;return ee(...e);case 1:return je(e,.25,n);case 2:return je(e,.5,n);case 3:return je(e,.75,n);case 4:if(n)throw R.value;return J(...e);default:throw R.num}}function Xe(e,t,n,r){const i=D(e),o=D(t),a=D(n);if(1==t)return 1/a;const l=Math.exp(-Math.pow(i/a,o));return r?1-l:o/Math.pow(a,o)*Math.pow(i,o-1)*l}function Ke(e,t,n,r=!1){const i=D(e),o=D(t),a=D(n),l=(e,t,n)=>ye(t,e)*Math.pow(n,e)*Math.pow(1-n,t-e);if(!r)return l(i,o,a);let s=0;for(let e=0;e<i+1;e++)s+=l(e,o,a);return s}function Ye(e,t,n){const r=e.filter(e=>"number"==typeof e),i=t.filter(e=>"number"==typeof e);if(r.length!==i.length)throw R.na;const o=r.length;if(0===o)throw R.div0;const a=r.reduce((e,t)=>e+t,0)/o,l=i.reduce((e,t)=>e+t,0)/o;let s=0;for(let e=0;e<o;e++)s+=(r[e]-a)*(i[e]-l);return s/(n?o-1:o)}function Ge(e,t){return Ye(e,t,!1)}const Qe={ABS:de,ACOS:function(e){const t=O(e);if("number"==typeof t)return Math.acos(t)},ACOSH:function(e){const t=O(e);if("number"==typeof t)return Math.acosh(t)},ACOT:function(e){const t=O(e);if("number"==typeof t)return Math.atan(1/t)},ACOTH:function(e){const t=O(e);if("number"==typeof t)return.5*Math.log((t+1)/(t-1))},ADD:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n+r},ARABIC:function(e){if(!O(e)&&/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(`${e}`)){let t=0;return`${e}`.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,function(e){return t+=we[e],e}),+t}},ASIN:function(e){const t=O(e);if("number"==typeof t)return Math.asin(t)},ASINH:function(e){const t=O(e);if("number"==typeof t)return Math.asinh(t)},ATAN:function(e){const t=O(e);if("number"==typeof t)return Math.atan(t)},ATAN2:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return Math.atan2(r,n)},ATANH:function(e){const t=O(e);if("number"==typeof t)return Math.log((1+t)/(1-t))/2},AVEDEV:function(...e){const t=I(e).filter(e=>"number"==typeof e),n=t.length;if(0===n)throw R.div0;const r=t.reduce((e,t)=>e+t,0)/n;return t.reduce((e,t)=>e+Math.abs(t-r),0)/n},AVERAGE:Y,AVERAGEA:G,BASE:function(e,t,n=0){const r=O(e),i=O(t),o=O(n);if("number"==typeof r&&"number"==typeof i&&"number"==typeof o){const e=r.toString(i);return new Array(Math.max(o+1-e.length,0)).join("0")+e.toUpperCase()}},BINOMDIST:Ke,"BINOM.INV":function(e,t,n){const r=D(e),i=D(t),o=D(n);for(let e=0;e<=r;e++)if(Ke(e,r,i,!0)>=o)return e},"BINOM.DIST.RANGE":function(e,t,n,r){const i=D(e),o=D(t),a=D(n);let l=O(r);"number"!=typeof l&&(l=a);let s=0;for(let e=a;e<=l;e++)s+=ye(i,e)*Math.pow(o,e)*Math.pow(1-o,i-e);return s},"BINOM.DIST":Ke,BITAND:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n&r;throw R.value},BITLSHIFT:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return r>0?n<<r:n>>-r;throw R.value},BITOR:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n|r;throw R.value},BITRSHIFT:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return r>0?n>>r:n<<-r;throw R.value},BITXOR:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n^r;throw R.value},CEILING:be,COMBIN:ye,COMBINA:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return 0===n&&0===r?1:ye(n+r-1,n-1)},COMPLEX:Re,CORREL:function(e,t){if(e.length!==t.length)throw R.na;const n=e.filter(e=>"number"==typeof e),r=t.filter(e=>"number"==typeof e),i=n.length,o=n.reduce((e,t)=>e+t,0)/i,a=r.reduce((e,t)=>e+t,0)/i;let l=0,s=0,u=0;for(let e=0;e<i;e++)l+=(n[e]-o)*(r[e]-a),s+=Math.pow(n[e]-o,2),u+=Math.pow(r[e]-a,2);const c=Math.sqrt(s*u);if(!c)throw R.div0;return l/c},COS:function(e){const t=O(e);if("number"==typeof t)return Math.cos(t)},COSH:function(e){const t=O(e);if("number"==typeof t)return Math.cosh(t)},COT:function(e){const t=O(e);if("number"==typeof t)return 1/Math.tan(t)},COTH:function(e){const t=O(e);if("number"==typeof t){const e=Math.exp(2*t);return(e+1)/(e-1)}},COUNT:Q,COUNTA:Z,COUNTBLANK:function(...e){let t=0;const n=I(e);for(let e=0;e<n.length;e++)0===n[e]||n[e]||t++;return t},COVAR:Ge,"COVARIANCE.P":Ge,"COVARIANCE.S":function(e,t){return Ye(e,t,!0)},CSC:function(e){const t=O(e);if("number"==typeof t)return 1/Math.sin(t)},CSCH:function(e){const t=O(e);if("number"==typeof t)return 2/(Math.exp(t)-Math.exp(-t))},DEC2BIN:Ae,DEC2HEX:Te,DEC2OCT:ke,DECIMAL:function(e,t){const n=O(e),r=O(t);if(!`${n}`.match("/[2-9]/")&&"number"==typeof n&&"number"==typeof r&&r>1&&r<37)return parseInt(`${n}`,r)},DEGREES:function(e){const t=O(e);if("number"==typeof t)return 180*t/Math.PI},DELTA:function(e,t){const n=O(e),r=O(t);if("number"==typeof n||"number"==typeof n)return+(n===r);throw R.value},DEVSQ:function(...e){const t=I(e),n=[];t.forEach(e=>{"number"==typeof e&&n.push(e)});const r=n.reduce((e,t)=>e+t,0)/n.length;return n.reduce((e,t)=>e+Math.pow(t-r,2),0)},DIVIDE:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r&&0!==r)return n/r},EQ:function(e,t){return typeof e==typeof t&&e==t},ERF:Ve,ERFC:function(e,t){const n=O(e);if("number"==typeof n)return 1-Ve(n,t);throw R.value},EVEN:function(e){const t=O(e);if("number"==typeof t){const e=X(t);return e%2?e+Math.sign(t):e}},EXP:Ne,FACT:xe,FACTDOUBLE:function e(t){const n=O(t);if("number"==typeof n){const t=Math.floor(n);return t<=0?1:t*e(t-2)}},FISHER:function(e){const t=O(e);if("number"==typeof t&&t>-1&&t<1)return.5*Math.log((1+t)/(1-t));throw R.value},FISHERINV:function(e){const t=O(e);if("number"==typeof t){const e=Math.exp(2*t);return(e-1)/(e+1)}throw R.value},FLOOR:Ce,GAMMA:function e(t){let n=O(t);if("number"!=typeof n)throw R.value;if(!(Number.isInteger(n)&&n<=0)){if(n<.5)return Math.PI/(Math.sin(Math.PI*n)*e(1-n));{n-=1;let e=Me[0];for(let t=1;t<9;t++)e+=Me[t]/(n+t);const t=n+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(t,n+.5)*Math.exp(-t)*e}}throw R.num},GCD:function(...e){const t=I(e),n=t.length;if(!n)return 1;let r=t[0],i=1;for(;"number"!=typeof r;){if(r=t[i],i>t.length)throw"The arguments should contain at least one numeric value";i++}let o=r<0?-r:r;for(;i<n;i++){const e=O(t[i]);if("number"==typeof e){let t=e<0?-e:e;for(;o&&t;)o>t?o%=t:t%=o;o+=t}}return o},GEOMEAN:function(...e){const t=I(e);if(t.some(e=>!Number.isFinite(e)||e<=0))throw R.num;return Math.pow(t.reduce((e,t)=>t*e,1),1/t.length)},GESTEP:function(e,t=0){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return+(e>=t);throw R.value},GT:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n>r},GTE:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n>=r},HARMEAN:function(...e){const t=I(e);if(t.some(e=>!Number.isFinite(e)||e<=0))throw R.num;const n=t.reduce((e,t)=>e+1/t,0);return 1/(1/t.length*n)},HEX2BIN:function(e,t){return Ae(parseInt(e.toString(),16),t)},HEX2DEC:function(e,t){let n=parseInt(e.toString(),16);if(!Number.isFinite(n))throw R.value;const r=n>De;r&&(n=-(n-2*De));const i=t?O(t):null,o=n.toString();return(r?"-":"")+(i?o.padStart(i,"0"):o)},HEX2OCT:function(e,t=null){let n=parseInt(e.toString(),16);return n>De&&(n^=De),ke(n,t)},IMABS:function(e){const t=qe(e),n=ze(e);if(!Number.isFinite(+t)||!Number.isFinite(+n))throw R.value;return Math.sqrt(Math.pow(+t,2)+Math.pow(+n,2))},IMAGINARY:ze,IMCONJUGATE:function(e){return Re(+qe(e),-+ze(e))},IMCOS:Pe,IMCOSH:Fe,IMCOT:function(e){return Ue(Pe(e),Le(e))},IMCSC:function(e){return Ue("1",Le(e))},IMCSCH:function(e){return Ue("1",Be(e))},IMDIV:Ue,IMEXP:function(e){const t=+qe(e),n=+ze(e),r=Math.exp(t);return Re(r*Math.cos(n),r*Math.sin(t))},IMLN:function(e){const t=+qe(e),n=+ze(e);return Re(Math.log(Math.sqrt(t*t+n*n)),Math.atan(n/t))},IMPOWER:function(e,t){const n=O(t);if("number"!=typeof n)throw R.value;const r=+qe(e),i=+ze(e),o=Math.sqrt(r*r+i*i),a=Math.pow(o,n),l=Math.atan(i/r);return Re(a*Math.cos(n*l),a*Math.sin(n*l))},IMPRODUCT:function(...e){if(0===e.length)throw R.value;let t=e[0];for(const n of e.slice(1))t=H(t.toString(),n.toString());return t.toString()},IMREAL:qe,IMSEC:function(e){return Ue("1",Pe(e))},IMSECH:function(e){return Ue("1",Fe(e))},IMSIN:Le,IMSINH:Be,IMSQRT:function(e){const t=+qe(e),n=+ze(e),r=Math.sqrt(Math.sqrt(t*t+n*n)),i=Math.atan(n/t)/2;return Re(r*Math.cos(i),r*Math.sin(i))},IMSUB:function(e,t){const n=+qe(e),r=+ze(e);return Re(n-+qe(t),r-+ze(t))},IMSUM:function(...e){if(0===e.length)throw R.value;let t=e[0];for(const n of e.slice(1))t=j(t.toString(),n.toString());return t.toString()},IMTAN:function(e){return Ue(Le(e),Pe(e))},INT:me,LARGE:function(e,t){const n=O(t),r=e.sort((e,t)=>e-t);if("number"==typeof n&&!e.some(e=>"number"!=typeof O(e)))return r[r.length-n];throw R.value},LN:function(e){const t=O(e);if("number"==typeof t)return Math.log(t)},LOG:Se,LOG10:function(e){const t=O(e);if("number"==typeof t)return Math.log(t)/Math.log(10)},LT:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n<r},LTE:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n<=r},MAX:J,MEDIAN:function(...e){const t=I(e);t.sort(function(e,t){return e-t});const n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2},MIN:ee,MINUS:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n-r},MOD:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r&&0!==r){const e=Math.abs(n%r);return t>0?e:-e}},MROUND:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r&&n*r>-1)return Math.round(n/r)*r},MULTINOMIAL:function(...e){const t=I(e);let n=0,r=1;for(let e=0;e<t.length;e++){const i=O(t[e]);"number"==typeof i&&(n+=i,r*=xe(t[e]))}return xe(n)/r},MULTIPLY:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return n*r},NE:function(e,t){return typeof e!=typeof t||e!=t},OCT2BIN:function(e,t=null){let n=parseInt(e.toString(),8);return n&He&&(n=-(2*He-n)),Ae(n,t)},OCT2DEC:function(e,t=null){const n=t?O(t):null;let r=parseInt(e.toString(),8);if(r&He&&(r=-(2*He-r)),!Number.isFinite(r)||"boolean"==typeof n)throw R.value;return r.toString().padStart(n||0,"0")},OCT2HEX:function(e,t=null){let n=parseInt(e.toString(),8);return n&He&&(n=-(2*He-n)),Te(n,t)},ODD:function(e){const t=O(e);if("number"==typeof t){const e=X(t);return e%2?e:e+Math.sign(t)}},PERCENTILE:je,"PERCENTILE.INC":je,"PERCENTILE.EXC":function(e,t){return je(e,t,!0)},PERMUT:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return xe(n)/xe(n-r);throw R.value},PI:function(){return Math.PI},POW:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return ce(e,t)},POWER:ce,PRODUCT:te,QUARTILE:We,"QUARTILE.INC":We,"QUARTILE.EXC":function(e,t){return We(e,t,!0)},QUOTIENT:function(e,t){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r)return W(n/r)},RADIANS:function(e){const t=O(e);if("number"==typeof t)return t*Math.PI/180},RAND:fe,RANDBETWEEN:$e,ROMAN:function(e){const t=O(e);if("number"==typeof t){const e=String(t).split("");let n="",r=3;for(;r--;)n=(Ee[+e.pop()+10*r]||"")+n;return new Array(+e.join("")+1).join("M")+n}},ROUND:ge,ROUNDDOWN:ve,ROUNDUP:pe,SEC:function(e){const t=O(e);if("number"==typeof t)return 1/Math.cos(t)},SECH:function(e){const t=O(e);if("number"==typeof t)return 2/(Math.exp(t)+Math.exp(-t))},SIGN:function(e){const t=O(e);if("number"==typeof t)return 0===t?0:t/Math.abs(t);throw R.value},SIN:function(e){const t=O(e);if("number"==typeof t)return Math.sin(t)},SINH:function(e){const t=O(e);if("number"==typeof t)return Math.sinh(t)},SMALL:function(e,t){const n=O(t),r=e.sort((e,t)=>e-t);if("number"==typeof n&&!e.some(e=>"number"!=typeof O(e)))return r[n-1];throw R.value},SQRT:he,SQRTPI:function(e){const t=O(e);if("number"==typeof t&&t>-1)return Math.sqrt(t*Math.PI)},STDEV:se,"STDEV.S":se,"STDEV.P":ue,STDEVA:function(...e){return Math.sqrt(oe(...e))},STDEVP:ue,STDEVPA:function(...e){return Math.sqrt(le(...e))},STEYX:function(e,t){if(e.length!==t.length)throw R.na;const n=e.filter(e=>"number"==typeof e),r=t.filter(e=>"number"==typeof e),i=n.length;if(2===i)throw R.div0;const o=n.reduce((e,t)=>e+t,0)/i,a=r.reduce((e,t)=>e+t,0)/i;let l=0,s=0,u=0;for(let e=0;e<i;e++)l+=(n[e]-o)*(r[e]-a),s+=Math.pow(n[e]-o,2),u+=Math.pow(r[e]-a,2);if(2===u)throw R.div0;return Math.sqrt((s-Math.pow(l,2)/u)/(i-2))},SUBTOTAL:function(e,...t){const n=O(e),r=I(t);if("number"==typeof n)switch(n){case 1:case 101:return Y(...r);case 102:case 2:return Q(...r);case 103:case 3:return Z(...r);case 104:case 4:return J(...r);case 105:case 5:return ee(...r);case 106:case 6:return te(...r);case 107:case 7:case 110:case 10:return;case 108:case 8:return ue(...r);case 109:case 9:return K(...r);case 111:case 11:return ae(...r)}},SUM:K,SUMPRODUCT:ne,SUMSQ:function(...e){let t=0;const n=I(e);for(let e=0;e<n.length;e++){const r=O(n[e]);"number"==typeof r&&(t+=Math.pow(r,2))}return t},SUMX2MY2:function(e,t){if(!e.find(e=>"number"!=typeof O(e))&&!t.find(e=>"number"!=typeof O(e))){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*e[r]-t[r]*t[r];return n}},SUMX2PY2:function(e,t){if(!e.find(e=>"number"!=typeof O(e))&&!t.find(e=>"number"!=typeof O(e))){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*e[r]+t[r]*t[r];return n}},SUMXMY2:function(e,t){if(!e.find(e=>"number"!=typeof O(e))&&!t.find(e=>"number"!=typeof O(e))){let n=0;for(let r=0;r<e.length;r++)n+=Math.pow(e[r]-t[r],2);return n}},TAN:function(e){const t=O(e);if("number"==typeof t)return Math.tan(t)},TANH:function(e){const t=O(e);if("number"==typeof t)return Math.tanh(t)},TRUNC:function(e){const t=O(e);if("number"==typeof t)return W(t)},VAR:ie,"VAR.S":ie,"VAR.P":ae,VARA:oe,VARP:ae,VARPA:le,WEIBULL:Xe,"WEIBULL.DIST":Xe};function Ze(...e){return I(e).join("")}function Je(e,t){return V(e)?"":e.toString().substring(0,t)}function et(e,t,n){return V(e)?"":e.toString().substring(t-1,t-1+n)}function tt(e,t){return V(e)?"":e.toString().substring(e.length-t)}function nt(e){return V(e)?"":e.toString().toLowerCase()}function rt(e){return V(e)?"":e.toString().toUpperCase()}function it(e){if(V(e))return"";const t=e.toString().toLowerCase().split(" ");e="";for(const n in t)e+=(e?" ":"")+t[n].substring(0,1).toUpperCase()+t[n].substring(1);return e}function ot(e){return V(e)?"":e.toString().trim()}function at(e){return V(e)?0:e.toString().length}const lt=/[\0-\x1F]/g;function st(e,t,n=0){const r=O(n);if("number"==typeof r&&t)return`${t}`.indexOf(`${e}`,r-1)+1;throw"index cannot be string"}function ut(e,t,n=0){const r=O(n);if("number"==typeof r){const n=`${t}`.toLowerCase().indexOf(`${e}`.toLowerCase(),r-1)+1;if(0!==n)return n;throw"not found"}}function ct(e,t,n,r){if(!e||!t||!n&&""!==n)return`${e}`;if(void 0===r)return`${e}`.replace(new RegExp(`${t}`,"g"),`${n}`);{let i=0,o=0;for(;`${e}`.indexOf(`${t}`,i)>0;)if(i=`${e}`.indexOf(`${t}`,i+1),o++,o===r)return`${e}`.substring(0,i)+n+`${e}`.substring(i+`${t}`.length)}}function ht(e,t,n,r){const i=O(t),o=O(n);if("number"==typeof i&&"number"==typeof o){const t=e.toString(),n=r.toString();return t.replace(t.substr(i-1,o),n)}}var dt=Object.freeze({__proto__:null,CONCATENATE:Ze,LEFT:Je,MID:et,RIGHT:tt,LOWER:nt,UPPER:rt,PROPER:it,TRIM:ot,LEN:at,CHAR:function(e){const t=O(e);if("number"==typeof t)return String.fromCharCode(t)},CLEAN:function(e=""){return`${e}`.replace(lt,"")},CODE:function(e=""){return`${e}`.charCodeAt(0)},EXACT:function(e,t){return e===t},FIND:st,FIXED:function(e,t=2,n=!1){const r=O(e),i=O(t);if("number"==typeof r&&"number"==typeof i){const e=r.toFixed(i);if(N(n))return`${e}`;const[t,o]=`${e}`.split(".");return t.replace(/\B(?=(\d{3})+(?!\d))/g,",")+"."+o}},NUMBERVALUE:function(e,t=".",n=","){if("string"==typeof e&&"string"==typeof t&&"string"==typeof n)return Number(e.replace(t,".").replace(n,""))},REGEXEXTRACT:function(e,t){if("string"==typeof e&&"string"==typeof t){const n=e.match(new RegExp(t));return n?n[n.length>1?n.length-1:0]:null}},REGEXMATCH:function(e,t){if("string"==typeof e&&"string"==typeof t)return!!e.match(new RegExp(t))},REGEXREPLACE:function(e,t,n){if("string"==typeof e&&"string"==typeof t)return e.replace(new RegExp(t),`${n}`)},REPT:function(e,t){const n=O(t);if("number"==typeof n)return new Array(n+1).join(`${e}`)},SEARCH:ut,SUBSTITUTE:ct,T:function(e){return"string"==typeof e&&"TRUE"!==e&&"FALSE"!==e?`${e}`:""},JOIN:function(e,...t){const n=[];return t.forEach(t=>{"object"==typeof t?n.push(t.join(`${e}`)):n.push(t)}),n.join(`${e}`)},REPLACE:ht,ARRAYTOTEXT:function(e,t){return t?`{${e.map(e=>"string"==typeof e?`"${e}"`:e).join("; ")}}`:e.join("; ")}});const ft=[[],[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],[],[],[],[],[],[],[],[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]],mt=[void 0,0,1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,0],gt=[[],[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],void 0,void 0,void 0,[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6]];function vt(e,t,n){return k(new Date(e,t-1,n))}function pt(e,t,n){const r=k(new Date(1900,0,1,e,t,n,0));return r-Math.trunc(r)}function wt(e){return T(e).getDate()}function bt(e){return T(e).getMonth()+1}function _t(e){return T(e).getFullYear()}function xt(e){return T(e).getHours()}function yt(e){return T(e).getMinutes()}function Ct(e){return T(e).getSeconds()}function St(){return k(new Date)}function $t(e,t,n){const r=n.toLowerCase();if("d"===r)return t-e;const i=T(e),o=T(t);switch(r){case"y":return o.getFullYear()-i.getFullYear();case"m":return 12*(o.getFullYear()-i.getFullYear())+o.getMonth()-i.getMonth();case"d":return Math.floor(t-e);case"md":{const e=o.getDate()-i.getDate();if(e<0){const e=new Date(i.getFullYear(),i.getMonth()+1,0).getDate();return o.getDate()+e-i.getDate()}return e}case"ym":{const e=o.getMonth()-i.getMonth();return e<0?12+e:e}case"yd":{const e=A(o)-A(i);return e<0?365+e:e}}}function Et(e,t){const n=M(e),r=M(t);if(n&&r)return Math.round((n.getTime()-r.getTime())/864e5)}function Rt(e){const t=M(e);if(t){t.setHours(0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));const e=new Date(t.getFullYear(),0,1);return Math.ceil(((t.getTime()-e.getTime())/864e5+1)/7)}}function At(e,t,n,r){const i=M(e),o=M(t);if(i&&o){const e=void 0===n?gt[1]:gt[n],t=r||[];for(let e=0;e<t.length;e++){const n=T(t[e]);if(n instanceof Error)throw`The ${t[e]} is not a  number`;t[e]=n}const a=(o.getTime()-i.getTime())/864e5+1;let l=Math.round(a);const s=i;for(let n=0;n<a;n++){const n=(new Date).getTimezoneOffset()>0?s.getUTCDay():s.getDay();let r=!1;n!==e[0]&&n!==e[1]||(r=!0);for(let e=0;e<t.length;e++){const n=t[e];if(n.getDate()===s.getDate()&&n.getMonth()===s.getMonth()&&n.getFullYear()===s.getFullYear()){r=!0;break}}r&&l--,s.setDate(s.getDate()+1)}return l}}function Tt(e,t,n,r){const i=M(e),o=O(t);if(i&&"number"==typeof o){const e=void 0===n?gt[1]:gt[n],t=r||[];for(let e=0;e<t.length;e++){const n=T(t[e]);if(n instanceof Error)throw`The ${t[e]} is not a  number`;t[e]=n}let a=0;for(;a<o;){i.setDate(i.getDate()+1);const n=i.getDay();if(n!==e[0]&&n!==e[1]){for(let e=0;e<t.length;e++){const n=t[e];if(n.getDate()===i.getDate()&&n.getMonth()===i.getMonth()&&n.getFullYear()===i.getFullYear()){a--;break}}a++}}return k(i)}}function kt(e){return 1===new Date(e,1,29).getMonth()}function Ot(e,t,n=0){const r=M(e),i=M(t);if(r&&i){let e=r.getDate();const t=r.getMonth()+1,o=r.getFullYear();let a=i.getDate();const l=i.getMonth()+1,s=i.getFullYear();let u=365;const c=s-o+1,h=(new Date(s+1,0,1).getTime()-new Date(o,0,1).getTime())/1e3/60/60/24/c;switch(n){case 0:return 31===e&&31===a?(e=30,a=30):31===e?e=30:30===e&&31===a&&(a=30),(a+30*l+360*s-(e+30*t+360*o))/360;case 1:return o===s||o+1===s&&(t>l||t===l&&e>=a)?((o===s&&kt(o)||function(e,t){const n=e.getFullYear(),r=new Date(n,2,1);if(kt(n)&&e<r&&t>=r)return!0;const i=t.getFullYear(),o=new Date(i,2,1);return kt(i)&&t>=o&&e<o}(r,i)||1===l&&29===a)&&(u=366),Et(i.toDateString(),r.toDateString())/u):Et(i.toDateString(),r.toDateString())/h;case 2:return Et(i.toDateString(),r.toDateString())/360;case 3:return Et(i.toDateString(),r.toDateString())/365;case 4:return(a+30*l+360*s-(e+30*t+360*o))/360}}}const It={DATE:vt,TIME:pt,DAY:wt,MONTH:bt,YEAR:_t,HOUR:xt,MINUTE:yt,SECOND:Ct,NOW:St,DATEDIF:$t,DATEVALUE:function(e){if("string"==typeof e)return k(new Date(new Date(e).toDateString()))},DAYS:Et,DAYS360:function(e,t,n=0){const r=M(e),i=M(t);if(r&&i){const e=r.getMonth();let t,o,a=i.getMonth();if(N(n))t=31===r.getDate()?30:r.getDate(),o=31===i.getDate()?30:i.getDate();else{const n=new Date(r.getFullYear(),e+1,0).getDate(),l=new Date(i.getFullYear(),a+1,0).getDate();t=r.getDate()===n?30:r.getDate(),i.getDate()===l?t<30?(a++,o=1):o=30:o=i.getDate()}return 360*(i.getFullYear()-r.getFullYear())+30*(a-e)+(o-t)}},EDATE:function(e,t){const n=M(e),r=O(t);if(n&&"number"==typeof r)return n.setMonth(n.getMonth()+r),k(n)},EOMONTH:function(e,t){const n=M(e),r=O(t);if(n&&"number"==typeof r)return k(new Date(n.getFullYear(),n.getMonth()+r+1,0))},ISOWEEKNUM:Rt,NETWORKDAYS:function(e,t,n){return At(e,t,1,n)},"NETWORKDAYS.INTL":At,TIMEVALUE:function(e){if("string"==typeof e){const t=e.split(" "),n=t[1],r=t[0].split(":"),i=new Date;return i.setHours(+r[0]),n&&"PM"===n.toUpperCase()&&i.setHours(i.getHours()+12),i.setMinutes(+r[1]),r[2]&&i.setSeconds(+r[2]),(3600*i.getHours()+60*i.getMinutes()+i.getSeconds())/86400}},WEEKNUM:function(e,t=1){const n=M(e);if(21===t)return Rt(t);const r=mt[t],i=new Date(n.getFullYear(),0,1),o=i.getDay()<r?1:0,a=i.getTime()-24*Math.abs(i.getDay()-r)*60*60*1e3;return Math.floor((n.getTime()-a)/864e5/7+1)+o},WEEKDAY:function(e,t=1){const n=M(e).getDay();return ft[t][n]},WORKDAY:function(e,t,n){return Tt(e,t,1,n)},"WORKDAY.INTL":Tt,YEARFRAC:Ot};function Vt(e){return void 0===e?null:e}function Nt(e,t,n,r){void 0===n&&(n=0);let i=-1;if(0===n)i=t.indexOf(e);else{let r="string"==typeof e?"":-1/0*n;1===n?t.forEach((t,n)=>{t<=e&&t>r&&(r=t,i=n)}):-1===n&&t.forEach((t,n)=>{t>=e&&t<r&&(r=t,i=n)})}return i+1}var Mt=Object.freeze({__proto__:null,INDEX:function(e,t,n){const r=t,i=n;return Vt(e[(e.$width?e.$width:1)*(r-1)+(i||1)-1])},XMATCH:function(e,t,n,r){const i=Nt(e,t,n);if(0===i)throw"#N/A";return i},XLOOKUP:function(e,t,n,r,i,o){const a=Nt(e,t,i);if(0===a){if(void 0!==r)return r;throw"#N/A"}return(n||t)[a-1]},LOOKUP:function(e,t,n){const r=Nt(e,t,1);if(0===r)throw"#N/A";return(n||t)[r-1]},HLOOKUP:function(e,t,n,r){let i=!0;void 0!==r&&(i=N(r));const o=t.$width?t.$width:t.length,a=Nt(e,t.slice(0,o),i?1:0);if(0===a)throw"#N/A";return Vt(t[o*((n||1)-1)+a-1])},VLOOKUP:function(e,t,n,r){let i=!0;void 0!==r&&(i=N(r));const o=t.$width?t.$width:1,a=t.length/o;let l;if(1===a)l=t;else{l=[];for(let e=0;e<a;e++)l.push(t[o*e])}const s=n,u=Nt(e,l,i?1:0);if(0===u)throw"#N/A";return Vt(t[o*(u-1)+(s||1)-1])},MATCH:function(e,t,n){let r=n;void 0===n&&(r=1);const i=Nt(e,t,r);if(0===i)throw"#N/A";return i},CHOOSE:function(e,...t){let n=O(e);if(t.length>1&&"number"==typeof n){if(t.length<n)throw"the index number is greater than the length of the array of values";if(n<=0)throw"index cannot be less than or equal to 0";return n--,t[n]}}}),Dt=Object.freeze({__proto__:null,IF:function(e,t,n){return e?t:n},AND:function(...e){for(let t=0;t<e.length;t++)if(!N(e[t]))return!1;return!0},NOT:function(e){return!N(e)},OR:function(...e){for(let t=0;t<e.length;t++)if(e[t])return!0;return!1},FALSE:function(){return!1},TRUE:function(){return!0}}),qt=Object.freeze({__proto__:null,ISBLANK:function(e){return V(e)},ISBINARY:function(e){return/^[01]{1,10}$/.test(`${e}`)},ISEVEN:function(e){const t=O(e);return"number"==typeof t&&t%2==0},ISODD:function(e){const t=O(e);return"number"==typeof t&&t%2!=0},ISNONTEXT:function(e){return"string"!=typeof e},ISNUMBER:function(e){return"number"==typeof O(e)},ISTEXT:function(e){return"string"==typeof e},N:function(e){const t=O(e);if("number"==typeof t)return t;const n=new Date(e);return n.getTime()?k(n):"TRUE"===e||!0===e?1:0}});const zt={SUM:K,AVERAGE:Y,AVERAGEA:G,COUNT:Q,COUNTA:Z,MIN:ee,MAX:J,SQRT:he,POWER:ce,LOG:Se,EXP:Ne,PRODUCT:te,SUMPRODUCT:ne,ABS:de,RAND:fe,RANDBETWEEN:$e,ROUND:ge,ROUNDUP:pe,ROUNDDOWN:ve,INT:me,CEILING:be,FLOOR:Ce},Pt={CONCATENATE:Ze,MID:et,LEFT:Je,RIGHT:tt,LOWER:nt,UPPER:rt,PROPER:it,TRIM:ot,LEN:at,SEARCH:ut,FIND:st,REPLACE:ht,SUBSTITUTE:ct,NOW:St},Ft={DATE:vt,TIME:pt,YEAR:_t,MONTH:bt,DAY:wt,HOUR:xt,MINUTE:yt,SECOND:Ct,DATEDIF:$t},Ut=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zt),Pt),Ft),Mt),qt),Dt),Lt=Object.assign({},Ut),Bt=()=>Object.keys(Lt);function Ht(e,t,r,i,o,a){const[l,s,u]=n(e),[c,h,d]=n(i);return!(u!==d||l>=c+o||l+t<=c||s>=h+a||s+r<=h)}const jt=Math.pow(10,8);function Wt(e,t,n){n.add?e.has(t)||n.add(t):e.add(t)}function Xt(e){if(e.keys)return Array.from(e.keys());const t=[];return e.forEach((e,n)=>t.push(n)),t}function Kt(e){if(e.values)return e.values();const t=[];e.forEach((e,n)=>t.push(n));let n=0;return{add:e=>{t.push(e)},next:()=>{const e=t[n];return n++,{done:n>t.length,value:e}}}}class Yt{constructor(e){(e=e||{get:null,set:null,strict:!1})&&(this._getter=e.get,this._setter=e.set,this._strict=e.strict),this._parser=C,this._printer=E,this._parseContext={name:function(){},pageName:()=>"",pageObj:()=>null,page:function(){return 0},z:0},this.$count=0,this._data=new Map,this._triggers=new Map,this._holders={},this._context={a:(e,t,n)=>(e.$width=t,e.$height=n,e),v:e=>{if(-1===e)throw new Error;const t=this._getter(e);return void 0===t?null:t},r:(e,t)=>{const[r,i]=n(e),[o,a]=n(t),l=o-r,s=a-i+1,u=[];u.$width=s,u.$height=l+1;for(let t=0;t<=l;t++)for(let n=0;n<s;n++)u[t*s+n]=this._getter(e+64*n+4096*t*64);return u},m:Lt,e:e=>{throw e},p:e=>this.getPlaceholder(e)}}getTriggerList(e){return this._triggers.get(e)}setValue(e,t,n,r){""===t&&(t=null),this._removeTriggers(e,null),this._setter(e,t,n)&&(r||this.trigger(e))}clean(e){this._removeTriggers(e,null)}getValue(e){return this._getter(e)}getMeta(){return this._meta}setMeta(e){this._meta=Object.assign(Object.assign({},this._meta),e)}setPlaceholder(e,t){"*"===e?Object.entries(t).forEach(e=>this.setPlaceholder(e[0],e[1])):(null===t?delete this._holders[e]:this._holders[e]=t,this.each((t,n)=>{(function(e,t,n){for(let r=0;r<e.length;r+=3)if(2===e[r]&&t.substr(e[r+1],e[r+2])==n)return!0;return!1})(n.code,n.source,e)&&this.setMath(t,n.source,this._parseContext)}))}getPlaceholder(e){if("*"===e)return this._holders;const t=this._holders[e];return void 0===t?null:t}setMath(e,t,n,r){const i=this._generate(t,n),o=this._setMathAt(e,i);r||this._execAndTrigger(o)}refresh(e){this._execAndTrigger(e)}getMath(e){return this._data.get(e)}trigger(e,t){const n=this._triggers.get(e);if(n){const e=!t;t||(t=new Set);for(let e=0;e<n.length;e++)t.add(n[e]);e&&this.triggerSet(t)}return null}triggerSet(e){const t=new Map;for(;e.size;){const n=Kt(e);let r=!1;e:for(let i=n.next();!i.done;i=n.next()){const n=this._data.get(i.value);let o=t.get(i.value);if(o&&(1==o&&(o=this._check_for_loops(i.value,n.triggers,t)),2==o))continue;const a=n.triggers;if(a)for(let t=0;t<a.length;t++)if(e.has(a[t]))continue e;this._execAndTrigger(i.value,e),o||t.set(i.value,1),e.delete(i.value),r=!0}if(!r)return void e.forEach(t=>this._errorAndTrigger(t,e))}}getStats(){return{math:this._data.size,trigger:this._triggers.size}}_check_for_loops(e,t,n){const r=new Set;t.forEach(e=>r.add(e));const i=Kt(r);for(let t=i.next();!t.done;t=i.next()){if(t.value==e)return n.set(e,2),2;const o=n.get(t.value);if(o&&o>1)return n.set(e,o),o;const a=this._data.get(t.value);a&&a.triggers&&a.triggers.forEach(e=>Wt(r,e,i))}return n.set(e,3),3}_setMathAt(e,t){if(this._removeTriggers(e,t)){if(t.triggers)if(-1===t.triggers.indexOf(e)&&3!==t.broken)for(let n=0;n<t.triggers.length;n++){const r=t.triggers[n];let i=this._triggers.get(r);void 0===i&&(i=[],this._triggers.set(r,i)),i.push(e)}else t=Object.assign(Object.assign({},t),{broken:3});return this._data.set(e,t),e}}_removeTriggers(e,t){const n=this._data.get(e);if(!n)return!0;if(n===t)return!1;n.$width&&this._clearArea(e,!1);const r=n.triggers;if(r&&3!==n.broken)for(let t=0;t<r.length;t++){const n=r[t],i=this._triggers.get(n);if(i){const t=i.filter(t=>t!==e);t.length?this._triggers.set(n,t):this._triggers.delete(n)}}return this._data.delete(e),!0}parse(e,t){return this._parser(e,t||this._parseContext)}exec(e,t){const n=this._generate(e,t);return this._exec(n)}each(e){Xt(this._data).forEach(t=>e(t,this._data.get(t)))}setLogger(e){this._err_handler=e}_setErr(t,n){return t.broken=2,n&&this._err_handler&&this._err_handler(n),e[t.broken]}_exec(t){if(t.broken>0&&2!==t.broken)return e[t.broken];try{const e=t.exec(this._context);return t.broken=0,"number"==typeof e?isFinite(e)?Math.round(e*jt)/jt:this._setErr(t):e}catch(e){return this._setErr(t,e)}}toString(e,t){return l(e,t||this._parseContext)}regenerate(e,t,n){n=Object.assign({},n||this._parseContext),Xt(this._data).forEach(r=>{let o=!1;const a=this._data.get(r),s=i(r);if(t&&s===e)this._removeTriggers(r,null);else{for(let t=0;t<a.code.length;t+=3)if(9===a.code[t]&&i(a.code[t+1])===e){o=!0;break}o&&(n.z=s,t?this.setMath(r,a.source,n):(a.source=l(a,n),a.code=this._parser(a.source,n).code))}})}recalculate(e,t){t=Object.assign({},t||this._parseContext);const n=new Set;this.each(r=>{if(e){const e=this._data.get(r);if(e.broken&&2!==e.broken)return t.z=i(r),void this.setMath(r,e.source,t)}n.add(r)}),this.triggerSet(n)}_generate(e,t,n){const r=n||this._parser(e,t||this._parseContext);return this._printer(r,this._strict),r.triggers=function(e){let t=[];const n=e.code,r=n.length;for(let e=0;e<r;e+=3)switch(n[e]){case 7:case 6:{const r=n[e+4];t.push(r);break}case 8:o(n[e+4],n[e+7],e=>t.push(e))}if(t.length>10){const e=new Set;t=t.filter(t=>!e.has(t)&&(e.add(t),!0))}return t.length?t:null}(r),r}_execAndTrigger(e,t){this.$count+=1;const n=this._data.get(e);if(n){const r=this._exec(n);if(Array.isArray(r)&&63!==i(e))return void this._complexSetter(e,r,t);this._setter(e,r,2)&&this.trigger(e,t)}}_complexSetter(e,t,n){const{$width:r,$height:i}=t,o=this._data.get(e);o.$width=r,o.$height=i;try{a(e,r,i,(r,i)=>{this._setter(r,t[i],2,0===i?null:e)&&this.trigger(r,n)})}catch(t){this._clearArea(e,!0)}}_clearArea(t,n){const{$width:r,$height:i}=this._data.get(t);a(t,r,i,(r,i)=>{0===i&&n?this._setter(r,e[4],1)&&this.trigger(r):(n?this._setter(r,null,3,t):this._setter(r,null,3,-1))&&this.trigger(r)})}_errorAndTrigger(e,t){const n=this._data.get(e),r=this._setErr(n);this._setter(e,r,2)&&this.trigger(e,t)}debug(e,t=!1){const n=function(e){const t=e.code,n=e.source;let r="";const i=t.length;for(let e=0;e<i;e+=3){const i=t[e];let o;switch(i){case 4:o="method";break;case 1:o="text";break;case 5:o="page";break;case 2:o="holder";break;case 6:o="name";break;case 7:o="arg";break;case 8:o="range";break;case 9:o="data";break;case 10:o="op";break;case 11:o="number";break;case 3:o="error";break;case 12:o="extra";break;case 13:o="arr"}r+=9===i?`            ${t[e+1]}.${t[e+2]}\n`:13===i?`[${o}]${S(o)}${t[e+1]} x ${t[e+2]}\n`:`[${o}]${S(o)}${n.substr(t[e+1],t[e+2])}\n`}return r}(this.parse(e));if(t)return n;console.log(n)}transpose(e,r,i,o){o=o||this._parseContext;const[a,l,s]=n(e),u=new Map,c=new Map,h=new Set;Xt(this._data).forEach(e=>{const[d,f,m]=n(e),g=this._data.get(e),v=m===o.z?o:Object.assign(Object.assign({},o),{z:m}),p=this._transpose(g,a,l,r,i,o,v);let w=e;if(m===s&&(f>=l||d>=a)&&(w=t(d>=a?d+r:d,f>=l?f+i:f,m)),g!==p||e!==w){if(c.set(e,p),m===s&&(i<0&&f>=l&&f<l-i||r<0&&d>=a&&d<a-r))return;u.set(w,p),g.broken!==p.broken&&h.add(w)}}),Xt(u).forEach(e=>this._setMathAt(e,u.get(e))),Array.from(c.keys()).forEach(e=>{u.has(e)||this._removeTriggers(e,null)}),r>0&&this._triggerRow(a,r,h),i>0&&this._triggerColumn(l,i,h),r<0&&this._triggerRow(a-1,2,h),i<0&&this._triggerColumn(l-1,2,h),this.triggerSet(h)}_triggerColumn(e,t,n){const r=t?e+t:e;Xt(this._triggers).forEach(t=>{const i=function(e){return e>>6&4095}(t);i>=e&&i<r&&this.trigger(t,n)})}_triggerRow(e,t,n){const i=t?e+t:e;Xt(this._triggers).forEach(t=>{const o=r(t);o>=e&&o<i&&this.trigger(t,n)})}moveMath(e,t,n,r,i,o,a){return"string"==typeof e&&(e=this.parse(e,o)),this._moveMath(e,t,n,r,i,a||o).source}_moveMath(e,r,i,o,a,s){const u=e.code;for(let e=0;e<u.length;e+=3)if(7===u[e]){let[l,s]=n(u[e+4]);Ht(a.id,a.h,a.w,u[e+4],1,1)&&(l+=r,s+=i,u[e+4]=t(l,s,o)),e+=3}else if(8===u[e]){let[l,s]=n(u[e+4]),[c,h]=n(u[e+7]);Ht(a.id,a.h,a.w,u[e+4],c-l+1,h-s+1)&&(l+=r,s+=i,c+=r,h+=i,u[e+4]=t(l,s,o),u[e+7]=t(c,h,o)),e+=6}let c={code:u,broken:e.broken,source:e.source,triggers:null,exec:null};return c=this._parser(l(c,s),s),this._generate(c.source,s,c)}transposeMath(e,t,n,r){return"string"==typeof e&&(e=this.parse(e,r)),r=r||this._parseContext,this._transpose(e,-1,-1,t,n,r,r).source}_transpose(e,r,i,o,a,s,u){let c=!0,h=e.code;const d=!(r<0||i<0);for(let e=0;e<h.length;e+=3)if(7===h[e]){let[l,u,f]=n(h[e+4]);if(s.z!==f)continue;const m=h[e+5];if(!d&&3==m)continue;(d||!(1&m))&&0!==o&&l>=r&&(c&&(h=[].concat(h),c=!1),l+=o,(l<r||l<0)&&(h[e]=3)),(d||!(2&m))&&0!==a&&u>=i&&(c&&(h=[].concat(h),c=!1),u+=a,(u<i||u<0)&&(h[e]=3)),c||(h[e+4]=t(l,u,f)),e+=3}else if(8===h[e]){const l=h[e+5],u=h[e+8];if(!d&&3===l&&3===u)continue;let[f,m,g]=n(h[e+4]),[v,p]=n(h[e+7]);if(s.z!==g)continue;0!==o&&((d||!(1&l))&&(o>0?f>=r:f>r)&&(c&&(h=[].concat(h),c=!1),f+=o,f<0&&(h[e]=3)),(d||!(1&u))&&v>=r&&(c&&(h=[].concat(h),c=!1),v+=o,v<f&&(h[e]=3))),0!==a&&((d||!(2&l))&&(a>0?m>=i:m>i)&&(c&&(h=[].concat(h),c=!1),m+=a,m<0&&(h[e]=3)),(d||!(2&u))&&p>=i&&(c&&(h=[].concat(h),c=!1),p+=a,p<m&&(h[e]=3))),c||(h[e+4]=t(f,m,g),h[e+7]=t(v,p,g)),e+=6}if(c)return e;let f={code:h,broken:e.broken,source:e.source,triggers:null,exec:null};return f=this._parser(l(f,u),u),this._generate(f.source,u,f)}}class Gt{constructor(e,t,n){this._id=e,this._store=t,this._meta={},this._parseContext=Object.assign(Object.assign({},n),{z:e}),this.reset(),this._parseMode=!1}reset(){this._data=[],this._rows=[],this._cols=[],this._spans=[]}getMeta(){return this._meta}setMeta(e){this._meta=Object.assign(Object.assign({},this._meta),e)}getID(){return this._id}cellID(e,n){return t(e,n,this._id)}getSize(){const e=this._data.length;let t=0;return this._data.forEach(e=>{e&&e.length>t&&(t=e.length)}),[e,t]}getContext(){return this._parseContext}addRow(e,n){this._data.splice.apply(this._data,Qt(e,n)),this._store.transpose(t(e,0,this._id),n,0,this._parseContext),this._rows.splice.apply(this._rows,Qt(e,n)),this._recalculateSpans(e,n,0)}removeRow(e,n){return this._data.splice(e,n),this._store.transpose(t(e,0,this._id),-n,0,this._parseContext),this._rows.splice(e,n),this._recalculateSpans(e,-n,0)}addColumn(e,n){const r=Qt(e,n);this._data.forEach(e=>{e&&e.splice.apply(e,r)}),this._store.transpose(t(0,e,this._id),0,n,this._parseContext),this._cols.splice.apply(this._cols,Qt(e,n)),this._recalculateSpans(e,0,n)}removeColumn(e,n){this._data.forEach(t=>{t&&t.splice(e,n)}),this._store.transpose(t(0,e,this._id),0,-n,this._parseContext),this._cols.splice(e,n),this._recalculateSpans(e,0,-n)}setCell(e,t,n){let r=this._data[e];r||(r=this._data[e]=[]);const i=r[t];r[t]=i?Object.assign(Object.assign(Object.assign({},i),n),{value:i.value}):n,void 0!==n.value&&this.setValue(e,t,n.value)}clearCell(e,n){const r=this._data[e];r&&r[n]&&(r[n]=null,this._store.setValue(t(e,n,this._id),""))}setValue(e,n,r,i){if(this.getCell(e,n,!0).$locked)return;const o=t(e,n,this._id);"string"==typeof r&&r.length>1&&"="===r[0]?this._store.setMath(o,r.substr(1),this._parseContext):this._store.setValue(o,r,i)}getCell(e,t,n){let r=this._data[e],i=r?r[t]:null;return i||!n||(r||(r=this._data[e]=[]),i=r[t],i||(i=r[t]={value:null})),i}getValue(e,n,r){if(r){const r=this._store.getMath(t(e,n,this._id));if(r)return"="+r.source}const i=this.getCell(e,n,!1);return i?i.value:null}getRange(e,t,n,r){const i=[];for(let o=e;o<=n;o++)for(let e=t;e<=r;e++)i.push(this.getValue(o,e,!1));return i}getCellRange(e,t,n,r){const i=[];for(let o=e;o<=n;o++)for(let e=t;e<=r;e++)i.push(this.getCell(o,e));return i}eachCell(e){this._data.forEach((t,n)=>{t&&t.forEach((t,r)=>{t&&e(n,r,t)})})}serialize(e){const n=[];return this.eachCell((r,i,o)=>{if(o=Object.assign({},o),e){const e=this._store.getMath(t(r,i,this.getID()));e&&(o.value="="+e.source)}n.push([r,i,o])}),n}serializeBlock(e,n,r,i,o){const a=[];for(let l=n;l<=i;l++)for(let n=e;n<=r;n++){const e=this.getCell(l,n);if(null==e)continue;const r=Object.assign({},e);if(o){const e=this._store.getMath(t(l,n,this.getID()));e&&(r.value="="+e.source)}a.push([l,n,r])}return a}parse(e,t){this.reset(),this._store.each(e=>{i(e)===this._id&&this._store.clean(e)}),this.parseBlock(e,t,!0)}parseBlock(e,n,r){const i=new Set;this._parseMode=!0,e.forEach(([e,o,a])=>{const l=t(e,o,this._id);r||this._store.clean(l);let s=this._data[e];s||(s=this._data[e]=[]);const u=(a=s[o]=Object.assign({},a)).value;if(u)if("string"==typeof u&&u.length>1&&"="===u[0]){const e=u.substr(1);this._store.setMath(l,e,this.getContext(),!0),i.add(l)}else n&&(a.value=null,this._store.setValue(l,u,null,!0),this._store.trigger(l,i))}),this._store.triggerSet(i),this._parseMode=!1}throwError(e){if(!this._parseMode)throw e}setRowMeta(e,t){const n=this._rows[e]||{};this._rows[e]=n?Object.assign(Object.assign({},n),t):t}getRowMeta(e,t){const n=this._rows[e];if(t&&!n){const t={};return this._rows[e]=t,t}return n||null}setColumnMeta(e,t){const n=this._cols[e]||{};this._cols[e]=n?Object.assign(Object.assign({},n),t):t}getColumnMeta(e,t){const n=this._cols[e];if(t&&!n){const t={};return this._cols[e]=t,t}return n||null}sort(e,t,r=0,i="asc"){const[o,a]=n(e),[l,s]=n(t),u="asc"===i,c=[],h=[];for(let e=o;e<=l;e++){const t=[];for(let n=a;n<=s;n++){const r=this._store.getMath(this.cellID(e,n));t.push({value:this.getValue(e,n),row:e,math:r||null})}c.push(t)}c.sort((e,t)=>{const n=e[r].value,i=t[r].value;return"string"==typeof n&&"string"==typeof i||"number"==typeof n&&"number"==typeof i?n<i?u?-1:1:n>i?u?1:-1:0:"number"==typeof n?-1:1});for(let e=o;e<=l;e++)for(let t=a;t<=s;t++){const n=c[e-o][t-a];if(n.math){const t=n.row-e,r=this._store.transposeMath(n.math,-t,0,this._parseContext);n.value=`=${r}`}h.push([e,t,{value:n.value}])}this.parseBlock(h)}addSpan(e,t,n){let r;if(!(t>1||n>1))return r=this._spans.findIndex(t=>t.id===e),void(-1!==r&&this._spans.splice(r,1));for(let r=0;r<=this._spans.length-1;r++){const i=this._spans[r];Ht(e,t,n,i.id,i.info.width,i.info.height)&&this._spans.splice(r,1)}this._spans.push({id:e,info:{width:t,height:n}})}getSpan(e){return this._spans.find(t=>t.id===e)||null}getSpans(){return this._spans}_recalculateSpans(e,r,i){if(this._spans.length)for(let o=this._spans.length-1;o>=0;o--){const a=this._spans[o];let{height:l,width:s}=a.info,[u,c]=n(a.id);r&&([u,l]=this._adjustSpan(u,l,e,r)),i&&([c,s]=this._adjustSpan(c,s,e,i)),s<1||l<1||s+l<=2?this._spans.splice(o,1):(a.id=t(u,c,this._id),a.info.height=l,a.info.width=s)}}_adjustSpan(e,t,n,r){const i=e+t;if(r<0){const o=n+(r=-r);n>e?n<=i&&(t-=Math.min(r,e+t-n)):o>e?(t-=o-e,e=r-(o-e)):e-=r}else n<=e?e+=r:n<=i&&(t+=r);return[e,t]}}function Qt(e,t){const n=[e,0];for(let e=0;e<t;e++)n.push(null);return n}class Zt{constructor(e,t,n){this._ranges=new Map,this._counter=1,this._rangeOrder=[],this._store=e,this._page=t,this._pageGetter=n}get(e){return this._store.getMath(this._ranges.get(e))}toId(e){return this._ranges.get(e)}add(e,t){const n=this._ranges.get(e)||this._next_id();this._store.setMath(n,t,this._page.getContext()),this._ranges.set(e,n),this._refresh(e)}remove(e){this._ranges.delete(e),this._counter=1,this._refresh(e)}serialize(){return Array.from(this._ranges.keys()).map(e=>[e,this.get(e).source])}parse(e){e.forEach(e=>this.add(e[0],e[1]))}_refresh(e){const t=e.indexOf("!");let n="";-1!==t&&(n=e.substr(0,t),e=e.substr(t+1)),this._store.each((t,r)=>{if(function(e,t,n,r){for(let i=0;i<e.length;i+=3)if(6===e[i]){if(""!==n){if(5===e[i-3]&&t.substr(e[i-2],e[i-1])!==n)continue;return!0}if(t.substr(e[i+1],e[i+2])===r)return!0}return!1}(r.code,r.source,n,e)){const e=i(t);this._store.setMath(t,r.source,this._pageGetter(e).getContext())}})}_next_id(){for(;this._rangeOrder[this._counter];)this._counter++;return this._rangeOrder[this._counter]=!0,t(this._counter,0,this._page.getID())}renamePage(e,t){e+="!",t&&(t+="!"),this._ranges.forEach((n,r,i)=>{0===r.indexOf(e)&&(t?i.set(r.replace(e,t),n):this._store.clean(n),i.delete(r))})}}class Jt{constructor(e,t){this._store=e,this._pageGetter=t}copy(e,t){t||(t=e);const n=this._serialize(e,t);return this._store.setMeta({$clipboard:n}),n}paste(e,t,r,i,o=this._updateCurrentCell){var a;if(i=i||0,!(null===(a=r=r||this._store.getMeta().$clipboard)||void 0===a?void 0:a.data.length))return;const[l,s,u]=n(e),[c,h]=n(t),d=this._pageGetter(u),[f,m]=n(r.from||0),g=r.data,v=[],p=l-f,w=s-m,b=[];if(0===i){const e=g[0].length-1;for(let t=0;t<=g.length-1;t++)for(let n=0;n<=e;n++){const e=g[t][n],r=l+t,i=s+n,a=this._updateCell(r,i,u,e,p,w,o);a&&this._addCellToPasteData(v,a,b,r,i,u)}}if(1===i)for(let e=l;e<=c;e++)for(let t=s;t<=h;t++){const n=t-s,r=g[e-l][n],i=this._updateCell(e,t,u,r,p,w,o);i&&this._addCellToPasteData(v,i,b,e,t,u)}if(2===i){let e=0;for(let t=l;t<=c;t++){let n=0;e===g.length&&(e=0);for(let r=s;r<=h;r++){n===g[0].length&&(n=0);const i=g[e][n],a=t-(f+e),l=r-(m+n),s=this._updateCell(t,r,u,i,a,l,o);s&&this._addCellToPasteData(v,s,b,t,r,u),n++}e++}}d.parseBlock(v),this._refreshRelatedFormulas(b)}_addCellToPasteData(e,n,r,i,o,a){e.push(n);const l=t(i,o,a),s=this._store.getTriggerList(l);s&&r.push(...s)}clean(e,r,i){i=i||255;const[o,a,l]=n(e),[s,u]=n(r),c=this._pageGetter(l),h=[],d=[];for(let e=o;e<=s;e++)for(let n=a;n<=u;n++){const r=c.getCell(e,n),o=t(e,n,l),a=255!==i||r.$locked?Object.assign({},r):{};if(1&i&&!r.$locked){const e=this._store.getTriggerList(o);e&&d.push(...e),delete a.value}h.push([e,n,a])}c.parseBlock(h),this._refreshRelatedFormulas(d)}_refreshRelatedFormulas(e){en(e).forEach(e=>this._store.refresh(e))}_serialize(e,r){const[i,o,a]=n(e),[l,s]=n(r),u=this._pageGetter(a),c={from:e,data:[]};for(let e=i;e<=l;e++){const n=[];for(let r=o;r<=s;r++){const i=u.getCell(e,r),o=this._store.getMath(t(e,r,a));let l;o&&(l=o.source);let s=null;i&&(s=Object.assign({},i),delete s.$locked);const c=[s];l&&c.push(l),n.push(c)}c.data.push(n)}return c}reset(){this._store.setMeta({$clipboard:null})}move(e,r){const{data:i,from:o}=r||this._store.getMeta().$clipboard,[a,l,s]=n(o),u=i.length,c=i[0].length,[h,d,f]=n(e),m=[],g=[],v=this._pageGetter(f),p={id:o,h:u,w:c};for(let e=0;e<u;e++)for(let n=0;n<c;n++){const r=h+e,w=d+n,b=v.getCell(r,w);if(b&&b.$locked){g.push([r,w,b]);continue}const _=i[e][n],[x,y]=_,C=t(a+e,l+n,s),S=this._store.getTriggerList(C);if(S){const e=this._getTriggersOutsideCutRange(S,o,u,c);e.length&&m.push(...e)}if(x){if(y){const e=this._pageGetter(s).getContext(),t=this._store.moveMath(y,h-a,d-l,f,p,e,v.getContext());x.value=`=${t}`}g.push([r,w,x])}else g.push([r,w,{}])}v.parseBlock(g),this._updateRelatedFormulas(m,h-a,d-l,f,p)}_updateRelatedFormulas(e,t,r,i,o){en(e).forEach(e=>{const[,,a]=n(e),l=this._store.getMath(e),s=this._pageGetter(a).getContext(),u=this._store.moveMath(l,t,r,i,o,s);this._store.setMath(e,u,s)})}_getTriggersOutsideCutRange(e,t,n,r){const i=[];return e.forEach(e=>{Ht(t,n,r,e,1,1)||i.push(e)}),i}_updateCell(e,t,n,r,i,o,a){const[l,s]=r,u=this._pageGetter(n),c=l?Object.assign({},l):{value:null},h=u.getCell(e,t)||{};if(h.$locked)return null;c.formula=s?`=${this._store.transposeMath(s,i,o)}`:null;const d=a(h,c);return d?[e,t,d]:null}_updateCurrentCell(e,t){return t.formula&&(t.value=t.formula),t}fromCSV(e,t="\n",n="\t"){return{data:e.split(t).map(e=>e.split(n).map(e=>[{value:e}]))}}}function en(e){const t=new Set(e);return Array.from(t)}class tn{constructor(e){this._cfg=e||{strict:!1},this._pages=[],this._pageNames=[],this._pageName2ID=new Map,this._pCounter=0,this._parseContext={page:e=>this._pageName2ID.get(e),pageName:e=>this._pageNames[e],pageObj:e=>this._pages[e],name:(e,t,n)=>{const r=e.length,i=t.substr(e[r-2],e[r-1]);let o;if(5===e[r-6]){const n=t.substr(e[r-5],e[r-4]);o=this._ranges.toId(n+"!"+i)||this._ranges.toId(i)}else o=this._ranges.toId(n.pageName(n.z)+"!"+i)||this._ranges.toId(i);e.push(9,o||-1,0)},z:0};const t=this._store=new Yt(Object.assign(Object.assign({},this._cfg),{get:e=>{const[t,r,i]=n(e);return this._pages[i].getValue(t,r)},set:(e,r,i,o)=>{const[a,l,s]=n(e),u=this._pages[s].getCell(a,l,!0),c=0===o||o?null:"number"==typeof u.spill?u.spill:r||0===r?u.source:null;if(3===i){if(o>=0&&(u.spill=o,u.source!==o))return!1;u.source=o=null}else if(null===r&&0!==o&&!o&&u.source)return!1;(o||0===o)&&e!==o&&u.source!==o&&(u.value||0===u.value||"number"==typeof u.source&&u.source!==o)&&this._pages[s].throwError("spill error"),u.source!==o&&(u.source=o);const h=2===i||3===i;if((null==i||h)&&(i=u.$format||0),u.$format=i,"string"==typeof r&&1!=i&&r){let e=parseFloat(r);h&&(e=e.toString()),e!=r||"0"===r[0]&&"e"!==r[1]&&r[1]>"9"||(r=parseFloat(r))}const d=u.value!==r;return d&&(u.value=r),"number"==typeof c&&t.triggerSet(new Set([c])),d}})),r=this._pages[63]=new Gt(63,this._store,this._parseContext);this._ranges=new Zt(this._store,r,this.getPage.bind(this)),this._cm=new Jt(this._store,this.getPage.bind(this))}addPage(e){for(;this._pages[this._pCounter];)this._pCounter++;const t=this._pCounter,n=new Gt(t,this._store,this._parseContext);return this._pageName2ID.set(e,t),this._pages[t]=n,this._pageNames[t]=e,n}renamePage(e,t){if(e===t)return;const n=this._pageName2ID.get(e);this._pageName2ID.delete(e),this._pageName2ID.set(t,n),this._pageNames[n]=t,this._ranges.renamePage(e,t);const r=this._pages[n].getContext();this._store.regenerate(n,!1,r)}removePage(e){const t=this._pageName2ID.get(e),n=this._pages[t].getContext();this._pageName2ID.delete(e),this._pages[t]=this._pageNames[t]=null,this._pCounter=0,this._ranges.renamePage(e,null),this._store.regenerate(t,!0,n)}getPage(e){return"string"==typeof e&&(e=this._pageName2ID.get(e)),this._pages[e]}getRanges(){return this._ranges}getStore(){return this._store}find(e,{firstOnly:n,resultsLimit:r=100}){const i=[];return this._pages.forEach((o,a)=>{o.eachCell((o,l,s)=>{const u=s.value;e(u)&&(n&&0===i.length||!n&&i.length<r)&&i.push({id:t(o,l,a),value:u})})}),i}getCopyManager(){return this._cm}}const nn={UNIQUE:function(e,t,n){const r=Object.assign([],{$width:0,$height:0});if(n)for(let t=0;t<e.length;t++)-1==e.indexOf(e[t],e.indexOf(e[t])+1)&&r.push(e[t]);else r.push(...e.filter((e,t,n)=>n.indexOf(e)==t));const i=r.length;return t?(r.$height=1,r.$width=i):(r.$height=i,r.$width=1),r},RANDARRAY:function(e=1,t=1,n=0,r=1,i=0){const o=Object.assign([],{$width:0,$height:0});for(let a=0;a<e*t;a++){const e=Math.random()*(r-n)+n;o.push(i?Math.round(e):e)}return o.$width=t,o.$height=e,o},TOROW:function(e,t=0,n=0){const r=B(e,t,n);return Object.assign(r,{$width:r.length,$height:1})},TOCOL:function(e,t=0,n=0){const r=B(e,t,n);return Object.assign(r,{$width:1,$height:r.length})},TEXTSPLIT:function(e,t,n,r,i,o=R.na){let a;if(n){let t=n;"string"!=typeof n&&(t=n.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")),a=e.split(new RegExp(t,i?"i":void 0))}else a=[e];r&&(a=a.filter(e=>e));let l=0;a=a.map(e=>{let n=[e];if(t){let r=t;"string"!=typeof t&&(r=t.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")),n=e.split(new RegExp(r,i?"i":void 0))}return r&&(n=n.filter(e=>e)),l=Math.max(n.length,l),n}),a=a.map(e=>(e.length<l&&(e=e.concat(Array(l-e.length).fill(o))),e));const s=Object.assign([],{$width:l,$height:a.length});for(let e=0;e<a.length;e++)for(let t=0;t<l;t++)s.push(a[e][t]);return s},WRAPROWS:function(e,t,n=R.na){const r=Math.ceil(e.length/t);return Object.assign(e.concat(new Array(t*r%e.length).fill(n)),{$width:t,$height:r})},WRAPCOLS:function(e,t,n=R.na){const r=Math.ceil(e.length/t),i=t*r,o=Object.assign(new Array(i),{$width:0,$height:0});for(let i=0;i<r;i++)for(let a=0;a<t;a++){const l=i*t+a;o[a*r+i]=l<e.length?e[l]:n}return o.$width=r,o.$height=t,o},TAKE:function(e,t,n){const r=e.$width,i=e.$height;let o=i;"number"==typeof t&&(o=Math.min(Math.abs(t),i),t<0&&(o*=-1));let a=r;"number"==typeof n&&(a=Math.min(Math.abs(n),r),n<0&&(a*=-1));const l=o>=0?0:i+o,s=o>=0?l+o:i,u=a>=0?0:r+a,c=a>=0?u+a:r,h=Object.assign([],{$width:0,$height:0});for(let t=l;t<s;t++)for(let n=u;n<c;n++){const i=t*r+n;h.push(e[i])}return h.$height=s-l,h.$width=c-u,h},DROP:function(e,t,n){const r=e.$width,i=e.$height;let o=0,a=i;"number"==typeof t&&(t>0?o=Math.min(t,i):t<0&&(a=i-Math.min(-t,i)));let l=0,s=r;"number"==typeof n&&(n>0?l=Math.min(n,r):n<0&&(s=r-Math.min(-n,r)));const u=Object.assign([],{$width:0,$height:0});for(let t=o;t<a;t++)for(let n=l;n<s;n++)u.push(e[t*r+n]);return u.$height=a-o,u.$width=s-l,u},SEQUENCE:function(e,t=1,n=1,r=1){const i=Object.assign([],{$width:0,$height:0});for(let o=0;o<e;o++)for(let e=0;e<t;e++){const a=n+(o*t+e)*r;i.push(a)}return i.$height=e,i.$width=t,i},CHOOSEROWS:function(e,...t){const n=e.$width,r=e.$height,i=Object.assign([],{$width:0,$height:0}),o=t.map(e=>e>0?e-1:r+e);for(const t of o){if(!(t>=0&&t<r))throw"incorrect row index";for(let r=0;r<n;r++)i.push(e[t*n+r])}return i.$width=n,i.$height=o.length,i},CHOOSECOLS:function(e,...t){const n=e.$width,r=e.$height,i=Object.assign([],{$width:0,$height:0}),o=t.map(e=>e>0?e-1:n+e);for(let t=0;t<r;t++)for(const r of o){if(!(r>=0&&r<n))throw"incorrect column index";i.push(e[t*n+r])}return i.$width=o.length,i.$height=r,i},EXPAND:function(e,t=0,n=0,r=R.na){const i=Object.assign([],{$width:0,$height:0});i.$height=Math.max(t,e.$height),i.$width=Math.max(n,e.$width);for(let t=0;t<i.$height;t++)for(let n=0;n<i.$width;n++)t<e.$height&&n<e.$width?i.push(e[t*e.$width+n]):i.push(r);return i},SORT:function(e,t=1,n=1,r=0){let i=U(e);return r&&(i=F(i)),P(i,[{index:t,dir:n}]),r&&(i=F(i)),L(i,e.$width,e.$height)},SORTBY:function(e,...t){const n=U(e),r=[];for(let e=0;e<t.length;e++){const i=t[e];e%2?"number"==typeof i&&(r[r.length-1].dir=i):"number"!=typeof i&&(n.map((e,t)=>{const n=i[t];e.push(void 0===n?"":n)}),r.push({index:n[0].length,dir:1}))}return P(n,r),L(n,e.$width,e.$height)}};function rn(e,t,n,r=0,i=0){const o=D(e),a=D(t),l=D(n),s=D(r);let u;if(0===o)u=(l+s)/a;else{const e=Math.pow(1+o,a);u=o*(l*e+s)/(e-1),1===i&&(u/=1+o)}return-u}function on(e,t,n,r=0,i=0){const o=D(e),a=D(t),l=D(n),s=D(r);let u;if(0!==o){const e=Math.pow(1+o,a);return u=s*e+l*(e-1)/o,1===i&&(u=s*e+l*(1+o)*(e-1)/o),-u}u=s+l*a}function an(e,t,n,r,i=0,o=0){const a=D(e),l=D(n),s=D(t),u=D(r),c=rn(a,l,u,D(i),o);let h;return h=1===s?1===o?0:-u:1===o?on(a,s-2,c,u,1)-c:on(a,s-1,c,u,0),h*a}var ln=Object.freeze({__proto__:null,ACCRINT:function(e,t,n,r,i=0,o,a=0){const l=M(e),s=M(n),u=D(r),c=D(i),h=D(o),d=D(a);if(1!==h)throw"This function is only supported with frequency 1";if(-1===[0,1,2,3,4].indexOf(d))throw`Basis is ${a}. It's should be 0, 1, 2, 3 or 4`;if(s<=l)throw"Settlement canot be before or equal to issue";return c*u*Ot(e,n,d)},PMT:rn,FV:on,DB:function(e,t,n,r,i=12){const o=D(e),a=D(t),l=D(n),s=D(r),u=D(i);if(o<0||a<0||l<0||s<0)throw"Parameters cannot be negative";if(-1===[1,2,3,4,5,6,7,8,9,10,11,12].indexOf(u))throw`Month is ${i}. It's should be beetwen 1 and 12`;if(s>l)throw"Period cannot be greater than life";if(a>=o)return 0;const c=+(1-Math.pow(a/o,1/l)).toFixed(3),h=o*c*u/12;let d=h,f=0;const m=r===l?l-1:r;for(let e=2;e<=+m;e++)f=(o-d)*c,d+=f;return 1===r?h:r===l?(o-d)*c:f},DDB:function(e,t,n,r,i=2){const o=D(e),a=D(t),l=D(n),s=D(r),u=D(i);if(o<0||a<0||l<0||s<0||u<0)throw"Parameters cannot be negative";if(s>l)throw"Period cannot be greater than life";if(a>=o)return 0;let c=0,h=0;for(let e=1;e<=+r;e++)h=Math.min(u/l*(o-c),o-a-c),c+=h;return h},DOLLAR:function(e,t=2){const n=O(e),r=O(t);if("number"==typeof n&&"number"==typeof r){if(r>=0)return`$${n.toFixed(r)}`;const e=Math.pow(10,-r);return"$"+Math.trunc(n/e)*e}},DOLLARDE:function(e,t){const n=D(e);let r=D(t);if(r<0)throw"Fraction cannot be negative";if(r>=0&&r<1)throw"Fraction cannot be zero";r=parseInt(`${r}`,10);let i=parseInt(`${e}`,10);i+=n%1*Math.pow(10,Math.ceil(Math.log(r)/Math.LN10))/r;const o=Math.pow(10,Math.ceil(Math.log(r)/Math.LN2)+1);return i=Math.round(i*o)/o,i},DOLLARFR:function(e,t){const n=D(e);let r=D(t);if(r<0)throw"Fraction cannot be negative";if(r>=0&&r<1)throw"Fraction cannot be zero";r=parseInt(`${r}`,10);let i=parseInt(`${e}`,10);return i+=n%1*Math.pow(10,-Math.ceil(Math.log(r)/Math.LN10))*r,i},EFFECT:function(e,t){const n=D(e);let r=D(t);if(n<=0)throw"Rate cannot be less than or equal to zero";if(r<1)throw"Periods cannot be less than 1";return r=parseInt(`${r}`,10),Math.pow(1+n/r,r)-1},FVSCHEDULE:function(e,t){const n=D(e),r=t.map(e=>D(e)),i=r.length;let o=n;for(let e=0;e<i;e++)o*=1+r[e];return o},IRR:function(e,t=0){const n=I(e).map(e=>D(e));let r=D(t);const i=function(e,t,n){const r=n+1;let i=e[0];for(let n=1;n<e.length;n++)i+=e[n]/Math.pow(r,(t[n]-t[0])/365);return i},o=function(e,t,n){const r=n+1;let i=0;for(let n=1;n<e.length;n++){const o=(t[n]-t[0])/365;i-=o*e[n]/Math.pow(r,o+1)}return i},a=[];let l=!1,s=!1;for(let e=0;e<n.length;e++)a[e]=0===e?0:a[e-1]+365,n[e]>0&&(l=!0),n[e]<0&&(s=!0);if(!l||!s)throw"Values should contain at least one positive value and one negative value";r=void 0===t?.1:r;let u,c,h,d=r,f=!0;do{h=i(n,a,d),u=d-h/o(n,a,d),c=Math.abs(u-d),d=u,f=c>1e-10&&Math.abs(h)>1e-10}while(f);return d},IPMT:an,ISPMT:function(e,t,n,r){const i=D(e),o=D(t),a=D(n);return D(r)*i*(o/a-1)},NPV:function(...e){const t=I(e).map(e=>D(e)),n=D(t[0]);let r=0;for(let e=1;e<t.length;e++)r+=t[e]/Math.pow(1+n,e);return r},NOMINAL:function(e,t){const n=D(e);let r=D(t);if(n<=0)throw"Rate cannot be less then or equal to zero";if(r<1)throw"Periods cannot be less then 1";return r=parseInt(`${r}`,10),(Math.pow(n+1,1/r)-1)*r},NPER:function(e,t,n,r=0,i=0){const o=D(e),a=D(t),l=D(n),s=D(r),u=D(i),c=a*(1+o*u)-s*o,h=l*o+a*(1+o*u);return Math.log(c/h)/Math.log(1+o)},PDURATION:function(e,t,n){const r=D(e),i=D(t),o=D(n);if(r<=0)throw"Rate cannot be less then or equal to zero";return(Math.log(o)-Math.log(i))/Math.log(1+r)},PPMT:function(e,t,n,r,i=0,o=0){const a=D(e),l=D(t),s=D(n),u=D(r),c=D(i),h=D(o);return rn(a,s,u,c,h)-an(a,l,s,u,c,h)},PV:function(e,t,n,r=0,i=0){const o=D(e),a=D(t),l=D(n),s=D(r),u=D(i);return 0===o?-l*a-s:((1-Math.pow(1+o,a))/o*l*(1+o*u)-s)/Math.pow(1+o,a)},SYD:function(e,t,n,r){const i=D(e),o=D(t),a=D(n);return(i-o)*(a-D(r)+1)*2/(a*(a+1))},TBILLPRICE:function(e,t,n){const r=M(e),i=M(t),o=D(n);if("number"==typeof o&&i>r)return 100*(1-o*Math.round((i.getTime()-r.getTime())/864e5)/360)},TBILLYIELD:function(e,t,n){const r=M(e),i=M(t),o=D(n);if("number"==typeof o&&i>r)return(100-o)/o*360/Math.round((i.getTime()-r.getTime())/864e5)}});var sn={labels:{common:"Common",currency:"Currency",number:"Number",percent:"Percent",date:"Date",string:"Text","custom-format":"Custom","decimal-places":"Decimal places",separator:"Group separator",negative:"Negative number","currency-symbol":"Currency","date-format":"Date format","format-docs":"How to create a format","undo-redo":"Undo/Redo",font:"Font",text:"Text",cell:"Cell",align:"Align",format:"Number",column:"Column",borders:"Borders",px:"px",apply:"Apply",cancel:"Cancel",save:"Save",sheet:"Sheet","conditional-format":"Conditional Format","conditional-common":"Common","conditional-text":"Text",condition:"Condition","conditional-style":"Style","conditional-operator":"Operator","conditional-between":"between","conditional-not-equal":"not equal",range:"Range","range-title":"Named ranges","range-name":"Name","range-cells":"Range","range-scope":"Scope","range-global":"Book","image-or":"or","image-title":"Add image","image-upload":"Select file for upload","image-url":"URL (e.g. http://*)","sparkline-title":"Add sparkline","sparkline-type":"Type","sparkline-range":"Range","sparkline-color":"Color","sparkline-positive":"Positive","sparkline-negative":"Negative","format-title":"Set format","format-pattern":"Format pattern","dropdown-empty":"Empty cells","dropdown-empty-option":"Empty option","dropdown-title":"Add dropdown","dropdown-range":"Range",ok:"OK","import-title":"Import","import-not-support":"Sorry, your browser does not support import","export-title":"Export","export-name":"Name of xslx file","export-all-sheets":"Export all sheets","link-title":"Add Link","link-name":"Text","link-url":"URL",image:"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells",controls:"Controls","add-checkbox":"Add checkbox","add-radio":"Add radio group",display:"Display",value:"Value","range-remove-confirm":"Are you sure you want to remove the range permanently?","sheet-remove-confirm":"Are you sure you want to remove the sheet permanently?","merge-cell-confirm":"Only the left top value will remain after merging. Continue?","error-range":"The range is incorrect!","error-link":"The link is incorrect!",print:"Print","print-title":"Before you print..","print-settings":"General settings","print-paper":"Paper size","print-layout":"Layout",sheets:"Sheets:",selection:"Selected cells",borderless:"Hide gridlines","sheet-names":"Show sheet names","skip-rows":"Skip empty rows",margin:"Hide margins","page-letter":"Letter","page-a4":"A4 (210x297mm)","page-a3":"A3 (297x420mm)","page-width":"Page width","page-actual":"Actual Size","page-portrait":"Portrait","page-landscape":"Landscape","external-ui":"External UI","print-borders":"Show print borders",comment:"Comment",width:"Width",height:"Height","fit-content":"Fit to content","default-size":"Reset to default","edit-view":"Edit","remove-view":"Remove","chart-edit":"Edit chart","chart-common":"Common","chart-series":"Series","chart-extras":"Extras","export-view":"Download","export-view-pdf":"PDF document","export-view-png":"PNG image","export-view-excel":"Excel file","line-chart":"Line","area-chart":"Area","bar-chart":"Bar","donut-chart":"Donut","pie-chart":"Pie","radar-chart":"Radar","spline-chart":"Spline","splinearea-chart":"Spline Area","scatter-chart":"Scatter","chart-scale":"Scale","chart-x-axis":"X axis","chart-y-axis":"Y axis","chart-lines":"Lines","chart-scale-color":"Scale color","chart-xAxis-title":"Title","chart-yAxis-title":"Title","chart-col-xAxis":"Use left column as xAxis","chart-col-yAxis":"Use left column as yAxis","chart-row-xAxis":"Use top row as xAxis","chart-row-yAxis":"Use top row as yAxis","chart-xAxis-range":"Range","chart-yAxis-origin":"Origin","chart-yAxis-start":"Start","chart-yAxis-end":"End","chart-yAxis-step":"Step","chart-yAxis-note":"* Set all the following parameters to see the effect","chart-legend":"Legend","chart-row-legend":"Use top row as legend","chart-col-legend":"Use left column as legend","chart-legend-range":"Legend range","chart-legend-align":"Align","chart-legend-left":"Left","chart-legend-right":"Right","chart-legend-center":"Center","chart-legend-valign":"Vertical align","chart-legend-top":"Top","chart-legend-middle":"Middle","chart-legend-bottom":"Bottom","chart-item":"Data","stacked-chart":"Stacked","horizontal-chart":"Horizontal","chart-range":"Range","chart-series-color":"Color","add-line":"Add line","chart-type":"Type","chart-tooltip":"Tooltips","chart-label":"Labels","chart-data-from":"Data series from","chart-columns":"columns","chart-rows":"rows","chart-markers":"Markers","chart-markers-square":"Square","chart-markers-triangle":"Triangle","chart-markers-diamond":"Diamond","chart-markers-round":"Round","chart-pie-3d":"3D","chart-radar-circle":"Circled lines","add-cell-validation":"Add data validation","remove-cell-validation":"Remove data validation","highlight-invalid-data":"Highlight invalid data","remove-highlight-invalid-data":"Remove highlighting of invalid data","validation-placeholder-text":"Some text","validation-type":"Type","validation-any":"Any","validation-date":"Date","validation-number":"Number","validation-text":"Text","validation-text-length":"Text length","validation-range":"Range","validation-integer":"Integers only","validation-ignore-empty":"Ignore empty","validation-input-message":"Input message","validation-error-title":"Error title","validation-error-message":"Error message","validation-error-handle":"Error handle","validation-error-stop":"Stop","validation-error-warning":"Warning","validation-error-information":"Information","validation-error-title-text":"Error","validation-error-message-text":"Invalid data","validation-error-save":"Save","validation-error-restore":"Restore","find-replace-title":"Find and Replace","find-title":"Find","find-what":"Find what:","replace-with":"Replace with:","find-within":"Within:","find-sheet":"Sheet","find-book":"Book","find-match-case":"Match case","find-match-entire-content":"Match entire cell contents","find-look-in":"Look in","find-formulas":"Formulas","find-values":"Values","find-all-sheet":"Sheet","find-all-cell":"Cell","find-all-value":"Value","find-all-formula":"Formula","replace-all":"Replace all",replace:"Replace","find-all":"Find all","find-next":"Find next"},tooltips:{color:"Font color",background:"Background color",borders:"Borders","borders-no":"Clear borders","borders-left":"Left border","borders-top":"Top border","borders-right":"Right border","borders-bottom":"Bottom border","borders-all":"All borders","borders-outer":"Outer borders","borders-top-bottom":"Top and bottom borders","borders-color":"Border color","borders-line":"Border line type","add-sheet":"Add Sheet",sheet:"Sheet",scale:"Scale","show-sheet":"Show sheet"},menus:{"rename-sheet":"Rename sheet","copy-sheet":"Copy to new sheet","remove-sheet":"Remove sheet","hide-sheet":"Hide sheet",new:"New",graph:"Graph",image:"Image",data:"Data",sort:"Sort",cut:"Cut",copy:"Copy",paste:"Paste","special-paste":"Special paste","paste-values":"Values","paste-formulas":"Formulas","paste-styles":"Styles","paste-conditions":"Conditional formats","paste-validation":"Validation"},actions:{file:"File",sheet:"Sheets","new-sheet":"New sheet","copy-sheet":"Copy to new sheet","remove-sheet":"Remove sheet","hide-sheet":"Hide sheet","excel-import":"Import from Excel","excel-export":"Export to Excel",print:"Print","print-borders":"Hide/show print borders","undo-redo":"Undo/Redo",undo:"Undo",redo:"Redo",font:"Font","font-family":"Font family","font-weight":"Bold","font-style":"Italic",underline:"Underline",strike:"Strike","font-size":"Font size",align:"Align","text-align":"Horizontal align","text-align-left":"Left align","text-align-center":"Center align","text-align-right":"Right align","vertical-align":"Vertical align","vertical-align-top":"Top align","vertical-align-middle":"Middle align","vertical-align-bottom":"Bottom align",span:"Merge",wrap:"Text wrap","increase-indent":"Increase indent","decrease-indent":"Decrease indent",number:"Number",format:"Number format",price:"Currency",int:"Number",custom:"Custom","format-common":"Common","format-price":"Currency","format-int":"Number","format-percent":"Percent","format-date":"Date","format-string":"Text","format-custom":"Custom","increase-decimals":"Increase decimal places","decrease-decimals":"Decrease decimal places",edit:"Edit","sort-asc":"Sort A to Z","sort-desc":"Sort Z to A","create-filter":"Create/remove filters","add-range":"Named ranges","conditional-format":"Conditional format","lock-cell":"Lock/unlock cell","add-link":"Add link","add-dropdown":"Add dropdown",clear:"Clear","clear-value":"Values","clear-style":"Styles","clear-conditional-formats":"Conditional formats","clear-dropdown-editors":"Dropdowns","clear-filters":"Filters","clear-comments":"Comments","clear-all":"All",validation:"Validation","add-cell-validation":"Add data validation","remove-cell-validation":"Remove data validation","highlight-invalid-data":"Highlight invalid data","remove-highlight-invalid-data":"Remove highlighting of invalid data",find:"Find and Replace",insert:"Insert",image:"Image","add-image":"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells","add-comment":"Comment",controls:"Controls","add-checkbox":"Add checkbox","add-radio":"Add radio group",view:"View",row:"Rows","add-row":"Insert row","del-row":"Delete row","show-row":"Show row","hide-row":"Hide row","resize-row":"Resize row","format-row":"Row format",column:"Columns","add-column":"Insert column","del-column":"Delete column","show-column":"Show column","hide-column":"Hide column","resize-column":"Resize column","format-column":"Column format","hide-gridlines":"Hide/show gridlines","hide-headers":"Hide/show headers","freeze-rows":"Freeze/unfreeze rows","freeze-columns":"Freeze/unfreeze columns","show-formulas":"Hide/Show formulas",other:"Other","find-readonly":"Find"},table:{"math-error":"#ERROR!","math-ref-error":"#REF!","format-error":"INCORRECT FORMAT","math-xss-error":"#XSS!"},liveEditor:{edit:"Edit:",date:"Date",number:"Number",text:"Text",financial:"Financial",array:"Array",common:"Common",search:"Search",category:"Category","functions-syntax":Object.assign({SUM:[["Number1","Required. The first value to sum."],["Number2","Optional. The second value to sum."],["Number3","Optional. The third value to sum."]],AVERAGE:[["Number1","Required. A number or cell reference that refers to numeric values."],["Number2","Optional. A number or cell reference that refers to numeric values."]],AVERAGEA:[["Value1","Required. A value or reference to a value that can be evaluated as a number."],["Value2","Optional. A value or reference to a value that can be evaluated as a number."]],COUNT:[["Value1","Required. An item, cell reference, or range."],["Value2","Optional. An item, cell reference, or range."]],COUNTA:[["Value1","Required. An item, cell reference, or range."],["Value2","Optional. An item, cell reference, or range."]],MIN:[["Number1","Required. Number, reference to numeric value, or range that contains numeric values."],["Number2","Optional. Number, reference to numeric value, or range that contains numeric values."]],MAX:[["Number1","Required. Number, reference to numeric value, or range that contains numeric values."],["Number2","Optional. Number, reference to numeric value, or range that contains numeric values."]],SQRT:[["Number","Required. The number to get the square root of."]],POWER:[["Number","Required. Number to raise to a power."],["Power","Required. Power to raise number to (the exponent)."]],LOG:[["Number","Required. Number for which you want the logarithm."],["Base","Optional. Base of the logarithm. Defaults to 10."]],EXP:[["Number","Required. The power that e is raised to."]],PRODUCT:[["Number1","Required. The first number or range to multiply."],["Number2","Optional. The second number or range to multiply."]],SUMPRODUCT:[["Array1","Required. The first array or range to multiply, then add."],["Array2","Optional. The second array or range to multiply, then add."]],ABS:[["Number","Required. The number to get the absolute value of."]],RAND:[],RANDBETWEEN:[["Bottom","Required. An integer representing the lower value of the range."],["Top","Required. An integer representing the upper value of the range."]],ROUND:[["Number","Required. The number to round."],["Num_digits","Required. The place at which number should be rounded."]],ROUNDUP:[["Number","Required. The number to round up."],["Num_digits","Required. The place at which number should be rounded."]],ROUNDDOWN:[["Number","Required. The number to round down."],["Num_digits","Required. The place at which number should be rounded."]],INT:[["Number","Required. The number from which you want an integer."]],CEILING:[["Number","Required. The number that should be rounded."],["Significance","Required. The multiple to use when rounding."]],FLOOR:[["Number","Required. The number that should be rounded."],["Significance","Required. The multiple to use when rounding."]],CONCATENATE:[["Text1","Required. The first text value to join together."],["Text2","Required. The second text value to join together."],["Text3","Optional. The third text value to join together."]],MID:[["Text","Required. The text to extract from."],["Start_num","Required. The location of the first character to extract."],["Num_chars","Required. The number of characters to extract."]],LEFT:[["Text","Required. The text from which to extract characters."],["Num_chars","Optional. The number of characters to extract, starting on the left side of text. Default = 1."]],RIGHT:[["Text","Required. The text from which to extract characters on the right."],["Num_chars","Optional. The number of characters to extract, starting on the right. Optional, default = 1."]],LOWER:[["Text","Required. The text that should be converted to lower case."]],UPPER:[["Text","Required. The text thatto convert to upper case."]],PROPER:[["Text","Required. The text that should be converted to proper case."]],TRIM:[["Text","Required. The text from which to remove extra space."]],LEN:[["Text","Required. The text for which to calculate length."]],SEARCH:[["Find_text","Required. The substring to find."],["Within_text","Required. The text to search within."],["Start_num","Optional. Starting position. Optional, defaults to 1."]],FIND:[["Find_text","Required. The substring to find."],["Within_text","Required. The text to search within."],["Start_num","Optional. The starting position in the text to search. Optional, defaults to 1."]],REPLACE:[["Old_text","Required. The text to replace."],["Start_num","Required. The starting location in the text to search."],["Num_chars","Required. The number of characters to replace."],["New_text","Required. The text to replace old_text with."]],SUBSTITUTE:[["Text","Required. The text to change."],["Old_text","Required. The text to replace."],["New_text","Required. The text to replace with."],["Instance","Optional. The instance to replace. If not supplied, all instances are replaced."]],NOW:[],DATE:[["Year","Required. Number for year."],["Month","Required. Number for month."],["Day","Required. Number for day."]],TIME:[["Hour","Required. The hour for the time you wish to create."],["Minute","Required. The minute for the time you wish to create."],["Second","Required. The second for the time you wish to create."]],YEAR:[["Date","Required. A valid Excel date."]],MONTH:[["Serial_number","Required. A valid Excel date."]],DAY:[["Date","Required. A valid Excel date."]],HOUR:[["Serial_number","Required. A valid Excel time."]],MINUTE:[["Serial_number","Required. A valid date or time."]],SECOND:[["Serial_number","Required. A valid time in a format Excel recognizes."]],DATEDIF:[["Start_date","Required. Start date in Excel date serial number format."],["End_date","Required. End date in Excel date serial number format."],["Unit","Required. The time unit to use (years, months, or days)."]],LOOKUP:[["Lookup_value","Required. The value to search for."],["Lookup_vector","Required. The one-row, or one-column range to search."],["Result_vector","Optional. The one-row, or one-column range of results."]],HLOOKUP:[["Lookup_value","Required. The value to look up."],["Table_array","Required. The table from which to retrieve data."],["Row_index","Required. The row number from which to retrieve data."],["Range_lookup","Optional. A Boolean to indicate exact match or approximate match. Default = TRUE = approximate match."]],VLOOKUP:[["Lookup_value","Required. The value to look for in the first column of a table."],["Table_array","Required. The table from which to retrieve a value."],["Column_index_num","Required. The column in the table from which to retrieve a value."],["Range_lookup","Optional. TRUE = approximate match (default). FALSE = exact match."]],XLOOKUP:[["Lookup","Required. The lookup value."],["Lookup_array","Required. The array or range to search."],["Return_array","Required. The array or range to return."],["Not_found","Optional. Value to return if no match found."],["Match_mode","Optional. 0 = exact match (default), -1 = exact match or next smallest, 1 = exact match or next larger, 2 = wildcard match."],["Search_mode","Optional. 1 = search from first (default), -1 = search from last, 2 = binary search ascending, -2 = binary search descending."]],INDEX:[["Array","Required. A range of cells, or an array constant."],["Row_num","Required. The row position in the reference or array."],["Col_num","Optional. The column position in the reference or array."],["Area_num","Optional. The range in reference that should be used."]],MATCH:[["Lookup_value","Required. The value to match in lookup_array."],["Lookup_array","Required. A range of cells or an array reference."],["Match_type","Optional. 1 = exact or next smallest (default), 0 = exact match, -1 = exact or next largest."]],XMATCH:[["Lookup_value","Required. The lookup value."],["Lookup_array","Required. The array or range to search."],["Match_mode","Optional. 0 = exact match (default), -1 = exact match or next smallest, 1 = exact match or next larger, 2 = wildcard match."],["Search_mode","Optional. 1 = search from first (default), -1 = search from last, 2 = binary search ascending, -2 = binary search descending."]],CHOOSE:[["Index_num","Required. The value to choose. A number between 1 and 254."],["Value1","Required. The first value from which to choose."],["Value2","Optional. The second value from which to choose."]],ISBLANK:[["Value","Required. The value to check."]],ISBINARY:[["Value","Required. The value to check."]],ISEVEN:[["Value","Required. The numeric value to check."]],ISODD:[["Value","Required. The numeric value to check."]],ISNONTEXT:[["Value","Required. The value to check."]],ISNUMBER:[["Value","Required. The value to check."]],ISTEXT:[["Value","Required. The value to check."]],N:[["Value","Required. The value to convert to a number."]],IF:[["Logical_test","Required. A value or logical expression that can be evaluated as TRUE or FALSE."],["Value_if_true","Optional. The value to return when logical_test evaluates to TRUE."],["Value_if_false","Optional. The value to return when logical_test evaluates to FALSE."]],AND:[["Logical1","Required. The first condition or logical value to evaluate."],["Logical2","Optional. The second condition or logical value to evaluate."]],NOT:[["Logical","Required. A value or logical expression that can be evaluated as TRUE or FALSE."]],OR:[["Logical1","Required. The first condition or logical value to evaluate."],["Logical2","Optional. The second condition or logical value to evaluate."]],FALSE:[],TRUE:[],ACOS:[["Number","Required. The value to get the inverse cosine of. The number must be between -1 and 1 inclusive."]],ACOSH:[["Number","Required. Any real number equal to or greater than 1."]],ACOT:[["Number","Required. Number is the cotangent of the angle you want. This must be a real number."]],ACOTH:[["Number","Required. The absolute value of Number must be greater than 1."]],ADD:[["Number1","Required. The first value to sum."],["Number2","Required. The second value to sum."]],ARABIC:[["Roman_text","Required. The Roman numeral in text that you want to convert."]],ASIN:[["Number","Required. The value to get the inverse sine of. The number must be between -1 and 1 inclusive."]],ASINH:[["Number","Required. Any real number."]],ATAN:[["Number","Required. The value to get the inverse tangent of."]],ATAN2:[["X_num","Required. The x coordinate of the input point."],["Y_num","Required. The y coordinate of the input point."]],ATANH:[["Number","Required. Any real number between 1 and -1."]],AVEDEV:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],BASE:[["Number","Required. The number to convert to a given base."],["Radix","Required. The base to convert to."],["Min_length","Optional. The minimum string length to return, achieved by padding with zeros."]],BINOMDIST:[["Number_s","Required. The number of successes."],["Trials","Required. The number of independent trials."],["Probability_s","Required. The probability of success on each trial."],["Cumulative","Required. TRUE = cumulative distribution function, FALSE=probability mass function."]],"BINOM.INV":[["Trials","Required. The number of Bernoulli trials."],["Probability_s","Required. The probability of a success on each trial."],["Alpha","Required. The criterion value."]],"BINOM.DIST.RANGE":[["Trials","Required. The number of independent trials. Must be greater than or equal to 0."],["Probability_s","Required. The probability of success in each trial. Must be greater than or equal to 0 and less than or equal to 1."],["Number_s","Required. The number of successes in trials. Must be greater than or equal to 0 and less than or equal to Trials."],["Number_s2","Optional. If provided, returns the probability that the number of successful trials will fall between Number_s and number_s2. Must be greater than or equal to Number_s and less than or equal to Trials."]],"BINOM.DIST":[["Number_s","Required. The number of successes."],["Trials","Required. The number of independent trials."],["Probability_s","Required. The probability of success on each trial."],["Cumulative","Required. TRUE = cumulative distribution function, FALSE=probability mass function."]],BITAND:[["Number1","Required. A positive decimal number."],["Number2","Required. A positive decimal number."]],BITLSHIFT:[["Number","Required. The number to be bit shifted."],["Shift_amount","Required. The amount of bits to shift, if negative shifts bits to the right instead."]],BITOR:[["Number1","Required. A positive decimal number."],["Number2","Required. A positive decimal number."]],BITRSHIFT:[["Number","Required. The number to be bit shifted."],["Shift_amount","Required. The amount of bits to shift to the right, if negative shifts bits to the left instead."]],BITXOR:[["Number1","Required. A positive decimal number."],["Number2","Required. A positive decimal number."]],COMBIN:[["Number","Required. The total number of items."],["Number_chosen","Required. The number of items in each combination."]],COMBINA:[["Number","Required. The total number of items."],["Number_chosen","Required. The number of items in each combination."]],COMPLEX:[["Real_num","Required. The real number."],["I_num","Required. The imaginary number."],["Suffix",'Optional. The suffix, either "i" or "j".']],CORREL:[["Array1","Required. A range of cell values."],["Array2","Required. A second range of cell values."]],COS:[["Number","Required. The angle in radians for which you want the cosine."]],COSH:[["Number","Required. The hyperbolic angle."]],COT:[["Number","Required. The angle provided in radians."]],COTH:[["Number","Required."]],COUNTBLANK:[["Range","Required. The range in which to count blank cells."]],COVAR:[["Array1","Required. The first cell range of integers."],["Array2","Required. The second cell range of integers."]],"COVARIANCE.P":[["Array1","Required. The first cell range of integers."],["Array2","Required. The second cell range of integers."]],"COVARIANCE.S":[["Array1","Required. The first cell range of integers."],["Array2","Required. The second cell range of integers."]],CSC:[["Number","Required. The angle provided in radians."]],CSCH:[["Number","Required."]],DEC2BIN:[["Number","Required. The decimal number you want to convert to binary."],["Places","Optional. Pads the resulting binary number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],DEC2HEX:[["Number","Required. The decimal number you want to convert to hexadecimal."],["Places","Optional. Pads the resulting number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],DEC2OCT:[["Number","Required. The decimal number you want to convert to octal."],["Places","Optional. Pads the resulting octal number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],DECIMAL:[["Number","Required. A text string representing a number."],["Radix","Required. The base of the number to be converted, an integer between 2-36."]],DEGREES:[["Angle","Required. Angle in radians that you want to convert to degrees."]],DELTA:[["Number1","Required. The first number."],["Number2","Optional. The second number."]],DEVSQ:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],DIVIDE:[["Number1","Required. The number we are dividing."],["Number2","Required. The number by which we divide."]],EQ:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],ERF:[["Lower_limit","Required. The lower bound for integrating ERF."],["Upper_limit","Optional. The upper bound for integrating ERF. If omitted, ERF integrates between zero and lower_limit."]],ERFC:[["X","Required. The lower bound for integrating ERFC."]],EVEN:[["Number","Required. The number to round up to an even integer."]],FACT:[["Number","Required. The number to get the factorial of."]],FACTDOUBLE:[["Number","Required. A number greater than or equal to -1."]],FISHER:[["X","Required. A numeric value for which you want the transformation."]],FISHERINV:[["Y","Required. The value for which you want to perform the inverse of the transformation."]],GAMMA:[["Number","Required. Returns a number."]],GCD:[["Number1","Required. The first number."],["Number2","Optional. The second number."]],GEOMEAN:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],GESTEP:[["Number","Required. The value to test against step."],["Step","Optional. The threshold value. If you omit a value for step, GESTEP uses zero."]],GT:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],GTE:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],HARMEAN:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],HEX2BIN:[["Number","Required. The hexadecimal number you want to convert to binary."],["Places","Optional. Pads the resulting binary number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],HEX2DEC:[["Number","Required. The hexadecimal number you want to convert to decimal."]],HEX2OCT:[["Number","Required. The hexadecimal number you want to convert to octal."],["Places","Optional. Pads the resulting binary number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],IMABS:[["Inumber","Required. A complex number."]],IMAGINARY:[["Inumber","Required. A complex number."]],IMCONJUGATE:[["Inumber","Required. A complex number for which you want the conjugate."]],IMCOS:[["Inumber","Required. A complex number for which you want the cosine."]],IMCOSH:[["Inumber","Required. A complex number for which you want the hyperbolic cosine."]],IMCOT:[],IMCSC:[["Inumber","Required. A complex number for which you want the cosecant."]],IMCSCH:[["Inumber","Required. A complex number for which you want the hyperbolic cosecant."]],IMDIV:[["Inumber1","Required. The complex numerator or dividend."],["Inumber2","Required. The complex denominator or divisor."]],IMEXP:[["Inumber","Required. A complex number for which you want the exponential."]],IMLN:[["Inumber","Required. A complex number for which you want the natural logarithm."]],IMPOWER:[["Inumber","Required. A complex number."],["Number","Required. Power to raise number."]],IMPRODUCT:[["Inumber1","Required. Complex number 1."],["Inumber2","Optional. Complex number 2."]],IMREAL:[["Inumber","Required. A complex number."]],IMSEC:[["Inumber","Required. A complex number for which you want the secant."]],IMSECH:[["Inumber","Required. A complex number for which you want the hyperbolic secant."]],IMSIN:[["Inumber","Required. A complex number for which you want the sine."]],IMSINH:[["Inumber","Required. A complex number for which you want the hyperbolic sine."]],IMSQRT:[["Inumber","Required. A complex number for which you want the square root."]],IMSUB:[["Inumber1","Required. Complex number 1."],["Inumber2","Required. Complex number 2."]],IMSUM:[["Inumber1","Required. Complex number 1."],["Inumber2","Optional. Complex number 2."]],IMTAN:[["Inumber","Required. A complex number for which you want the tangent."]],LARGE:[["Array","Required. An array or range of numeric values."],["K","Required. Position as an integer, where 1 corresponds to the largest value."]],LN:[["Number","Required. A number to take the natural logarithm of."]],LOG10:[["Number","Required. Number for which you want the logarithm."]],LT:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],LTE:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],MEDIAN:[["Number1","Required. A number or cell reference that refers to numeric values."],["Number2","Optional. A number or cell reference that refers to numeric values."]],MINUS:[["Number1","Required. The number from which we subtract."],["Number2","Required. The number by which we subtract."]],MOD:[["Number","Required. The number to be divided."],["Divisor","Required. The number to divide with."]],MROUND:[["Number","Required. The number that should be rounded."],["Significance","Required. The multiple to use when rounding."]],MULTINOMIAL:[["Number1, number2, ...","Required. Number1 is required, subsequent numbers are optional. 1 to 255 values for which you want the multinomial."]],MULTIPLY:[["Number1","Required. The number to multiply."],["Number2","Required. The number to multiply by."]],NE:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],OCT2BIN:[["Number","Required. The octal number you want to convert. Number may not contain more than 10 characters. The most significant bit of number is the sign bit. The remaining 29 bits are magnitude bits. Negative numbers are represented using two's-complement notation."],["Places","Optional. The number of characters to use. If places is omitted, OCT2BIN uses the minimum number of characters necessary. Places is useful for padding the return value with leading 0s (zeros)."]],OCT2DEC:[["Number","Required. The octal number you want to convert. Number may not contain more than 10 octal characters (30 bits). The most significant bit of number is the sign bit. The remaining 29 bits are magnitude bits. Negative numbers are represented using two's-complement notation."]],OCT2HEX:[["Number","Required. The octal number you want to convert. Number may not contain more than 10 octal characters (30 bits). The most significant bit of number is the sign bit. The remaining 29 bits are magnitude bits. Negative numbers are represented using two's-complement notation."],["Places","Optional. The number of characters to use. If places is omitted, OCT2HEX uses the minimum number of characters necessary. Places is useful for padding the return value with leading 0s (zeros)."]],ODD:[["Number","Required. The number to round up to an odd integer."]],PERCENTILE:[["Array","Required. Data values."],["K","Required. Number representing kth percentile."]],"PERCENTILE.INC":[["Array","Required. Data values."],["K","Required. Number representing kth percentile."]],"PERCENTILE.EXC":[["Array","Required. Data values."],["K","Required. A value between 0 and 1 that represents the k:th percentile."]],PERMUT:[["Number","Required. The total number of items."],["Number_chosen","Required. The number of items in each combination."]],PI:[],POW:[["Number","Required. Number to raise to a power."],["Power","Required. Power to raise number to (the exponent)."]],QUARTILE:[["Array","Required. A reference containing data to analyze."],["Quart","Required. The quartile value to return."]],"QUARTILE.INC":[["Array","Required. A reference containing data to analyze."],["Quart","Required. The quartile value to return."]],"QUARTILE.EXC":[["Array","Required. A reference containing data to analyze."],["Quart","Required. The quartile value to return, 1-3."]],QUOTIENT:[["Numerator","Required. The number to be divided."],["Denominator","Required. The number to divide by."]],RADIANS:[["Angle","Required. Angle in degrees to convert to radians."]],ROMAN:[["Number","Required. Number (in Arabic numeral) you want to convert to Roman numeral."],["Form","Optional. The type of Roman numeral you want."]],SEC:[["Number","Required. The angle in radians for which you want the secant."]],SECH:[],SIGN:[["Number","Required. The number to get the sign of."]],SIN:[["Number","Required. The angle in radians for which you want the sine."]],SINH:[["Number","Required. The hyperbolic angle."]],SMALL:[["Array","Required. An array or range of numeric values."],["K","Required. Position as an integer, where 1 corresponds to the smallest value."]],SQRTPI:[["Number","Required. The number by which pi is multiplied."]],STDEV:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],"STDEV.S":[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],"STDEV.P":[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STDEVA:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STDEVP:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STDEVPA:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STEYX:[["Known_y's","Required. An array or range of dependent data points."],["Known_x's","Required. An array or range of independent data points."]],SUBTOTAL:[["Function_num","Required. A number that specifies which function to use in calculating subtotals within a list. See table below for full list."],["Ref1","Required. A named range or reference to subtotal."],["Ref2","Optional. A named range or reference to subtotal."]],SUMSQ:[["Number1","Required. The first argument containing numeric values."],["Number2","Optional. The first argument containing numeric values."]],SUMX2MY2:[["Array_x","Required. The first range or array containing numeric values."],["Array_y","Required. The second range or array containing numeric values."]],SUMX2PY2:[["Array_x","Required. The first range or array containing numeric values."],["Array_y","Required. The second range or array containing numeric values."]],SUMXMY2:[["Array_x","Required. The first range or array containing numeric values."],["Array_y","Required. The second range or array containing numeric values."]],TAN:[["Number","Required. The angle in radians for which you want the tangent."]],TANH:[["Number","Required. Any real number."]],TRUNC:[["Number","Required. The number to truncate."],["Num_digits","Optional. The precision of the truncation (default is 0)."]],VAR:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],"VAR.S":[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],"VAR.P":[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],VARA:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],VARP:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],VARPA:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],WEIBULL:[["X","Required. The value at which to evaluate the function."],["Alpha","Required. A parameter to the distribution."],["Beta","Required. A parameter to the distribution."],["Cumulative","Required. Determines the form of the function."]],"WEIBULL.DIST":[["X","Required. The value at which to evaluate the function."],["Alpha","Required. A parameter to the distribution."],["Beta","Required. A parameter to the distribution."],["Cumulative","Required. Determines the form of the function."]],CHAR:[["Number","Required. A number between 1 and 255."]],CLEAN:[["Text","Required. The text to clean."]],CODE:[["Text","Required. The text for which you want a numeric code."]],EXACT:[["Text1","Required. The first text string to compare."],["Text2","Required. The second text string to compare."]],FIXED:[["Number","Required. The number to round and format."],["Decimals","Optional. Number of decimals to use. Default is 2."],["No_commas","Optional. Suppress commas. TRUE = no commas, FALSE = commas. Default is FALSE."]],NUMBERVALUE:[["Text","Required. The text to convert to a number."],["Decimal_separator","Optional. The character for decimal values."],["Group_separator","Optional. The character for grouping by thousands."]],REGEXEXTRACT:[["Text","Required. The input text."],["Regular_expression","Required. The first part of text that matches this expression will be returned."]],REGEXMATCH:[["Text","Required. The text to be tested against the regular expression."],["Regular_expression","Required. The regular expression to test the text against."]],REGEXREPLACE:[["Text","Required. The text, a part of which will be replaced."],["Regular_expression","Required. The regular expression. All matching instances in text will be replaced."],["Replacement","Required. The text which will be inserted into the original text."]],REPT:[["Text","Required. The text to repeat."],["Number_times","Required. The number of times to repeat text."]],T:[["Value","Required. The value to return as text."]],JOIN:[["Text1, text2, ..."],["Text you want to combine"]],ARRAYTOTEXT:[["Array","Required. The array or range to convert to text."],["Format","Optional. Output format. 0 = concise (default), and 1 = strict."]],DATEVALUE:[["Date_text","Required. A valid date in text format."]],DAYS:[["End_date","Required. The end date."],["Start_date","Required. The start date."]],DAYS360:[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Method","Optional. Day count method. FALSE (default) = US method, TRUE = European method."]],EDATE:[["Start_date","Required. Start date as a valid Excel date."],["Months","Required. Number of months before or after start_date."]],EOMONTH:[["Start_date","Required. A date that represents the start date in a valid Excel serial number format."],["Months","Required. The number of months before or after start_date."]],ISOWEEKNUM:[["Date","Required. A valid Excel date in serial number format."]],NETWORKDAYS:[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Holidays","Optional. A list of non-work days as dates."]],"NETWORKDAYS.INTL":[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Weekend","Optional. Setting for which days of the week should be considered weekends."],["Holidays","Optional. A reference to dates that should be considered non-work days."]],TIMEVALUE:[["Time_text","Required. A date and/or time in a text format recognized by Excel."]],WEEKNUM:[["Serial_num","Required. A valid Excel date in serial number format."],["Return_type","Optional. The day the week begins. Default is 1."]],WEEKDAY:[["Serial_number","Required. The date for which you want to get the day of week."],["Return_type","Optional. A number representing day of week mapping scheme. Default is 1."]],WORKDAY:[["Start_date","Required. The date from which to start."],["Days","Required. The working days before or after start_date."],["Holidays","Optional. A list dates that should be considered non-work days."]],"WORKDAY.INTL":[["Start_date","Required. The start date."],["Days","Required. The end date."],["Weekend","Optional. Setting for which days of the week should be considered weekends."],["Holidays","Optional. A list of one or more dates that should be considered non-work days."]],YEARFRAC:[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Basis","Optional. The type of day count basis to use (see below)."]],ACCRINT:[["Id","Required. Issue date of the security."],["Fd","Required. First interest date of security."],["Sd","Required. Settlement date of security."],["Rate","Required. Interest rate of security."],["Par","Required. Par value of security."],["Freq","Required. Coupon payments per year (annual = 1, semiannual = 2; quarterly = 4)."],["Basis","Optional. Day count basis (see below, default =0)."],["Calc","Optional. Calculation method (see below, default = TRUE)."]],PMT:[["Rate","Required. The interest rate for the loan."],["Nper","Required. The total number of payments for the loan."],["Pv","Required. The present value, or total value of all loan payments now."],["Fv","Optional. The future value, or a cash balance you want after the last payment is made. Defaults to 0 (zero)."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],FV:[["Rate","Required. The interest rate per period."],["Nper","Required. The total number of payment periods."],["Pmt","Required. The payment made each period. Must be entered as a negative number."],["Pv","Optional. The present value of future payments. If omitted, assumed to be zero. Must be entered as a negative number."],["Type","Optional. When payments are due. 0 = end of period, 1 = beginning of period. Default is 0."]],DB:[["Cost","Required. Initial cost of asset."],["Salvage","Required. Asset value at the end of the depreciation."],["Life","Required. Periods over which asset is depreciated."],["Period","Required. Period to calculation depreciation for."],["Month","Optional. Number of months in the first year. Defaults to 12."]],DDB:[["Cost","Required. Initial cost of asset."],["Salvage","Required. Asset value at the end of the depreciation."],["Life","Required. Periods over which asset is depreciated."],["Period","Required. Period to calculation depreciation for."],["Factor","Optional. Rate at which the balance declines. If omitted, defaults to 2."]],DOLLAR:[["Number","Required. The number to convert."],["Decimals","Required. The number of digits to the right of the decimal point. Default is 2."]],DOLLARDE:[["Fractional_dollar","Required. Dollar component in special fractional notation."],["Fraction","Required. The denominator in the fractional unit. 8 = 1/8, 16 = 1/16, 32 = 1/32, etc."]],DOLLARFR:[["Decimal_dollar","Required. Pricing as a normal decimal number."],["Fraction","Required. The denominator in the fractional unit. 8 = 1/8, 16 = 1/16, 32 = 1/32, etc."]],EFFECT:[["Nominal_rate","Required. The nominal or stated interest rate."],["Npery","Required. Number of compounding periods per year."]],FVSCHEDULE:[["Principal","Required. The initial investment sum."],["Schedule","Required. Schedule of interest rates, provided as range or array."]],IRR:[["Values","Required. Array or reference to cells that contain values."],["Guess","Optional. An estimate for expected IRR. Default is .1 (10%)."]],IPMT:[["Rate","Required. The interest rate per period."],["Per","Required. The payment period of interest."],["Nper","Required. The total number of payment periods."],["Pv","Required. The present value, or total value of all payments now."],["Fv","Optional. The cash balance desired after last payment is made. Defaults to 0."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],ISPMT:[["Rate","Required. Interest rate."],["Per","Required. Period (starts with zero, not 1)."],["Nper","Required. Number of periods."],["Pv","Required. Present value."]],NPV:[["Rate","Required. Discount rate over one period."],["Value1","Required. First value(s) representing cash flows."],["Value2","Optional. Second value(s) representing cash flows."]],NOMINAL:[["Effect_rate","Required. The effective annual interest rate."],["Npery","Required. Number of compounding periods per year."]],NPER:[["Rate","Required. The interest rate per period."],["Pmt","Required. The payment made each period."],["Pv","Required. The present value, or total value of all payments now."],["Fv","Optional. The future value, or a cash balance you want after the last payment is made. Defaults to 0."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],PDURATION:[["Rate","Required. Interest rate per period."],["Pv","Required. Present value of the investment."],["Fv","Required. Future value of the investment."]],PPMT:[["Rate","Required. The interest rate per period."],["Per","Required. The payment period of interest."],["Nper","Required. The total number of payments for the loan."],["Pv","Required. The present value, or total value of all payments now."],["Fv","Optional. The cash balance desired after last payment is made. Defaults to 0."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],PV:[["Rate","Required. The interest rate per period."],["Nper","Required. The number of payment periods."],["Pmt","Required. The payment made each period."],["Fv","Optional. Future value. If omitted, defaults to zero."],["Type","Optional. Payment type, 0 = end of period, 1 = beginning of period. Default is 0."]],SYD:[["Cost","Required. Initial cost of asset."],["Salvage","Required. Asset value at the end of the depreciation."],["Life","Required. Periods over which asset is depreciated."],["Period","Required. Period to calculation depreciation for."]],TBILLPRICE:[["Settlement","Required. Settlement date of the security."],["Maturity","Required. Maturity date of the security."],["Discount","Required. The discount rate for the security."]],TBILLYIELD:[["Settlement","Required. Settlement date of the security."],["Maturity","Required. Maturity date of the security."],["Price","Required. Price per $100."]],UNIQUE:[["Array","Required. Range or array from which to extract unique values."],["By_col","Optional. How to compare and extract. By row = FALSE (default); by column = TRUE."],["Exactly_once","Optional. TRUE = values that occur once, FALSE= all unique values (default)."]],RANDARRAY:[["Rows","Optional. Row count. Default = 1."],["Columns","Optional. Column count. Default = 1."],["Min","Optional. Minimum value. Default = 0."],["Max","Optional. Maximum value. Default = 1."],["Integer","Optional. Whole numbers. Boolean, TRUE or FALSE. Default = FALSE."]],TOROW:[["Array","Required. The array to transform."],["Ignore","Required. Control to ignore blanks and errors."],["Scan_by_column","Required. Scan array by column. TRUE = by column, FALSE = by row (default)."]],TOCOL:[["Array","Required. The array to transform."],["Ignore","Required. Setting to ignore blanks and errors."],["Scan_by_column","Required. Scan array by column. TRUE = by column, FALSE = by row (default)."]],TEXTSPLIT:[["Text","Required. The text string to split."],["Col_delimiter","Required. The character(s) to delimit columns."],["Row_delimiter","Optional. The character(s) to delimit rows."],["Ignore_empty","Optional. Ignore empty values. TRUE = ignore, FALSE = preserve. Default is FALSE."],["Match_mode","Optional. Case-sensitivity. 0 = enabled, 1 = disabled. Default is 0."],["Pad_with","Optional. Value to pad missing values in 2d arrays."]],WRAPROWS:[["Vector","Required. The array or range to wrap."],["Wrap_count","Required. Max values in each row."],["Pad_with","Optional. Value to use for unfilled places."]],WRAPCOLS:[["Vector","Required. The array or range to wrap."],["Wrap_count","Required. Max values in each column."],["Pad_with","Optional. Value to use for unfilled places."]],TAKE:[["Array","Required. The source array or range."],["Rows","Optional. Number of rows to return as an integer."],["Col","Optional. Number of columns to return as an integer."]],DROP:[["Array","Required. The source array or range."],["Rows","Optional. Number of rows to drop."],["Col","Optional. Number of columns to drop."]],SEQUENCE:[["Rows","Required. Number of rows to return."],["Columns","Optional. Number of columns to return."],["Start","Optional. Starting value (defaults to 1)."],["Step","Optional. Increment between each value (defaults to 1)."]],CHOOSEROWS:[["Array","Required. The array to extract rows from."],["Row_num1","Required. The numeric index of the first row to return."],["Row_num2","Optional. The numeric index of the second row to return."]],CHOOSECOLS:[["Array","Required. The array to extract columns from."],["Col_num1","Required. The numeric index of the first column to return."],["Col_num2","Optional. The numeric index of the second column to return."]],EXPAND:[["Array","Required. The array to expand."],["Rows","Optional. The final number of rows. Default is total rows."],["Columns","Optional. The final number of columns. Default is total columns."],["Pad_with","Optional. Value to use for new cells. Default is #N/A."]],SORT:[["Array","Required. Range or array to sort."],["Sort_index","Optional. Column index to use for sorting. Default is 1."],["Sort_order","Optional. 1 = Ascending, -1 = Descending. Default is ascending order."],["By_col","Optional. TRUE = sort by column. FALSE = sort by row. Default is FALSE."]],SORTBY:[["Array","Required. Range or array to sort."],["By_array","Required. Range or array to sort by."],["Sort_order","Optional. Sort order. 1 = ascending (default), -1 = descending."],["Array/order","Optional. Additional array and sort order pairs."]]},{IMAGE:[["Url","Required. Image link"]],HYPERLINK:[["Link_location","Required. The path and file name to the document to be opened. Link_location can refer to a place in a document  such as a specific cell or named range."],["Friendly_name","Optional. The jump text or numeric value that is displayed in the cell. Friendly_name is displayed in blue and is underlined. If friendly_name is omitted, the cell displays the link_location as the jump text."]],SPARKLINE:[["Range","Required. Range or named range"],["Type","Required. Sparkline type"],["Positive_color","Required. Positive color"],["Negative_color","Required. Negative color"]],CHECKBOX:[["State","Optional. Checkbox state"]],RADIO:[["Y_position","Required. Y-axis position in radio group"],["X_position","Required. X-axis position in radio group"],["Row_count","Required. Rows count in radio group"],["Col_count","Required. Columns count in radio group"],["State","Optional. Radio button state"]]})},formats:{dateFormat:"mm/dd/yyyy",timeFormat:"hh:mm AM/PM",longDateFormat:"dd mmmm yyyy",fullDateFormat:"mm/dd/yyyy hh:mm AM/PM",parseDateTime:"%m/%d/%Y %G:%i:%s",parseDate:"%m/%d/%Y",currencies:["{obj} ","{obj}","R$ {obj}","{obj} rub."]}};function un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function cn(e,t,n){return t=gn(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,pn()?Reflect.construct(t,n||[],gn(e).constructor):t.apply(e,n))}function hn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dn(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xn(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function fn(e,t,n){return(t=xn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mn(){return mn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=gn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},mn.apply(null,arguments)}function gn(e){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gn(e)}function vn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wn(e,t)}function pn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(pn=function(){return!!e})()}function wn(e,t){return wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wn(e,t)}function bn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,l=[],s=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){u=!0,i=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return l}}(e,t)||Cn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _n(e){return function(e){if(Array.isArray(e))return un(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Cn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xn(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function yn(e){return yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yn(e)}function Cn(e,t){if(e){if("string"==typeof e)return un(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?un(e,t):void 0}}webix.i18n.spreadsheet=sn,webix.protoUI({name:"ssheet-align",$cssName:"richselect",$init:function(e){e.options={view:"datasuggest",body:{view:"ssheet-icons",tooltip:{template:"#tooltip#"},xCount:3,yCount:1},data:e.data}}},webix.ui.richselect),webix.protoUI({name:"ssheet-borders-suggest",defaults:{width:300},$init:function(e){var t=webix.skin.$name;e.body={margin:6,cols:[{view:"ssheet-icons",scroll:!1,select:!0,xCount:4,yCount:2,tooltip:{template:function(e){return e.tooltip}},on:{onAfterSelect:function(){this.getParentView().getParentView().updateMasterValue(!0)}},template:function(e){var t="webix_ssheet_button_icon webix_ssheet_icon ssi-borders-"+e.id;return"<span class='".concat(t,"'></span>")},data:e.data},{view:"ssheet-separator"},{rows:[{view:"ssheet-color",css:e.css,name:e.name,width:68,value:"contrast"==t||"dark"==t?"#ffffff":"#000000",tooltip:webix.i18n.spreadsheet.tooltips["borders-color"],title:"<span class='webix_icon wxi-pencil'></span>",on:{onChange:function(){this.getParentView().getParentView().getParentView().updateMasterValue(!1)}}},{view:"richselect",css:"webix_ssheet_border_type",value:"thin",tooltip:webix.i18n.spreadsheet.tooltips["borders-line"],suggest:{fitMaster:!1,width:130,css:"webix_ssheet_suggest",body:{template:"<div class='webix_ssheet_border webix_ssheet_border_#id#'></div>"},data:[{id:"thin"},{id:"medium"},{id:"thick"},{id:"dashed"},{id:"dotted"},{id:"double"}]}},{}]}]}},updateMasterValue:function(e){var t=this.getValue();webix.$$(this.config.master).setValue(t,"user"),e&&this.hide()},setValue:function(e){e[0]&&this.getList().select(e[0]),e[1]&&this.getColorView().setValue(e[1]),e[2]&&this.getTypeView().setValue(e[2])},getValue:function(){return[this.getList().getSelectedId(),this.getColorView().getValue()||"",this.getTypeView().getValue()||""]},getList:function(){return this.getBody().getChildViews()[0]},getColorView:function(){return this.getBody().getChildViews()[2].getChildViews()[0]},getTypeView:function(){return this.getBody().getChildViews()[2].getChildViews()[1]},getItemText:function(){return"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-borders-all'>"}},webix.ui.suggest),webix.protoUI({name:"ssheet-borders",$cssName:"richselect",$init:function(e){e.options={view:"ssheet-borders-suggest",fitMaster:!1,data:e.data},this.$ready.push(webix.bind(function(){this.getPopup().config.master=this.config.id},this))},setValue:function(e,t){if(webix.isArray(e)){this.config.value&&e[0]==this.config.value[0]&&e[1]==this.config.value[1]||this.getPopup().setValue(e);var n=this.config.value;this.config.value=e,e[0]&&this.callEvent("onChange",[this.getValue(),n,t])}return e},getValue:function(){return this.getPopup().getValue().join(",")},getList:function(){return this.getPopup().getBody().getChildViews()[0]},getColorView:function(){return this.getPopup().getBody().getChildViews()[1].getChildViews()[0]}},webix.ui.richselect),webix.protoUI({$cssName:"colorboard",name:"ssheet-colorboard",defaults:{height:196,width:244,css:"webix_ssheet_colorboard",palette:[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f3f3f3","#ffffff"],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#4a86e8","#0000ff","#9900ff","#ff00ff"],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc"],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd"],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0"],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79"],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47"],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130"]]},$init:function(){this.attachEvent("onSelect",function(e){this.getParentView().setMasterValue({value:e},!1,"user")})}},webix.ui.colorboard),webix.protoUI({$cssName:"richselect",name:"ssheet-color",defaults:{css:"webix_ssheet_color",icon:"wxi-menu-down",suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}},$init:function(){this.$view.className+=" webix_ssheet_color"},$renderInput:function(e,t,n){var r=this.renderColor.call(this);return t=t.replace(/([^>]>)(.*)(<\/div)/,function(t,n,i,o){return n+e.title+r+o}),webix.ui.colorpicker.prototype.$renderInput.call(this,e,t,n)},$setValue:function(e){e=e||"",this.getColorNode().style.backgroundColor=e},renderColor:function(){return"<div class='webix_ssheet_cp_color' style='background-color:"+this.config.value+";'> </div>"},getColorNode:function(){return this.$view.firstChild.firstChild.childNodes[1]},$renderIcon:function(){return webix.ui.text.prototype.$renderIcon.apply(this,arguments)}},webix.ui.colorpicker);var Sn={value:null,set:function(e,t){this.value?e.call(t):(this.start(),e.call(t),this.end())},start:function(){this.value=webix.uid()},end:function(){this.value=null}},$n={},En=[];function Rn(e){e=e||[],[["date",It],["text",dt],["number",Qe],["financial",ln],["array",nn]].forEach(function(t){var n;"all"!=e&&-1==e.indexOf(t[0])||(En.push(t[0]),n=t[1],Object.assign(Lt,n),Object.keys(t[1]).forEach(function(e){return $n[e]=t[0]}))})}var An=["IMAGE","HYPERLINK","SPARKLINE","CHECKBOX","RADIO"];function Tn(e,t,n,r,i){var o=e.getCellValue(t,n,!0,i);if(/^=(radio)\(/i.test(o)){var a=o.match(/\((.+?)\)/)[1].split(",").map(function(e){return e.trim()}),l=bn(a,4),s=l[0],u=l[1],c=l[2],h=l[3];if(!1===r)e.setCellValue(t,n,"=radio(".concat(s,", ").concat(u,", ").concat(c,", ").concat(u,", 0)"),i),e.refresh();else e.getCellValue(t,n,!1)||Sn.set(function(){for(var r=1;r<=c;r++)for(var o=1;o<=h;o++)e.setCellValue(t-s+r,n-u+o,"=radio(".concat(r,", ").concat(o,", ").concat(c,", ").concat(h,", ").concat(r==s&&o==u?1:0,")"),i);e.refresh()})}}function kn(e,t,n,r,i,o){var a;if(t=t.toUpperCase(),a=n,Lt[t]=a,i&&($n[t]=i),o&&An.push(t),e.$$("liveEditor")){var l=webix.$$(e.$$("formulaButton").config.popup).getBody().getChildViews();if([webix.$$(e.$$("liveEditor").config.suggest).getList(),l[3]].forEach(function(e){e.exists(t)||(e.add({id:t,value:t}),r&&e.sort("value","asc","string"))}),i){var s=l[0],u=s.getList();u.exists(i)||(u.add({id:i,value:webix.i18n.spreadsheet.liveEditor[i]||i}),s.isVisible()||s.show())}}}function On(e){var t=new Date(Math.round(86400*(e-25569)*1e3));return new Date(t.getTime()+6e4*t.getTimezoneOffset())}function In(e){return(25569+(e.getTime()-6e4*e.getTimezoneOffset())/864e5).toString()}function Vn(e,t,n){if("string"==typeof t){if(/^=checkbox\(/i.test(t))return"<span class='webix_icon ssheet_checkbox wxi-checkbox-".concat(n?"marked":"blank","'></span>");if(/^=radio\(/i.test(t))return"<span class='webix_icon ssheet_radio wxi-radiobox-".concat(n?"marked":"blank","'></span>");if(/^=hyperlink\(/i.test(t)){for(var r,i,o=t.indexOf("(")+1,a=o;a<t.length;a++)if('"'==t[a])r=!r;else if(","==t[a]&&!r){i=a;break}i||(i=t.indexOf(")"));var l,s=e._mData.getStore().exec(t.substring(o,i),e._mPage.getContext()),u=webix.template.escape;return l="#"==s[0]?'href="javascript:void(0);" class="webix_ssheet_ref" data-ref="'.concat(u(s.substr(1)),'"'):'target="blank" href="'.concat(u(s),'"'),"<a ".concat(l,">").concat(n,"</a>")}}return n}var Nn=Object.freeze({__proto__:null,addMath:kn,addMathMethods:Rn,getExcelDateFromJs:In,getJsDateFromExcel:On,getMathTemplate:Vn,htmlMath:An,init:function(e){var t={IMAGE:function(t){return e.config.xssSafe&&0!=t.indexOf("data:image/")&&new URL(document.baseURI).origin!=new URL(t,document.baseURI).origin?"#XSS!":'<img class="webix_ssheet_cimage" src="'.concat(webix.template.escape(t),'">')},HYPERLINK:function(e,t){return webix.template.escape(t||e)},SPARKLINE:function(t,n,r,i){var o={type:n,color:r,negativeColor:i,paddingX:2,paddingY:2};"donut"==n?webix.extend(o,{type:"pie",donut:1},!0):"barH"==n&&webix.extend(o,{type:"bar",horizontal:1},!0);for(var a=0;a<t.length;a++)t[a]=t[a]||0;var l=e.$$("cells").config,s="pie"==o.type||"radar"==n,u=s?100:l.columnWidth,c=s?100:l.rowHeight;return webix.Sparklines.getTemplate(o)(t,{width:u,height:c})},CHECKBOX:function(e){return!!e},RADIO:function(e,t,n,r,i){return!!i}},n=Object.keys(t);n.forEach(function(r,i){return kn(e,r,t[r],i==n.length-1)});var r=e.$$("cells");r.on_click.ssheet_checkbox=function(t,n){var r=e.getCellValue(n.row,n.column,!1);e.setCellValue(n.row,n.column,"=checkbox(".concat(r?0:1,")")),e.refresh()},r.on_click.ssheet_radio=function(t,n){Tn(e,n.row,n.column)},e.attachEvent("onCommand",function(t){"add-radio"==t.id?e.addRadio():"add-checkbox"==t.id&&e.addCheckbox()})},mathCategories:En,methodsWithCategories:$n,setRadioState:Tn});function Mn(e){return!e&&0!==e||e instanceof Date||isNaN(e)||(e=On(e)),e}function Dn(e){return e&&e instanceof Date&&(e=In(e)),e}function qn(e,t,n){var r,i=e.config.save;if(i){if("all"==t){if(!i.all)return;n={data:e.serialize({sheets:!0})},r=i.all}else r="string"==typeof i?i+"/"+t:i[t];if(r=webix.proxy.$parse(r)){if("function"==typeof r)return r(t,n);if(r.$proxy&&r.save)return r.save(e,n,null,null);var o=webix.ajax();"all"===t&&o.headers({"Content-type":"application/json"}),o.post(r,n)}}}webix.protoUI({$cssName:"datepicker",name:"ssheet-datepicker",getValue:function(){return Dn(webix.ui.datepicker.prototype.getValue.apply(this))||""},$prepareValue:function(e){return e=Mn(e),webix.ui.datepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.datepicker),webix.protoUI({$cssName:"daterangepicker",name:"ssheet-daterangepicker",getValue:function(){var e=webix.ui.datepicker.prototype.getValue.apply(this);return e&&((e=webix.copy(e)).start=Dn(e.start),e.end=Dn(e.end)),e||""},$prepareValue:function(e){return e?e.start||e.end||(e={start:e}):e={start:null,end:null},e.start=Mn(e.start),e.end=Mn(e.end),webix.ui.daterangepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.daterangepicker),webix.protoUI({$cssName:"window",name:"ssheet-dialog",$init:function(e){this.$view.className+=" webix_ssheet_dialog",this.config.buttons=e.buttons,this.config.close=!0},getBodyConfig:function(e){e.borderless=!0;var t=this.getFormElements(e);return{view:"form",css:"webix_ssheet_form",padding:webix.skin.$active.layoutPadding.form,elements:t}},getFormElements:function(e){var t;return webix.isArray(e)?t=e:(t=[]).push(e),this.config.buttons&&(t.push({height:1}),t.push({margin:10,cols:[{},{view:"button",css:"ssheet_cancel_button",label:webix.i18n.spreadsheet.labels.cancel,autowidth:!0,click:function(){this.getTopParentView().callEvent("onCancelClick",[])}},{view:"button",label:webix.i18n.spreadsheet.labels.save,hotkey:"enter",autowidth:!0,click:function(){this.getTopParentView().callEvent("onSaveClick",[])}}]})),t},body_setter:function(e){return"object"==yn(e)&&(webix.isUndefined(e.padding)&&(e.padding=webix.skin.$active.layoutPadding.form),"form"==e.view&&e.elements?(e.elements=this.getFormElements(e.elements),e.css||(e.css="webix_ssheet_form")):e=this.getBodyConfig(e)),webix.ui.window.prototype.body_setter.call(this,e)},defaults:{move:!0,head:"Dialog",buttons:!0,close:!0,autofocus:!1,width:350}},webix.ui.window,webix.IdSpace),webix.protoUI({$cssName:"datatable",name:"ssheet-dialog-table",$init:function(e){e.headerRowHeight||(e.headerRowHeight=34),this.$view.className+=" webix_ssheet_dialog_table"}},webix.ui.datatable),webix.protoUI({name:"ssheet-suggest-labels",defaults:{fitMaster:!1,padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_suggest"},getItemText:function(e){return this.getList().getItem(e).value}},webix.ui.suggest),webix.protoUI({name:"ssheet-form-suggest",defaults:{padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_suggest"}},webix.ui.suggest),webix.protoUI({$cssName:"colorpicker",name:"ssheet-colorpicker",$init:function(){this.$view.className+=" webix_ssheet_colorpicker"},defaults:{suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}}},webix.ui.colorpicker),webix.protoUI({name:"formlate",setValue:function(e){return this.setHTML(e)},getValue:function(){return""}},webix.ui.template),webix.protoUI({name:"ssheet-icons",$cssName:"dataview",$init:function(){this.$view.className+=" webix_ssheet_dataview"},defaults:{borderless:!0,template:"<span class='webix_ssheet_button_icon #css#' ></span>",type:{width:36,height:36}}},webix.ui.dataview),webix.protoUI({name:"ssheet-suggest",defaults:{padding:0,css:"webix_ssheet_suggest"}},webix.ui.contextmenu);var zn=Object.freeze({__proto__:null,init:function(e){for(var t,n=[{name:"onSheetAdd",type:"insert"},{name:"onSheetRemove",type:"remove"},{name:"onSheetRename",type:"rename"},{name:"onSheetStateChange",type:"state"},{name:"onCellChange"},{name:"onStyleChange"},{name:"onAction"},{name:"onRowOperation"},{name:"onColumnOperation"},{name:"onAfterConditionSet"},{name:"onAfterRangeSet"},{name:"onAfterSpan"},{name:"onAfterSplit"},{name:"onZoom"},{name:"onAfterFilter",view:"cells"},{name:"onRowResize",view:"cells"},{name:"onColumnResize",view:"cells"}],r=function(){var r=n[i];(r.view?e.$$(r.view):e).attachEvent(r.name,function(n,i,o,a,l){if(!e._loading_data&&!e._type_change){var s;if(r.type)s="rename"==r.type?[r.type,i,n]:[r.type,n];else{var u=e.getActiveSheet();"onAction"==r.name&&i.page&&i.page!=u?u=i.page:-1!=["onAfterSplit","onAfterSpan","onCellChange","onColumnOperation","onRowOperation"].indexOf(r.name)&&a!=u?u=a:-1!=["onStyleChange","onAfterConditionSet"].indexOf(r.name)&&l!=u?u=l:"onZoom"==r.name&&(u=o),s=["update",u]}clearTimeout(t),t=webix.delay(function(){return e.callEvent("onChange",s)})}})},i=0;i<n.length;i++)r();e.attachEvent("onChange",function(){qn(e,"all")})},save:qn}),Pn={},Fn={},Un="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Ln(e){var t=Math.floor(--e/26);return t>0?Ln(t)+Un[e%26]:Un[e%26]}function Bn(e){var t=Object.keys(Fn).length;e||(e=t+1);for(var n=t+1;n<=e;n++){var r=Ln(n);Pn[r]=n,Fn[n]=r}}function Hn(e){for(var t,n=0;n<e.length;n++)if(e.charCodeAt(n)<59){t=n;break}var r=e.substr(0,t),i=e.substr(t);if(!Pn[r])for(;!Pn[r];)Bn();return[1*i,Pn[r]]}function jn(e,t,n){var r=e.indexOf("!"),i=n||"";-1!==r&&("'"===(i=e.substr(0,r))[0]&&(i=i.substr(1,i.length-2)),e=e.substr(r+1));var o=e.split(":");if(2!=o.length){if(1!=o.length)return null;if(Zn(o[0]))o.push(o[0]);else{if(!t)return null;var a=t.ranges.getCode(e,i);if(!a&&!(a=t.ranges.getCode(e,!0)))return null;var l=a.split("!");(l[0]!=n||t.getActiveSheet())&&(i=l[0].replace(/'/g,"")),o=(a=l[1]).split(":")}}if(!Zn(o[0])||!Zn(o[1]))return null;var s=Hn(o[0]),u=Hn(o[1]);return s[0]&&s[1]&&u[0]&&u[1]?[s[0],s[1],u[0],u[1],i]:void 0}function Wn(e){return(/[\s\-&.!%()+*=^~,;@#$"`|{}<>]/.test(e)||/^[0-9]/.test(e)||/^[A-Za-z]{1,3}[0-9]{1,7}$/.test(e))&&(e="'".concat(e,"'")),e}function Xn(e,t,n,r,i){if("number"==typeof t&&t>0&&!Fn[t])for(;!Fn[t];)Bn();if(n&&"number"==typeof r&&r>0&&!Fn[r])for(;!Fn[r];)Bn();return(i?Wn(i)+"!":"")+Fn[t]+e+(!n||e==n&&t==r?"":":"+Fn[r]+n)}function Kn(e,t){if("object"===yn(e))return e;var n=jn(e,t);return{start:{row:n[0],column:n[1]},end:{row:n[2],column:n[3]},sheet:n[4]}}function Yn(e,t,n,r){for(var i=Kn(e),o=i.start.row;o<=i.end.row;o++)for(var a=i.start.column;a<=i.end.column;a++)n(t,{row:o,column:a},r)}function Gn(e){if("string"==typeof e){var t=e.split(":");if(2==t.length){for(var n=0;n<t.length;n++){if(!Zn(t[n].split("!").pop()))return}return!0}}}var Qn=/^[A-Z]{1,3}[0-9]{1,7}$/;function Zn(e){return Qn.test(e)}function Jn(e,t,n,r){var i=!1;if(Gn(e)){var o=bn(jn(e),5),a=o[0],l=o[1],s=o[2],u=o[3],c=o[4];if(a>s){var h=[s,a];a=h[0],s=h[1]}if(l>u){var d=[u,l];l=d[0],u=d[1]}if("row"===t&&r.row<=s){if((n<0&&r.row<a||n>0&&r.row<=a)&&(a+=n),(s+=n)<a)return"";i=!0}else if("column"===t&&r.column<=u){if((n<0&&r.column<l||n>0&&r.column<=l)&&(l+=n),(u+=n)<l)return"";i=!0}i&&(e=Xn(a,l,s,u,c))}return e}var er={width:38},tr={color:"#666666",background:"#ffffff","font-family":"'PT Sans', Tahoma","font-size":"15","text-align":"left","vertical-align":"middle","white-space":"nowrap",format:"common"},nr={material:"'Roboto', sans-serif",mini:"'Roboto', sans-serif",flat:"'PT Sans', Tahoma",compact:"'PT Sans', Tahoma",contrast:"'PT Sans', Tahoma",willow:"'Open Sans', sans-serif",dark:"'Open Sans', sans-serif"};function rr(e,t){return e[ir(e,t)]}function ir(e,t){for(var n=-1,r=0;n<0&&r<e.length;r++)t(e[r])&&(n=r);return n}function or(e,t,n,r,i){for(var o=0;o<e.length;o++){var a=e[o];a[0]>n&&(n=a[0]),a[1]>r&&(r=a[1])}if(t)for(var l=0;l<t.length;l++){var s=t[l][0]+t[l][3]-1,u=t[l][1]+t[l][2]-1;s>n&&(n=s),u>r&&(r=u)}if(i)for(var c=0;c<i.length;c++)i[c][0]>n&&(n=i[c][0]),i[c][1]>r&&(r=i[c][1]);return[1*n,1*r]}var ar=["color","background","text-align","font-family","font-size","font-style","underline","font-weight","vertical-align","wrap","borders","format","border-right","border-bottom","border-left","border-top","strike","indent"],lr={format:function(){return""},"text-align":{left:function(){return"justify-content:flex-start;"},center:function(){return"justify-content:center;text-align:center;"},right:function(){return"justify-content:flex-end;text-align:right;"}},"vertical-align":{top:function(){return"align-items:flex-start;"},middle:function(){return"align-items:center;"},bottom:function(){return"align-items:flex-end;"}},wrap:{wrap:function(){return"white-space: normal !important;"}},"border-left":function(e,t){return sr("border-left",e,t)},"border-top":function(e,t){return sr("border-top",e,t)},"border-right":function(e,t){return sr("border-right",e,t)},"border-bottom":function(e,t){return sr("border-bottom",e,t)},"font-weight":function(e){return"bold"==e["font-weight"]?"font-weight:"+("'Roboto', sans-serif"==(e["font-family"]||tr["font-family"])?500:700)+";":""},underline:function(e){var t="underline"==e.underline?"underline":"";if(t){var n="strike"==e.strike?"line-through":"";return"text-decoration: ".concat(t," ").concat(n,";")}return""},strike:function(e){return"underline"!=e.underline&&"strike"==e.strike?"text-decoration: line-through;":""},indent:function(e,t){var n=1*e.indent;if(n>0){var r="right"==e["text-align"]?"right":"left";return{innerCss:"margin-".concat(r,":").concat((8*n+12)*t,"px;")}}},"font-size":function(e,t){var n=e["font-size"];return 1!=t&&(n=e["font-size"].replace("px","")*t+"px"),"font-size:"+n+";"}};function sr(e,t,n){var r=t[e];if(r){var i=bn(r.split(","),2),o=i[0],a=i[1],l=1;return"medium"==(a=a||"thin")?l=2:"thick"!=a&&"double"!=a||(l=3),l=l*n+"px",-1!=["thin","medium","thick"].indexOf(a)&&(a="solid"),"".concat(e,": ").concat(l," ").concat(a," ").concat(o," !important;")}return""}var ur,cr={"border-left":function(e,t,n){return e.column==t.start.column||"no"==n},"border-right":function(e,t,n){return e.column==t.end.column||"all"==n||"no"==n},"border-top":function(e,t,n){return e.row==t.start.row||"no"==n},"border-bottom":function(e,t,n){return e.row==t.end.row||"all"==n||"no"==n}},hr={borders:function(e,t,n,r){var i=e.$$("cells").getSelectArea(),o=(n=n.split(","))[0],a=n[1],l=n[2],s=["border-left","border-right","border-bottom","border-top"];"top-bottom"==o?s=["border-top","border-bottom"]:"no"!=o&&"all"!=o&&"outer"!=o&&(s=["border-"+o]);for(var u=0;u<s.length;u++){var c=s[u];if(!0===e.callEvent("onAction",["check-borders",{row:r.row,column:r.column,area:i,type:o,mode:c}])||cr[c](r,i,o))t=_r(e,t,c,"no"==o?"":"".concat(a,",").concat(l),r)}return t}},dr={"font-weight":["normal","bold"],"font-style":["normal","italic"],underline:["normal","underline"],strike:["normal","strike"],wrap:["nowrap","wrap"]};function fr(e){e._styles={},e._styles_cache={},e._styles_max=1;var t=".wss_"+e.$index;webix.html.removeStyle(t)}function mr(e){var t={};pr(e,t),fr(e),br(e,t,!0)}function gr(e,t,n,r){if(n&&n!=e.getActiveSheet()){var i=e._mData.getPage(n);if(i){var o=i.getCell(t.row-1,t.column-1);if(o&&o.style){var a=rr(e._sheets,function(e){return e.name==n}).content.styles||[],l=rr(a,function(e){return e[0]==o.style});if(l)return{id:o.style,text:l[1],props:Ar(l[1])}}}}else{var s=e._mPage.getCell(t.row-1,t.column-1),u=e.$$("cells").getSpan(t.row,t.column);if(u&&(r||u[0]==t.row&&u[1]==t.column))for(var c=u[5].split(" "),h=0;h<c.length;h++){var d=e._styles[c[h]];if(d)return d}if(s&&s.style)return e._styles[s.style]}return null}function vr(e,t,n){var r=e._mPage.getCell(t-1,n-1);return r&&r.format||""}function pr(e,t){var n=[];for(var r in e._styles_cache)n.push([e._styles_cache[r].id,r]);t.styles=n}function wr(e,t,n,r){var i,o={props:Ar(ar.map(function(){return""}).join(";"))};if(n)for(var a in n.props)o.props[a]=n.props[a];for(var l in t)o.props[l]=t[l];if(o.text=Rr(o),r&&r!=e.getActiveSheet()){if(!(i=rr(e._sheets,function(e){return e.name==r})))return null;if(i.content.styles){var s=rr(i.content.styles,function(e){return e[1]==o.text});if(s)return webix.extend(o,{id:s[0]})}else i.content.styles=[]}else{var u=e._styles_cache[o.text];if(u)return u}return Er(e,o,!1,i),o}function br(e,t,n){if(t.styles)for(var r=0;r<t.styles.length;r++){var i=t.styles[r];Er(e,{id:i[0],text:i[1],props:Ar(i[1])},!0)}if(!n)for(var o=0;o<t.data.length;o++){var a=bn(t.data[o],4),l=a[0],s=a[1],u=a[3];u&&xr(e,l,s,e._styles[u])}}function _r(e,t,n,r,i){if(hr[n])return hr[n](e,t,r,i);var o=void 0===r&&dr[n];if(t&&t.props[n]==r&&!o)return t;var a={text:"",id:0,props:t?webix.copy(t.props):{}};if(o){var l=a.props[n],s=l?o.findIndex(function(e){return e==l}):0;r=o[1^s]}a.props[n]=r,a.text=Rr(a);var u=e._styles_cache[a.text];return u||(Er(e,a),a)}function xr(e,t,n,r,i){var o=!i||i==e.getActiveSheet(),a=o?e._mPage:e._mData.getPage(i);if(a){var l=a.getCell(t-1,n-1,!0);if(l.style=r&&r.id,l.format=r&&r.props.format,!o){var s=rr(e._sheets,function(e){return e.name==i}).content.data,u=rr(s,function(e){return e[0]==t&&e[1]==n});u?u[3]=l.style:s.push([t,n,"",l.style])}}}function yr(e,t,n,r){return $r(e,t,n,r)}function Cr(e,t,n,r){Yn(t,e,function(e,t,n){return $r(e,t,n.style,n.page,!1)},{style:n,page:r}),r&&r!=e.getActiveSheet()||e.callEvent("onCommand",[{id:"toolbar-update"}])}function Sr(e,t,n,r){ur.innerHTML=t,ur.style.width=r?r+"px":"auto",ur.className="webix_table_cell webix_cell "+n,e._table.$view.appendChild(ur);var i=Math.max(0,ur.offsetWidth+1),o=Math.max(0,ur.offsetHeight+1);return e._table.$view.removeChild(ur),ur.innerHTML="",{width:i,height:o}}function $r(e,t,n,r,i){var o=gr(e,t,r),a=e.getActiveSheet();r||(r=a),e.callEvent("onBeforeStyleChange",[t.row,t.column,n,o,r])&&Sn.set(function(){var l=n&&n.props.format||null,s=o&&o.props.format||null,u=l!=s;(!u||u&&e.callEvent("onBeforeFormatChange",[t.row,t.column,l,s,r]))&&(xr(e,t.row,t.column,n,r),e.callEvent("onStyleChange",[t.row,t.column,n,o,r]),u&&e.callEvent("onFormatChange",[t.row,t.column,l,s,r]),e.saveCell(t.row,t.column,r),!1!==i&&r==a&&e.callEvent("onCommand",[{id:"toolbar-update"}]))})}function Er(e,t,n,r){if(r&&r.name!=e.getActiveSheet()){for(var i=1;!t.id||rr(r.content.styles,function(e){return e[0]==t.id});)t.id="wss"+i++;r.content.styles.push([t.id,t.text])}else{for(e._styles_cache[t.text]=t;!t.id||e._styles[t.id];)t.id="wss"+e._styles_max++;e._styles[t.id]=t;var o=function(e,t){var n="",r="";for(var i in t)if(t[i])if(lr[i]){if(lr[i][t[i]])n+=lr[i][t[i]](t);else if("function"==typeof lr[i]){var o=lr[i](t,e._zoom);"object"==yn(o)?(n+=o.css||"",r+=o.innerCss||""):n+=o}}else n+=i+":"+t[i]+";";return{css:n,innerCss:r}}(e,t.props),a=o.css,l=o.innerCss,s=".wss_"+e.$index;webix.html.addStyle(s+" ."+t.id+"{"+a+"}",s),webix.html.addStyle(s+" ."+t.id+" div:first-child{"+l+"}",s)}n||qn(e,"styles",{name:t.id,text:t.text,page:r?r.name:e.getActiveSheet()})}function Rr(e){for(var t=[],n=0;n<ar.length;n++)t.push(e.props[ar[n]]);return t.join(";")}function Ar(e){for(var t=e.split(";"),n={},r=0;r<ar.length;r++)n[ar[r]]=t[r];return n}function Tr(e,t,n){Sn.set(function(){Yn(t,e,function(e,t){gr(e,t,n)&&$r(e,t,null,n,!1)}),e.callEvent("onCommand",[{id:"toolbar-update"}])})}function kr(e){var t=e.serialize();t.styles=Or(t),fr(e),br(e,t)}function Or(e){for(var t=e.data,n=e.styles,r={},i=0;i<t.length;i++){var o=t[i][3];o&&(r[o]=1)}for(var a=[],l=0;l<n.length;l++){r[n[l][0]]&&a.push(n[l])}return a}var Ir=Object.freeze({__proto__:null,addStyle:wr,clearRangeStyle:Tr,compactStyles:kr,getFormat:vr,getStyle:gr,getTextSize:Sr,init:function(e){e.attachEvent("onStyleSet",function(t,n){return function(e,t,n){if(!e.getSelectedId())return;Sn.set(function(){e.eachSelectedCell(function(r){var i=e.$$("cells").getSpan(r.row,r.column);(!i||i&&i[0]==r.row&&i[1]==r.column)&&function(e,t,n,r){var i=gr(e,t);if("indent"==n){var o=1*(i&&i.props[n]||0);if(!o&&-1==r)return;r+=o}var a=_r(e,i,n,r,t);a&&a!=i&&$r(e,t,a,null,!1)}(e,r,t,n)})}),e.callEvent("onCommand",[{id:"toolbar-update"}]),e.refresh()}(e,t,n)}),e.attachEvent("onDataParse",function(t){return br(e,t)}),e.attachEvent("onDataSerialize",function(t){return pr(e,t)}),e.attachEvent("onReset",function(){return fr(e)}),e.attachEvent("onUndo",function(t,n,r,i){"style"==t&&function(e,t,n,r){var i={row:t,column:n};yr(e,i,r)}(e,n,r,i)}),fr(e),ur||(ur=webix.html.create("DIV",{style:"visibility:hidden; position:absolute; top:0px; left:0px; height:auto;"},""))},removeUnusedStyles:Or,setRangeStyle:Cr,setStyle:yr,styleFromText:Ar,styleToText:Rr,style_names:ar,zoomStyles:mr});function Vr(e,t,n,r){var i=e._table.getSelectArea();i&&e.groupUndo(function(){if(r&&(n=Br(e,n,r)),"row"==t)for(var o=i.start.row;o<=i.end.row;o++)jr(e,o,n,!0);else for(var a=i.start.column;a<=i.end.column;a++)jr(e,a,n);e.refresh()})}function Nr(e,t,n,r){e.groupUndo(function(){if("column"==t.group){if("add"==t.id)for(var i=1;i<=e.config.rowCount;i++){var o=fi(e,i,n.column-1);if(o)for(var a=n.column;a<=r.column;a++)Hr(e,i,a,o)}}else if("add"==t.id)for(var l=1;l<=e.config.columnCount;l++){var s=fi(e,n.row-1,l);if(s)for(var u=n.row;u<=r.row;u++)Hr(e,u,l,s)}})}var Mr=[];function Dr(){Mr.length||(Mr=(Mr=(Mr=[webix.i18n.price]).concat(webix.copy(webix.i18n.spreadsheet.formats.currencies))).map(function(e){var t=function(e){return webix.template(e)("")}(e);return{format:e,id:t,value:t.trim()}}))}var qr={common:1};function zr(e){Dr();var t=webix.i18n.spreadsheet.formats,n=e._formats={formats:{},formatsCount:0,formatSources:{},formatCache:{},formatHelpers:{price:{getFormat:function(e,t){return t.css="webix_ssheet_format_price",webix.i18n.priceFormat(e)},values:webix.extend({zeros:webix.i18n.priceSettings.decimalSize,symbol:webix.i18n.price.replace("{obj}",""),separator:1,negative:1,type:"price"},Pr("price"))},int:{getFormat:function(e,t){return t.css="webix_ssheet_format_int",webix.i18n.numberFormat(e)},values:webix.extend({zeros:webix.i18n.decimalSize,separator:1,negative:1,type:"int"},Pr("int"))},percent:{getFormat:function(e,t){return t.css="webix_ssheet_format_percent",Math.round(100*e)+"%"},values:webix.extend({zeros:0,separator:0,negative:1,type:"percent"},Pr("percent"))},date:{getFormat:function(e,n){return n.css="webix_ssheet_format_date",Yr(t.dateFormat,Pr("date"))(e)},values:{type:"date",date:t.dateFormat}},string:{getFormat:function(e,t){return t.css="webix_ssheet_format_text",e},values:{type:"string"}}}};for(var r in n.formatHelpers){qr[r]=1;var i=n.formatSources[r]=ai(oi(r,n.formatHelpers[r].values));n.formatCache[i]=r}}function Pr(e){return"price"==e?{groupSign:webix.i18n.priceSettings.groupDelimiter,decimalSign:webix.i18n.priceSettings.decimalDelimiter}:{groupSign:webix.i18n.groupDelimiter,decimalSign:webix.i18n.decimalDelimiter}}function Fr(e,t){var n=e._formats.formatHelpers;return n[t]?n[t].getFormat:n[t]}function Ur(e,t,n){return n?ai(li({values:e._formats.formatHelpers[t].values,format:e._formats.formatSources[t]}),!0):e._formats.formatSources[t]}function Lr(e,t,n){if(e._formats.formatCache[t])return e._formats.formatCache[t];var r="object"==yn(n)?"fmt"+e._formats.formatsCount:n;e._formats.formatsCount++,e._formats.formats[r]=t,"string"==typeof n&&(n=function(e){var t=webix.i18n.spreadsheet.formats,n=[t.dateFormat,t.timeFormat,t.fullDateFormat,t.longDateFormat],r={format:e,type:"custom"};if(rr(n,function(t){return t==e}))webix.extend(r,{type:"date",date:e},!0);else{var i,o=bn(e.split(";"),2),a=o[0],l=o[1];if(a&&l)if(0==a.indexOf("[>=0]")&&0==l.indexOf("[<0]"))if(a=a.replace("[>=0]",""),0==(l=l.replace("[<0]","")).indexOf("[red]")&&(l=l.replace("[red]",""),i=!0),"-"==l[0]?(l=l.substring(1),r.negative=i?2:1):i&&("("==l[0]&&")"==l[l.length-1]?(r.negative=4,l=l.substring(1,l.length-1)):r.negative=3),r.negative&&a==l){var s="int",u=-1!=a.indexOf("[$");if("%"==a[a.length-1])a=a.substring(0,a.length-1),s="percent";else for(var c=0;c<Mr.length;c++){var h=Mr[c].id,d=void 0;if(u?-1!=a.indexOf("[$".concat(h,"]"))&&(a=a.replace("[$".concat(h,"]"),""),d=!0):-1!=a.indexOf(h)&&(a=a.replace(h,""),d=!0),d){s="price",r.symbol=h;break}}var f=Pr(s);0==a.indexOf("#"+f.groupSign)&&(a=a.replace("#"+f.groupSign,""),r.separator=1);var m=bn(a.split(f.decimalSign),2),g=m[0],v=m[1];g&&"0"!=g||v&&!/^[0]+$/.test(v)||(r.type=s,r.delimiters=f,r.zeros=v?v.length:0)}}return r}(t)),webix.extend(n,Pr("custom"));var i=e._formats;return i.formatHelpers[r]={getFormat:Yr(t,{decimalSign:n.decimalSign,groupSign:n.groupSign}),values:n},i.formatSources[r]=t,i.formatCache[t]=r,r}function Br(e,t,n){n||(n={format:t,type:"custom"});var r=Lr(e,t,n);return e._sheets.map(function(e){e.content.formats||(e.content.formats=[]),rr(e.content.formats,function(e){return e[0]==r})||e.content.formats.push([r,t])}),r}function Hr(e,t,n,r,i){var o=e.getStyle(t,n,i),a=wr(e,{format:r},o,i);e.setStyle(t,n,a,i)}function jr(e,t,n,r){for(var i=r?e.config.columnCount:e.config.rowCount,o=1;o<=i;o++){Hr(e,r?t:o,r?o:t,n)}}function Wr(e,t,n,r,i,o){var a=Br(e,r,i);return Hr(e,t,n,a,o),a}function Xr(e,t,n,r){Hr(e,t,n,"",r)}function Kr(e){var t=e.match(/.*\[[><=].*/g),n=e.split(";");return t||n.length>1&&(n[0]=(n.length>2?"[>0]":"[>=0]")+n[0],n[1]="[<0]"+n[1],n[2]&&(n[2]="[=0]"+n[2])),n}function Yr(e,t){for(var n,r=webix.i18n.spreadsheet.table["format-error"],i=Kr(e),o=['var spaces = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";'],a=0;a<i.length;a++){var l=ui(i[a]);o.push(Gr(l.condition,l.color.toLowerCase(),l.symbol,l.fmt,a,i.length>0,t))}try{n=new Function("val","extra","try{ ".concat(o.join("\n"),' return val; } catch(err) { return "').concat(r,'"; }'))}catch(e){n=function(){return r}}return n}function Gr(e,t,n,r,i,o,a){var l="";return e&&(l+=i?"else if":"if","="===e[0]&&(e="="+e),l+="(val"+e+"){",o&&(l+="val = Math.abs(val);")),t&&(l+='extra.css = "webix_ssheet_format_'+t+'";'),l+=function(e,t,n){if(!e)return"return val;";var r,i,o,a,l,s='return ""',u="",c=1,h=[],d="date";if(n){var f=rr(Mr,function(e){return e.id==n});l="left",f&&(l=ir(f.format.split("{obj}"),function(e){return e})?"right":"left")}for(var m=0;m<e.length;m++){var g=ci(e[m-1])&&ci(e[m+1]);if('"'!=e[m]){if(webix.isUndefined(r))if("%"==e[m]&&(c*=100),/[a-zA-Z]/.test(e[m])){var v=ti(e.substr(m),d);if(v){if(o||a)return'throw "unexpected number placeholder";';h.push(v.format),s+="/*date*/",d=v.type,m+=v.length-1;continue}s+='+"'.concat(e[m],'"')}else if(e[m]===t.decimalSign&&g)u+=t.decimalSign;else if("@"==e[m]){if(o||h.length)return'throw "unexpected number placeholder";';a||(s+="+fmt",a=!0),u+=e[m]}else if(ci(e[m])){if(a||h.length)return'throw "unexpected text placeholder";';o||("left"==l&&(s+='+"'.concat(n,'"')),s+="+fmt","right"==l&&(s+='+"'.concat(n,'"')),o=!0),u+=e[m]}else e[m]===t.groupSign&&g?i=!0:s+='+"'.concat(e[m],'"')}else webix.isUndefined(r)?r=m:(s+='+"'.concat(e.substr(r+1,m-r-1),'"'),r=void 0)}if(h.length){-1!=h.indexOf("%A")&&(h=h.map(function(e){switch(e){case"%G":return"%g";case"%H":return"%h";default:return e}}));for(var p=0;p<h.length;p++)s=s.replace("/*date*/","+dateParts[".concat(p,"]"))}return"\n\t\t".concat(h.length?"val = (".concat(On,')(val); var dateParts = webix.Date.dateToStr("').concat(h.join(";"),'")(val).split(";");'):"","\n\t\t").concat(u?"".concat(function(e,t,n,r){var i='if(/^@+$/.test("'.concat(e,'") || isNaN(val)){ var fmt = val; }else {'),o=n.decimalSign,a=hi(e,o),l=bn(a,2),s=l[0],u=l[1];u=(u||"").split("").reverse().join("");var c=s.indexOf("0");c>=0&&(c=s.length-c);var h=s.indexOf("?");h>=0&&(h=s.length-h);var d=u.indexOf("0");d>=0&&(d=u.length-d);var f=u.indexOf("?");f>=0&&(f=u.length-f);var m=u.length;return i+="\n\tval = val*".concat(r,";\n\tvar parts = val.toFixed(").concat(m,').split(".");\n\tvar left = parts[0];\n\tvar lsize = left.length; \n\tvar right = parts[1] || "";\n\tif (left.length < ').concat(c,') left = "0000000000".substr(0, ').concat(c," - left.length)+left;\n\tif (left.length < ").concat(h,") left = spaces.substr(0, 6*(").concat(h," - left.length))+left;\n\tif (").concat(t,') {\n\t\tvar buf = [];\n\t\tvar start = 3;\n\t\twhile (lsize > start) { buf.push(left.substr(left.length-start,3)); start+=3; }\n\t\tvar last = left.substr(0,left.length-start+3);\n\t\tif (last !== "-")\n\t\t\tbuf.push(last);\n\t\telse\n\t\t\tbuf.push("-"+buf.pop());\n\n\t\tleft = buf.reverse().join("').concat(n.groupSign,'");\n\t}\n\tif (right){\n\t\tvar zpoint = right.length-1;\n\t\twhile (zpoint >= ').concat(d,'){\n\t\t\tif (right[zpoint] !== "0"){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tzpoint--;\n\t\t}\n\n\t\tif (zpoint <= right.length)\n\t\t\tright = right.substr(0, zpoint+1);\n\n\t\tif (right.length < ').concat(f,"){\n\t\t\tright += spaces.substr(0, 6*(").concat(f,' - right.length));\n\t\t}\n\t}\n\tvar fmt = left+(right?"').concat(o,'":"")+right;\n\t'),i+"}\n"}(u,i,t,c),";"):"","\n\t\t").concat(s,";")}(r,a,n),l+(e?"}":"")}var Qr={yy:"%y",yyyy:"%Y",m:"%n",mm:"%m",mmm:"%M",mmmm:"%F",mmmmm:"%F",d:"%j",dd:"%d",ddd:"%D",dddd:"%l"},Zr={h:"%G",hh:"%H",m:"%i",mm:"%i",s:"%s",ss:"%s","AM/PM":"%A"},Jr=Object.keys(Qr).sort(function(e,t){return t.length-e.length}),ei=Object.keys(Zr).sort(function(e,t){return t.length-e.length});function ti(e,t){var n=[{name:"date",order:Jr,types:Qr},{name:"time",order:ei,types:Zr}];/^m{1,2}(?!m)/.test(e)&&"date"!=t&&n.reverse();for(var r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.order.length;o++)if(0==e.indexOf(i.order[o]))return{format:i.types[i.order[o]],length:i.order[o].length,type:i.name}}function ni(e,t,n,r,i){var o=!i||i==e.getActiveSheet(),a=o?e._mPage:e._mData.getPage(i);if(a){var l=function(e,t,n){if(t&&n){if("object"===yn(t)&&"object"===yn(n)){for(var r=[],i=t.row;i<=n.row;i++)for(var o=t.column;o<=n.column;o++)r.push({row:i,column:o});return r}return[{row:t,column:n}]}return e.getSelectedId(!0)}(e,n,r);if(0!=l.length){var s=a.getCell(l[0].row-1,l[0].column-1),u=s&&s.format,c=s&&s.value?s.value.toString():"";if((webix.rules.isNumber(c)||u)&&(Sn.set(function(){for(var n=0;n<l.length;n++)ri(e,t,l[n],i,a)}),o)){e.refresh();var h=fi(e,l[0].row,l[0].column)||"common";h=ii(h)?"custom":h,e.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:h}])}}}}function ri(e,t,n,r,i){var o,a=i.getCell(n.row-1,n.column-1),l=a&&a.format,s=a&&a.value?a.value.toString():"";l?((o=webix.copy({values:e._formats.formatHelpers[l].values,format:Ur(e,l)})).format=function(e,t,n){for(var r=li(e),i=0;i<r.length;i++){if(r[i].decimals)t>0?r[i].right.placeholders+=Array(t+1).join("0"):r[i].right.placeholders=r[i].right.placeholders.slice(0,t);else{var o=!r[i].left.text&&!r[i].right.text,a=!r[i].left.placeholders&&!r[i].right.placeholders;t<0&&o&&a&&webix.rules.isNumber(n)&&n.indexOf(".")>-1?(r[i].left.placeholders="0",r[i].right.placeholders=Array(n.split(".")[1].length).join(Array(t+1).join("0"))):t>0&&(r[i].left.placeholders||o)&&(r[i].left.placeholders=r[i].left.placeholders||"0",r[i].right.placeholders=Array(t+1).join("0"),r[i].decimals=!0)}r[i].decimals=r[i].right.placeholders.length>0}return ai(r)}(o,t,s),o.values&&Object.prototype.hasOwnProperty.call(o.values,"zeros")&&(o.values.zeros=Math.max(o.values.zeros+t,0))):(o={values:{negative:1,zeros:webix.rules.isNumber(s)&&s.split(".")[1]?Math.max(s.split(".")[1].length+t,0):Math.max(t,0),separator:0,type:"int"}}).format=ai(oi(o.values.type,o.values));Wr(e,n.row,n.column,o.format,o.values,r)}function ii(e){return!qr[e]}function oi(e,t){if("string"==e)return[{left:{text:"@"}}];if(t.date)return[{left:{text:t.date}}];var n=[{condition:">=0",left:{text:""},right:{text:""}},{condition:"<0",left:{text:""},right:{text:""}}];if(webix.extend(n,Pr(e)),n[0].right.placeholders=n[1].right.placeholders=t.zeros?Array(t.zeros+1).join("0"):"",n[0].separator=n[1].separator=t.separator&&"percent"!=e,n[0].left.placeholders=n[1].left.placeholders=n[0].separator?"#"+n.groupSign+"0":"0",n[0].decimals=n[1].decimals=!!t.zeros,n[1].color=1!=t.negative?"red":"",n[1].left.text+=t.negative<3?"-":"",4==t.negative&&(n[1].left.text+="("),"percent"===e)n[0].right.text=n[1].right.text+="%";else if("price"===e){var r=t.symbol,i=ir(rr(Mr,function(e){return e.id==r}).format.split("{obj}"),function(e){return e})?"right":"left";n[0][i].symbol=n[1][i].symbol=r}return 4==t.negative&&(n[1].right.text+=")"),n}function ai(e,t){for(var n="",r=0;r<e.length;r++){if(e[r].condition&&(n+="["+e[r].condition+"]"),e[r].color&&(n+="["+e[r].color+"]"),e[r].left){if(e[r].left.text)n+=e[r].left.text;if(e[r].left.symbol&&(n+="[$"+e[r].left.symbol+"]"),e[r].left.placeholders){var i=e[r].left.placeholders;n+=t?i.replace(e.groupSign,","):i}}if(e[r].decimals&&(n+=t?".":e.decimalSign),e[r].right)if(e[r].right.placeholders&&(n+=e[r].right.placeholders),e[r].right.symbol&&(n+="[$"+e[r].right.symbol+"]"),e[r].right.text)n+=e[r].right.text;r!=e.length-1&&(n+=";")}return n}function li(e){for(var t=e.format.split(";"),n=[],r=function(){var r=ui(t[i]);n[i]={color:r.color,condition:r.condition,left:{},right:{}};var o=r.fmt;n.groupSign=e.values.groupSign,n.decimalSign=e.values.decimalSign,o.indexOf(n.groupSign)>-1&&(n[i].separator=!0);var a=hi(o,n.decimalSign),l=a[0],s=a[1]||"";a[1]&&(n[i].decimals=!0),l=si(l,"left",n.groupSign),s=si(s,"right",n.groupSign),n[i].left={text:l.leftText,placeholders:l.placeholders},n[i].right={text:l.rightText+s.rightText,placeholders:s.placeholders};var u=r.symbol;if(u){var c=rr(Mr,function(e){return e.id==u}),h="left";c&&(h=ir(c.format.split("{obj}"),function(e){return e})?"right":"left"),n[i][h].symbol=u}},i=0;i<t.length;i++)r();return n}function si(e,t,n){var r;"left"==t&&(r=(r=e.match(/[#?0]/))?r.index:1/0);for(var i="",o="",a="",l=0;l<e.length;l++)if(ci(e[l]))a+=e[l];else{if(e[l]==n&&ci(e[l+1])&&ci(e[l-1])){a+=e[l];continue}if("left"==t&&l<r){i+=e[l];continue}o+=e[l]}return{leftText:i,rightText:o,placeholders:a}}function ui(e){var t="",n="",r="",i=e.indexOf("[");if(-1!=i&&e[1].match(/[><=]/)){var o=e.indexOf("]");n=e.substr(i+1,o-i-1),e=e.substr(o+1)}if(-1!=(i=e.indexOf("[$"))){var a=i+e.substr(i).indexOf("]");r=e.substr(i+2,a-i-2),e=e.substr(0,i)+e.substr(a+1)}if(-1!=(i=e.indexOf("["))){var l=e.indexOf("]");t=e.substr(i+1,l-i-1),e=e.substr(l+1)}return{condition:n,color:t,symbol:r,fmt:e}}function ci(e){return"0"===e||"#"===e||"?"===e}function hi(e,t){var n=e.match("[#?0][/"+t+"][#?0]");return n?[e.substring(0,n.index+1),e.substring(n.index+2)]:[e]}function di(e,t,n,r){if(t=t&&t.fmt?t.fmt:Ur(e,t)){var i,o=ui(Kr(t)[0]).fmt;if(o)for(var a=0;a<o.length;a++)if('"'==o[a]&&(i=!i),!i){if("date"==n&&/[a-zA-Z]/.test(o)){var l=ti(o.substr(a),"date");if(l){if(!r)return!0;if("time"==l.type)return!0;if("onlyTime"==r)return!1}}if("string"==n&&"@"==o[a])return!0}}}function fi(e,t,n,r){var i=!r||r==e.getActiveSheet()?e._mPage:e._mData.getPage(r);if(i){var o=i.getCell(t-1,n-1);return o&&o.format||null}}function mi(e){return e<-99974430.925||e>100025569.125}function gi(e,t,n){var r=fi(e,t,n),i=webix.i18n.spreadsheet.formats,o=di(e,r,"date",!0);return webix.Date.dateToStr(i[o?"parseDateTime":"parseDate"])}function vi(e,t,n){var r,i=n[3];if(i){var o=rr(t.styles,function(e){return e[0]==i});if(o){var a=Ar(o=o[1]).format;a&&(t.formats&&(r=rr(t.formats,function(e){return e[0]==a})),r=r?r[1]:Ur(e,a))}}return r}var pi=Object.freeze({__proto__:null,addAreaFormat:Vr,addFormat:Wr,changeAreaDecimals:ni,checkFormat:di,createFormat:Br,get currencies(){return Mr},formToValues:oi,format2code:Yr,getDateEditFormat:gi,getDelimiters:Pr,getFormat:Fr,getFormatFromData:vi,getFormatName:fi,getFormatSource:Ur,init:function(e){e.attachEvent("onDataParse",function(t){return function(e,t){var n=t.formats;if(n)for(var r=0;r<n.length;r++)Lr(e,n[r][1],n[r][0])}(e,t)}),e.attachEvent("onDataSerialize",function(t,n){return function(e,t){var n=[];for(var r in e._formats.formatSources)qr[r]||n.push([r,e._formats.formatSources[r]]);t.formats=n}(e,t)}),e.attachEvent("onCommand",function(t){-1!=["int","price","percent","date","string","common"].indexOf(t.id)&&Vr(e,t.group,"common"==t.id?"":t.id)})},initCurrencies:Dr,isCustom:ii,isDateInvalid:mi,processAreaFormats:Nr,removeFormat:Xr,serializeFormat:ai,setDefaultFormats:zr,setFormat:Hr});function wi(e){var t=e.charCodeAt(0);return t<=122?t>=65||35==t||36==t||46==t:t>191}function bi(e,t){for(var n=e.length,r=n-1;r>=0;r--){if(!wi(e[r])){if(t&&_i(e[r]))continue;return n}n=r}}function _i(e){var t=e.charCodeAt(0);return t>=48&&t<=57}function xi(e,t){var n,r="",i=!1;for(n=t;n<e.length;n++){var o=e[n];if("'"!==o){if(!i)if("!"==o){if("#"==e[t])continue;"'"===(r=e.substr(t,n-t))[0]&&(r=r.substr(1,r.length-2)),t=n+1}else if(!wi(o)&&!_i(o))return[e.substr(t,n-t),n,t,r]}else i=!i}return[e.substr(t),n,t,r]}var yi=/^[A-Z$]+[0-9]+$/i;function Ci(e){return yi.test(e)}function Si(e){for(var t=0,n=0,r=1,i=1,o=0,a=!1,l=e.length-1;l>=0;l--){var s=e[l].charCodeAt(0);36!==s?s<58?(n+=(s-48)*r,r*=10):(a||(r=1,t=n,n=0,a=!0,i+=1),n+=(s-64)*r,r*=26):o+=i}return[t,n,o]}function $i(e,t,n,r){for(var i=t.getActiveSheet(),o=[],a=0,l=!1,s=!1,u="="===e[u]?1:0;u<e.length;u++){var c=e[u];if('"'==c)l=!l;else if(!l)if("{"==c&&"{"==e[u+1])s=!0;else if("}"==c&&"}"==e[u+1])s=!1;else if(!s){var h="'"===c;if(h||wi(c)){var d=bn(xi(e,u),4),f=d[0],m=d[1],g=d[3],v=m-1;if("("!==e[v+1])if(Ci(f))g&&g!=i&&!n||(Ei(o,e,u,a,g?[g,f,h]:f),a=v+1);else if(n)Ei(o,e,u,a,g?[g,f,h]:f),a=v+1;else{var p=t.ranges.getCode(f,g||r);if(p||(p=t.ranges.getCode(f,!0)),p){var w=p.split("!");w[0]==i&&(Ei(o,e,u,a,[g,f,h,w[1]]),a=v+1)}}u=v}}}return a!=e.length&&o.push(e.substr(a)),o}function Ei(e,t,n,r,i){0!==n&&e.push(t.substr(r,n-r)),e.push(i)}function Ri(e){var t=e.getValue(),n=e.getInputNode(),r=webix.html.offset(n),i=n.selectionStart,o=webix.html.getTextSize(t.substring(0,i),"webix_ssheet_formula").width;return{x:r.x+o,y:r.y+r.height}}function Ai(e,t,n){var r=vi(e,t,n),i={value:n[2],fmt:r?{fmt:r}:null,type:n[3]};return Vi(e,i),i}function Ti(e,t,n,r){if(!e._setType){var i=fi(e,t,n);Vi(e,{row:t,col:n,value:r,fmt:i?{fmt:Ur(e,i)}:null})}}function ki(e,t,n,r){n=In(n),t.value=n,e._loading_data||e._page_value_set||e.setCellValue(t.row,t.col,n,r)}function Oi(e,t){var n=t?"number":null;return di(e,t,"string")?n="string":di(e,t,"date")&&(n="date"),n}function Ii(e,t,n,r){var i=(r=r?e._mData.getPage(r):e._mPage).getCell(t-1,n-1);return i&&i.type||null}function Vi(e,t,n,r){var i=!(t.row&&t.col);e._setType=!0;var o,a="string"==typeof t.value&&"="==t.value[0],l=(!n||t.fmt==Ur(e,"date"))&&(!e._loading_data||e._page_value_set||"date"==t.type);i||r&&r!=e.getActiveSheet()||(o=a&&!t.fmt?function(e,t){for(var n,r=0,i=$i(t,e),o=0;o<i.length;o++)if(o%2==0){var a=i[o].match(/(([a-zA-Z]*\()|\))(?=(?:[^"]|"[^"]*")*$)/g);a&&a.forEach(function(e){e.indexOf("(")>-1?(r++,n||/^(SUM|AVERAGE|MAX|MIN|INT|ROUND|ROUNDDOWN|ROUNDUP|TRUNC)?\($/gi.test(e)||(n=r)):--r<n&&(n=null)})}else if(!n){if(webix.isArray(i[o]))if(/^[A-Za-z]+$/.test(i[o][1]))i[o]=i[o][3].split(":")[0];else{if(i[o][0]!=e.getActiveSheet())continue;i[o]=i[o][1]}var l=Si(i[o]),s=fi(e,l[0],l[1]);if(s)return{fmt:Ur(e,s)}}}(e,t.value):null);var s=Oi(e,t.fmt||o),u=function(e,t,n,r,i,o,a){var l="string";if(!(webix.isUndefined(t.value)||"string"==typeof t.value&&/^0[xob][0-9a-f]+$/i.test(t.value)))if(r)l="number",/^=(now|date|time)\(/i.test(t.value)?l="date":/^=(sparkline|image)\(/i.test(t.value)&&(l="string");else if(isNaN(t.value)){if("string"!=i&&n){var s=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(t.value);""==s||isNaN(s)||(o?ki(e,t,s,a):e.ignoreUndo(function(){return ki(e,t,s)}),l="date")}}else l="number";return l}(e,t,l,a,s,n,r);if(t.type=function(e,t,n,r,i){return e=e||t,"string"==t?e="string":n&&(e=n),"date"==e&&!r&&mi(i)&&(e="number"),e}(t.type,u,s,a,t.value),!i){var c=(r&&r!=e.getActiveSheet()?e._mData.getPage(r):e._mPage).getCell(t.row-1,t.col-1,!0);c.$format="string"==s?1:0,function(e,t,n,r,i,o){var a=t.row,l=t.col,s="string"==typeof t.value,u=s&&"="==t.value[0],c=e.getCellEditor(a,l,o);e._loading_data||e._page_value_set||"number"!==t.type||!s||u||""===t.value||e.setCellValue(a,l,1*t.value,o);if(i)e.setFormat(a,l,i.fmt);else if("date"==t.type){if("date"!=r){var h=u&&0==t.value.toUpperCase().indexOf("=TIME("),d=webix.i18n.spreadsheet.formats,f=h?d.timeFormat:d.dateFormat;e.setFormat(a,l,f,o)}u||c||e.setCellEditor(a,l,{editor:"excel_date"},o)}else"string"!=r&&"string"==t.type&&"string"!=n&&e.setFormat(a,l,"@",o);("date"!=t.type||u)&&c&&"excel_date"==c.editor&&e.setCellEditor(a,l,null,o)}(e,t,u,s,o,r),c.type=t.type}delete e._setType}webix.protoUI({name:"suggest-formula",defaults:{fitMaster:!1,filter:function(e,t){var n=webix.$$(this.config.master),r=n.getInputNode().selectionStart,i=n.getValue();if("="===i.charAt(0)){var o=i.substring(0,r),a=o.substring(bi(o,!0)),l=i.charAt(r);return!a||r!==i.length&&(wi(l)||/^[0-9]/.test(l))||(t=a),0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}},$init:function(){var e=this;this.attachEvent("onBeforeShow",function(t){if(t.tagName){var n=webix.$$(e.config.master),r=n.getValue();return!(!r||"="!==r.charAt(0))&&(webix.ui.popup.prototype.show.apply(e,[Ri(n)]),!1)}})},setMasterValue:function(e,t){var n=e.id?this.getItemText(e.id):e.text||e.value;webix.$$(this.config.master).setValueHere(n),t||this.hide(!0),this.callEvent("onValueSuggest",[e,n])},$enterKey:function(){if(this.isVisible())return webix.ui.suggest.prototype.$enterKey.apply(this,arguments)}},webix.ui.suggest);var Ni=Object.freeze({__proto__:null,getType:Ii,handleChange:Ti,init:function(e){e.attachEvent("onBeforeFormatChange",function(t,n,r,i,o){this._setType||Vi(this,{row:t,col:n,value:e.getCellValue(t,n,!0,o),fmt:{fmt:Ur(e,r)}},!0,o)}),e.attachEvent("onAction",function(t,n){if("dropdown"==t&&n.newValue&&"excel_date"==n.newValue.editor){var r=fi(this,n.row,n.column,n.page);"date"!=Oi(e,r)&&this.setFormat(n.row,n.column,webix.i18n.spreadsheet.formats.dateFormat,n.page)}})},loadCell:Ai});function Mi(e,t,n,r){var i={},o="",a=webix.template.escape;if(t&&"="==t[0])for(var l=$i(t,e,null,n),s=e.getActiveSheet(),u=1,c=0;c<l.length;c++)if(c%2==0)o+=a(l[c]);else{var h=webix.isArray(l[c]),d=h?qi(l[c][0],l[c][2]):"",f=!(h||n&&n!=s),m=Si((h?l[c][1]:l[c]).toUpperCase()),g=h?d+l[c][1]:l[c],v=h&&!bi(l[c][1]);if(v||f||h&&l[c][0]==s){var p=void 0;if(":"==l[c+1]&&l[c+2]||v){var w=void 0,b=void 0;if(v){var _=l[c][3].split(":");m=Si(_[0]),w=Si(_[1])}else w=Si((webix.isArray(l[c+2])?l[c+2][1]:l[c+2]).toUpperCase()),b=webix.isArray(l[c+2])?d+l[c+2][1]:l[c+2],c+=2;p=Pi(e,m[0],m[1],w[0],w[1],u,i,r),o+='<span class="webix_ssheet_highlight_color_'.concat(p||u,'">').concat(v?g:g+":"+b,"</span>")}else{if(l[c-1]&&":"==l[c-1][l[c-1].length-1]){o+=g;continue}p=Pi(e,m[0],m[1],m[0],m[1],u,i,r),o+='<span class="webix_ssheet_highlight_color_'.concat(p||u,'">').concat(g,"</span>")}p||(u+=7==u?-6:1)}else o+=g}else o=a(t);return r&&(e._highlightedCells=i),o}function Di(e){if(e._highlightedCells)for(var t in e._highlightedCells){var n=e._highlightedCells[t];Fi(e,n[0],n[1],n[2],!0)}e._highlightedCells={}}function qi(e,t){return e?(webix.isUndefined(t)&&(e=Wn(e)),(t?"'".concat(e,"'"):e)+"!"):""}function zi(e,t){return{start:Math.min(e,t),end:Math.max(e,t)}}function Pi(e,t,n,r,i,o,a,l){var s=zi(t,r),u=zi(n,i),c=[s.start,s.end,u.start,u.end].join(","),h=a[c];if(h)return h[2];a[c]=[s,u,o],l&&Fi(e,s,u,o)}function Fi(e,t,n,r,i){for(var o="webix_ssheet_highlight_background_".concat(r),a=t.start;a<=t.end;a++)for(var l=n.start;l<=n.end;l++)e.$$("cells")[i?"removeCellCss":"addCellCss"](a,l,o,!0)}function Ui(e){var t=e?"-".concat(e):"";return[{id:"common"+t},{id:"price"+t,example:"98.20"},{id:"int"+t,example:"2120.02"},{id:"percent"+t,example:"0.5"},{id:"date"+t,example:"45000"},{id:"string"+t,example:"012345"},{id:"custom"+t}]}webix.protoUI({name:"live-editor",$cssName:"texthighlight",$init:function(e){var t=this,n=this.getTopParentView();this.paramsPopup=webix.ui({view:"popup",width:350,maxHeight:300,body:{scroll:"auto",autoheight:!0,template:function(e){var t=$n[e.method]||"common";t=webix.i18n.spreadsheet.liveEditor[t]||t;for(var n='<p><span class = "webix_ssheet_method_name">'.concat(e.method,'</span><span class="webix_ssheet_method_category">').concat(t,"</span></p>"),r=e.params,i=0;i<r.length;i++){var o='<span class = "webix_ssheet_method_param_name">'.concat(r[i][0]+": ","</span>");n+="<p".concat(e.number==i?" class = 'webix_ssheet_method_param_active'":"",">").concat(o,'<span class="webix_ssheet_method_param_description">').concat(r[i][1],"</p>")}return n}}}),n._destroy_with_me.push(this.paramsPopup),e.suggest={width:350,height:200,view:"suggest-formula",css:"webix_ssheet_math_suggest",data:e.suggestData,template:function(e){return e.pos?e.id:e.value},body:{template:function(e){return 0==e.id.indexOf("$range_")?'<span class="webix_ssheet_left">'.concat(e.value,'</span><span class="webix_ssheet_range webix_ssheet_right">').concat(e.pos,"</span>"):e.value}},on:{onBeforeShow:function(){var e=this,t=this.getList(),r=t.find(function(e){return 0==e.id.indexOf("$range_")});r&&r.forEach(function(e){return t.remove(e.id)});var i=n.ranges.serialize(n.getActiveSheet()).map(function(e){return{id:"$range_"+e[0],value:e[0],pos:e[1],global:e[2]}}),o=i.filter(function(e){return!e.global});i.filter(function(e){return e.global}).forEach(function(e){o.find(function(t){return t.value==e.value})||o.push(e)}),o.forEach(function(e){return t.add(e)}),t.filter(function(t){return e.config.filter.apply(e,[t,e.getMasterValue()])}),t.sort("value","asc","string")}}},e.highlight=this.highlight,this._highlightedCells={},this.$view.className+=" webix_ssheet_formula",this.attachEvent("onKeyPress",function(e,r){if(delete t._update_range,13==e){if(new Date-(t._last_value_set||0)>300){var i=t.config.activeCell;t.showActiveSheet(!0),t.updateCellValue(i),t.getInputNode().blur()}webix.html.preventEvent(r)}else 27==e?(t.showActiveSheet(),webix.delay(function(){var e=n.getSelectedId(),r=t.getCellValue(e.row,e.column);t.getValue()==r?n.$$("cells").refresh(e.row):t.setValue(r),delete n.$handleSelection,webix.UIManager.setFocus(n.$$("cells"))})):e>=33&&e<=40&&t.showParamsPopup()}),this.attachEvent("onItemClick",function(){this.showParamsPopup()}),this.attachEvent("onAfterRender",function(){var e=this;webix.eventRemove(this.keydownEv),this.keydownEv=webix.event(this.getInputNode(),"keydown",function(t){e.endEdit(t)})})},showParamsPopup:function(){var e=this;webix.delay(function(){var t=e.paramsPopup,n=e.getValue();if("="==n[0])for(var r=0,i=0,o=e.getInputNode().selectionStart-1;o>0;o--)switch(n[o]){case",":i||r++;break;case")":i++;break;case"(":if(!i){var a=n.substring(0,o),l=a.substring(bi(a,!0));if(l){l=l.toUpperCase();var s=webix.i18n.spreadsheet.liveEditor["functions-syntax"][l];if(s&&s.length){var u=t.getBody();u.setValues({params:s,number:r,method:l});var c=webix.$$(e.config.suggest),h=void 0;if(c.isVisible()){var d=c.config;h={x:d.left,y:d.top+c.$height+10}}else h=Ri(e);t.show(h);var f=u.$view.querySelector(".webix_ssheet_method_param_active");if(f){var m=f.offsetTop+f.offsetHeight-u.$height;u.scrollTo(0,m>0?m:0)}e.focus()}else t.hide()}return}i--}t.hide()})},highlight:function(e){this.showParamsPopup();var t=this.getTopParentView();Di(t);var n=Mi(t,e,this._activeMath,!0);return t.$$("cells").refresh(),document.activeElement==this.getInputNode()&&this.paintValue(),n},showActiveSheet:function(e){var t=this.getTopParentView(),n=t._table;if(this._activeMath){if(this._activeMath!=t.getActiveSheet()){var r=this.config.activeCell;this.define({activeCell:null}),t.showSheet(this._activeMath),webix.delay(function(){n.select(r.row+(e?1:0),r.column)})}delete this._activeMath}else e&&webix.delay(function(){return n.moveSelection("down")})},endEdit:function(e){9==(e.which||e.keyCode)&&(webix.html.preventEvent(e),this.getInputNode().blur(),this.updateCellValue(),this.getTopParentView()._table.moveSelection(e.shiftKey?"left":"right"))},paintValue:function(){var e=this.getTopParentView();if(!this._activeMath||this._activeMath==e.getActiveSheet()){var t=this.config.activeCell,n=e._table.getItemNode(t);t&&n&&(n.innerHTML="<div>".concat(Mi(e,this.getValue()),"</div>"))}},updateCellValue:function(e){var t=this.getValue(),n=this.getTopParentView();(e=e||this.config.activeCell)?t!==n.getCellValue(e.row,e.column)&&(this.config.value=t,n.setCellValue(e.row,e.column,t),n.refresh()):this.setValue("");delete n.$handleSelection},$setValueHere:function(e){this.setValueHere(e)},setValueHere:function(e){this._last_value_set=new Date;var t=this.getValue();if(t&&"="===t.charAt(0)){var n=this.getInputNode().selectionStart,r=t.substring(0,n),i=t.substring(n);"("==r[r.length-1]&&(r=r.substring(0,r.length-1)),r=r.substring(0,bi(r,!0));var o=0==e.indexOf("$range_");o&&(e=e.substr(7)),r+=e+(o||"("==i[0]?"":"("),this.setValue(r+i),this.getInputNode().setSelectionRange(r.length,r.length)}},expectOperator:function(e){var t=this.getValue();if("="==t[0]){for(var n=e?t.length:this.getInputNode().selectionStart;" "==t[n-1];)n--;return t[n-1]&&t[n-1].match(/[+&\-/*=(:,]/)}},setRange:function(e,t){var n,r,i=this.getInputNode().selectionStart,o=this.getValue();t&&(t=this._update_range&&i==this._update_range.pos+this._update_range.len);var a=t?this._update_range.pos:i;n=o.substring(0,a)+e,r=o.substring(i),this._update_range={pos:a,len:e.length},this.setValue(n+r)},getCellValue:function(e,t){var n=this.getTopParentView(),r=n.getCellValue(e,t);"date"==Ii(n,e,t)&&"="!=r[0]&&(r=gi(n,e,t)(On(r)));return r}},webix.ui.texthighlight),webix.protoUI({name:"ssheet-separator",defaults:{css:"webix_ssheet_toolbar_spacer",template:" ",width:1,borderless:!0}},webix.ui.view),webix.protoUI({name:"sheets",defaults:{layout:"x",borderless:!0,css:"ssheet_list_sheets",select:!0,drag:"order",dragscroll:"x",scroll:!1}},webix.EditAbility,webix.ui.list),webix.protoUI({$cssName:"toggle",name:"ssheet-toggle",toggle:function(){var e=this.getValue();e&&e!=this.config.offValue?this.config.value=this.config.offValue||!1:this.config.value=this.config.onValue||!0;var t=this.getValue();this.$setValue(t),this.callEvent("onChange",[t,e,"user"])},$setValue:function(e){e==this.config.offValue?e=!1:e==this.config.onValue&&(e=!0),webix.ui.toggle.prototype.$setValue.call(this,e)},getValue:function(){var e=this.config,t=e.value;return t&&t!=e.offValue?e.onValue||!0:e.offValue||!1},defaults:{template:function(e,t){var n=!0===e.value||e.value==e.onValue?" webix_pressed":"",r=t.$renderInput(e,t);return"<div class='webix_el_box"+n+"' style='width:"+e.awidth+"px; height:"+e.aheight+"px'>"+r+"</div>"}}},webix.ui.toggle),webix.protoUI({name:"ssheet-toggle-silent",$cssName:"toggle",$allowsClear:!1,setValue:function(){this.blockEvent(),webix.ui.toggle.prototype.setValue.apply(this,arguments),this.unblockEvent()}},webix.ui.toggle),webix.protoUI({name:"ssheet-bar-title",defaults:{borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_subbar_title"}},webix.ui.template);var Li=[{id:"Arial",value:"Arial"},{id:"'Roboto', sans-serif",value:"Roboto"},{id:"'PT Sans', Tahoma",value:"PT Sans"},{id:"'Open Sans', sans-serif",value:"Open Sans"},{id:"Tahoma",value:"Tahoma"},{id:"Verdana",value:"Verdana"},{id:"Calibri, Tahoma",value:"Calibri"}];function Bi(){return[{id:"add-column"},{id:"del-column"},{id:"show-column"},{id:"hide-column"},{id:"resize-column"},{id:"format-column",submenu:Ui("column")}]}function Hi(){return[{id:"add-row"},{id:"del-row"},{id:"show-row"},{id:"hide-row"},{id:"resize-row"},{id:"format-row",submenu:Ui("row")}]}var ji={format:Ui(),"font-family":Li,column:Bi(),row:Hi(),clear:[{id:"clear-value"},{id:"clear-style"},{id:"clear-conditional-formats"},{id:"clear-dropdown-editors"},{id:"clear-filters"},{id:"clear-comments"},{$template:"Separator"},{id:"clear-all"}],validation:[{id:"add-cell-validation"},{id:"remove-cell-validation"},{id:"highlight-invalid-data"},{id:"remove-highlight-invalid-data"}],"vertical-align":[{id:"top",css:"webix_ssheet_icon ssi-top"},{id:"middle",css:"webix_ssheet_icon ssi-middle"},{id:"bottom",css:"webix_ssheet_icon ssi-bottom"}],"text-align":[{id:"left",css:"webix_ssheet_icon ssi-left"},{id:"center",css:"webix_ssheet_icon ssi-center"},{id:"right",css:"webix_ssheet_icon ssi-right"}],"font-size":[{id:"8px",value:"8"},{id:"9px",value:"9"},{id:"10px",value:"10"},{id:"11px",value:"11"},{id:"12px",value:"12"},{id:"14px",value:"14"},{id:"15px",value:"15"},{id:"16px",value:"16"},{id:"18px",value:"18"},{id:"20px",value:"20"},{id:"22px",value:"22"},{id:"24px",value:"24"},{id:"28px",value:"28"},{id:"36px",value:"36"}],borders:[{id:"no"},{id:"left"},{id:"top"},{id:"right"},{id:"bottom"},{id:"all"},{id:"outer"},{id:"top-bottom"}],image:[{id:"add-image-cell"},{id:"add-image-top"}],graph:[{id:"add-sparkline"},{id:"add-chart"}],controls:[{id:"add-checkbox"},{id:"add-radio"}]};function Wi(){return[{id:"sort-asc",menuOrder:0},{id:"create-filter",menuOrder:2},{id:"conditional-format",menuOrder:4},{id:"add-link",menuOrder:6},{id:"clear",submenu:ji.clear,menuOrder:8},{id:"find",menuOrder:10},{id:"sort-desc",menuOrder:1},{id:"add-range",menuOrder:3},{id:"lock-cell",menuOrder:5},{id:"add-dropdown",menuOrder:7},{id:"validation",submenu:ji.validation,menuOrder:9}]}var Xi=[{id:"file",submenu:[{id:"sheet",toolbarHeight:2,toolbarWidth:2,menuOrder:0,toolbarLabel:!0,view:"ssheet-button-icon-top",submenu:[{id:"new-sheet"},{id:"copy-sheet"},{id:"remove-sheet"},{id:"hide-sheet"}]},{id:"excel-import",menuOrder:1},{id:"print",menuOrder:3},{id:"excel-export",menuOrder:2},{id:"print-borders",menuOrder:4}]},{id:"undo-redo",submenu:[{id:"undo",toolbarWidth:2,toolbarLabel:!0,view:"ssheet-button"},{id:"redo",toolbarWidth:2,toolbarLabel:!0,view:"ssheet-button"}]},{id:"font",submenu:[{id:"font-family",toolbarWidth:4,submenu:ji["font-family"]},{id:"font-size",submenu:ji["font-size"]},{id:"borders",menu:!1,submenu:ji.borders},{id:"font-weight",toolbarWidth:1},{id:"font-style",toolbarWidth:1},{id:"underline",toolbarWidth:1},{id:"strike",toolbarWidth:1},{id:"background",menu:!1},{id:"color",menu:!1}]},{id:"align",submenu:[{id:"text-align",submenu:ji["text-align"],menuOrder:0},{id:"span",menuOrder:2},{id:"increase-indent",menuOrder:4},{id:"vertical-align",submenu:ji["vertical-align"],menuOrder:1},{id:"wrap",menuOrder:3},{id:"decrease-indent",menuOrder:5}]},{id:"number",submenu:[{id:"format",toolbarWidth:3,submenu:ji.format},{id:"increase-decimals"},{id:"decrease-decimals"}]},{id:"edit",submenu:Wi()},{id:"insert",submenu:[{id:"image",toolbarWidth:3,view:"ssheet-button",toolbarLabel:!0,submenu:ji.image},{id:"add-comment",toolbarWidth:3,view:"ssheet-button",toolbarLabel:!0},{id:"graph",toolbarWidth:3,view:"ssheet-button",toolbarLabel:!0,submenu:ji.graph},{id:"controls",toolbarWidth:3,view:"ssheet-button",toolbarLabel:!0,submenu:ji.controls}]},{id:"view",submenu:[{id:"row",submenu:ji.row,menuOrder:0},{id:"hide-gridlines",menuOrder:2},{id:"freeze-rows",menuOrder:4},{id:"show-formulas",menuOrder:6},{id:"column",submenu:ji.column,menuOrder:1},{id:"hide-headers",menuOrder:3},{id:"freeze-columns",menuOrder:5}]}],Ki=[{id:"file",submenu:[{id:"excel-export"},{id:"print"},{id:"print-borders"}]},{id:"view",submenu:[{id:"hide-gridlines"},{id:"hide-headers"},{id:"show-formulas"}]},{id:"other",submenu:[{id:"find-readonly"}]}],Yi={"font-weight":"bold","font-style":"italic",underline:"underline",strike:"strike"},Gi={borders:!0,align:!0};function Qi(e,t){Gi[t]&&(e="".concat(t,"-").concat(e)),"format-row"!==t&&"format-column"!==t||(e="format-".concat(e.split("-")[0]));var n=webix.i18n.spreadsheet;return n.tooltips[e]||n.actions[e]||n.labels[e]||e}function Zi(e,t){return e.map(function(e){return e.tooltip=Qi(e.id,t),e.value||(e.value=e.tooltip),e.submenu&&(e.submenu=Zi(e.submenu,e.id)),e})}function Ji(e,t){var n=e._formats.formatHelpers[t.id]?e._formats.formatHelpers[t.id].getFormat:"",r={css:""},i=n&&t.example?n(t.example,r):"";return t.value+(n?"<span class='webix_ssheet_right"+(r.css?" "+r.css:"")+"'>"+i+"</span>":"")}var eo=function(e){return{view:"ssheet-toggle",width:e.width||er.width,id:e.name,name:e.name,label:e.label,css:e.css||"",onValue:Yi[e.name],offValue:"normal",tooltip:Qi(e.name)}},to=function(e){return{view:"ssheet-color",css:e.css,name:e.name,width:e.width||er.width+24,title:"<span class='webix_ssheet_button_icon webix_ssheet_color_button_icon webix_ssheet_icon ssi-"+e.name+"' ></span>",tooltip:Qi(e.name)}},no=function(e){return{view:"ssheet-toggle-silent",width:er.width,id:e.name,name:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+(e.icon||e.name)+"'></span>",tooltip:Qi(e.name)}},ro=function(e){var t=webix.copy(e);return webix.extend(t,{view:"button",width:er.width,id:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+(e.icon||e.name)+"'></span>",css:"",tooltip:Qi(e.name)}),e.onValue&&webix.extend(t,{view:"ssheet-toggle",onValue:e.onValue,offValue:e.offValue},!0),t},io=function(e){return webix.extend(e,{view:"richselect",id:e.name,value:tr[e.name],suggest:{template:function(e){return e.value},css:"webix_ssheet_suggest",padding:0,data:Zi(ji[e.name])}}),e.tooltip=Qi(e.name),e.popupWidth&&(e.suggest.fitMaster=!1,e.suggest.width=e.popupWidth),e.popupTemplate&&(e.suggest.body={template:e.popupTemplate}),e.popupEvents&&(e.suggest.body=e.suggest.body||{},e.suggest.body.on=e.popupEvents),e},oo=function(){return{view:"ssheet-separator"}},ao=function(e){var t=e.title;return 0===t.indexOf("$")&&(t=""),{template:t=webix.i18n.spreadsheet.labels[e.title]||t,view:"ssheet-bar-title",height:er.titleHeight}},lo=function(e){return{view:"ssheet-borders",width:e.width||er.width+24,data:Zi(ji[e.name],e.name),id:e.name,name:e.name,tooltip:Qi(e.name)}},so=function(e){return{view:"ssheet-align",value:tr[e.name],width:e.width||er.width+24,data:Zi(ji[e.name],e.name),name:e.name,tooltip:Qi(e.name)}},uo={"font-family":function(){return io({name:"font-family",width:100,view:"combo"})},"font-size":function(){return io({name:"font-size",width:70,view:"text",icon:"wxi-menu-down",css:"webix_ssheet_text",on:{onItemClick:function(){var e=webix.$$(this.config.suggest);e.isVisible()||e.show(this.getInputNode())}}})},"font-weight":function(){return eo({name:"font-weight",label:"B",css:"webix_ssheet_bold"})},"font-style":function(){return eo({name:"font-style",label:"I",css:"webix_ssheet_italic"})},underline:function(){return eo({name:"underline",label:"U",css:"webix_ssheet_underline"})},strike:function(){return eo({name:"strike",label:"S",css:"webix_ssheet_strike"})},color:function(){return to({name:"color",icon:"font",css:"webix_ssheet_color"})},background:function(){return to({name:"background",icon:"paint-brush",css:"webix_ssheet_background",width:70})},borders:function(){return lo({name:"borders"})},"text-align":function(){return so({name:"text-align",css:"webix_ssheet_align"})},"vertical-align":function(){return so({name:"vertical-align",css:"webix_ssheet_align"})},wrap:function(){return ro({name:"wrap",onValue:"wrap",offValue:"nowrap"})},format:function(e){return io({name:"format",width:106,popupWidth:180,popupTemplate:function(t){return Ji(e,t)},popupEvents:{onItemClick:function(e){"custom"==e&&this.getTopParentView().callEvent("onCommand",[{id:e}])}}})},column:function(e){var t=Zi(ji.column);return{name:"column",view:"ssheet-button",icon:"column",arrow:!0,area:!0,width:58,options:e.resizeCell?t:t.filter(function(e){return"resize"!==e.id})}},row:function(e){var t=Zi(ji.row);return{name:"row",view:"ssheet-button",icon:"row",arrow:!0,area:!0,width:58,options:e.resizeCell?t:t.filter(function(e){return"resize"!==e.id})}},clear:function(){return{name:"clear",view:"ssheet-button",icon:"clear-styles",arrow:!0,area:!0,width:58,options:Zi(ji.clear)}},validation:function(){return{name:"validation",view:"ssheet-button",icon:"validation",arrow:!0,area:!0,width:58,options:Zi(ji.validation)}},image:function(){return{name:"image",view:"ssheet-button",icon:"add-image",arrow:!0,options:Zi(ji.image)}},graph:function(){return{name:"graph",view:"ssheet-button",icon:"add-sparkline",arrow:!0,options:Zi(ji.graph)}},controls:function(){return{name:"controls",view:"ssheet-button",icon:"add-control",arrow:!0,options:Zi(ji.controls)}},comment:function(){return{name:"comment",view:"ssheet-button",icon:"comments",arrow:!0,area:!0,width:55}},"create-filter":function(){return no({name:"create-filter"})},"hide-gridlines":function(){return no({name:"hide-gridlines"})},"hide-headers":function(){return no({name:"hide-headers"})},"show-formulas":function(){return no({name:"show-formulas"})},"print-borders":function(){return no({name:"print-borders",icon:"borders-no"})},"find-readonly":function(){return ro({name:"find-readonly",icon:"find"})}};function co(e){return-1!==e.indexOf("-row")||-1!==e.indexOf("-column")}function ho(e){if(co(e.id)){var t=e.id.split("-");e.id=t[0],e.group||(e.group=t[1]),"show"===e.id&&(e.neighbors=!0)}}function fo(e,t){if(!e)return"";t&&"format"!==t&&(e="".concat(t,"-").concat(e)),"format"==t&&co(e)&&(e="format-".concat(e.split("-")[0]));var n=webix.i18n.spreadsheet;return n.menus[e]||n.actions[e]||n.labels[e]||e}function mo(e,t){for(var n=[],r=0;r<t.length;r++){var i=t[r];if("object"==yn(i))n.push(i);else{var o=uo[i]?uo[i](e):ro({name:i});n.push(o)}}return n}function go(e,t,n){return{rows:[{padding:2,cols:[{margin:2,cols:mo(e,n)}]},ao({title:t})]}}function vo(e){return{view:"ssheet-suggest",css:"webix_ssheet_suggest",autowidth:!0,template:function(e){var t="";return e.icon&&(t+="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.icon+"'></span> "),t+=e.value||fo(e.id)},data:e,on:{onMenuItemClick:function(e){var t=this.config.master;if(t){var n=webix.copy(this.getMenuItem(e));if(!n.submenu){ho(n);var r=[n],i=webix.$$(t).getTopParentView();if(webix.$$(t).config.area){var o=i.$$("cells").getSelectArea();o&&(r=r.concat([o.start,o.end]))}i.callEvent("onCommand",r)}}}}}}function po(e,t,n){n=n?e._mData.getPage(n):e._mPage;var r=[];return[n.serialize(t).map(function(e){e[2].$locked&&r.push([e[0]+1,e[1]+1]);var t=e[2].value;return null===t&&(t=""),[++e[0],++e[1],t,e[2].style||"",e[2].type]}).filter(function(e){return e[2]||0===e[2]||e[3]}),r]}webix.protoUI({name:"ssheet-button",$cssName:"button",defaults:{width:40},$init:function(e){var t=e.arrow?" webix_ssheet_button_menu":"",n=e.label?"":" webix_ssheet_icon_only";if(this.$view.className+=" webix_ssheet_button"+t+n,e.label||e.icon){var r=e.icon||e.name,i=e.label||"";if(e.arrow)i+="<span class='webix_ssheet_button_icon webix_ssheet_icon_arrow webix_icon wxi-menu-down' style='right:"+webix.skin.$active.inputSpacing/2+"px;'></span>";e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+r+"'></span> "+i}e.options&&!e.popup&&(e.popup=vo(e.options)),void 0===e.tooltip&&(e.tooltip=Qi(e.name))}},webix.ui.button),webix.protoUI({name:"ssheet-button-icon-top",$cssName:"button",defaults:{width:70,height:70},$init:function(e){if(this.$view.className+=" ssheet_button_icon_top",e.label){var t=e.icon||e.name||"",n=e.label;e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+t+"'></span><br/>",e.label+="<span class='ssheet_button_icon_top_text'>"+n+"</span>",!1!==e.arrow&&(e.label+="<br/><span class='ssheet_button_icon_top_arrow webix_icon wxi-menu-down'></span>")}e.options&&!e.popup&&(e.popup=vo(e.options)),void 0===e.tooltip&&(e.tooltip=Qi(e.name))}},webix.ui.button),webix.protoUI({name:"multicheckbox",defaults:{padding:0,type:"clean",borderless:!0,elementsConfig:{labelWidth:0}},$init:function(e){e.rows=[{height:1e-6}],this.$ready.push(function(){this._initOnChange()})},_initOnChange:function(){this.attachEvent("onChange",function(e){var t=this.$eventSource.config.name;if(this.blockEvent(),"$all"==t){for(var n in this.elements)this.elements[n].setValue(e);e||this._getCheckboxes()[0].setValue(1)}else{var r=this.getValue(!0);if(webix.isArray(r)&&(!r.length||!rr(r,function(e){return!e.$hiddenSheet})))rr(this._getCheckboxes(),function(e){return!e.config.$hiddenSheet}).setValue(1);this.elements.$all.setValue(!0===this.getValue(!0)?1:0)}this.unblockEvent()})},setValue:function(e){if(this.elements={},this._count=e.length,e.length>1){var t=[],n=[];e.forEach(function(e){var t='<span class="webix_icon wxi-eye'.concat(e.hidden?"-slash":"",'"></span>');n.push({view:"checkbox",labelRight:t+e.name,name:e.name,value:e.active,$hiddenSheet:e.hidden})});var r=n.length*webix.skin.$active.inputHeight,i=r>400;t.push({view:"scrollview",body:{rows:n},scroll:i,height:i?400:r}),t.push({template:"<div class='ss_sep_line'></div>",height:10}),t.push({view:"checkbox",labelRight:webix.i18n.spreadsheet.labels["export-all-sheets"],name:"$all",value:0}),webix.ui(t,this)}else this.getChildViews().length>1&&webix.ui([{height:1e-6}],this)},getValue:function(e){for(var t=this._getCheckboxes(),n=[],r=0;r<t.length;r++)if(t[r].getValue()){var i=t[r].config;n.push(e?i:i.name)}return n.length==this._count||n},_getCheckboxes:function(){var e=this.queryView("scrollview");return e?e.getBody().getChildViews():[]}},webix.ui.form),webix.protoUI({name:"formlist",defaults:{paddingY:5,height:120},$init:function(e){var t=this;e.cols=[{css:"webix_inp_label",template:e.label,width:e.labelWidth,borderless:!0},{view:"list",data:e.data,css:e.css,template:e.template,select:!0,scroll:!1,borderless:!0,on:{onSelectChange:function(){t.getParentView().callEvent("onChange",[])}}}]},setValue:function(e){this.getChildViews()[1].select(e)},getValue:function(){return this.getChildViews()[1].getSelectedId()},refresh:function(){this.getChildViews()[1].refresh()},focus:function(){}},webix.ui.layout),webix.protoUI({name:"ssheet-ui",defaults:{move:!0,css:"webix_shadow_none webix_ssheet_ui",head:!1,resize:!0,toFront:!0,minWidth:50,minHeight:200,escHide:!1,autofit:!1},$init:function(){this.$view.setAttribute("webixignore","1"),this.$ready.push(function(){webix.UIManager.addHotKey("delete",webix.bind(this._removeView,this)),webix.UIManager.addHotKey("backspace",webix.bind(this._removeView,this)),this.getMenu()}),this.attachEvent("onDestruct",function(){webix.eventRemove(this._clickEv),this._menu.destructor()})},move_setter:function(e){return e&&webix.DragControl.addDrag(this.$view,this),e},$dragPos:function(e,t){return this.callEvent("onViewMove",[e,t]),e},$dragCreate:function(e,t){var n=t.target;if(n.getAttribute&&!n.getAttribute("webix_disable_drag")&&!n.getAttribute("webixignore")){this.getMenu().hide();var r=webix.html.offset(e),i=webix.html.pos(t),o=webix.html.offset(e.parentNode),a=webix.$$(this.config.master).getScrollState();return webix.DragControl.top=r.y-i.y-o.y,webix.DragControl.left=r.x-i.x-o.x+a.x,webix.toNode(this.$view)}},$dragDestroy:function(e,t){var n=this.config.left=parseInt(t.style.left,10),r=this.config.top=parseInt(t.style.top,10);webix.DragControl.top=webix.DragControl.left=0,this.callEvent("onViewMoveEnd",[n,r])},getMenu:function(){var e=this,t=webix.i18n.spreadsheet.labels;if(!this._menu){var n=[{value:t["export-view"],submenu:[{id:"pdf",value:t["export-view-pdf"]},{id:"png",value:t["export-view-png"]},{id:"excel",value:t["export-view-excel"]}]}];webix.$$(this.config.master).getTopParentView().config.readonly||(n=[{id:"edit",value:t["edit-view"]}].concat(_n(n),[{id:"del",value:t["remove-view"]}])),this._menu=webix.ui({view:"contextmenu",submenuConfig:{externalUI:this.config.id},data:n,on:{onMenuItemClick:function(t){return e._menuActions(t)},onBeforeShow:function(){return e._toggleExcel()}}});var r=webix.html.create("span",{class:"webix_ssheet_view_menu webix_icon wxi-dots"});this._clickEv=webix.event(r,"click",function(){e._menu.isVisible()?e._menu.hide():e._menu.show(r)}),this.$view.firstChild.appendChild(r)}return this._menu},_menuActions:function(e){switch(e){case"del":this.callEvent("onViewRemove",[]);break;case"edit":this.callEvent("onViewEdit",[]);break;case"pdf":webix.toPDF(this.getBody(),{display:"image"});break;case"png":webix.toPNG(this.getBody());break;case"excel":webix.toExcel(this.getBody(),{header:!1})}},_toggleExcel:function(){var e=this.getBody();e.data&&e.data.pull?this._menu.showMenuItem("excel"):this._menu.hideMenuItem("excel")},_removeView:function(e){e&&e.getTopParentView()==this&&this.callEvent("onViewRemove",[])}},webix.ui.window),webix.protoUI({name:"ssheet-series",$init:function(e){var t=this;this.hidden={},e.rows=[{view:"scrollview",borderless:!0,body:{view:"accordion",css:"webix_ssheet_accordion",margin:webix.skin.$active.layoutMargin.form,multi:!0,type:"clean",rows:[this.getSectionConfig()]},on:{onAfterScroll:function(){webix.callEvent("onClick",[])}}},{view:"button",label:webix.i18n.spreadsheet.labels["add-line"],click:function(){t.addSection()}}]},getSectionConfig:function(e){var t=this,n=this,r=webix.i18n.spreadsheet.labels,i="<span class='webix_icon webix_ssheet_series_icon wxi-trash'></span>",o=webix.skin.$active.dataPadding-2;return{view:"accordionitem",header:"".concat(r["chart-item"]," ").concat(e?e+1:1," ").concat(i),body:{view:"form",padding:o,elementsConfig:{labelWidth:180},on:{onChange:function(){t.callEvent("onChange",[])}},elements:[{view:"text",label:r["chart-range"],name:"range",range:!0,on:{onChange:function(e,t){var r=e.toUpperCase();e!=r&&(this.blockEvent(),this.setValue(r),this.unblockEvent()),n.callEvent("onRangeChange",[r,t])}}},{view:"ssheet-colorpicker",label:r["chart-series-color"],name:"color",hidden:this.hidden.color},{view:"checkbox",label:r["chart-tooltip"],name:"tooltip"},{view:"checkbox",label:r["chart-label"],name:"label",hidden:this.hidden.label},{view:"richselect",label:r["chart-markers"],value:"square",name:"marker",hidden:this.hidden.marker,suggest:{view:"ssheet-form-suggest",data:[{id:"square",value:r["chart-markers-square"]},{id:"triangle",value:r["chart-markers-triangle"]},{id:"diamond",value:r["chart-markers-diamond"]},{id:"round",value:r["chart-markers-round"]}]}}]},onClick:{"wxi-trash":function(){var e=this.getParentView();e.removeView(this);for(var t=e.getChildViews(),o=0;o<t.length;o++)t[o].define({header:"".concat(r["chart-item"]," ").concat(o+1," ").concat(i)}),t[o].refresh();return n.callEvent("onChange",[]),!1}}}},addSection:function(){var e=this.getLayout(),t=e.getChildViews().length,n=e.addView(this.getSectionConfig(t));webix.$$(n).queryView({name:"range"}).focus()},setValue:function(e){e=e||[];var t=this.getLayout().getChildViews(),n=t.length;if(n>e.length)for(var r=n;r>e.length;r--)this.getLayout().removeView(t[r-1]);else if(e.length>n)for(var i=e.length;i>n;i--)this.addSection();for(var o=0;o<t.length;o++){var a=t[o].getChildViews()[0],l=a.queryView({name:"range"});l.blockEvent(),a.setValues(e[o]),l.unblockEvent()}},setSubValue:function(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()},getLayout:function(){return this.queryView("scrollview").getBody()},hideSubviews:function(e,t){this.hidden[e]=!t,this.queryView({name:e},"all").forEach(function(e){t?e.show():e.hide()})},getValue:function(){var e=[];return this.getLayout().getChildViews().forEach(function(t){e.push(t.getChildViews()[0].getValues())}),e}},webix.ui.layout),webix.protoUI({name:"ssheet-toolbar-scrollview",$getSize:function(){var e=webix.ui.scrollview.prototype.$getSize.apply(this,arguments),t=this.getBody().$getSize(0,0),n=0;return this.config.scroll?n=webix.env.scrollSize:this.$view.style["overflow-x"]="hidden",e[2]=e[3]=t[2]+n,e},$setSize:function(e,t){var n=this,r=this.getBody().$getSize(0,0),i=this.config.scroll,o=e<r[0]&&"x";if(o!=i)return this.define({scroll:o}),webix.delay(function(){n.resize()});webix.ui.scrollview.prototype.$setSize.apply(this,[e,t])}},webix.ui.scrollview);var wo=Object.freeze({__proto__:null,getSheetData:po,init:function(e){e.attachEvent("onDataParse",function(t){return function(e,t){var n=t.table||{frozenColumns:0,frozenRows:0};e._frozenColumns=e._frozenRows=0,n&&(webix.isUndefined(n.frozenColumns)||e.freezeColumns(n.frozenColumns),webix.isUndefined(n.frozenRows)||e.freezeRows(n.frozenRows));t.sizes&&e.$$("cells").define("fixedRowHeight",!1)}(e,t)}),e.attachEvent("onDataSerialize",function(t,n){return function(e,t,n){var r=!n||!1!==n.math,i=e.$$("cells"),o=i.getState(),a=o.ids.concat(o.hidden);a.splice(a.indexOf("rowId"),1);var l=po(e,r),s=bn(l,2);t.data=s[0],t.locked=s[1],webix.extend(t.table,{frozenColumns:e._frozenColumns||0,frozenRows:e._frozenRows||0})}(e,t,n)}),e.attachEvent("onUndo",function(t,n,r,i){"value"==t&&function(e,t,n,r){e.setCellValue(t,n,r)}(e,n,r,i)})}}),bo=["rename-sheet","remove-sheet","copy-sheet","hide-sheet"],_o={"remove-sheet":function(e){return function(e){e.confirm({text:webix.i18n.spreadsheet.labels["sheet-remove-confirm"]}).then(function(){No(e,e._activeSheet)})}(e)},"rename-sheet":function(e){return Oo(e)},"new-sheet":function(e){return ko(e)},"copy-sheet":function(e){return function(e){ko(e,e.serialize())}(e)},"hide-sheet":function(e){return Ao(e,e._activeSheet,"hidden")}};function xo(e){e.attachEvent("onComponentInit",function(){return function(e){zo(e),e.attachEvent("onAfterSheetShow",function(t){return function(e,t){e.$$("sheets")&&(e.$$("sheets").select(t),e.$$("sheets").showItem(t))}(e,t)}),e.attachEvent("onCommand",function(e){_o[e.id]&&_o[e.id](this)}),e.$$("sheets")&&(e.$$("sheets").data.attachEvent("onStoreUpdated",function(){Ro(e),Eo(e)}),e.$$("sheets").attachEvent("onAfterRender",webix.once(function(){webix.delay(function(){return Ro(e)})})),e.$$("sheets").attachEvent("onAfterScroll",function(){return Eo(e)}),e.$$("sheets").attachEvent("onAfterDrop",function(t){return function(e,t,n){for(var r in e._sheets)if(e._sheets[r].name==t){var i=e._sheets.splice(r,1);e._sheets.splice(n,0,i[0]);break}}(e,t.start,t.index)}),e.$$("sheets").attachEvent("onAfterEditStop",function(t){return Mo(e,t.old,t.value)}))}(e)})}var yo=[.5,.75,.9,1,1.1,1.25,1.5,1.75,2,3,4];function Co(e){var t=webix.i18n.spreadsheet.tooltips,n=e.config.readonly,r=e.config.sheetTabWidth,i="auto"==r?e.defaults.sheetTabWidth:r,o={view:"toolbar",id:"bottom-toolbar",css:"webix_ssheet_bottom_toolbar webix_layout_toolbar",paddingY:0,height:34,elements:[{hidden:n,padding:{top:2,bottom:2,left:4},cols:[{view:"icon",icon:"wxi-plus",width:30,id:"add-sheet",click:function(){return ko(e)},tooltip:t["add-sheet"]},{view:"icon",icon:"wxi-dots",width:30,id:"show-sheet",popup:$o(e),tooltip:t["show-sheet"]}]},{id:"sheets",view:"sheets",maxWidth:5*i,minWidth:i,editable:!n,editaction:"dblclick",editor:"text",editValue:"value",type:{width:r,height:32,template:function(e){return"<div style='"+(n?"width: 100%;padding-right:9px;":"width:calc(100% - 20px);")+"'>"+e.value+"</div>"+(n?"":"<div class='webix_input_icon wxi-menu-down webix_ssheet_sheet_arrow'></div>")},css:"ssheet_order_sheets"},onClick:{webix_ssheet_sheet_arrow:function(t,n){!function(e,t,n){e.$sheetMenu||(e.$sheetMenu=webix.ui(function(e){for(var t=[],n=0;n<bo.length;n++)t.push({id:bo[n],value:webix.i18n.spreadsheet.menus[bo[n]]||bo[n]});var r={view:"ssheet-suggest",data:t};return e.callEvent("onViewInit",["sheet-menu",r]),r}(e)),e._destroy_with_me.push(e.$sheetMenu),e.$sheetMenu.attachEvent("onItemClick",function(t){return function(e,t){e.$sheetMenu.data.getMark(t,"webix_disabled")||(_o[t]?_o[t](e):e.callEvent("onCommand",[{id:t}]))}(e,t)}));var r=1==e.$$("sheets").count();e.$sheetMenu.getItem("remove-sheet")&&e.$sheetMenu[r?"disableItem":"enableItem"]("remove-sheet");e.$sheetMenu.getItem("hide-sheet")&&e.$sheetMenu[r?"disableItem":"enableItem"]("hide-sheet");e.callEvent("onBeforeSheetMenu",[n])&&e.$sheetMenu.show(t)}(e,t,n)}},on:{onItemClick:function(t){t!=e._activeSheet&&e.showSheet(t)}}},{view:"button",width:34,id:"prev-sheet",disabled:!0,hidden:!0,label:"<span class='webix_icon wxi-menu-left'></span>",batch:"pager",click:function(){So(e,-1)}},{view:"button",width:34,id:"next-sheet",hidden:!0,label:"<span class='webix_icon wxi-menu-right'></span>",batch:"pager",click:function(){So(e,1)}},{gravity:1e-6},{view:"ssheet-zoom",numbers:yo,value:1,width:108,tooltip:t.scale,id:"zoom",on:{onChange:function(t,n,r){"user"==r&&e.zoom(t)}}}]};return e.callEvent("onViewInit",["bottom-toolbar",o]),o}function So(e,t){var n=e.$$("sheets"),r=e.config.sheetTabWidth;"auto"==r&&(r=e.defaults.sheetTabWidth),n.scrollTo(n.getScrollState().x+t*r,0)}function $o(e){return{view:"popup",css:"webix_ssheet_suggest",width:125,body:{view:"list",select:!0,css:"webix_ssheet_show_list",template:"<span class='webix_icon wxi-#icon#'></span>#id#",on:{onAfterSelect:function(t){Ao(e,t,"visible"),e.showSheet(t),this.getParentView().hide()}},maxHeight:200,autoheight:!0},on:{onShow:function(){this.getBody().showItem(e.getActiveSheet())},onBeforeShow:function(){var t=e._sheets.filter(function(e){return"veryHidden"!=e.state}).map(function(e){return{id:e.name,icon:"hidden"==e.state?"eye-slash":"eye"}}),n=this.getBody();n.clearAll(),n.parse(t),n.select(e.getActiveSheet())}}}}function Eo(e){var t=e.$$("sheets"),n=t.getScrollState().x;if(0==n)e.$$("prev-sheet").disable();else if(e.$$("prev-sheet").enable(),t.$view.scrollWidth-n==t.$width)return e.$$("next-sheet").disable();e.$$("next-sheet").enable()}function Ro(e){var t=e.$$("sheets");e.$$("bottom-toolbar").showBatch("pager",t.$width!=t.$view.scrollWidth)}function Ao(e,t,n){var r=Uo(e,t);if(n!=r.state&&("visible"!=n||r.state)){if("visible"!=n){var i=Io(e);if(1==i.length&&i[0]===r)return;t==e._activeSheet&&Vo(e,t)}r.state=n,To(e),e.callEvent("onSheetStateChange",[t,n])}}function To(e){var t=e.$$("sheets");t&&t.filter(function(t){var n=Uo(e,t.id).state;return"hidden"!=n&&"veryHidden"!=n})}function ko(e,t,n,r){var i,o;return i=ir(e._sheets,function(t){return t.name==e._activeSheet}),o=i>-1?i+1:e._sheets.length,n&&!rr(e._sheets,function(e){return e.name==n})||(n=function(e){var t=e._sheets.length+1;for(;Uo(e,webix.i18n.spreadsheet.labels.sheet+t);)t++;var n=webix.i18n.spreadsheet.labels.sheet+t;return n}(e)),t=t||{data:[]},e._sheets.splice(o,0,{name:n,content:t}),e.$$("sheets")&&e.$$("sheets").add({id:n,value:n},o),e._mData.addPage(n),Do(e,n,t,e.config.prepareData),!1!==r&&e.showSheet(n),e.callEvent("onSheetAdd",[n]),n}function Oo(e,t){t||(t=e._activeSheet),e.$$("sheets").edit(t)}function Io(e){return e._sheets.filter(function(e){return"hidden"!=e.state&&"veryHidden"!=e.state})}function Vo(e,t){var n=Io(e),r=ir(n,function(e){return e.name==t}),i=r-1;n[i]||(i=0),n.splice(r,1),e.showSheet(n[i].name)}function No(e,t){if(e._sheets.length>1){var n=Io(e);if(1==n.length&&n[0]===Uo(e,t))return;e._activeSheet==t&&Vo(e,t);var r=ir(e._sheets,function(e){return e.name==t});e._sheets.splice(r,1),e._mData.removePage(t),e.$$("sheets")&&(e.$$("sheets").remove(t),e.$$("sheets").refresh()),e.callEvent("onSheetRemove",[t])}}function Mo(e,t,n){if(t!=n){for(var r=1;!n||Uo(e,n);)n=webix.i18n.spreadsheet.labels.sheet+r,r++;n=n.replace(/[*?:[\]\\/]/g,"").substring(0,31);var i=Uo(e,t),o=e.$$("sheets");if(i.name=n,e._activeSheet==t&&(e._activeSheet=n),o)o.getItem(t).value=n,o.data.changeId(t,n),o.refresh(n);e._mData.renamePage(t,n),e.callEvent("onSheetRename",[t,n])}}function Do(e,t,n,r){var i=n.ranges;if(r&&i){var o=ir(i,function(e){return"_XLNM._FILTERDATABASE"==e[0]});if(-1!=o){n.filters||(n.filters=[]);var a=i[o][1];if(a){for(var l=bn(jn(a),4),s=l[0],u=l[1],c=l[2],h=l[3],d=u;d<=h;d++)n.filters.push([s,d,{options:Xn(s+1,d,c,d),lastRow:c}]);i.splice(o,1)}}}e.ranges.parse(i,t),webix.extend(n,{styles:[],formats:[],editors:[]});var f=e._mData.getPage(t),m=n.data.map(function(i){var o=webix.isUndefined(i[2])||null===i[2];if(r){if(o)i[2]="";else{var a=/^=link\(/i;"string"==typeof i[2]&&a.test(i[2])&&(i[2]=i[2].replace(a,"=HYPERLINK("))}var l=Ai(e,n,i);i[2]=l.value,i[3]=i[3]||"",i[4]=l.type,qo(i,n)}else if(o)throw"unsupported value in ".concat(Wn(t),"!").concat(Fn[i[0]]).concat(i[1]);return[i[0]-1,i[1]-1,{value:i[2],type:i[4],style:i[3],$format:di(e,{fmt:vi(e,n,i)},"string")?1:0}]});f.parse(m,!0)}function qo(e,t,n){var r="date"==e[4];if(r||n){var i="string"==typeof e[2],o=n&&i&&/^=hyperlink\(/i.test(e[2]),a=e[3]?rr(t.styles,function(t){return t[0]==e[3]}):null,l=a?Ar(a[1]):{},s=r&&t.editors?rr(t.editors,function(t){return t[0]==e[0]&&t[1]==e[1]}):null;if(r&&(!a||!l.format)||o){var u={};o?(e[3]="wss_link"+(a?"_"+e[3]:""),u={color:"#0000ff",underline:"underline"}):i&&/^=time\(/i.test(e[2])?(e[3]="wss_load_time"+(a?"_"+e[3]:""),u.format=e[3]+"_fmt",t.formats.push([u.format,webix.i18n.spreadsheet.formats.timeFormat])):(e[3]="wss_load_date"+(a?"_"+e[3]:""),u.format="date"),r&&!s&&(t.editors||(t.editors=[]),t.editors.push([e[0],e[1],{editor:"excel_date"}])),rr(t.styles,function(t){return t[0]==e[3]})||t.styles.push([e[3],Rr({props:webix.extend(l,u,!0)})])}}}function zo(e,t,n){t||(t={data:[]}),t.sheets||(t=Po(t)),e._activeSheet="",e._sheets=t.sheets,e._mData=new tn({strict:e.config.strict}),t.sheets.forEach(function(t){e._mData.addPage(t.name)}),t.sheets.forEach(function(t){var r=t.content,i=t.name;Do(e,i,r,n)}),function(e,t){var n=e.$$("sheets");if(n){n.clearAll();var r=[];t.sheets.forEach(function(e){r.push({id:e.name,value:e.name})}),n.parse(r),To(e)}}(e,t),Fo(e,Io(e)[0].name)}function Po(e){return{sheets:[{name:webix.i18n.spreadsheet.labels.sheet+1,content:e}]}}function Fo(e,t){if(t!=e._activeSheet&&e.callEvent("onBeforeSheetShow",[t])){e._activeSheet&&(Uo(e,e._activeSheet).content=e.serialize()),e._activeSheet=t;var n=Uo(e,t).content;e._mPage=e._mData.getPage(t),Bo(e,n),e.callEvent("onAfterSheetShow",[t])}}function Uo(e,t){return rr(e._sheets,function(e){return e.name==t})}function Lo(e,t){return"hidden"!=(t=Uo(e,t)).state&&"veryHidden"!=t.state}function Bo(e,t){var n=bn(po(e),1),r=bn(or(n[0],t.spans,e.config.rowCount,e.config.columnCount,t.filters),2),i=r[0],o=r[1];i==e.config.rowCount&&o==e.config.columnCount||(e.config.rowCount=i,e.config.columnCount=o,e._resetTable()),Bn(o),e._loading_data=!0,e.callEvent("onReset",[]),e.callEvent("onDataParse",[t]),e._loading_data=!1,e._table.refresh(),e.config.bottombar&&e.$$("sheets").refresh()}function Ho(e,t,n){for(var r=[],i=e.$$("cells"),o=i.getState().order,a=i.data.order,l=n||e._zoom,s=i.config.columnWidth,u=i.config.rowHeight,c=1;c<o.length;c++){var h=Math.ceil(i.getColumnConfig(o[c]).width/l);h&&h!=s&&r.push([0,c,h])}for(var d=0;d<a.length;d++){var f=Math.ceil(i.getItem(a[d]).$height/l);f&&f!=u&&r.push([1*a[d],0,f])}t.sizes=r}function jo(e,t){var n=1;t.table&&t.table.zoom&&(n=t.table.zoom);for(var r=e.$$("cells"),i=r.config.columnWidth,o=r.config.rowHeight,a=1;a<=e.config.rowCount;a++){e.$$("cells").getItem(a).$height=o*n}var l=("contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20)*n,s=e.getColumn("rowId");s.width=40*n,s.header[0].height=l;for(var u=1;u<=e.config.columnCount;u++){var c=e.getColumn(u);c.header[0].height=l,c.width=i*n}if(t.sizes)for(var h=0;h<t.sizes.length;h++){var d=t.sizes[h];if(1*d[0]!=0){var f=e.$$("cells").getItem(d[0]);f&&(f.$height=d[2]*n)}else{var m=e.getColumn(d[1]);m&&(m.width=d[2]*n)}}e.refresh(!0)}function Wo(e,t){var n={table:{zoom:e._zoom}};Ho(e,n,t),jo(e,n)}function Xo(e,t,n){if(!e._loading_data){var r=gr(e,{row:t,column:n});if(r&&r.props.wrap){var i=e._table,o=i.getItem(t),a=o.$height||i.config.rowHeight;i.eachColumn(function(n,r){var o=gr(e,{row:t,column:n});if(o&&o.props&&"wrap"===o.props.wrap){var l,s=this.getText(t,n),u=r.width,c=i.getSpan(t,n);if(c){var h=i.getSpanNode({row:c[0],column:c[1]});u=h.offsetWidth,l=h.offsetHeight}(e.getCellEditor(t,n)||e.getCellFilter(t,n))&&(u+=20);var d=Sr(e,s,o.id,u).height;l&&(d=l>=d?0:d-l+a),a=Math.max(a,d)}}),o.$height=a}}}var Ko=Object.freeze({__proto__:null,init:function(e){if(e.config.resizeCell){var t=e.$$("cells");t.define("resizeRow",{headerOnly:!0,size:10}),t.define("resizeColumn",{headerOnly:!0,size:10}),t.define("fixedRowHeight",!1),t.attachEvent("onRowResize",function(t){e.$$("cells").refreshSelectArea(),qn(e,"sizes",{row:t,column:0,size:e.$$("cells").getItem(t).$height,page:e.getActiveSheet()})}),t.attachEvent("onColumnResize",function(t){e.$$("cells").refreshSelectArea(),qn(e,"sizes",{row:0,column:t,size:e.getColumn(t).width,page:e.getActiveSheet()})}),e.attachEvent("onUndo",function(t,n,r,i){"c-resize"!=t&&"r-resize"!=t||function(e,t,n,r){var i=e.$$("cells");t?(i.getItem(t).$height=r,qn(e,"sizes",{row:t,column:0,size:r,page:e.getActiveSheet()})):i.setColumnWidth(n,r);i.refreshSelectArea()}(e,n,r,i)})}e.attachEvent("onDataParse",function(t){jo(e,t)}),e.attachEvent("onDataSerialize",function(t){Ho(e,t)}),e.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function(e,t,n,r,i){var o,a=r.sizes,l=[];if(n){for(o=a.length-1;o>=0;o--){var s=bn(a[o],3),u=s[0],c=s[1],h=s[2];if(u&&"row"==t&&u>=i.row){if(n<0&&u<i.row-n)continue;l.push([1*u+n,c,h])}else if(c&&"column"==t&&c>=i.column){if(n<0&&c<i.column-n)continue;l.push([u,1*c+n,h])}else l.push(a[o])}if(n>0)if("column"==t)for(var d=function(e){var t=rr(a,function(t){return t[1]==i.column+e});t&&l.push([0,i.column+e,t[2]])},f=0;f<n;f++)d(f);else for(var m=function(e){var t=rr(a,function(t){return t[0]==i.row+e});t&&l.push([i.row+e,0,t[2]])},g=0;g<n;g++)m(g);r.sizes=l}}(0,t.name,t.inc,t.data,t.start)}),e.attachEvent("onBeforeStyleChange",function(t,n,r,i){!i||"wrap"!==i.props.wrap||r&&r.props.wrap==i.props.wrap||delete e._table.getItem(t).$height}),e.attachEvent("onStyleChange",function(t,n){return Xo(e,t,n)}),e.attachEvent("onCellChange",function(t,n,r,i){i==e.getActiveSheet()&&Xo(e,t,n)})},load:jo,zoomSizes:Wo});function Yo(e,t,n){var r=e.$$("cells").getSpan()[t];if(r)return r[n]}function Go(e,t){var n=[],r=e.$$("cells").getSpan();if(r){for(var i in r){var o=r[i];for(var a in o){var l=o[a];n.push([1*i,1*a,l[0],l[1]])}}t.spans=n}return t}function Qo(e,t,n,r,i,o){if(o=o||e.getActiveSheet(),!(n<2&&r<2)&&(i||e.callEvent("onBeforeSpan",[t.row,t.column,[n,r],o]))){if(o==e.getActiveSheet()){var a=e._mPage.getCell(t.row-1,t.column-1),l=a&&a.style||"",s=ta(e,t.row,t.column);s&&(l+=" "+s),e.$$("cells").addSpan(t.row,t.column,n,r,null,l)}else{var u=Uo(e,o);u&&(u.content.spans||(u.content.spans=[]),u.content.spans.push([t.row,t.column,r,n]))}!function(e,t,n,r,i){for(var o=1*t.row,a=1*t.column,l=!e.getCellValue(o,a,i),s=o;s<o+r;s++)for(var u=a;u<a+n;u++){var c=e.getCellValue(s,u,i);""===c||u==a&&s==o||(l&&(l=!1,e.setCellValue(o,a,c,i)),e.setCellValue(s,u,"",i))}}(e,t,n,r,o),i||(e.callEvent("onAfterSpan",[t.row,t.column,[n,r],o]),qn(e,"spans",{page:o,row:t.row,column:t.column,x:n,y:r}))}}function Zo(e,t,n){var r,i,o,a=(n=n||e.getActiveSheet())==e.getActiveSheet();a?r=e.$$("cells").getSpan(t.row,t.column):(o=Uo(e,n))&&o.content.spans&&(i=ir(o.content.spans,function(e){return e[0]==t.row&&e[1]==t.column}),-1!=i&&(r=o.content.spans[i])),r&&e.callEvent("onBeforeSplit",[t.row,t.column,[r[2],r[3]],n])&&(a?e.$$("cells").removeSpan(t.row,t.column):o.content.spans.splice(i,1),e.callEvent("onAfterSplit",[t.row,t.column,[r[2],r[3]],n]),qn(e,"spans",{row:t.row,column:t.column,x:0,y:0,page:n}))}function Jo(e){var t,n,r,i;r=i=0,t=n=1/0;for(var o=0;o<e.length;o++){var a=1*e[o].column,l=1*e[o].row;t=Math.min(a,t),r=Math.max(a,r),n=Math.min(l,n),i=Math.max(l,i)}return{cell:{row:n,column:t},x:r-t+1,y:i-n+1}}function ea(e,t,n,r,i){var o=Yo(e,t,n);o&&(i?-1==o[3].indexOf(r)&&(o[3]+=" "+r):o[3]=o[3].replace(" "+r,""))}function ta(e,t,n){var r=[];return e.getCellEditor(t,n)&&r.push("ss_editor"),e.getCellFilter(t,n)&&r.push("ss_filter"),r.join(" ")}var na={"border-right":function(e,t,n,r){return r.end.column==t+n[0]-1},"border-bottom":function(e,t,n,r){return r.end.row==e+n[1]-1}};function ra(e,t,n,r,i,o,a){var l="row"==t.group?e[3]:e[2],s="row"==t.group?[1*e[0],1*e[0]+e[3]-1]:[1*e[1],1*e[1]+e[2]-1],u="row"==t.group?[n.row,r.row]:[n.column,r.column],c=u[1]-u[0]+1;u[0]=Math.max(u[0],s[0]),u[1]=Math.min(u[1],s[1]);var h=u[0]==s[0];if(u[0]<=u[1]){if("del"==t.id&&(c=-1*(u[1]-u[0]+1)),"del"==t.id&&h&&l>-1*c){var d=rr(o,function(t){return t[0]==e[0]&&t[1]==e[1]});d&&a.push(d)}h&&"add"==t.id||(e[2]="column"==t.group?e[2]+c:e[2],e[3]="row"==t.group?e[3]+c:e[3])}return e}function ia(e,t,n,r,i,o){var a=e._table.getSpan(n,r);if(t&&t.span){var l=t.span;n==1*l[0]+o.row&&r==1*l[1]+o.column&&(e._table.mapCells(n,r,l[3],l[2],function(t,n,r){(a=e._table.getSpan(n,r))&&Zo(e,{row:a[0],column:a[1]})},!0),Qo(e,{row:n,column:r},l[2],l[3]),1===i&&Zo(e,{row:t.row,column:t.col}))}else a&&Zo(e,{row:a[0],column:a[1]})}var oa=Object.freeze({__proto__:null,addSpan:Qo,adjustSpan:ra,getRange:Jo,init:function(e){e.attachEvent("onStyleChange",function(t,n,r){var i=Yo(e,t,n);if(i){var o=ta(e,t,n);i[3]=(r?r.id:"")+(o?" "+o:"")}}),e.attachEvent("onDataParse",function(t){!function(e,t){if(t.spans)for(var n=0;n<t.spans.length;n++){var r=t.spans[n];Qo(e,{row:r[0],column:r[1]},1*r[2],1*r[3],!0)}}(e,t)}),e.attachEvent("onDataSerialize",function(t){Go(e,t)}),e.attachEvent("onUndo",function(t,n,r,i,o){"span"!=t&&"split"!=t||("span"==t&&(o=!o),function(e,t,n,r,i){i?Zo(e,{row:t,column:n}):Qo(e,{row:t,column:n},r[0],r[1])}(e,n,r,i,o))}),e.attachEvent("onAction",function(t,n){if("before-grid-change"==t)!function(e,t,n,r,i){var o=r.spans;if(n)for(var a=o.length-1;a>=0;a--){var l=bn(o[a],2),s=l[0],u=l[1];n<0&&("row"==t&&s<=i.row-n-1?n=i.row-o[a][0]:"column"==t&&u<=i.column-n-1&&(n=i.column-o[a][1])),("row"==t&&s>=i.row||"column"==t&&u>=i.column)&&(o[a][0]="row"==t?1*s+n:s,o[a][1]="column"==t?1*u+n:u)}}(0,n.name,n.inc,n.data,n.start);else if("check-borders"==t)return function(e,t,n,r,i){var o=Yo(e,t,n);return!(!o||!na[i])&&na[i](t,n,o,r)}(e,n.row,n.column,n.area,n.mode)})},pasteSpan:ia,removeSpan:Zo,serialize:Go,setSpanCss:ea});function aa(e,t,n){var r=[],i={},o=e._activeSheet,a=function(e,t,n,r,i){var o=webix.html.create("div",{class:"webix_ssheet_print"});t.xCorrection=1,t.header=t.header||!1,t.trim=!!webix.isUndefined(t.trim)||t.trim,t.sheetnames=!!webix.isUndefined(t.sheetnames)||t.sheetnames;var a=e.$index,l=la(t),s=t.sheets,u=t.data;s&&"current"!=u&&"selection"!=u?"string"==typeof s?s=[s]:!0!==s&&"all"!=u||(s=e._sheets.map(function(e){return e.name})):s=[n];return s=s.filter(function(t){return Lo(e,t)}),s.forEach(function(s,u){e.$index=a+"_"+u;var c=e.$$("cells");e.showSheet(s);var h=e._zoom;e.ignoreUndo(function(){return e.zoom(1)});var d="wss_"+e.$index;e._print=!0;var f=c.$customPrint(t,!0);delete e._print;var m=f.firstChild;if(m){for(var g=bn(m.children,2),v=g[0],p=g[1],w=v.childElementCount,b=t.sheetnames?20:0,_=b,x=1;x<=w;x++)_+=c.getItem(x).$height||c.config.rowHeight;if(_>l.height/4)for(var y=w-1;y>=0;y--)p.firstChild?webix.html.insertBefore(v.children[y],p.firstChild):p.appendChild(v.children[y]);if(b){var C=webix.html.create("tr",{class:"webix_ssheet_sheetname"},"<td>".concat(s,":</td>"));v.firstChild?webix.html.insertBefore(C,v.firstChild):v.appendChild(C)}var S=f.firstChild;S&&(s!=n&&webix.html.removeCss(S,"wss_"+a),webix.html.addCss(S,d)),o.appendChild(f)}if(t.external){var $=function(){var n=e.views._pull[E];if("image"==n.type){var a=webix.html.create("IMG",{src:n.data,width:(n.config.width||500)+"px",height:(n.config.height||300)+"px"}),l=webix.promise.defer();r.push(l),a.onload=function(){return l.resolve()},o.appendChild(a)}else{var s=webix.$$(E).getBody();if(s.$customPrint){var u=s.$customPrint({size:t.size},!0);u.then?(i[r.length]=o.childElementCount,r.push(u)):o.appendChild(u)}else o.appendChild(function(e){var t=e.$view.cloneNode(!0),n=e.$view.getElementsByTagName("canvas");if(n.length)for(var r=n.length-1;r>=0;r--){t.getElementsByTagName("canvas")[r].getContext("2d").drawImage(n[r],0,0)}var i=webix.html.create("div",{class:"webix_ssheet_ui"});return i.appendChild(t),i}(webix.$$(E).getBody()))}};for(var E in e.views._pull)$()}if(u+1<e._sheets.length&&(m||t.external&&Object.keys(e.views._pull).length)){var R=webix.html.create("DIV",{class:"webix_print_pagebreak"});o.appendChild(R)}e.$index=a,e.ignoreUndo(function(){return e.zoom(h)})}),o}(e,t,o,r,i);e.showSheet(o);var l=webix.promise.defer();return webix.promise.all(r).then(function(r){for(var o=Object.keys(i).sort(e.$$("cells").data.sorting.as.int),s=o.length-1;s>=0;s--){var u=o[s];a.insertBefore(r[u],a.childNodes[i[u]])}if(n)return l.resolve(a);webix.html.insertBefore(a,t.docFooter,document.body),window.print(),function(e,t){webix.html.remove(t),e._sheets.forEach(function(t,n){webix.html.removeStyle(".wss_"+e.$index+"_"+n)})}(e,a),l.resolve()}),l}function la(e){var t=webix.env.printSizes.find(function(t){return t.id==e.paper}),n="landscape"==e.mode,r=e.margin?2*webix.env.printMargin:0;return{width:t[n?"height":"width"]*webix.env.printPPI-r,height:t[n?"width":"height"]*webix.env.printPPI-r}}function sa(e,t){if(!t||e._printBorders.$render){ca(e);for(var n={rows:{},cols:{}},r=e.$$("cells"),i=e._printBorders,o=la(i),a=i.sheetnames?20:0,l=r.config.topSplit,s=a,u=1;u<=l;u++)s+=(r.getItem(u).$height||r.config.rowHeight)/e._zoom;s>o.height/4&&(l=0,s=a);for(var c=s,h=l+1;h<=e.config.rowCount;h++){var d=(r.getItem(h).$height||r.config.rowHeight)/e._zoom;c+d>o.height&&(c=s,n.rows[1==h?h:h-1]=1),c+=d}if("page"!=i.fit)for(var f=0,m=1;m<=e.config.columnCount;m++){var g=(r.getColumnConfig(m).width||r.config.columnWidth)/e._zoom;f+g>o.width&&(f=0,n.cols[1==m?m:m-1]=1),f+=g}e._printBorders.$render=n,e.refresh()}}function ua(e,t,n){var r="",i=e._printBorders.$render,o=e.$$("cells").getSpan(t,n);if(o){var a=1*o[0]+(o[3]-1),l=1*o[1]+(o[2]-1);ea(e,o[0],o[1],"webix_ss_print_border_right",i&&i.cols[l]),ea(e,o[0],o[1],"webix_ss_print_border_bottom",i&&i.rows[a]);var s=e._printBorders.$renderedSpanBorders;if(i){var u=n!=l&&i.cols[n],c=t!=a&&i.rows[t];(u||c)&&(s[o[0]]||(s[o[0]]={}),s[o[0]][o[1]]||(s[o[0]][o[1]]={}),u&&ha(e,s[o[0]][o[1]],o,n,"right"),c&&ha(e,s[o[0]][o[1]],o,t,"bottom"))}else ca(e)}return i&&(i.cols[n]&&(r+="webix_ss_print_border_right"),i.rows[t]&&(r+=(r?" ":"")+"webix_ss_print_border_bottom")),r}function ca(e){var t=e._printBorders.$renderedSpanBorders;for(var n in t)for(var r in t[n])for(var i in t[n][r])webix.html.remove(t[n][r][i]);e._printBorders.$renderedSpanBorders={}}function ha(e,t,n,r,i){t[i]||(t[i]={});var o=t[i][r],a=e.$$("cells");if(!o){for(var l=0,s=1*n["right"==i?1:0];s<=r;s++)l+="right"==i?a.getColumnConfig(s).width||a.config.columnWidth:a.getItem(s).$height||a.config.rowHeight;o=t[i][r]=webix.html.create("div",{class:"webix_ss_print_border_".concat(i),style:"".concat("right"==i?"left":"top",":").concat(l-1,"px;")})}webix.delay(function(){var e=a.getSpanNode({row:n[0],column:n[1]});e.contains(o)||e.appendChild(o)})}var da=Object.freeze({__proto__:null,getPrintBordersCss:ua,init:function(e){e.$customPrint=function(t,n){return aa(e,t,n)},e._printBorders={paper:webix.env.printSizes.find(function(e){return"a4"==e.id})?"a4":webix.env.printSizes[0].id,fit:"page",mode:"landscape",margin:1,sheetnames:1,$renderedSpanBorders:{}},e.attachEvent("onUndo",function(t,n,r,i){"print-borders"==t&&e.showPrintBorders(i)}),e.attachEvent("onAfterSheetShow",function(){return sa(e,!0)}),e.attachEvent("onChange",function(t,n){"update"==t&&n==e.getActiveSheet()&&sa(e,!0)}),e.attachEvent("onAfterSplit",function(t,n,r,i){var o=e._printBorders.$renderedSpanBorders;if(i==e.getActiveSheet()&&o[t]&&o[t][n]){for(var a in o[t][n])webix.html.remove(o[t][n][a]);delete o[t][n]}})},print:aa,removePrintInnerBorders:ca,showBorders:sa}),fa={};function ma(e,t,n,r){var i;if((r=r||e.getActiveSheet())==e.getActiveSheet()){var o=e.$$("cells");if(i=e._zoom||1,"in"!=t&&"out"!=t||(t=pa(i,"in"==t?1:-1,yo)),e._zoom=t,o.define({minColumnWidth:40*t}),e.$$("zoom")&&e.$$("zoom").setValue(t),t!=i){var a=webix.skin.$active.fontSize*t,l="contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20,s="webix_ssheet_zoom_"+t.toString().replace(".","_");o.$view.className=o.$view.className.replace(/ webix_ssheet_zoom_\w+/,""),o.define({css:s}),n||(ca(e),Wo(e,i),mr(e)),fa[s]||1==t||(fa[s]=1,webix.html.addStyle("\n\t\t\t\t\t.".concat(s," .webix_hcell, .").concat(s," .webix_cell{\n\t\t\t\t\t\tfont-size: ").concat(a,"px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(s," .sheet_column_0 .webix_cell{\n\t\t\t\t\t\tpadding: 0 ").concat(12*t,"px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(s,".webix_ssheet_table .webix_hs_left .webix_hcell.webix_first:before{\n\t\t\t\t\t\tright: ").concat(4*t,"px;\n\t\t\t\t\t\tbottom: ").concat(4*t,"px;\n\t\t\t\t\t\tborder-top-width: ").concat((l-8)*t,"px;\n\t\t\t\t\t\tborder-right-width: ").concat((l-8)*t,"px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(s," .webix_cell{\n\t\t\t\t\t\tpadding: ").concat(2*t,"px 0px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(s," .webix_cell div:first-child{\n\t\t\t\t\t\tmargin: 0 ").concat(12*t,"px;\n\t\t\t\t\t}\n\t\t\t\t")),webix.html.addStyle("\n\t\t\t\t\t.".concat(s," .webix_cell.ss_filter, .").concat(s," .webix_cell.ss_editor{\n\t\t\t\t\t\tpadding-right: ").concat(16*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(s," .ssheet_filter_sign, .").concat(s," .webix_cell.ss_editor:after{\n\t\t\t\t\t\tfont-size: ").concat(20*t,"px;\n\t\t\t\t\t\tright: ").concat(6*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(s," .webix_cell.ss_filter.ss_editor:after{\n\t\t\t\t\t\tright: ").concat(28*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(s," .webix_cell.ss_filter.ss_editor{\n\t\t\t\t\t\tpadding-right: ").concat(36*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(s," .webix_lock:before{\n\t\t\t\t\t\tfont-size: ").concat(a,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(s," .ssheet_commented_sign:before{\n\t\t\t\t\t\tborder-top-width: ").concat(8*t,"px;\n\t\t\t\t\t\tborder-left-width: ").concat(8*t,"px;\n\t\t\t\t\t}\n\t\t\t\t")))}}else{var u=Uo(e,r);if(!u)return;u.content.table||(u.content.table={zoom:1}),i=u.content.table.zoom,"in"!=t&&"out"!=t||(t=pa(i,"in"==t?1:-1,yo)),u.content.table.zoom=t}n||i==t||e.callEvent("onZoom",[t,i,r])}function ga(e,t){t.table={zoom:e._zoom}}function va(e,t){var n=1;t.table&&t.table.zoom&&(n=t.table.zoom),ma(e,n,!0)}function pa(e,t,n){var r,i=n.indexOf(e);if(-1!=i)return n[i+t]||e;for(var o=0;o<n.length;o++)if(n[o]>e){if(t<0&&-1==--o)return e;r=n[o];break}return t<0&&!r&&(r=n[n.length-1]),r||e}var wa=Object.freeze({__proto__:null,getNext:pa,init:function(e){e.attachEvent("onUndo",function(t,n,r,i){"zoom"==t&&ma(e,i)}),e.attachEvent("onDataSerialize",function(t){return ga(e,t)}),e.attachEvent("onDataParse",function(t){return va(e,t)})},load:va,serialize:ga,zoom:ma});webix.protoUI({name:"ssheet-zoom",$cssName:"counter webix_ssheet_zoom",$init:function(){var e=this;this.attachEvent("onAfterRender",function(){e.$setValue(e.config.value),e.getInputNode().readOnly=!0,webix.event(e.$view.firstChild,"keydown",function(e){return webix.html.preventEvent(e)})})},$setValue:function(e){this.getInputNode().value=parseInt(100*e,10)+"%"},shift:function(e,t){var n=pa(this.config.value,e,this.config.numbers);this.setValue(n,t)}},webix.ui.counter),webix.editors.excel_date=webix.extend({createPopup:function(){var e=webix.editors.excel_date;if(!e.popup){var t=webix.ui({view:"popup",body:{view:"calendar",icons:!0,timepicker:!0,on:{onChange:function(e){e=e[0],this.getParentView()._last_input_target.value=e?In(e):"",webix.callEvent("onEditEnd",[])}}},on:{onEnter:function(){webix.callEvent("onEditEnd",[])},onBeforeShow:function(){var e=webix.$$(this._last_input_target),t=e.getParentView().getParentView(),n=e.getSelectedId(),r=di(t,fi(t,n.row,n.column),"date","onlyTime");this.getBody().define({type:r?"time":null})}}});e.popup=t.config.id}return e.popup},render:function(){var e=this,t=webix.html.create("div",{class:"webix_dt_editor"},"<input type='text'>");return this.popup=this.createPopup(),webix.event(t.firstChild,"click",function(){return e.getPopup().show(t)}),t},getPopup:function(){return webix.$$(this.popup)},showPopup:function(){var e=this.getInputNode(),t=this.getPopup();t._last_input_target=e,t.show(e),e.setAttribute("aria-expanded","true")},updateCalendar:function(e){var t=this.getPopup().getBody();t.blockEvent(),t.setValue(e),t.unblockEvent()},afterRender:function(){this.showPopup()},setValue:function(e){e=""===e||isNaN(1*e)?new Date:On(e),this.updateCalendar(e);var t=gi(webix.$$(this.config.node).getParentView().getParentView(),this.config.row.id,this.config.id);this.getInputNode().value=t(e)},getValue:function(){var e=this.getInputNode().value;return this.getPopup().hide(),e}},webix.editors.text),webix.editors.ss_richselect=webix.extend({getFormat:function(e){var t,n=this.getInputNode();return e&&n.exists(e)&&(t=n.getItem(e)),t&&t.format},popupInit:function(e){webix.editors.richselect.popupInit.apply(this,arguments),e.getList().define("template",function(e){return e.$value||e.value})}},webix.editors.richselect);var ba={undo:function(e){return e.undo()},redo:function(e){return e.redo()},"hide-gridlines":function(e){return e.hideGridlines("toggle")},"hide-headers":function(e){return e.hideHeaders("toggle")},"freeze-columns":function(e){return e.freezeColumns()},"freeze-rows":function(e){return e.freezeRows()},"show-formulas":function(e){return e.showFormulas("toggle")},"print-borders":function(e){return e.showPrintBorders("toggle")},span:function(e){var t=e.$$("cells").getSelectArea();if(t)if(function(e,t){for(var n=t.start,r=t.end,i=1*n.row;i<=1*r.row;i++)for(var o=1*n.column;o<=1*r.column;o++)if(e.$$("cells").getSpan(i,o))return!0;return!1}(e,t))e.splitCell();else{for(var n=[],r=t.start.row;r<=t.end.row;r++){for(var i=t.start.column;i<=t.end.column;i++){var o=e.getCellValue(r,i);if(o&&n.push(o),n.length>1)break}if(n.length>1)break}n.length>1?e.confirm({text:webix.i18n.spreadsheet.labels["merge-cell-confirm"]}).then(function(){return e.combineCells()}):e.combineCells()}},"increase-decimals":function(e){return ni(e,1)},"decrease-decimals":function(e){return ni(e,-1)},"increase-indent":function(e){return e.callEvent("onStyleSet",["indent",1])},"decrease-indent":function(e){return e.callEvent("onStyleSet",["indent",-1])},"find-readonly":function(e){return e.callEvent("onCommand",[{id:"find"}])}};function _a(e){var t=webix.i18n.spreadsheet;return t.actions[e]||t.labels[e]||e}function xa(e,t){var n={$button:e.id};if(e.view&&(n.view=e.view,n.name=e.id),e.toolbarLabel&&(n.label=Qi(e.id)),n.tooltip=Qi(e.id),e.submenu&&(n.options=Zi(e.submenu)),e.toolbarWidth){var r=webix.skin.$active.buttonHeight;n.width=t||r*e.toolbarWidth+2*(e.toolbarWidth-1)}return n}function ya(e,t){for(var n=e.reduce(function(e,t){return e+(t.toolbarWidth||1)},0),r={rows:[{margin:2,cols:[]},{margin:2,cols:[]}]},i=0,o=[],a=0;a<e.length;a++)if(e[a].toolbarHeight)o.push({index:a,span:e[a].toolbarHeight}),n-=e[a].toolbarWidth||1;else{var l=xa(e[a],t),s=e[a].toolbarWidth||1,u=i+s>Math.ceil(n/2)?1:0;r.rows[u].cols.push(l),i+=s}if(o.length){var c={cols:[r]};return o.forEach(function(t){c.cols.splice(t.index,0,xa(e[t.index]))}),c}return r}var Ca=function(){var e=Ki.flatMap(function(e){return[{padding:3,rows:[{margin:2,cols:(t=e).submenu.map(xa)},ao({title:Qi(t.id)})]},{view:"ssheet-separator"}];var t});return e.push({}),e};function Sa(e){var t=function(){var e={"undo-redo":["undo","redo"],insert:["graph","add-image","add-comment","controls"]},t={};for(var n in e){t[n]=0;for(var r=0;r<e[n].length;r++){var i=webix.html.getTextSize(_a(e[n][r]),"webix_ssheet_button_measure").width+7;t[n]=Math.max(i,t[n])}}return t}();return e?Ca():Xi.flatMap(function(e){return function(e,t){return[{padding:3,margin:0,rows:[ya(e.submenu,t[e.id]),ao({title:Qi(e.id)})]},{view:"ssheet-separator"}]}(e,t)})}var $a={"undo-redo":["undo","redo"],font:["font-family","font-size","font-weight","font-style","underline","strike","color","background","borders"],align:["text-align","vertical-align","wrap","span","increase-indent","decrease-indent"],format:["format"]};function Ea(e){e.attachEvent("onComponentInit",function(){return function(e){e.attachEvent("onAfterSelect",function(t){return Ra(e,t)})}(e)}),e.attachEvent("onCommand",function(t){"toolbar-update"==t.id&&(t.name?function(e,t,n){var r=e.$$("bar").elements[t];r&&r.setValue(n)}(e,t.name,t.value):Ra(e,e.getSelectedId(!0)))});var t=[];if(e.config.toolbar){var n=e.config.toolbar;"full"==n&&(n=Sa(e.config.readonly),webix.isUndefined(e.config.bottombar)&&(e.config.bottombar=!0)),t=function(e,t){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r].$button;if(i){var o=uo[i]?uo[i](e):ro({name:i});webix.extend(t[r],o)}t[r].rows&&n(t[r].rows),t[r].cols&&n(t[r].cols)}};return n(t),t}(e,n)}else t=function(e,t){var n=[];for(var r in t)n.push(go(e,r,t[r])),n.push(oo());return n}(e,e.config.buttons||$a);var r={view:webix.env.$customScroll?"scrollview":"ssheet-toolbar-scrollview",scroll:"x",body:{view:"toolbar",css:"webix_ssheet_toolbar webix_layout_toolbar",id:"bar",padding:0,elements:t,on:{onChange:function(t,n,r){if("user"==r){var i=this.$eventSource,o=i.config.name;"format"==o&&"common"==t&&(t="");var a="font-size"==o;if((a||"font-family"==o)&&(!t||a&&isNaN(t)))return i.setValue(n);if(a){var l=Math.floor(400/.75),s=Math.max(1,Math.min(l,t));s!=t&&(t=s,i.setValue(t)),t+="px"}"format"==o&&"custom"==t||e.callEvent("onStyleSet",[o,t]),webix.UIManager.setFocus(e.$$("cells"))}},onItemClick:function(t){var n=e.innerId(t);ba[n]?ba[n].call(this,e):e.callEvent("onCommand",[{id:n}])}}}};return e.callEvent("onViewInit",["toolbar",r]),r}function Ra(e,t){if(t.length){var n=function(e,t){for(var n=["font-family","font-size","text-align","vertical-align","format","background","color"],r=t[0],i=Aa(e,r),o=1;o<t.length;o++){for(var a=Aa(e,t[o]),l=n.length-1;l>=0;l--){var s=n[l];i[s]!=a[s]&&(delete i[s],n.splice(l,1))}if(!n.length)break}return i}(e,t);e.$$("bar").setValues(n)}}function Aa(e,t){var n=e.$$("cells").getSpan(t.row,t.column);if(n){var r=bn(n,2);t.row=r[0],t.column=r[1]}var i=gr(e,t),o=i?webix.copy(i.props):{};for(var a in tr)o[a]||(o[a]=tr[a]);o["font-size"]=o["font-size"].replace("px","");var l=vr(e,t.row,t.column)||"common";return o.format=ii(l)?"custom":l,o}function Ta(e,t,n){var r=t.$$("cells").config.columns,i={row:e,column:r["rowId"==r[0].id?1:0].id},o={row:n||e,column:r[r.length-1].id};i.column&&o.column&&Da(i,o,t)}function ka(e){var t=e.$$("cells").data.order,n=e.$$("cells").config.columns,r="rowId"==n[0].id?1:0,i={row:t[0],column:n[r].id},o={row:t[t.length-1],column:n[n.length-1].id};i.column&&o.column&&Da(i,o,e)}function Oa(e,t,n){var r=t.$$("cells").data.order;Da({row:r[0],column:e},{row:r[r.length-1],column:n||e},t)}function Ia(e,t){var n=t.$$("cells").getSelectArea();if(n){var r=t.$$("cells").config.columns,i=r["rowId"==r[0].id?1:0].id,o=r[r.length-1].id;if(n.start.column==i&&n.end.column==o){var a=t.$$("cells").data.order,l=a[0],s=a[a.length-1];return n.start.row==l&&n.end.row==s}if(e>=n.start.column&&e<=n.end.column)return!0}return!1}function Va(e,t,n){var r=n.$$("cells").getSelectArea();if(r){var i=r.start,o=r.end;return e>=i.row&&e<=o.row&&t>=i.column&&t<=o.column}return!1}function Na(e,t){var n=t.$$("cells").getSelectArea();if(n){var r=t.$$("cells").data.order,i=r[0],o=r[r.length-1];if(n.start.row==i&&n.end.row==o){var a=t.$$("cells").config.columns,l=a["rowId"==a[0].id?1:0].id,s=a[a.length-1].id;return n.start.column==l&&n.end.column==s}if(e>=n.start.row&&e<=n.end.row)return!0}return!1}function Ma(e,t){var n=t.$$("cells").getSelectArea();n?Oa(Math.min(n.start.column,n.end.column,e),t,Math.max(n.start.column,n.end.column,e)):Oa(e,t)}function Da(e,t,n){n.$$("cells").addSelectArea(e,t)}function qa(e,t){var n=t.$$("cells"),r=0,i=n.getColumnConfig(e).width;n.eachRow(function(o){var a=25,l=n.getSpan(o,e);if(!(l&&l[2]>1)){var s=t.getCellValue(o,e),u=this.getText(o,e),c=t.getStyle(o,e),h=c?c.id:"";if(u.replace(/<\/?[^>]+(>|$)/g,""))a=Sr(t,u,h).width;var d=t._zoom;t.getCellEditor(o,e)&&(a+=18*d),t.getCellFilter(o,e)&&(a+=18*d),/^=(checkbox|radio)\(/i.test(s)&&(a+=18*d),c&&"wrap"==c.props.wrap&&a>i&&(a=i),a>r&&(r=a)}}),n.setColumnWidth(e,r)}function za(e,t){var n=25;t._table.eachColumn(function(r){if("rowId"!=r){var i=this.getText(e,r),o=this.getColumnConfig(r).width,a=t._table.getSpan(e,r);a&&(o=t._table.getSpanNode({row:a[0],column:a[1]}).offsetWidth);var l=t.getStyle(e,r),s=l?l.id:"";if(i.replace(/<\/?[^>]+(>|$)/g,"")){var u=Sr(t,i,s,o);u.height>n&&(n=u.height)}}}),t._table.setRowHeight(e,n)}function Pa(e,t,n){if(n._table.config.header){var r=n._table,i="webix_highlight",o=e.row,a=t.row,l=e.column,s=t.column,u=r.config.columns,c=u[1].id;if("rowId"==l?l==s?(e.column=l=c,t.column=s=u[u.length-1].id):e.column=l=c:"rowId"==s&&(t.column=s=c),a<o){var h=[a,o];o=h[0],a=h[1]}if(s<l){var d=[s,l];l=d[0],s=d[1]}if(r.eachRow(function(e){e<o||e>a?r.removeCellCss(e,"rowId",i,!0):r.addCellCss(e,"rowId",i,!0)}),webix.delay(function(){return r.refresh()}),r.eachColumn(function(e){var t=r.getHeaderNode(e);"rowId"!=e&&t&&(e<l||e>s?webix.html.removeCss(t,i):webix.html.addCss(t,i,!0))}),n.$$("navigation")){var f="";if(l&&s){if(!o){var m=r.data.order;o=m[0],a=m[m.length-1]}var g=(f=Xn(o,l,a,s)).split(":");g[0]==g[1]&&(f=g[0])}n.$$("navigation").setValue(f)}}}var Fa=Object.freeze({__proto__:null,adjustColumn:qa,adjustRow:za,highlightColRow:Pa,isCellSelected:Va,isColSelected:Ia,isRowSelected:Na,selectAll:ka,selectColumn:Oa,selectColumns:Ma,selectRow:Ta});function Ua(e){return webix.i18n.spreadsheet.labels[e]||e}function La(e){return e&&!isNaN(e)&&!mi(e)}var Ba={number:[{id:"greater",batch:"text",handler:function(e,t){return""!==e&&1*e>1*t}},{id:"less",batch:"text",handler:function(e,t){return""!==e&&1*e<1*t}},{id:"greaterOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*e>=1*t}},{id:"lessOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*e<=1*t}},{id:"equal",batch:"text",handler:function(e,t){return e==t}},{id:"notEqual",batch:"text",handler:function(e,t){return e!=t}},{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}}],text:[{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"equal",batch:"text",handler:function(e,t){return e.toString().toLowerCase()===t.toString().toLowerCase()}},{id:"notEqual",batch:"text",handler:function(e,t){return e.toString().toLowerCase()!==t.toString().toLowerCase()}},{id:"beginsWith",batch:"text",handler:function(e,t){return 0===e.toString().toLowerCase().lastIndexOf(t.toString().toLowerCase(),0)}},{id:"notBeginsWith",batch:"text",handler:function(e,t){return 0!==e.toString().toLowerCase().lastIndexOf(t.toString().toLowerCase(),0)}},{id:"endsWith",batch:"text",handler:function(e,t){return e=e.toString(),t=t.toString(),-1!==e.toLowerCase().indexOf(t.toLowerCase(),e.length-t.length)}},{id:"notEndsWith",batch:"text",handler:function(e,t){return e=e.toString(),t=t.toString(),-1===e.toLowerCase().indexOf(t.toLowerCase(),e.length-t.length)}}],date:[{id:"greater",batch:"datepicker",handler:function(e,t){return La(e)&&e>t}},{id:"less",batch:"datepicker",handler:function(e,t){return La(e)&&e<t}},{id:"greaterOrEqual",batch:"datepicker",handler:function(e,t){return La(e)&&e>=t}},{id:"lessOrEqual",batch:"datepicker",handler:function(e,t){return La(e)&&e<=t}},{id:"equal",batch:"datepicker",handler:function(e,t){return La(e)&&e==t}},{id:"notEqual",batch:"datepicker",handler:function(e,t){return!La(e)||e!=t}},{id:"between",batch:"daterangepicker",handler:function(e,t){return!!La(e)&&((!t.start||e>t.start)&&(!t.end||e<t.end))}},{id:"notBetween",batch:"daterangepicker",handler:function(e,t){return!!La(e)&&(!t.start||e<=t.start||!t.end||e>=t.end)}}]},Ha=webix.copy(Ba);function ja(){var e=webix.copy(Ba);return e.number=e.number.concat([{id:"between",handler:function(e,t){return(!t.start||e>t.start)&&(!t.end||e<t.end)}},{id:"notBetween",handler:function(e,t){return!t.start||e<=t.start||!t.end||e>=t.end}}]),e}function Wa(e,t){return isNaN(1*t)?"="==t.charAt(0)&&t.length>1&&null===(t=e._mData.getStore().exec(t.substring(1),e._mPage.getContext()))&&(t=""):t*=1,t}function Xa(e,t,n,r){var i="";if(!e.conditions._empty){var o=e.conditions.get(t,n);if(o){var a=e.$$("cells").getSpan(t,n),l=e.getCellValue(t,n,!1);l||0===l||(l="");var s=Ii(e,t,n);s&&"string"!=s||(s="text");for(var u=function(){var u,h=l,d=o[c][0],f=e.conditions.handlers,m=["text",s,"number","date"];m=m.filter(function(e,t){return m.indexOf(e)==t});for(var g=0;g<m.length;g++){var v=m[g];if(u=rr(f[v],function(e){return e.id==d})){u=u.handler,"text"==v&&"equal"!=d&&"notEqual"!=d&&(h=r);break}}var p=o[c][1];if(p=webix.isArray(p)?{start:Wa(e,p[0]),end:Wa(e,p[1])}:Wa(e,p),!i&&u&&u(h,p)){if(i=o[c][2],!a)return 1;ea(e,t,n,o[c][2],!0)}else ea(e,t,n,o[c][2],!1)},c=o.length-1;c>=0&&!u();c--);}}return i}function Ka(e,t,n,r){return r._empty=!1,e[t]||(e[t]={}),e[t][n]||(e[t][n]=[]),e[t][n]}function Ya(e,t,n){if(n&&n!=e.getActiveSheet()){var r=Uo(e,n);r&&(r.content.conditions=t)}else{var i={">":"greater","<":"less","=":"equal","!=":"notEqual","<>":"between"};if(this._empty=!0,!t)return;for(var o=t.length;o--;){var a=t[o],l=Ka(this._pull,a[0],a[1],this);a[2]=i[a[2]]||a[2],l.push([a[2],a[3],a[4]])}}}function Ga(e,t){if(t&&t!=e.getActiveSheet()){var n=Uo(e,t);n&&(n.content.conditions=[])}else this._pull={}}function Qa(e,t,n,r,i){if(r.map(function(t){return ol(e,t)}),i&&i!=e.getActiveSheet()){var o=Uo(e,i);o&&(el(e,t,n,i),o.content.conditions||(o.content.conditions=[]),r.forEach(function(e){o.content.conditions.push([t,n].concat(_n(e)))}))}else Ka(this._pull,t,n,this),this._pull[t][n]=r}function Za(e,t,n,r){var i;if(r&&r!=e.getActiveSheet()){var o=Uo(e,r);if(o&&o.content.conditions){for(var a,l=webix.copy(o.content.conditions),s=[];-1!=(a=ir(l,function(e){return e[0]==t&&e[1]==n}));)s.push(l[a].slice(2,5)),l.splice(a,1);s.length&&(i=s)}}else this._pull[t]&&this._pull[t][n]&&(i=this._pull[t][n]||null);return i||null}function Ja(e,t,n,r,i,o,a){var l=ol(e,[r,i,o]);if(a&&a!=e.getActiveSheet()){var s=Uo(e,a);s&&(s.content.conditions||(s.content.conditions=[]),s.content.conditions.push([t,n].concat(_n(l))))}else Ka(this._pull,t,n,this).push(l)}function el(e,t,n,r){if(r&&r!=e.getActiveSheet()){var i=Uo(e,r);if(i&&i.content.conditions)for(var o;-1!=(o=ir(i.content.conditions,function(e){return e[0]==t&&e[1]==n}));)i.content.conditions.splice(o,1)}else{this.get(t,n)&&delete this._pull[t][n]}}function tl(e,t){var n=[];if(t&&t!=e.getActiveSheet()){var r=Uo(e,t);r&&r.content.conditions&&(n=r.content.conditions)}else for(var i in this._pull)for(var o in this._pull[i])for(var a=0;a<this._pull[i][o].length;a++){var l=this._pull[i][o][a];n.push([i,o,l[0],l[1],l[2]])}return n}function nl(e,t,n){Sn.set(function(){Yn(t,e,function(e,t){var r=e.conditions.get(t.row,t.column,n);r&&il("remove",t.row,t.column,r,null,e,n)}),e.refresh()})}function rl(e,t,n,r,i){var o=t.condition;il("update",n,r,e.conditions.get(n,r)||null,o,e),1===i&&il("remove",t.row,t.col,o,null,e)}function il(e,t,n,r,i,o,a){o.callEvent("onBeforeConditionSet",[t,n,r,i,a])&&(o.conditions[e].apply(o.conditions,[t,n,"remove"==e?a:i]),o.callEvent("onAfterConditionSet",[t,n,r,i,a]))}function ol(e,t){var n=t[1];return"="==n[0]&&(t[1]=e._mData.getStore().parse(n).source),t}Ha.textLength=[{id:"greater",handler:function(e,t){return e.toString().length>t}},{id:"less",handler:function(e,t){return e.toString().length<t}},{id:"greaterOrEqual",handler:function(e,t){return e.toString().length>=t}},{id:"lessOrEqual",handler:function(e,t){return e.toString().length<=t}},{id:"equal",handler:function(e,t){return e.toString().length==t}},{id:"notEqual",handler:function(e,t){return e.toString().length!=t}}],Ha.number=Ha.number.concat([{id:"between",handler:function(e,t){return(!t.start||e>t.start)&&(!t.end||e<t.end)}},{id:"notBetween",handler:function(e,t){return!t.start||e<=t.start||!t.end||e>=t.end}}]);var al=Object.freeze({__proto__:null,_changeCondition:il,clearConditionalFormats:nl,getConditionCss:Xa,init:function(e){e.conditions={_empty:!0,_pull:{},handlers:ja(),add:function(t,n,r,i,o,a){Ja.apply(this,[e,t,n,r,i,o,a])},update:function(t,n,r,i){Qa.apply(this,[e,t,n,r,i])},remove:function(t,n,r){el.apply(this,[e,t,n,r])},get:function(t,n,r){return Za.apply(this,[e,t,n,r])},parse:function(t,n){Ya.apply(this,[e,t,n])},serialize:function(t){return tl.apply(this,[e,t])},clear:function(t){Ga.apply(this,[e,t])}},e.attachEvent("onConditionSet",function(t){return function(e,t){Sn.set(function(){e.eachSelectedCell(function(n){var r=e.conditions.get(n.row,n.column);if(r)for(var i=0;i<r.length;i++)ea(e,n.row,n.column,r[i][2],!1);il("update",n.row,n.column,r||null,t,e)})}),e.refresh()}(e,t)}),e.attachEvent("onUndo",function(t,n,r,i){"condition"==t&&function(e,t,n,r){e.conditions.get(t,n)&&e.conditions.remove(t,n);r&&e.conditions.update(t,n,r)}(e,n,r,i)}),e.attachEvent("onDataSerialize",function(t){return function(e,t){t.conditions=e.conditions.serialize()}(e,t)}),e.attachEvent("onDataParse",function(t){return function(e,t){e.conditions.parse(t.conditions)}(e,t)}),e.attachEvent("onReset",function(){return e.conditions.clear()}),e.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function(e,t,n,r,i){var o=r.conditions,a=o.length;if(n)for(;a--;){var l=bn(o[a],2),s=l[0],u=l[1];("row"==t&&s>=i.row||"column"==t&&u>=i.column)&&("row"==t?s<i.row-n?o.splice(a,1):o[a][0]=1*s+n:"column"==t&&(u<i.column-n?o.splice(a,1):o[a][1]=1*u+n))}}(0,t.name,t.inc,t.data,t.start)}),function(e){e.conditions.clear()}(e)},pasteCondition:rl});function ll(e,t,n,r){var i;if(r&&r!=e.getActiveSheet()){var o=Uo(e,r);o&&o.content.validation&&(i=rr(o.content.validation,function(e){return e[0]==t&&e[1]==n}))&&(i=i[2])}else e.validation._pull[t]&&e.validation._pull[t][n]&&(i=e.validation._pull[t][n]);return i||null}function sl(e,t,n,r,i,o){o=o||e.getActiveSheet();var a=ll(e,t,n,o);if(o!=e.getActiveSheet()){var l=Uo(e,o);l.content.validation||(l.content.validation=[]),a?rr(l.content.validation,function(e){return e[0]==t&&e[1]==n})[2]=r:l.content.validation.push([t,n,r])}else e.validation._pull[t]||(e.validation._pull[t]={}),e.validation._pull[t][n]=r;i||e.callEvent("onAction",["validation",{row:t,column:n,newValue:r,value:a,page:o}])}function ul(e,t,n,r,i){i=i||e.getActiveSheet();var o=ll(e,t,n,i);if(o){if(i!=e.getActiveSheet()){var a=Uo(e,i).content.validation,l=ir(a,function(e){return e[0]==t&&e[1]==n});a.splice(l,1)}else delete e.validation._pull[t][n],e.$$("cells").updateItem(t,n);r||e.callEvent("onAction",["validation",{row:t,column:n,newValue:null,value:o,page:i}])}}function cl(e,t){return isNaN(1*t)?"="==t.charAt(0)&&t.length>1&&null===(t=e._mData.getStore().exec(t.substring(1),e._mPage.getContext()))&&(t=""):t*=1,t}function hl(e,t,n,r,i){var o=!1,a=e.validation.get(t,n,i);if(a){var l,s=a.type;if(""===(l=webix.isUndefined(r)||"text"!=s&&"textLength"!=s?e.getCellValue(t,n,!1,i):r))return!!a.ignoreEmpty;var u=a.value;u&&(u=webix.isArray(u)?{start:cl(e,u[0]),end:cl(e,u[1])}:cl(e,u));var c=e.validation.handlers[s];if(c)(0,rr(c,function(e){return e.id==a.condition}).handler)(l,u)||(o=!0);if(!o)switch(s){case"number":a.integer&&parseInt(l)!=l&&(o=!0);break;case"date":"date"!=Ii(e,t,n,i)&&(o=!0);break;case"range":webix.isArray(u)&&-1!=u.indexOf(l)||(o=!0)}}return o}function dl(e,t,n,r){var i="";return e.validation._highlight&&hl(e,t,n,r)&&(i="webix_ss_invalid_data"),e.$$("cells").getSpan(t,n)&&ea(e,t,n,"webix_ss_invalid_data",!!i),i}function fl(e){if(!e._commentSel){var t=e.getSelectedId(!0),n=e.validation._inputMessage;if(!e._context&&t&&1==t.length){var r=(t=t[0]).row,i=t.column,o=e.validation.get(r,i);if(o&&o.inputMessage){n||(n=e.validation._inputMessage=webix.ui({view:"popup",css:"ssheet_validation_input_message",minWidth:150,minHeight:50,height:100,width:250,resize:!0,body:{scroll:"auto",template:" "}}),e._destroy_with_me.push(n)),n.getBody().setHTML(o.inputMessage);var a=e.$$("cells"),l=a.getSpan(r,i),s=l?{row:r,column:1*l[1]+l[2]-1}:t;return n.show(a.getItemNode(s),{pos:"bottom"})}}n&&n.hide()}}function ml(e,t,n,r,i){var o=t.validation;e.validation.add(n,r,o),1===i&&e.validation.remove(t.row,t.col)}var gl=Object.freeze({__proto__:null,getValidationCss:dl,init:function(e){e.validation={handlers:webix.copy(Ha),get:function(t,n,r){return ll(e,t,n,r)},add:function(t,n,r,i){return sl(e,t,n,r,!1,i)},remove:function(t,n,r){return ul(e,t,n,!1,r)},highlight:function(t,n){return function(e,t,n){if(n=n||e.getActiveSheet(),n!=e.getActiveSheet()){var r=Uo(e,n);r.content.table||(r.content.table={}),t="toggle"==t?!r.content.table.highlightInvalid:!!t,r.content.table.highlightInvalid=t?1:0}else e.validation._highlight="toggle"==t?!e.validation._highlight:!!t,e.refresh()}(e,t,n)},_pull:{}},e.attachEvent("onReset",function(){return function(e){e.validation._pull={}}(e)}),e.attachEvent("onUndo",function(t,n,r,i){"validation"===t&&function(e,t,n,r){ll(e,t,n)&&ul(e,t,n,!0);r&&sl(e,t,n,r,!0)}(e,n,r,i)}),e.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function(e,t,n,r,i){var o=r.validation,a=o.length;if(n)for(;a--;){var l=bn(o[a],2),s=l[0],u=l[1];(s&&"row"==t&&s>=i.row||u&&"column"==t&&u>=i.column)&&("row"==t?s<i.row-n?o.splice(a,1):o[a][0]=1*s+n:"column"==t&&(u<i.column-n?o.splice(a,1):o[a][1]=1*u+n))}}(0,t.name,t.inc,t.data,t.start)}),e.attachEvent("onCommand",function(t){"highlight-invalid-data"==t.id?e.validation.highlight(!0):"remove-highlight-invalid-data"==t.id?e.validation.highlight():"remove-cell-validation"==t.id&&Sn.set(function(){return e.eachSelectedCell(function(t){return e.validation.remove(t.row,t.column)})})}),e.attachEvent("onDataSerialize",function(t){var n,r;return n=function(e){var t=e.validation._pull,n=[];for(var r in t)for(var i in t[r])n.push([r,i,t[r][i]]);return[n,e.validation._highlight?1:0]}(e),r=bn(n,2),t.validation=r[0],t.table.highlightInvalid=r[1],n}),e.attachEvent("onDataParse",function(t){return function(e,t){var n=t.validation;if(n)for(var r=0;r<n.length;r++){var i=n[r];e.validation._pull[i[0]]||(e.validation._pull[i[0]]={}),e.validation._pull[i[0]][i[1]]=i[2]}t.table&&t.table.highlightInvalid&&(e.validation._highlight=!0)}(e,t)}),e.attachEvent("onReset",function(){e.validation._pull={},e.validation._highlight=!1}),e.attachEvent("onChange",function(){return fl(e)}),e.$$("cells").attachEvent("onSelectChange",function(){return fl(e)})},isInvalid:hl,pasteValidation:ml});function vl(e,t){return t||e.alert({type:"alert-error",text:webix.i18n.spreadsheet.labels["error-link"]}),!1}function pl(e,t,n){try{var r,i,o,a,l,s=t.split("!");switch(s.length){case 1:s=bn(s,1)[0];break;case 2:var u=bn(s,2);if(l=u[0],s=u[1],!("'"==l[0]&&"'"==l[l.length-1])&&l!=Wn(l))return vl(e,n);break;default:return vl(e,n)}if(Zn(s)){var c=bn(Hn(s),2);r=c[0],o=c[1]}else{var h=jn(t,e);if(!h)return vl(e,n);var d=bn(h,5);r=d[0],o=d[1],i=d[2],a=d[3],l=d[4]}if(l){if(!Uo(e,l=l.replaceAll("'","")))return vl(e,n);l!=e.getActiveSheet()&&e.showSheet(l)}var f=e.$$("cells");return f.showCell(r,o),f.addSelectArea({row:r,column:o},{row:i||r,column:a||o}),!0}catch(t){return vl(e,n)}}var wl="webix_lock";function bl(e,t,n,r,i,o,a){if("object"===yn(t)&&"object"===yn(n))Sn.set(function(){for(var i=t,a=n,l=i.row;l<=a.row;l++)for(var s=i.column;s<=a.column;s++)bl(e,l,s,r,!0,o,!0)});else{r=!1!==r;var l=e.getActiveSheet();if(o||(o=l),o!=l){var s=rr(e._sheets,function(e){return e.name==o});if(s){var u=s.content.locked;if(u){var c=s.content.locked,h=ir(c,function(e){return e[0]==t&&e[1]==n});r?-1==h&&c.push([t,n]):-1!=h&&c.splice(h,1)}else!u&&r&&(s.content.locked=[[t,n]])}}else ea(e,t,n,wl,r);(o==l?e._mPage:e._mData.getPage(o)).getCell(t-1,n-1,!0).$locked=r}a||e.callEvent("onAction",["lock",{row:t,column:n,value:!r,newValue:r,page:o}]),i||e.$$("cells").refresh()}function _l(e,t,n,r){var i=e.getActiveSheet();r||(r=i);var o=(r==i?e._mPage:e._mData.getPage(r)).getCell(t-1,n-1);return o&&o.$locked}var xl=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onUndo",function(t,n,r,i){"lock"===t&&bl(e,n,r,!!i,!0)}),e.attachEvent("onCommand",function(t){if("lock-cell"===t.id){var n=e.$$("cells").getSelectArea();if(n){var r=_l(e,n.start.row,n.start.column);bl(e,n.start,n.end,!r)}}})},isCellLocked:_l,load:function(e,t){var n=t.locked;if(n)for(var r=0;r<n.length;r++)bl(e,n[r][0],n[r][1],!0,!0)},lockCell:bl,lockCss:wl});function yl(e,t){e.attachEvent("onComponentInit",function(){return function(e){var t,n,r=e._table,i=webix.event(document.body,"pointermove",function(){var t;return function(n){"mouse"===n.pointerType&&(clearTimeout(t),t=webix.delay(function(t){if(!e.comments._activeComment.editStatus){var n=r.locate(t),i=e.comments.commentsView&&e.comments.commentsView.isVisible();if(n&&e.comments.get(n.row,n.column)){var o=e.comments._activeComment.cell;(!o||o.row==n.row&&o.column==n.column)&&i||e.callEvent("onCommand",[{id:"add-comment",cell:n,viewonly:!0}])}else i&&!e.comments.commentsView.$view.contains(t.target)&&e.callEvent("onCommentHide",[])}},!0,[n],250))}}());e.config.math&&(r.config.editMath=!0);function o(){var t=r.getSelectedId(!0);if(t.length){Pa(t[0],t[t.length-1]?t[t.length-1]:t[0],e)}else{var n={row:0,column:0};Pa(n,n,e)}}r.attachEvent("onBeforeEditStop",function(t,n){r.$anyKey=!1;var i=e.getCellValue(n.row,n.column);""===i&&""===t.value||(t.value!=i&&(e.setCellValue(n.row,n.column,t.value),r.refresh()),t.value=t.old)}),r.attachEvent("onEnter",function(e){r.getEditor()&&webix.delay(function(){r.moveSelection("down")}),webix.html.preventEvent(e)}),e.attachEvent("onBeforeEditStart",function(t,n){return!_l(e,t,n)}),r.attachEvent("onAfterEditStart",function(t){var n=t.row,i=t.column,o=e.getCellValue(n,i);r.$anyKey&&(r.$anyKey=!1,o=""),r.getEditor().setValue(o)}),r.attachEvent("onBeforeEditStart",function(t){return e.callEvent("onBeforeEditStart",[t.row,t.column])}),r.attachEvent("onBeforeSelect",function(e){return"rowId"!=e.column}),r.attachEvent("onBeforeBlockSelect",function(t,n,r){Pa(r?t:webix.copy(t),r?n:webix.copy(n),e)}),r.attachEvent("onSelectChange",function(){return o()}),r.attachEvent("onAfterColumnShow",function(){webix.delay(function(){return o()})}),r.attachEvent("onColumnResize",function(){webix.delay(function(){return o()})}),webix.event(r.$view.firstChild,"mousedown",function(e){var n=r.config.resizeColumn,i=r.locate(e);if(i&&i.cind){if(n){var o=r.getColumnConfig(i.column).width,a=webix.html.posRelative(e);if(a.x<n.size||o-a.x<n.size+1)return}t=i.cind}}),webix.event(r.$view.firstChild,"mousemove",function(i){if(t){var o=r.locate(i);o&&(n=o.cind,Pa({column:r.columnId(t)},{column:r.columnId(n||1)},e))}});var a=webix.event(document.body,"mouseup",function(){t&&(null!=n&&(Oa(r.columnId(t),e,r.columnId(n||1)),n=null),t=null)});r.attachEvent("onItemDblClick",function(t){"rowId"===t.column&&za(t.row,e)});var l=0;r.attachEvent("onHeaderClick",function(t,n){if("rowId"!=t.column){var r=new Date;r-l<=300?qa(t.column,e):(l=r,n.shiftKey?Ma(t.column,e):Oa(t.column,e))}else ka(e)});var s=null;r.attachEvent("onItemClick",function(t,n){"rowId"===t.column&&(n.shiftKey&&s?Ta(s,e,t.row):Ta(t.row,e),s=t.row)}),e.attachEvent("onReset",function(){return $l(e)}),e.attachEvent("onBeforeSheetShow",function(){return r.editStop()}),r.attachEvent("onBlur",function(){webix.delay(function(){var t=document.activeElement;if(!t||"INPUT"!=t.tagName){var n=webix.UIManager.getFocus();n&&!n.config.saveFocus&&n!=r&&n.getTopParentView&&n.getTopParentView()===e&&webix.UIManager.setFocus(r)}},this,[],100)}),r.attachEvent("onMoveSelection",function(e,t,n){"rowId"==e.column&&("left"==t&&n.ctrl||"top"==t)&&(e.column=1)}),function(e){webix.html.addStyle("#"+e._table.$view.id+".webix_dtable .webix_cell { white-space:nowrap;}")}(e),e.attachEvent("onDestruct",function(){webix.eventRemove(i),webix.eventRemove(a)}),e.config.liveEditor||(r.attachEvent("onAfterEditStart",function(t){return Cl(e.getCellValue(t.row,t.column),e)}),r.attachEvent("onLiveEdit",function(t){return Cl(t.value,e)}),r.attachEvent("onAfterEditStop",function(){return r.refresh()}))}(e)});var n={view:"datatable",id:"cells",css:"webix_ssheet_table webix_data_border wss_"+e.$index,headerRowHeight:"contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20,spans:!0,leftSplit:1,areaselect:!0,minColumnWidth:40,editable:!0,editaction:t.liveEditor?"custom":"dblclick",minRowHeight:1,navigation:!0,onClick:{webix_ssheet_ref:function(t){var n=t.target.getAttribute("data-ref").replaceAll("&#x27;","'");if(pl(e,n))return!1}}};return t&&(n=webix.extend(n,t,!0)),n}function Cl(e,t){var n=t.$$("cells");Di(t),Mi(t,e,null,!0),t._highlightRefresh=!0,n.refresh(),delete t._highlightRefresh}function Sl(e,t,n,r,i,o){var a,l=e.config.xssSafe,s=e.$$("cells").config.showFormulas&&!o,u=i.id,c=t.id;if(!e._mPage)return"";var h=e._mPage.getCell(c-1,u-1),d="";h&&(h.value||0===h.value)&&(d=h.value);var f=h?h.format:"",m=e.getCellValue(c,u),g=e._highlightRefresh,v=e.$$("liveEditor");if(v||g||Di(e),s){var p=e.getSelectedId();!e.$$("cells").getEditor()&&p&&p.row==c&&p.column==u&&"string"==typeof m&&"="==m[0]&&m.length>1?(d=Mi(e,m,null,!v&&!g),v||g||!Object.keys(e._highlightedCells).length||(e._highlightRefresh=!0,webix.delay(function(){e.refresh(),delete e._highlightRefresh}))):(d=m,a=!0)}if(m!=d){var w=webix.i18n.spreadsheet.table;switch(d){case"#REF!":d=w["math-ref-error"];break;case"#ERROR":d=w["math-error"];break;case"#XSS!":d=w["math-xss-error"];break;default:d=Vn(e,m,d)}}if(l&&!s){var b;if("="==m[0]&&m.length>1)for(var _=0;_<An.length;_++){var x="=".concat(An[_],"(");if(0==m.indexOf(x))for(var y=!1,C=1,S=x.length;S<m.length;S++)if('"'==m[S])y=!y;else if(!y)if("("==m[S])C++;else if(")"==m[S]&&! --C){b=S==m.length-1;break}}b||(a=!0)}var $="",E="string"==typeof d&&("+"==d.trim()[0]||/^0[xob][0-9a-f]+$/i.test(d))||!d&&0!==d||isNaN(d),R=!s&&di(e,f,"date")&&mi(d),A="";if(o||(A+=e.comments.get(c,u)?"<div class='ssheet_commented_sign'></div>":"",A+=e.getCellFilter(c,u)?"<div class='ssheet_filter_sign'></div>":""),!s&&!R&&("boolean"==typeof d||!E||di(e,f,"string")))if(f){var T={css:""},k=Fr(e,f);if(k){var O=k(d,T);O!=webix.i18n.spreadsheet.table["format-error"]?(T.css&&($='class="'.concat(T.css,'"')),d=O,l&&-1==["price","int","percent","date","string"].indexOf(f)&&(a=!0)):E||(d*=1)}}else d*=1;return e._print&&!d&&0!==d?"":(webix.isUndefined(d)||null===d?d="":a&&(d=webix.template.escape(d)),"<div ".concat($,">").concat(d,"</div>").concat(e._print?"":A))}function $l(e){var t=e.$$("cells");t.clearAll();for(var n=e.config.columnCount,r=e.config.rowCount,i=[{id:"rowId",header:"",width:40,css:"sheet_column_0",template:function(e){return e.id}}],o=1;o<=n;o++)i.push({id:o,editor:"text",header:{text:Fn[o]},liveEdit:!1===e.config.liveEditor,template:function(t,n,r,i){return Sl(e,t,0,0,i)},cssFormat:function(t,n,r,i){var o=El(e,r,i),a=e._mPage.getCell(r-1,i-1),l=a&&a.style||"",s=Xa(e,r,i,o);s&&(l+=(l?" ":"")+s);var u=ua(e,r,i);u&&(l+=(l?" ":"")+u);var c=dl(e,r,i,o);c&&(l+=(l?" ":"")+c);var h=_l(e,r,i)?wl:"";return h&&(l+=(l?" ":"")+h),l}}),e.callEvent("onColumnInit",[i[o]]);t.refreshColumns(i);for(var a=[],l=1;l<=r;l++)a.push({id:l});t.parse(a)}function El(e,t,n){return Sl(e,{id:t},0,0,{id:n},!0).replace(/<[^>]*>/gi,"")}function Rl(e){var t=e.$$("cells"),n=webix.env.isMac?"command":"ctrl";webix.UIManager.addHotKey(n+"-a",function(){t.getEditor()||ka(e)},t),webix.UIManager.addHotKey(n+"-p",function(t,n){return kl("print",e,n)},t),webix.UIManager.addHotKey(n+"-f",function(t,n){return kl("find",e,n)},t),webix.UIManager.addHotKey(n+"-h",function(t,n){return kl("find",e,n)},t),webix.UIManager.addHotKey(n+"-add",function(t,n){return Tl(e,"in",n)},t),webix.UIManager.addHotKey(n+"-=",function(t,n){return Tl(e,"in",n)},t),webix.UIManager.addHotKey(n+"-subtract",function(t,n){return Tl(e,"out",n)},t),webix.UIManager.addHotKey(n+"-0",function(t,n){return Tl(e,1,n)},t),webix.UIManager.addHotKey(n+"-`",function(){return e.showFormulas("toggle")},t);var r=webix.event(t.$view,"wheel",function(t){(t.ctrlKey||t.metaKey)&&Tl(e,t.deltaY<0?"in":"out",t)});if(e.attachEvent("onDestruct",function(){return webix.eventRemove(r)}),!e.config.readonly){webix.UIManager.addHotKey("any",function(e,n){var r=n.which||n.keyCode,i=113==r;if(!(16==r||r>=112&&r<=123&&!i)){var o=e.getSelectedId(!0);o.length&&(e.config.liveEditor&&i||(t.$anyKey=!0),t.edit(o[0]))}},t),webix.UIManager.addHotKey("enter",function(e){var n=e.getSelectedId(!0);n.length&&(e.config.liveEditor&&!t.callEvent("onBeforeLiveEditor",[n[0]])||t.edit(n[0]))},t),webix.UIManager.addHotKey("backspace",function(){return Al(e)},t),webix.UIManager.addHotKey("delete",function(){return Al(e)},t);var i=webix.env.isMac?"command-shift-z":"ctrl-y";webix.UIManager.addHotKey(i,function(){return e.redo()},t),webix.UIManager.addHotKey(n+"-z",function(){return e.undo()},t),webix.UIManager.addHotKey(n+"-b",function(){return Ol(e,"font-weight")},t),webix.UIManager.addHotKey(n+"-i",function(){return Ol(e,"font-style")},t),webix.UIManager.addHotKey(n+"-u",function(t,n){return function(e,t){return Ol(e,"underline"),webix.html.preventEvent(t)}(e,n)},t);var o=webix.env.isMac?"command-shift-x":"ctrl-alt-s";webix.UIManager.addHotKey(o,function(){return Ol(e,"strike")},t)}}function Al(e){e.$$("cells").getEditor()||Sn.set(function(){e.eachSelectedCell(function(t){return e.setCellValue(t.row,t.column,"")}),e.refresh()})}function Tl(e,t,n){return e.zoom(t),webix.html.preventEvent(n)}function kl(e,t,n){return t.callEvent("onCommand",[{id:e}]),webix.html.preventEvent(n)}function Ol(e,t){var n=e.getSelectedId();if(n){var r=e.getStyle(n.row,n.column),i=Yi[t]||t,o=r&&r.props[t]===i?"normal":i;e.callEvent("onStyleSet",[t,o])}}function Il(e){e.attachEvent("onComponentInit",function(){return function(e){var t=e.$$("liveEditor"),n=e.$$("navigation"),r=e._table;function i(n,r){var i=t.config.activeCell;i&&i.row==n&&i.column==r&&Nl(e,{row:n,column:r})}function o(n,r,i){if(!e.getCellEditor(r.row,r.column)&&Nl(e,r,i)){if(t.focus(),!i){t.paintValue();var o=t.getInputNode(),a=o.value.length;o.setSelectionRange(a,a)}return!1}return!0}function a(){t.define({activeCell:null}),t.setValue(""),t.disable()}r.attachEvent("onBeforeEditStart",function(e){var t=r.$anyKey;return r.$anyKey=!1,o(this,e,t)}),r.attachEvent("onBeforeLiveEditor",function(e){return o(this,e,!1)}),r.attachEvent("onItemDblClick",function(t){"rowId"!=t.column&&(e.getCellEditor(t.row,t.column)?this.edit(t):o(this,t,!1))}),r.attachEvent("onAfterScroll",function(){t.$view.contains(document.activeElement)&&t.paintValue()}),e.attachEvent("onCellChange",function(n,r,i,o){if(o==e.getActiveSheet()){var a=t.config.activeCell;a&&a.row==n&&a.column==r&&t.setValue(i)}}),e.attachEvent("onAfterSelect",function(t){e.$handleSelection||Nl(e,t[0])}),e.attachEvent("onChange",function(n){if("update"==n&&t.isEnabled()){var r=t.config.activeCell;r&&t.getValue()!=e.getCellValue(r.row,r.column)&&(delete t._update_range,t.showActiveSheet(),t.updateCellValue())}}),e.attachEvent("onBeforeSheetShow",function(i){if(!e._rangeDialog){var o=t.config.activeCell;if(o){var l=t.getInputNode().selectionStart,s=t.getValue();e.getCellValue(o.row,o.column)!=s?(t._activeMath||(t._activeMath=e.getActiveSheet()),webix.delay(function(){if(i==t._activeMath){e.$handleSelection=null;var n=t.config.activeCell;r.select(n.row,n.column)}t.setValue(s),t.refresh(),t.getInputNode().setSelectionRange(l,l),webix.delay(function(){return t.paintValue()}),e.$handleSelection=function(t,n,r,i){return Dl(e,r,i,t,n)}})):(n.setValue(""),a())}}}),e.attachEvent("onReset",function(){e._rangeDialog||(e.$handleSelection=null)}),e.$$("cells").attachEvent("onFocus",function(){t._activeMath&&webix.delay(function(){return t.focus()})}),e.attachEvent("onAfterLoad",function(){return a()}),e.attachEvent("onAction",function(n,r){if(!r.page||r.page==e.getActiveSheet()){var i=t.config.activeCell;if("paste"==n)return Nl(e,i);!(i&&i.row==r.row&&i.column==r.column)||"lock"!=n&&"dropdown"!=n||Ml(e,r.row,r.column)}}),e.attachEvent("onFormatChange",function(t,n,r,o,a){a==e.getActiveSheet()&&i(t,n)}),e.attachEvent("onCellChange",function(t,n,r,o){o==e.getActiveSheet()&&i(t,n)})}(e)});var t=webix.i18n.spreadsheet.liveEditor,n=!En.length;return{view:"toolbar",css:"webix_ssheet_toolbar",elements:[{view:"text",icon:"wxi-menu-down",on:{onItemClick:function(){var e=webix.$$(this.config.suggest);e.isVisible()||e.show(this.getInputNode())},onChange:function(t,n,r){"user"==r&&""!==t&&e.showCell(t)}},suggest:{view:"ssheet-suggest-labels",css:"webix_ssheet_nav_suggest",body:{template:"<span class='webix_ssheet_left'>#name#</span><span class='webix_ssheet_right'>#value#</span>",width:250},on:{onBeforeShow:function(){var t=e.ranges.serialize(e.getActiveSheet()).map(function(e){return{name:e[0],value:e[1]}});if(!t.length)return!1;var n=this.getList();n.clearAll(),n.parse(t)}},data:[]},width:150,id:"navigation"},{view:"ssheet-separator"},{view:"label",label:t.edit,width:65},{view:"button",id:"formulaButton",label:"f(x)",autowidth:!0,popup:{view:"popup",on:{onBeforeShow:function(){var t=this;if(!e.getSelectedId())return!1;webix.delay(function(){var e=bn(t.getBody().getChildViews(),4),n=e[0],r=e[1],i=e[3];n.setValue(""),r.focus(),r.setValue(""),i.unselect&&i.unselect(),i.scrollTo(0,0),i.filter()})},onHide:function(){e.$$("liveEditor").focus()}},width:250,body:{padding:10,rows:[{view:"richselect",label:t.category,hidden:n,options:[{id:"",value:"",$empty:!0},{id:"common",value:t.common}].concat(_n(En.map(function(e){return{id:e,value:t[e]||e}}))),on:{onChange:function(){Vl(this.getParentView().getChildViews())}}},{view:"text",label:t.search,on:{onTimedKeyPress:function(){Vl(this.getParentView().getChildViews())}}},{height:webix.skin.$active.inputPadding},{view:"list",saveFocus:!0,scroll:"y",data:Bt(),on:{onItemClick:function(t){ql(e,this,t)},onKeyPress:function(t){if(27==t)this.hide();else if(13==t){var n=this.getSelectedId();n&&ql(e,this,n)}}}}]}}},{view:"live-editor",disabled:!0,id:"liveEditor",suggestData:Bt()}]}}function Vl(e){var t=bn(e,4),n=t[0],r=t[1],i=t[3];r=r.getValue(),n=n.getValue(),i.filter(function(e){var t=-1!==e.value.toLowerCase().indexOf(r.toLowerCase()),i=!0;return n&&(i="common"==n?!$n[e.value]:$n[e.value]==n),t&&i}),i.scrollTo(0,0)}function Nl(e,t,n){var r=e.$$("liveEditor");if(r&&t){var i=Ml(e,t.row,t.column);return r.config.activeCell=t,r.setValue(n?"":r.getCellValue(t.row,t.column)),e._rangeDialog||(e.$handleSelection=i?null:function(t,n,r,i){return Dl(e,r,i,t,n)}),!i}}function Ml(e,t,n){var r=e.$$("liveEditor"),i=e.getCellEditor(t,n)||e.isCellLocked(t,n);return i?r.disable():r.enable(),i}function Dl(e,t,n,r,i){var o=e.$$("cells").getSpan(r.row,r.column);o&&r.row+1*o[3]-1==i.row&&r.column+1*o[2]-1==i.column&&(n=t);var a,l=e.$$("liveEditor"),s=l._update_range,u=l.getInputNode().selectionStart,c="";if(l._activeMath){var h=e.getActiveSheet();l._activeMath!=h&&(c=qi(h))}t==n?a=":"==l.getValue()[(s?s.pos:u)-1]?t:c+t:a="".concat(c+t,":").concat(n);if(s&&s.pos==u-s.len)l.setRange(a,!0),u=l._update_range.pos+a.length;else{if(!l.expectOperator())return function(e,t){var n=e.$$("liveEditor");if(n.isEnabled()){var r=n.config.activeCell;n.showActiveSheet(),n.updateCellValue(r),n.setValue(t?e.getCellValue(t.row,t.column):"")}return!0}(e,r);l.setRange(a),u+=a.length}return l.focus(),l.getInputNode().setSelectionRange(u,u),l.paintValue(),!1}function ql(e,t,n){var r=e.$$("liveEditor"),i=t.getItem(n).value,o=r.getValue(),a=i+"(";a=0==o.indexOf("=")?o+(r.expectOperator(!0)?"":"+")+a:"="+a,t.getParentView().hide(),r.setValue(a)}var zl=function(){return dn(function e(t){hn(this,e),this.view=t},[{key:"$init",value:function(){}},{key:"$show",value:function(){}},{key:"$hide",value:function(){}},{key:"open",value:function(){var e=this;if(this.$dialog){if(this.$dialog.isVisible())return}else this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",function(){e.$hide(),webix.UIManager.setFocus(e.view)}),this.$dialog.attachEvent("onShow",function(){webix.UIManager.setFocus(e.$dialog)});var t=this.$dialog.getBody();this.$dialog.show(),!1===this.$show(this.$dialog,t)&&this.close()}},{key:"close",value:function(){this.$dialog.hide()}}])}();function Pl(e){return e?('"'===(e=e.trim())[0]&&(e=e.substr(1)),'"'===e[e.length-1]&&(e=e.substr(0,e.length-1)),e):""}var Fl=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e,t){if(this.cell=this.view.getSelectedId(),!this.cell)return!1;t.elements.preview.setHTML(""),t.elements.url.setValue("");var n=function(e){if(e&&"string"==typeof e&&0===e.indexOf("=IMAGE("))return{url:Pl(e.substr(7,e.length-8))}}(this.view.getCellValue(this.cell.row,this.cell.column));n&&n.url&&t.elements.url.setValue(n.url),t.elements.url.focus()}},{key:"$init",value:function(){var e=this,t=this.view.config.save,n=t&&t.images||null;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["image-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["image-url"],on:{onChange:function(t){return e.showPreview(t)}}},{view:"label",label:webix.i18n.spreadsheet.labels["image-or"],align:"center"},{view:"uploader",label:webix.i18n.spreadsheet.labels["image-upload"],upload:n,on:{onBeforeFileAdd:function(e){var t=this;if(!this.config.upload){var n=new FileReader;return n.onload=function(e){return t.getFormView().elements.url.setValue(e.target.result)},n.readAsDataURL(e.file),!1}this.getFormView().elements.preview.setHTML("")},onFileUpload:function(e,t){this.getFormView().elements.url.setValue(t.imageURL)}}},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",template:"",height:50}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.cell,t=this.fillUrl(this.$dialog.getBody().elements.url.getValue());this.view.addImage(e.row,e.column,t),this.close()}},{key:"fillUrl",value:function(e){return/^[/]|((https?:\/|data:image)\/)/i.test(e)||(e="http://"+e),e}},{key:"showPreview",value:function(e){e&&(e=webix.template.escape(this.fillUrl(e)),this.$dialog.queryView("form").elements.preview.setHTML("<img class='webix_ssheet_cimage' src='"+e+"'></img>"))}}])}(zl),Ul=Object.freeze({__proto__:null,DialogBox:Fl,action:"add-image-cell"}),Ll=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"open",value:function(e){this.config=e.config,this.viewid=e.viewid,this.view.callEvent("onUIEditStart",[this.viewid,"image"]),Fl.prototype.open.apply(this,arguments)}},{key:"$hide",value:function(){this.view.callEvent("onUIEditStop",[this.viewid,"image"]),this.config=this.viewid=null}},{key:"$init",value:function(){var e=this;return this.view.attachEvent("onUIEditStart",function(t,n){e.$dialog&&e.$dialog.isVisible()&&"image"!=n&&e.close()}),this.view.attachEvent("onCommand",function(t){"close-ui-editor"==t.id&&e.$dialog&&e.$dialog.isVisible()&&e.close()}),Fl.prototype.$init.apply(this,arguments)}},{key:"$show",value:function(e,t){t.elements.preview.setHTML(""),t.elements.url.setValue(""),this.config&&this.config.data&&t.elements.url.setValue(this.config.data),t.elements.url.focus()}},{key:"okClick",value:function(){var e=this.fillUrl(this.$dialog.getBody().elements.url.getValue());if(this.viewid)this.view.views.update(this.viewid,e);else{var t=this.view.views.add(null,null,"image",e);this.view.views.highlight(t)}this.close()}}])}(Fl),Bl=Object.freeze({__proto__:null,DialogBox:Ll,action:"add-image-top"}),Hl=!1;function jl(e){Ql(e,-1)}function Wl(e){Ql(e,1)}function Xl(e){Hl||(e._ssUndoHistory=[],e._ssUndoCursor=-1)}function Kl(e,t){e.$skipHistory||e._loading_data||(e._ssUndoHistory.splice(e._ssUndoCursor+1),e._ssUndoHistory.push(t),e._ssUndoCursor++)}function Yl(e,t){t.$skipHistory++;try{e.call(t)}finally{t.$skipHistory--}}function Gl(e){Hl=!0,e(),Hl=!1}function Ql(e,t){var n=e._ssUndoHistory[t>0?e._ssUndoCursor+t:e._ssUndoCursor];if(n){var r=t>0?n.newValue:n.value,i=t>0,o=[n.action,n.row,n.column,r,i,n.extra];e._ssUndoCursor+=t;var a=n.group,l=e._ssUndoHistory[t>0?e._ssUndoCursor+t:e._ssUndoCursor];Yl(function(){e.callEvent("onUndo",o),a&&l&&a==l.group||(e.refresh(),e.callEvent("onAfterUndo",[]))},e),l&&a&&a==l.group&&Ql(e,t)}}var Zl,Jl=Object.freeze({__proto__:null,ignoreReset:Gl,ignoreUndo:Yl,init:function(e){Xl(e),function(e){e.attachEvent("onUndo",function(t,n,r,i){switch(t){case"freeze-row":e.freezeRows(i);break;case"freeze-column":e.freezeColumns(i)}})}(e),e.attachEvent("onHardReset",function(){return Xl(e)}),e.attachEvent("onAfterSheetShow",function(){return Xl(e)}),e.attachEvent("onBeforeStyleChange",function(t,n,r,i){if(_l(e,t,n))return!1;Kl(e,{action:"style",row:t,column:n,value:i,newValue:r,group:Sn.value})}),e.attachEvent("onBeforeValueChange",function(t,n,r,i,o){if(_l(e,t,n,o))return!1;o==e.getActiveSheet()&&Kl(e,{action:"value",row:t,column:n,value:i,newValue:r,group:Sn.value})}),e.attachEvent("onBeforeSpan",function(t,n,r){if(_l(e,t,n))return!1;Kl(e,{action:"span",row:t,column:n,value:r,newValue:r,group:Sn.value})}),e.attachEvent("onBeforeSplit",function(t,n,r){if(_l(e,t,n))return!1;Kl(e,{action:"split",row:t,column:n,value:r,newValue:r,group:Sn.value})}),e.attachEvent("onAction",function(t,n){n.page&&n.page!=e.getActiveSheet()||Kl(e,{action:t,row:n.row||null,column:n.column||null,value:webix.isUndefined(n.value)?null:n.value,newValue:webix.isUndefined(n.newValue)?null:n.newValue,extra:n.extra||null,group:Sn.value})}),e.$$("cells").attachEvent("onColumnResize",function(t,n,r){return Kl(e,{action:"c-resize",row:0,column:t,value:r,newValue:n,group:Sn.value})}),e.attachEvent("onColumnOperation",function(t,n,r,i){i==e.getActiveSheet()&&"add"!==t&&"del"!==t&&Kl(e,{action:{id:t,group:"column"},group:Sn.value,column:{start:{column:n},end:{column:r}}})}),e.attachEvent("onRowOperation",function(t,n,r,i){i==e.getActiveSheet()&&"add"!==t&&"del"!==t&&Kl(e,{action:{id:t,group:"row"},group:Sn.value,row:{start:{row:n},end:{row:r}}})}),e.$$("cells").attachEvent("onRowResize",function(t,n,r){return Kl(e,{action:"r-resize",row:t,column:0,value:r,newValue:n,group:Sn.value})}),e.attachEvent("onBeforeConditionSet",function(t,n,r,i,o){if(_l(e,t,n,o))return!1;o==e.getActiveSheet()&&(r=r?webix.copy(r):null,Kl(e,{action:"condition",row:t,column:n,value:r,newValue:i,group:Sn.value}))}),e.attachEvent("onZoom",function(t,n,r){r==e.getActiveSheet()&&Kl(e,{action:"zoom",value:n,newValue:t,group:Sn.value})}),e.$skipHistory=0},redo:Wl,reset:Xl,undo:jl});function es(e){clearTimeout(Zl),Zl=webix.delay(function(){var t=e.views;for(var n in t._pull){var r=t._pull[n],i=t._types[r.type],o=i.render,a=i.track;a&&ts(e,t.get(n),a,r,o)}})}function ts(e,t,n,r,i){var o=as(e,r);if("chart"==r.type){i&&(t=i(t,r,o,!0));var a=r.config;a&&!us(a.type)&&function(e,t,n){var r=t.config;"object"!=yn(r.legend)&&(r.legend={fromData:!!r.legend});var i=r.legend;if(i.fromData)e.shift();else if(i.range)for(var o=ls(n,t),a="rows"==r.dataSeries,l=hs(i.range,a,o),s=0;s<l.length;s++){var u=l[s];delete e[0][u]}}(o,r,e)}n(t,o)}function ns(e,t){for(var n in webix.callEvent("onClick",[]),e.views._pull){var r=webix.$$(n),i=e.views._pull[n];t&&(i.x=is(e,i.config.width,i.x,"x"),i.y=is(e,i.config.height,i.y,"y")),rs(e,r,i)}}function rs(e,t,n){var r=e._table.getScrollState();t.define({width:n.config.width*e._zoom,height:n.config.height*e._zoom}),t.resize(),t.show({x:n.x*e._zoom,y:n.y*e._zoom-r.y})}function is(e,t,n,r){if(n||0===n){var i=("x"==r?function(e){var t=0;return e._table.eachColumn(function(e){"rowId"!==e&&(t+=this.getColumnConfig(e).width)}),t/e._zoom}(e):function(e){var t=0;return e._table.data.each(function(e){t+=e.$height||webix.skin.$active.rowHeight}),t/e._zoom}(e))-t;n=Math.min(Math.max(n,0),i)}else n=e._table.getScrollState()[r]+50;return n}function os(e){return"string"==typeof e&&-1===e.indexOf("data:image")}function as(e,t){var n=t.data;if(/^(http|data:image|\/)/i.test(n))return n;var r=[];if(n){var i="rows"==t.config.dataSeries,o=0;n=ss(n);for(var a=0;a<n.length;a++){var l=os(n[a])?jn(n[a],e):null;if(l){var s=l[4]?e._mData.getPage(l[4]):e._mPage;if(l[5]=o,s){var u=i?ms.apply(s,l):fs.apply(s,l);o+=u[2];for(var c=0;c<u[0].length;c++)r[c]||(r[c]={}),webix.extend(r[c],u[0][c])}}}}return r}function ls(e,t){var n=t.data;if(!/^(http|data:image|\/)/i.test(n)){var r={};if(n){var i="rows"==t.config.dataSeries,o=0;n=ss(n);for(var a=0;a<n.length;a++){var l=os(n[a])?jn(n[a],e):null;if(l){var s=l[4]?e._mData.getPage(l[4]):e._mPage;if(l[5]=o,s){var u=i?ms.apply(s,l):fs.apply(s,l);o+=u[2],webix.extend(r,u[1])}}}}return r}}function ss(e){return e.replace(/\s/g,"").split(",")}function us(e){return/pie|donut/.test(e)}function cs(e,t,n,r,i){var o="rows"==n,a=[];if(t){var l=[],s=[],u=[];r&&(r.legend&&(s=hs(r.legend,o)),r.xAxis&&(l=hs(r.xAxis,o)),r.series&&(u=r.series.filter(function(e){return-1==s.indexOf(e.range)&&-1==l.indexOf(e.range)}))),t=ss(t);var c=0,h=1;t.forEach(function(t){var n=Gn(t)?jn(t,e):null;if(n){for(var r,d=o?n[0]:n[1],f=o?n[2]:n[3],m=function(){var e=o?Xn(g,n[1],g,n[3],n[4]):Xn(n[0],g,n[2],g,n[4]),i=rr(u,function(n){return n.range==e&&(!n.active||n.active==t)});i&&(i.active||(i.active=t),r=1)},g=d;g<=f;g++)m();for(var v=function(){var e=o?Xn(p,n[1],p,n[3],n[4]):Xn(n[0],p,n[2],p,n[4]);if(-1!=s.indexOf(e)||-1!=l.indexOf(e))return 0;var f,m,g=u.filter(function(n){return n.range==e&&n.active==t})[0];if(r&&!g&&(!i||!h||p!=d))return 0;a.push(g||{active:t,range:e,marker:"square",tooltip:1,color:(f=c,m=["#e06666","#6aa84f","#3c78d8","#e69138","#783f04","#134f5c","#674ea7","#c27ba0"],m[f%m.length])}),c++},p=d;p<=f;p++)v();h=0}})}return a}function hs(e,t,n){var r=[];return(e=ss(e)).forEach(function(e){if(e=Gn(e)?jn(e):null)for(var i=t?e[0]:e[1],o=t?e[2]:e[3],a=i;a<=o;a++){var l=t?Xn(a,e[1],a,e[3],e[4]):Xn(e[0],a,e[2],a,e[4]);r.push(n?n[l]:l)}}),r}function ds(e){return"object"!=yn(e.xAxis)&&(e.xAxis={fromData:!!e.xAxis}),"object"!=yn(e.legend)&&(e.legend={fromData:!!e.legend}),e.legend=webix.extend(e.legend,{layout:"x",align:"center",valign:"bottom"}),e.scale||(e.scale={lines:1}),e}function fs(e,t,n,r,i,o){for(var a=[],l={},s=e,u=0;s<=n;s++,u++){a[u]={};for(var c=t,h=o;c<=r;c++,h++)s==n&&(l["".concat(i?i+"!":"").concat(Fn[c]).concat(e,":").concat(Fn[c]).concat(n)]="data".concat(h),o++),a[u]["data".concat(h)]=this.getValue(s-1,c-1)}return[a,l,o]}function ms(e,t,n,r,i,o){for(var a=[],l={},s=t,u=0;s<=r;s++,u++){a[u]={};for(var c=e,h=o;c<=n;c++,h++)s==r&&(l["".concat(i?i+"!":"").concat(Fn[t]).concat(c,":").concat(Fn[r]).concat(c)]="data".concat(h),o++),a[u]["data".concat(h)]=this.getValue(c-1,s-1)}return[a,l,o]}var gs=Object.freeze({__proto__:null,_getDataParts:ss,_getParts:hs,_getSeries:cs,_isPie:us,_normalizeConfig:ds,init:function(e){var t,n=e._table.$view.querySelector(".webix_ss_center");e.views={register:function(e,t,n){this._types[e]||(this._types[e]={render:t,track:n})},move:function(t,n,r){var i=webix.$$(t),o=webix.copy(this._pull[t]);this._pull[t].x=is(e,o.config.width,n/e._zoom,"x"),this._pull[t].y=is(e,o.config.height,r/e._zoom,"y"),e.callEvent("onAction",["move-view",{row:t,newValue:webix.copy(this._pull[t]),value:o}]),rs(e,i,this._pull[t])},add:function(t,r,i,o,a,l){var s=this;a=a||{},"chart"==i&&(a=webix.extend(a,{type:"line",dataSeries:"columns"}));var u=a.height=a.height||300,c=a.width=a.width||500,h=webix.ui({id:l||"$ssheet-ui"+webix.uid(),view:"ssheet-ui",container:n,master:e._table.config.id,width:c,height:u});return h.attachEvent("onViewMoveEnd",function(t,n){var r=e._table.getScrollState();s.move(l,t,n+r.y)}),h.attachEvent("onViewResize",function(){var t=s._pull[l],n=webix.copy(t);t.config.height=h.$height,t.config.width=h.$width,e.callEvent("onAction",["resize-view",{row:l,newValue:webix.copy(t),value:n}])}),h.attachEvent("onViewEdit",function(){var t=s._pull[l],n=s._commands[t.type]||t.type;e.callEvent("onCommand",[{id:n,viewid:l,config:t}])}),h.attachEvent("onViewRemove",function(){return s.remove(l)}),l=h.config.id,t=is(e,u,t,"x"),r=is(e,c,r,"y"),this._pull[l]={x:t,y:r,type:i,data:o,config:a},this.update(l,o,a,!0),rs(e,h,this._pull[l]),l},remove:function(t){var n=this._pull[t];webix.$$(t).close(),delete this._pull[t],e.callEvent("onAction",["add-view",{row:t,newValue:null,value:n}])},get:function(e){return webix.$$(e).getBody()},getConfig:function(e){return this._pull[e]},update:function(t,n,r,i){var o=i?null:webix.copy(this._pull[t]),a=this._pull[t],l=this._types[a.type];if(n=n||r.data||"",delete(r=r||{}).data,"chart"==a.type){var s=r.type;if(s&&!r.series){var u,c=r.xAxis&&r.xAxis.range,h=r.legend&&r.legend.range;o&&o.config&&(us(s)?o.config.legend&&o.config.legend.fromData&&(u=1):o.config.xAxis&&o.config.xAxis.fromData&&(u=1)),r.series=cs(e,n,r.dataSeries,{xAxis:c,legend:h},u)}}var d=webix.$$(t),f=r.height||300,m=r.width||500;d.$width!=m&&d.$height!=f&&(d.define({width:m,height:f}),d.resize()),a.data=n,a.config=r;var g=this.get(t);if(n=as(e,a),l.render){var v=webix.copy(a);v.config.width=v.config.height=0,function(e){var t=function(e){return"datatable"==e.name||"treetable"==e.name},n=e.queryView(t,"self");n=n?[n]:e.queryView(t,"all");n.forEach(function(e){return e.disable()})}(g=l.render(g,v,n))}l.track&&ts(e,g,l.track,a),e.callEvent("onAction",["add-view",{row:t,newValue:webix.copy(this._pull[t]),value:o}])},highlight:function(e){var t=webix.$$(e),n="webix_ssheet_ui_focused",r=webix.$$(this._activeWin);r&&!r.$destructed&&webix.html.removeCss(r.$view,n),t?(this._activeWin=e,webix.html.addCss(t.$view,n)):delete this._activeWin},_commands:{image:"add-image-top",chart:"add-chart"},_types:{},_pull:{}},e._table.attachEvent("onResize",function(){return ns(e)}),e._table.attachEvent("onScrollY",function(){return ns(e)}),e._table.attachEvent("onScrollX",function(){return ns(e)}),e.attachEvent("onReset",function(){return function(e){Yl(function(){for(var t in e.views._pull)e.views.remove(t)},e)}(e)}),e.attachEvent("onUndo",function(t,n,r,i){var o="move-view"===t;(o||"resize-view"==t||"add-view"===t)&&function(e,t,n,r){if(r){var i=r.x,o=r.y,a=r.type,l=r.data,s=r.config;e.views._pull[n]?t?e.views.move(n,i,o):e.views.update(n,l,s):e.views.add(i,o,a,l,s,n);var u=e.$$("chartEditor");u&&u.viewId==n&&u.queryView("form").setValues(s)}else e.views.remove(n)}(e,o,n,i)}),e.attachEvent("onAction",function(t,n){"header-hide"==t?ns(e):"before-grid-change"==t&&function(e,t,n,r,i){for(var o=r.views,a=0;a<o.length;a++)if(os(o[a][3])){var l=o[a][4].series;l&&l.forEach(function(e){e.range=Jn(e.range,t,n,i),e.active=Jn(e.active,t,n,i)});var s=o[a][4].legend&&o[a][4].legend.range;s&&(o[a][4].legend.range=ss(s).map(function(e){return Jn(e,t,n,i)}).join(","));var u=o[a][4].xAxis&&o[a][4].xAxis.range;u&&(o[a][4].xAxis.range=Jn(u,t,n,i)),o[a][3]=ss(o[a][3]).map(function(e){return Jn(e,t,n,i)}).join(",")}}(0,n.name,n.inc,n.data,n.start)}),e.attachEvent("onZoom",function(t,n,r){r==e.getActiveSheet()&&ns(e,!0)}),e.attachEvent("onColumnOperation",function(t,n,r,i){i==e.getActiveSheet()&&ns(e,!0)}),e.attachEvent("onRowOperation",function(t,n,r,i){i==e.getActiveSheet()&&ns(e,!0)}),e.attachEvent("onDataParse",function(t){return function(e,t){var n=t.views;n&&Yl(function(){n.forEach(function(t){return e.views.add.apply(e.views,t)})},e)}(e,t)}),e.attachEvent("onDataSerialize",function(t,n){return function(e,t,n){for(var r in t.views=[],e.views._pull){var i=e.views._pull[r],o=[i.x,i.y,i.type,i.data,i.config];n&&n.viewIds&&o.push(r),t.views.push(o)}}(e,t,n)}),e.attachEvent("onCellChange",function(t,n,r,i){i==e.getActiveSheet()&&es(e)}),e.attachEvent("onMathRefresh",function(){return es(e)}),e.attachEvent("onDestruct",function(){for(var t in e.views._pull)webix.$$(t).destructor()}),webix.attachEvent("onClick",function(n){var r=webix.$$(n);r&&r.config.externalUI&&(r=webix.$$(r.config.externalUI));var i=r&&(r.queryView("ssheet-ui","self")||r.queryView("ssheet-ui","parent"));if(i){e.views.highlight(i);var o=i.config.id;t&&(e.views.getConfig(o).type==t?i.callEvent("onViewEdit",[]):e.callEvent("onCommand",[{id:"close-ui-editor"}]))}else t||e.views.highlight()}),e.attachEvent("onUIEditStart",function(n,r){e.views.highlight(n),t=r}),e.attachEvent("onUIEditStop",function(e,n){t==n&&webix.delay(function(){t=null})}),e.views.register("chart",function(t,n,r){var i=function(e,t,n){var r=/<[^>]*>/gi,i=webix.copy(e.config);i=ds(i);var o=i.scale.lines,a=i.scale.color||void 0,l=i.type=function(e){var t=e.type;e.stacked&&-1==t.indexOf("stacked")&&(e.type="stacked"+e.type.charAt(0).toUpperCase()+e.type.substr(1));e["3D"]&&-1==t.indexOf("3D")&&(e.type+="3D");e.horizontal&&-1==t.indexOf("H")&&(e.type+="H");return e.type}(i),s=us(l),u=i.series;i.series=[];var c,h,d=i.xAxis,f=i.legend,m={height:24,align:f.align||"center",valign:f.valign||"bottom"};if(m.layout="middle"==m.valign?"y":"x",s)f.fromData?c="data0":f.range&&(c=n[f.range]),m.template="#".concat(c,"#");else{if(m.values=[],h=!f.fromData&&f.range){var g="rows"==i.dataSeries;h=hs(f.range,g,n)}for(var v in i.yAxis=i.yAxis||{},i.yAxis)""===i.yAxis[v]&&delete i.yAxis[v];i.yAxis=webix.extend(i.yAxis,{lineColor:a,color:a,lines:o,lineShape:i.scale.circle?"arc":"default"}),d.fromData?d.range=h?Object.keys(t[0]).filter(function(e){return-1==h.indexOf(e)})[0]:"data0":d.range&&(d.range=n[d.range])}for(var p=0;p<u.length;p++){var w=u[p].color,b=n[u[p].range];if(b!=d.range&&(!s||b!=c)){var _={value:"#".concat(b,"#"),tooltip:{template:u[p].tooltip?"#".concat(b,"#"):""}};if(_[s?"pieInnerText":"label"]=u[p].label?"#".concat(b,"#"):"","radar"==l||"line"==l||"spline"==l||"scatter"==l?(_.line={color:w},_.item={borderColor:w,type:u[p].marker}):s||(_.color=w),"area"!=l&&"splineArea"!=l||(_.alpha=.7),t[0]&&!s&&(h||f.fromData)){var x=h?t[0][h[p]]:t[0][b],y=x||0===x?(x+"").replace(r,""):"";m.values.push({text:y,color:w})}i.series.push(_)}}s||(i.xAxis={title:i.xAxis.title,lineColor:a,color:a,lines:o},i["barH"==l||"stackedBarH"==l?"yAxis":"xAxis"].template=function(e){var t=e[d.range];return t||0===t?(t+"").replace(r,""):""});c||m.values&&m.values.length?i.legend=m:delete i.legend;"scatter"==l&&(i.xValue=i.xAxis.template,i.origin="auto",delete i.xAxis.template);return webix.extend({view:"chart",padding:{left:80}},i,!0)}(n,r,ls(e,n));return webix.ui(i,t)},function(e,t){e.clearAll(),e.parse(t)}),e.views.register("image",function(e,t,n){var r=webix.extend({css:"webix_ssheet_bgimage",template:'<img src="'.concat(n,'"/>')},t.config||{},!0);return webix.ui(r,e)})}}),vs=webix.i18n.spreadsheet.labels;function ps(e){e.attachEvent("onComponentInit",function(){return function(e){var t=e.$$("chartEditor"),n=t.queryView("form"),r=n.elements;function i(){if(r["legend.fromData"].getValue()){var e=us(r.type.getValue())?s:u;l(r["legend.range"],e())}}function o(e){e&&c("",r["legend.range"].getValue());var t=us(r.type.getValue())?s:u;e=e?t():"",l(r["legend.range"],e)}function a(e){e&&c("",r["xAxis.range"].getValue());e=e?s():"",l(r["xAxis.range"],e)}function l(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()}function s(){var t=r.range.getValue(),n=r.dataSeries.getValue(),i=r["legend.range"].getValue(),o="",a=cs(e,t,n,{legend:i||""});return a.length&&(o=a[0].range),o}function u(){var t=ss(r.range.getValue()),n="rows"==r.dataSeries.getValue(),i=ss(r["xAxis.range"].getValue()),o=[];return t.forEach(function(r){if(-1==i.indexOf(r)){var a=jn(r,e);if(a){var l=n?Xn(a[0],a[1],a[2],a[1],a[4]):Xn(a[0],a[1],a[0],a[3],a[4]);-1==t.indexOf(l)&&o.push(l)}}}),o.join(",")}function c(t,n){var i=r.range.getValue(),o=r["legend.range"].getValue(),a=r["xAxis.range"].getValue(),s=r.dataSeries.getValue(),u=cs(e,i,s,{legend:o,xAxis:a});n=ss(n),i=ss(i).filter(function(e){return-1==n.indexOf(e)}),t&&(t=ss(t)).forEach(function(e){u.filter(function(t){return t.range==e}).length||i.push(e)}),l(r.range,i.join(","))}function h(e){var t=r["legend.align"].getList();"middle"==e?t.exists("center")&&t.remove("center"):t.exists("center")||t.add({id:"center",value:vs["chart-legend-center"]},1)}function d(e){var t=r["legend.valign"].getList();"center"==e?t.exists("middle")&&t.remove("middle"):t.exists("middle")||t.add({id:"middle",value:vs["chart-legend-middle"]},1)}function f(e){i();var t=us(e),n="bar"==e,o=r.series,a="radar"==e||"line"==e||"spline"==e||"scatter"==e;o.hideSubviews("marker",a),o.hideSubviews("label",a||n||t),o.hideSubviews("color",!t),"area"==e||n?r.stacked.show():v(r.stacked),n?r.horizontal.show():v(r.horizontal),"radar"==e?r["scale.circle"].show():v(r["scale.circle"]),t?(p("axis"),p("pie",!0)):(p("axis",!0),p("pie")),t||"radar"==e?p("axisTitle"):p("axisTitle",!0),g()}function m(t){var n=r.range.getValue(),i=r.series.getValue(),o=r["legend.range"].getValue(),a=r["xAxis.range"].getValue(),l=r.dataSeries.getValue();i=cs(e,n,l,{series:i,legend:o,xAxis:a},t),r.series.setValue(i)}function g(){var e="rows"==r.dataSeries.getValue(),t=r.horizontal.getValue(),n=us(r.type.getValue());!n&&e||!e&&n?(r["legend.fromData"].define("label",vs["chart-col-legend"]),r["xAxis.fromData"].define("label",vs["chart-row-"+(t?"yAxis":"xAxis")])):(r["legend.fromData"].define("label",vs["chart-row-legend"]),r["xAxis.fromData"].define("label",vs["chart-col-"+(t?"yAxis":"xAxis")])),r["legend.fromData"].refresh(),r["xAxis.fromData"].refresh()}function v(e){e.setValue&&l(e),e.hide()}function p(e,t){n.queryView({batch:e},"all").forEach(function(e){t?e.show():v(e)})}function w(e){return[{value:"H",name:"horizontal"},{value:"stacked"},{value:"3D"}].forEach(function(t){-1!=e.type.indexOf(t.value)&&(e[t.name||t.value]=1,e.type=e.type.replace(t.value,"").toLowerCase())}),e}e.attachEvent("onCommand",function(i){if("add-chart"==i.id){var l=i.config,s=l&&l.config||{};t.show(),e.$handleSelection=function(n,i,o,a){var l=webix.UIManager.getFocus(),s=e.$$("cells").getSpan(n.row,n.column);if(s&&n.row+1*s[3]-1==i.row&&n.column+1*s[2]-1==i.column&&(a=o),t.queryView(function(e){return e==l}))if(l==r.range||l==r["legend.range"]){var u=l.getValue(),c=u.lastIndexOf(",");u=-1==c?"":u.substring(0,c+1),l.setValue(u+o+":"+a)}else l.config.range&&l.setValue(o+":"+a);return!1},n.clear(),e.$$("chartTabs").setValue("common"),(s=ds(s)).range=l?l.data:e.getSelectedRange(),t.viewId=i.viewid?i.viewid:e.views.add(null,null,"chart",s.range,s),e.callEvent("onUIEditStart",[t.viewId,"chart"]),d(s.legend.align),h(s.legend.valign);var u=w(s);n.setValues(u),f(u.type),!us(u.type)&&s.legend.fromData&&o(s.legend.fromData),s.xAxis.fromData&&a(s.xAxis.fromData),m(),n.queryView("accordionitem","all").forEach(function(e){return e.expand()}),r.range.focus()}}),e.attachEvent("onUIEditStart",function(n,r){t.isVisible()&&"chart"!=r&&ws(e)}),e.attachEvent("onCommand",function(n){"close-ui-editor"==n.id&&t.isVisible()&&ws(e)}),e.attachEvent("onAction",function(n,r){"add-view"!=n||r.newValue||t.isVisible()&&t.viewId==r.row&&ws(e)}),n.attachEvent("onChange",function(u,v){var p=this.$eventSource;if(p===r.range||p===r["xAxis.range"]||p===r["legend.range"]){var w=u.split("!"),b=2==w.length?w[0]+"!"+w[1].toUpperCase():u.toUpperCase();u!=b&&(u=b,l(p,b))}switch(p){case r.type:f(u);break;case r.horizontal:g();break;case r.range:case r.dataSeries:this.$eventSource==r.dataSeries&&g(),r["legend.fromData"].getValue()&&i(),r["xAxis.fromData"].getValue()&&l(r["xAxis.range"],s()),m();break;case r["xAxis.fromData"]:a(u),m(v);break;case r["legend.fromData"]:o(u),m(us(r.type.getValue())?v:0);break;case r["legend.align"]:d(u);break;case r["legend.valign"]:h(u);break;case r["xAxis.range"]:r["xAxis.fromData"].getValue()&&l(r["xAxis.fromData"]),c(u,v);break;case r["legend.range"]:r["legend.fromData"].getValue()&&l(r["legend.fromData"]),c(u,v)}var _=n.getValues();e.views.update(t.viewId,_.range,_)}),r.series.attachEvent("onRangeChange",c)}(e)});var t=webix.skin.$active,n=t.dataPadding-2,r=t.layoutMargin.form;return{width:440,hidden:!0,id:"chartEditor",css:"ssheet_chart",rows:[{height:t.barHeight,css:"ssheet_chart_wizard_head",padding:{left:4},cols:[{view:"icon",inputHeight:t.inputHeight,hotkey:"esc",icon:"webix_ssheet_icon ssi-arrow-left",click:function(){return ws(e)}},{type:"header",borderless:!0,template:vs["chart-edit"]}]},{view:"form",complexData:!0,borderless:!0,padding:{top:0},elementsConfig:{labelWidth:184},elements:[{view:"tabview",id:"chartTabs",cells:[{id:"common",borderless:!0,type:"form",paddingX:0,header:vs["chart-common"],rows:[{view:"scrollview",body:{margin:r,rows:[bs("type","chart-type",_s()),{view:"checkbox",label:vs["stacked-chart"],name:"stacked",hidden:!0},{view:"checkbox",label:vs["horizontal-chart"],name:"horizontal",hidden:!0},{view:"checkbox",label:vs["chart-pie-3d"],name:"3D",batch:"pie"},{view:"text",label:vs["chart-range"],name:"range"},{view:"checkbox",label:vs["chart-col-xAxis"],name:"xAxis.fromData",batch:"axis"},{view:"checkbox",label:vs["chart-row-legend"],name:"legend.fromData"},{view:"radio",label:vs["chart-data-from"],name:"dataSeries",vertical:!0,options:[{id:"columns",value:vs["chart-columns"]},{id:"rows",value:vs["chart-rows"]}]},{}]}}]},{id:"advanced",borderless:!0,type:"form",paddingX:0,padding:{bottom:0},header:vs["chart-series"],rows:[{view:"ssheet-series",name:"series"}]},{id:"extras",borderless:!0,type:"form",paddingX:0,header:vs["chart-extras"],rows:[{view:"scrollview",body:{view:"accordion",margin:webix.skin.$active.layoutMargin.form,css:"webix_ssheet_accordion",multi:!0,type:"clean",rows:[{header:vs["chart-legend"],body:{margin:r,padding:n,rows:[{view:"text",label:vs["chart-legend-range"],name:"legend.range"},bs("legend.align","chart-legend-align",[{id:"left",value:vs["chart-legend-left"]},{id:"center",value:vs["chart-legend-center"]},{id:"right",value:vs["chart-legend-right"]}]),bs("legend.valign","chart-legend-valign",[{id:"top",value:vs["chart-legend-top"]},{id:"middle",value:vs["chart-legend-middle"]},{id:"bottom",value:vs["chart-legend-bottom"]}])]}},{header:vs["chart-scale"],batch:"axis",id:"scale",body:{margin:r,padding:n,rows:[{view:"checkbox",label:vs["chart-lines"],name:"scale.lines",batch:"axis"},{view:"checkbox",label:vs["chart-radar-circle"],name:"scale.circle",hidden:!0},{view:"ssheet-colorpicker",label:vs["chart-scale-color"],name:"scale.color",batch:"axis"}]}},{header:vs["chart-x-axis"],batch:"axis",body:{margin:r,padding:n,rows:[{view:"text",label:vs["chart-xAxis-range"],name:"xAxis.range",range:!0,batch:"axis"},{view:"text",label:vs["chart-xAxis-title"],name:"xAxis.title",batch:"axisTitle"}]}},{header:vs["chart-y-axis"],batch:"axis",body:{margin:r,padding:n,rows:[{view:"text",label:vs["chart-yAxis-title"],name:"yAxis.title",batch:"axisTitle"},{view:"text",label:vs["chart-yAxis-origin"],name:"origin",batch:"axis",attributes:{type:"number"}},{view:"label",label:vs["chart-yAxis-note"],css:"ssheet_note",height:20},{view:"text",label:vs["chart-yAxis-start"],name:"yAxis.start",batch:"axis",attributes:{type:"number"}},{view:"text",label:vs["chart-yAxis-end"],name:"yAxis.end",batch:"axis",attributes:{type:"number"}},{view:"text",label:vs["chart-yAxis-step"],name:"yAxis.step",batch:"axis",attributes:{type:"number"}}]}},{}]}}]}]}]}]}}function ws(e){var t=e.$$("chartEditor");e.callEvent("onUIEditStop",[t.viewId,"chart"]),t.viewId=null,e.$handleSelection=null,t.hide()}function bs(e,t,n){return{view:"richselect",name:e,label:vs[t],suggest:{view:"ssheet-form-suggest",data:n}}}function _s(e){var t=[{id:"line",value:vs["line-chart"]},{id:"spline",value:vs["spline-chart"]},{id:"splineArea",value:vs["splinearea-chart"]},{id:"area",value:vs["area-chart"]},{id:"bar",value:vs["bar-chart"]},{id:"radar",value:vs["radar-chart"]},{id:"pie",value:vs["pie-chart"]},{id:"donut",value:vs["donut-chart"]}];return e||t.push({id:"scatter",value:vs["scatter-chart"]}),t}var xs=webix.i18n.spreadsheet.labels,ys=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e,t){var n=this;if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var r=t.elements;this.view.$handleSelection=function(e,t,i,o){var a=n.view.$$("cells").getSpan(e.row,e.column);return a&&e.row+1*a[3]-1==t.row&&e.column+1*a[2]-1==t.column&&(o=i),r.range.setValue(i+":"+o),!1},r.range.setValue("");var i=function(e){if(e&&"string"==typeof e&&0===e.indexOf("=SPARKLINE(")){var t=e.substr(11,e.length-12).split(","),n={range:t[0],type:Pl(t[1]),color:Pl(t[2]),negativeColor:Pl(t[3])};return"barH"==n.type&&(n.type="bar",n.horizontal=1),n}}(this.view.getCellValue(this.cell.row,this.cell.column));i&&(t.blockEvent(),r.type.setValue(i.type),r.range.setValue(i.range),i.color&&(r.color_def.setValue(i.color),r.color_pos.setValue(i.color)),i.negativeColor&&r.color_neg.setValue(i.negativeColor),i.horizontal&&r.horizontal.setValue(1),t.unblockEvent(),this.renderPreview()),r.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:xs["sparkline-title"],move:!0,position:"center",body:{view:"form",visibleBatch:1,on:{onChange:function(){return e.renderPreview()}},elements:[{view:"richselect",name:"type",label:xs["sparkline-type"],value:"line",labelPosition:"left",suggest:{view:"ssheet-form-suggest",data:_s(!0)},on:{onChange:function(e){var t=this.getFormView();switch(e){case"pie":case"donut":t.showBatch(3);break;case"bar":t.showBatch(2);break;default:t.showBatch(1)}}}},{view:"text",label:xs["sparkline-range"],name:"range"},{view:"ssheet-colorpicker",label:xs["sparkline-color"],name:"color_def",id:"add_sparkline_color",value:"#6666FF",batch:"1"},{view:"ssheet-colorpicker",label:xs["sparkline-positive"],name:"color_pos",value:"#6666FF",batch:"2"},{view:"ssheet-colorpicker",label:xs["sparkline-negative"],name:"color_neg",value:"#FF6666",batch:"2"},{view:"checkbox",label:xs["horizontal-chart"],name:"horizontal",batch:"2"},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",height:50}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"checkRange",value:function(e){if(e&&jn(e,this.view))return!0;this.view.alert({text:xs["error-range"]})}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();if(e.range=e.range.toUpperCase(),e.range&&this.checkRange(e.range)){var t=this.sparkConfig(e);this.view.addSparkline(this.cell.row,this.cell.column,t),this.close()}}},{key:"renderPreview",value:function(){var e=this.$dialog.getBody(),t=e.getValues();if(t.range=t.range.toUpperCase(),t.range&&this.checkRange(t.range)){for(var n=jn(t.range,this.view),r=this.view._mPage.getRange(n[0]-1,n[1]-1,n[2]-1,n[3]-1),i=this.sparkConfig(t,!0),o=0;o<r.length;o++)r[o]=r[o]||0;e.elements.preview.setValue(webix.Sparklines.getTemplate(i)(r,{width:200,height:40}))}else e.elements.preview.setValue("")}},{key:"sparkConfig",value:function(e,t){e=webix.copy(e);var n=this.$dialog.getBody();return"bar"===e.type?(e.color=e.color_pos,e.negativeColor=e.color_neg):n.elements.color_def.isVisible()?e.color=e.color_def:"donut"==e.type&&t&&webix.extend(e,{type:"pie",donut:1},!0),e}}])}(zl),Cs=Object.freeze({__proto__:null,DialogBox:ys,action:"add-sparkline"}),Ss=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e){var t=this,n=e.$$("form");n.clear(),n.clearValidation(),n.elements.name.focus();var r=this.view.getSelectedRange();r&&(r=Wn(this.view.getActiveSheet())+"!"+r),n.setValues({range:r,scope:"$global"}),this._updateData(),this.view._rangeDialog=!0,this.view.$handleSelection=function(e,r,i,o){var a=t.view.$$("cells").getSpan(e.row,e.column);return a&&e.row+1*a[3]-1==r.row&&e.column+1*a[2]-1==r.column&&(o=i),n.elements.range.setValue(function(e,t,n){return(n?Wn(n)+"!":"")+e+":"+t}(i,o,t.view.getActiveSheet())),!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null,this.view._rangeDialog=null}},{key:"saveClick",value:function(){var e=this.view,t=this.$dialog.$$("form"),n=t.getValues();if(n.range){var r=n.range.split("!");1==r.length&&r.unshift(Wn(e.getActiveSheet())),n.range=r[0]+"!"+r[1].toUpperCase()}if(n.name=n.name.toUpperCase(),t.setValues(n),t.validate()){var i=this.$dialog.$$("table");if(n.id){var o=i.getItem(n.id);e.ranges.remove(o.name,this._getScope(o)),i.updateItem(n.id,n)}else i.add(n);e.ranges.add(n.name,n.range,this._getScope(n)),e.refresh(),i.unselect(),t.setValues({scope:"$global"})}}},{key:"_getScope",value:function(e){return"$global"==e.scope||e.scope}},{key:"removeRange",value:function(e){var t=this,n=this.view;n.confirm({text:webix.i18n.spreadsheet.labels["range-remove-confirm"]}).then(function(){var r=t.$dialog.$$("table"),i=r.getItem(e);n.ranges.remove(i.name,t._getScope(i)),n.refresh(),r.remove(e)})}},{key:"editRange",value:function(e){var t=this.$dialog.$$("form"),n=this.$dialog.$$("table");t.clearValidation();var r=webix.copy(n.getItem(e));t.setValues(r)}},{key:"$init",value:function(){var e=this;this.view.attachEvent("onSheetRename",function(t,n){return e._updateData(t,n)}),this.view.attachEvent("onSheetRemove",function(t){return e._updateData(t)}),this.view.attachEvent("onSheetAdd",function(){return e._updateData()});var t=webix.i18n.spreadsheet.labels,n={padding:0,type:"clean",cols:[{view:"ssheet-dialog-table",id:"table",borderless:!0,columns:[{id:"name",header:t["range-name"],width:120},{id:"range",header:t["range-cells"],width:150},{id:"scope",header:t["range-scope"],width:95,template:function(e){return"$global"==e.scope?t["range-global"]:e.scope}},{template:"<span class='webix_icon ssheet_ranges_edit wxi-pencil'></span>",width:44},{template:"<span class='webix_icon ssheet_ranges_edit wxi-trash'></span>",width:44}],autowidth:!0,height:200,select:"row",on:{onBeforeSelect:function(t){return t==e.$dialog.$$("form").getValues().id}},onClick:{"wxi-trash":function(t,n){return e.removeRange(n)},"wxi-pencil":function(t,n){return e.editRange(n)}}},{width:270,view:"form",id:"form",rules:{name:function(t,n){return!e.$dialog.$$("table").find(function(e){return e.name==n.name&&e.scope==n.scope&&e.id!=n.id},!0)&&!bi(n.name)},range:Gn,scope:webix.rules.isNotEmpty},elementsConfig:{labelWidth:95},elements:[{view:"text",name:"name",label:t["range-name"]},{view:"text",name:"range",id:"range",label:t["range-cells"],on:{onFocus:function(){return e.view.showCell(e.$dialog.$$("range").getValue(),!0)}}},{view:"richselect",name:"scope",id:"sheets",label:t["range-scope"],suggest:{view:"ssheet-form-suggest",body:{data:[]}}}]}]};return{view:"ssheet-dialog",move:!0,head:webix.i18n.spreadsheet.labels["range-title"],autoheight:!0,width:800,position:"center",body:n,on:{onSaveClick:function(){return e.saveClick()},onCancelClick:function(){return e.close()}}}}},{key:"_updateData",value:function(e,t){if(this.$dialog.isVisible()){var n=this.view._mData.getRanges(),r=webix.i18n.spreadsheet.labels,i=this.$dialog.$$("table"),o=this.$dialog.$$("form"),a=i.getItem(o.getValues().id);if(a){var l=a.name;a=(l=e==a.scope?t?t+"!"+l:null:a.scope+"!"+l)?n.get(l):null}i.clearAll();for(var s,u=n.serialize(),c=[],h=0;h<u.length;h++){var d=h+1,f=bn(u[h],2),m=f[0],g=f[1];a&&n.get(m)==a&&(s=d);var v=m.split("!");c.push({scope:1==v.length?"$global":v[0],name:v[1]||v[0],range:g,id:d})}i.parse(c),o.setValues({id:s},!0),s&&i.select(s);var p=this.$dialog.$$("sheets"),w=p.getList();w.clearAll();var b=[{id:"$global",value:r["range-global"]}];if(this.view._sheets.forEach(function(e){b.push({id:e.name,value:e.name})}),w.parse(b),e){var _=this.$dialog.$$("range"),x=_.getValue();t=t||this.view.getActiveSheet(),0==x.indexOf(Wn(e)+"!")&&_.setValue(Wn(t)+"!"+x.split("!")[1]),p.getValue()==e&&p.setValue(t)}}}}])}(zl),$s=Object.freeze({__proto__:null,DialogBox:Ss,action:"add-range"}),Es=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(){var e=this,t=this.$dialog.$$("form");if(this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;t.clear();var n=this.view.getCellEditor(this.cell[0].row,this.cell[0].column);n&&t.setValues({range:n.options,empty:n.empty}),this.view.$handleSelection=function(n,r,i,o){var a=e.view.$$("cells").getSpan(n.row,n.column);return a&&n.row+1*a[3]-1==r.row&&n.column+1*a[2]-1==r.column&&(o=i),t.elements.range.setValue(i+":"+o),!1},t.elements.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",position:"center",head:webix.i18n.spreadsheet.labels["dropdown-title"],move:!0,body:{padding:0,view:"form",id:"form",elementsConfig:{labelWidth:130},rows:[{view:"text",label:webix.i18n.spreadsheet.labels["dropdown-range"],name:"range"},{view:"checkbox",label:webix.i18n.spreadsheet.labels["dropdown-empty-option"],name:"empty"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.$dialog.$$("form").getValues();jn(e.range,this.view)?(Sn.set(function(){for(var t=0;t<this.cell.length;t++)this.view.setCellEditor(this.cell[t].row,this.cell[t].column,{editor:"ss_richselect",options:e.range,empty:e.empty})},this),this.close()):this.view.alert({text:webix.i18n.spreadsheet.labels["error-range"],type:"alert-error"})}}])}(zl),Rs=Object.freeze({__proto__:null,DialogBox:Es,action:"add-dropdown"}),As=function(){return dn(function e(t){hn(this,e),this._master=t},[{key:"clear",value:function(e){var t=this,n="string"==typeof e?e:this._master.getActiveSheet();this.serialize(n).forEach(function(n){(!0!==e||n[2])&&t.remove(n[0],e)})}},{key:"_normalizeName",value:function(e,t){return!0!==t&&(e=(t||this._master.getActiveSheet())+"!"+e),e}},{key:"_normalizeRange",value:function(e,t){return 1==e.split("!").length&&(e=("string"==typeof t?t:this._master.getActiveSheet())+"!"+e),e}},{key:"add",value:function(e,t,n){var r=this._master;r.callEvent("onAfterRangeSet",[e,t,n]),e=this._normalizeName(e,n),r._mData.getRanges().add(e,this._normalizeRange(t,n)),r.callEvent("onMathRefresh",[])}},{key:"getCode",value:function(e,t){e=this._normalizeName(e,t);var n=this._master._mData.getRanges().get(e);if(n)return n.source}},{key:"remove",value:function(e,t){e=this._normalizeName(e,t),this._master._mData.getRanges().remove(e),this._master.callEvent("onMathRefresh",[])}},{key:"parse",value:function(e,t){if(e)for(var n=0;n<e.length;n++){var r=this._master._mData.getRanges(),i=bn(e[n],3),o=i[0],a=i[1],l=i[2];o=this._normalizeName(o,l||t),r.get(o)||r.add(o,this._normalizeRange(a,t))}}},{key:"serialize",value:function(e){e=e||this._master.getActiveSheet();for(var t=this._master._mData.getRanges().serialize(),n=[],r=0;r<t.length;r++){var i=t[r],o=i[0].split("!"),a=1==o.length;(a||o[0]==e)&&n.push([o[a?0:1],i[1],a])}return n}},{key:"getRanges",value:function(e){return this.serialize(e).map(function(e){return{name:e[0],range:e[1],global:e[2]}})}}])}();function Ts(e,t,n,r,i,o){for(var a=[],l=e._mPage===this,s=t-1;s<=r-1;s++)for(var u=n-1;u<=i-1;u++){for(var c=void 0,h=0;h<o.length;h++){var d=o[h],f=s+1,m=u+1;if((f!=d[0]||m!=d[1])&&f>=d[0]&&f<d[0]+d[3]&&m>=d[1]&&m<d[1]+d[2]){c=!0;break}}if(!c){var g=this.getCell(s,u),v=void 0;v=g?webix.copy(g):{value:""},l?v.$value=Sl(e,{id:s+1},0,0,{id:u+1},!0):delete v.format,v.id=v.value,a.push(v)}}return a}function ks(e,t,n){var r=[];if("string"==typeof t){var i=jn(t,e);if(i){var o=e._mPage;if(i[4]&&(o=e._mData.getPage(i[4])),o){var a=(o==e._mPage?Go(e,{}):rr(e._sheets,function(e){return e.name==i[4]}).content).spans;r=Ts.apply(o,[e,i[0],i[1],i[2],i[3],a])}}}else if(webix.isArray(t))for(var l=0;l<t.length;l++){var s=t[l]||0===t[l]?t[l]:"";s="object"===yn(s)?webix.copy(s):{id:s,value:s},r.push(s)}for(var u={},c=r.length-1;c>=0;c--){var h="boolean"==typeof r[c].value;h&&(r[c].value*=1),(h||0===r[c].id)&&(r[c].id=String(r[c].value)),n&&n.unique&&(u[r[c].id]?r.splice(c,1):u[r[c].id]=!0)}if(n){for(var d=!1,f=r.length-1;f>=0;f--){var m=r[f].value;m||0===m?r[f].value=String(m):(r.splice(f,1),d=!0)}n.order&&r.sort(function(t,n){var r=e.$$("cells").data.sorting.as,i=t.value,o=n.value;return webix.rules.isNumber(i)&&webix.rules.isNumber(o)?r.int(i,o):r.string(i,o)}),d&&n.filter&&r.unshift({id:"$empty",value:"",$value:"<span class='webix_ssheet_empty'>"+webix.i18n.spreadsheet.labels["dropdown-empty"]+"</span>"}),n.empty&&r.unshift({id:"$empty",$empty:!0,value:""})}return r}var Os=Object.freeze({__proto__:null,init:function(e){e.ranges=new As(e),e.attachEvent("onDataSerialize",function(t){t.ranges=e.ranges.serialize()})},rangeOptions:ks});function Is(e){e._table._ssFilters={},zs(e)}function Vs(e){var t=e._ssFilters,n=[];for(var r in t)for(var i in t[r])n.push(t[r][i]);return n}function Ns(e,t,n){var r=!1;Yn(t,e,function(e,t){e.getCellFilter(t.row,t.column,n)&&(n&&n!=e.getActiveSheet()||(r=!0),e.setCellFilter(t.row,t.column,null,n))}),r&&e.filterSpreadSheet()}function Ms(e,t,n,r,i,o){(r||(r={end:{row:t}}),r.end)&&(r=function(e,t,n,r,i,o){var a=Ps(e,t,n,o);if(t===r||a&&t==r-a[3]+1)for(r=t;r<e.config.rowCount;r++){var l=r+1,s=Ps(e,l,n,o);if(!s||s[0]==l){var u=e.getCellValue(l,n,!1,o?o.name:null);if(!u&&0!==u)break}}return i?r:Xn(t+1,n,r,n)}(e,t,n,r.end.row,i,o));return r}function Ds(e){return!!(e.includes||e.condition&&e.condition.filter)}function qs(e){var t=e._table._ssFilters;for(var n in t)for(var r in t[n])if(t[n][r])return!0;return!1}function zs(e){var t=qs(e);e.callEvent("onCommand",[{id:"toolbar-update",name:"create-filter",value:t}])}function Ps(e,t,n,r){return r?r.content.spans?rr(r.content.spans,function(e,r,i,o){return t>=e&&t<e+o&&n>=r&&n<r+i}):void 0:e._table.getSpan(t,n)}function Fs(e,t,n){for(var r=t+1;r<e.config.rowCount;r++){var i=e.getCellValue(r,n);if(i||0===i){var o=Ii(e,r,n);return"number"==o||"date"==o?o:"text"}if(""!==i)break}return"text"}function Us(e,t,n,r,i,o){var a=t.filter;a.options=Jn(a.options,"row",o.row,{column:t.col,row:t.row}),a.options=Jn(a.options,"column",o.column,{column:t.col,row:t.row}),a.lastRow&&(a.lastRow+=o.row),delete a.value,delete a.handler,e.setCellFilter(n,r,a)}function Ls(e,t){for(var n=Ba[e],r=0;r<n.length;r++)if(n[r].id==t)return n[r]}function Bs(e){return webix.copy(Ba[e])}function Hs(e,t){var n=t.includes,r=t.condition,i=Ls(e,r.type),o=i?i.handler:function(){return!0};if(n)for(var a=0;a<n.length;a++)n[a]=String(n[a]);return function(e){return n?-1!==n.indexOf(e):""===r.filter||o(e,r.filter)}}var js=Object.freeze({__proto__:null,calibrateRange:Ms,clearFilters:Ns,getConditions:Bs,getFilterFunction:Hs,getFilterMode:Fs,getFilters:Vs,getSingleOption:Ls,init:function(e){var t=e._table;e.attachEvent("onReset",function(){return Is(e)}),Is(e),t.on_click.ssheet_filter_sign=function(n,r){var i=t._ssFilters[r.row][r.column],o=i.mode||Fs(e,r.row,r.column),a=[];i.options&&("string"==typeof i.options?a=ks(e,i.options,{unique:!0,order:!0,filter:!0}):webix.isArray(i.options)&&(a=ks(e,i.options,{filter:!0}))),e.callEvent("onCommand",[{id:"start-filter",cell:r,mode:o,options:a,filter:i}])},t.on_dblclick.ssheet_filter_sign=function(){return!1},e.attachEvent("onCommand",function(t){"create-filter"===t.id&&function(e){var t=e._table.getSelectArea();qs(e)?(Sn.set(function(){return e.removeFilters()}),t&&e._table.addSelectArea(t.start,t.end)):t&&Sn.set(function(){for(var n=t.start.row,r=t.start.column;r<=t.end.column;r++)e.setCellFilter(n,r,{options:t,lastRow:Ms(e,n,r,t,!0)})});zs(e)}(e)});var n=!1;e.attachEvent("onUndo",function(r,i,o,a){if("filter"==r)a="object"==yn(a)?a:null,e.setCellFilter(i,o,a),n=!0;else if("apply-filter"==r){var l=e.getCellFilter(i,o);if(l.value=a,delete l.handler,a&&a.condition){var s=l.mode||Fs(e,i,o);l.handler=Hs(s,l.value)}n=!0;var u=a&&Ds(a);t[u?"addCellCss":"removeCellCss"](i,o,"ss_filter_active"),ea(e,i,o,"ss_filter_active",u)}}),e.attachEvent("onAfterUndo",function(){n&&(e.filterSpreadSheet(),n=!1)}),e.attachEvent("onAction",function(t,n){"filter"==t?n.page==e.getActiveSheet()&&(ea(e,n.row,n.column,"ss_filter",n.newValue),ea(e,n.row,n.column,"ss_filter_active",n.newValue&&n.newValue.value&&Ds(n.newValue.value)),zs(e)):"before-grid-change"==t&&function(e,t,n,r,i){var o=r.filters;if(n)for(var a=o.length-1;a>=0;a--){var l=bn(o[a],3),s=l[0],u=l[1],c=l[2];if("row"==t&&s>=i.row||"column"==t&&u>=i.column){if("row"==t){if(s<i.row-n){o.splice(a,1);continue}o[a][0]=1*s+n,c.lastRow&&(c.lastRow+=n)}else if("column"==t){if(u<i.column-n){o.splice(a,1);continue}o[a][1]=1*u+n}c.options=Jn(c.options,t,n,i)}}}(0,n.name,n.inc,n.data,n.start)})},isFilter:function(e,t,n){var r=e._table._ssFilters;return r[t]&&!!r[t][n]},isValueActive:Ds,load:function(e,t){var n=t.filters;if(n){for(var r=0;r<n.length;r++)e.setCellFilter(n[r][0],n[r][1],n[r][2]||{options:""});e.filterSpreadSheet()}},pasteFilter:Us,serialize:function(e,t){for(var n=Vs(e._table),r=t.filters=[],i=0;i<n.length;i++){var o=n[i],a=o.row,l=o.column,s=o.options,u=o.mode,c=o.value,h=o.lastRow;c=c&&webix.copy(c),r.push([a,l,{value:c,options:s,mode:u,lastRow:h}])}}}),Ws=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell,this.$mode=e.mode,this.$filter=e.filter,!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column))return!1;if(!this.$dialog){this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",function(){return t.$hide()});var n=this.view.$$("cells");n.attachEvent("onScrollY",function(){return t.syncScroll()}),n.attachEvent("onScrollX",function(){return t.syncScroll()})}if(!1===this.$show(this.$filter.value,e.options))return this.close();this.$dialog.show(this._getTargetNode())}},{key:"_getTargetNode",value:function(){var e=this.view.$$("cells");return e.getSpan(this.cell.row,this.cell.column)?e.getSpanNode(this.cell):e.getItemNode(this.cell)}},{key:"$show",value:function(e,t){var n=this.getList(),r=this.getFilter();r.config.mode!==this.$mode&&(r.define("conditions",this.getConditions(this.$mode)),r.define("mode",this.$mode));var i=e&&e.conditions&&e.conditions.type;i&&!Ls(this.$mode,i)&&(e=""),n.clearAll(),n.data.importData(t),r.config.value="",r.setValue(webix.copy(e||{}))}},{key:"$init",value:function(){var e=this,t=webix.i18n.spreadsheet.labels;return{view:"popup",css:"ssheet_filter",padding:7,relative:"right",body:{margin:4,rows:[{view:"filter",field:"value",mode:"text",conditions:this.getConditions("text"),inputs:["text",{view:"ssheet-datepicker",timepicker:!0,batch:"datepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}},{view:"ssheet-daterangepicker",timepicker:!0,batch:"daterangepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}}],template:function(e){return e.$value||e.value}},{cols:[{},{view:"button",label:t.cancel,autowidth:!0,css:"webix_transparent",on:{onItemClick:function(){return e.close()}}},{view:"button",label:t.apply,autowidth:!0,css:"webix_secondary",on:{onItemClick:function(){return e.applyFilter()}}}]}]}}}},{key:"applyFilter",value:function(){var e=this.getFilter(),t=this.$filter.value,n=this.$filter.value=e.getValue();this.$filter.handler=Hs(this.$mode,n),this.view.filterSpreadSheet(),this.view.callEvent("onAction",["apply-filter",{row:this.cell.row,column:this.cell.column,value:t,newValue:n}]),this.setCellStyle(this.cell.row,this.cell.column,"ss_filter_active",Ds(n)),this.close()}},{key:"setCellStyle",value:function(e,t,n,r){var i=this.view.$$("cells"),o=this.getSpan(i,e,t);o&&(r?-1==o[3].indexOf(n)&&(o[3]+=" "+n):o[3]=o[3].replace(" "+n,"")),i[r?"addCellCss":"removeCellCss"](e,t,n)}},{key:"getSpan",value:function(e,t,n){var r=e.getSpan()[t];if(r)return r[n]}},{key:"getList",value:function(){return this.getFilter().getChildViews()[2]}},{key:"getFilter",value:function(){return this.$dialog.getBody().getChildViews()[0]}},{key:"syncScroll",value:function(){if(this.$dialog.isVisible()){var e=this._getTargetNode(),t=this.view.$$("cells"),n=!1;if(e){var r=webix.html.offset(e),i=webix.html.offset(t.$view.getElementsByClassName("webix_ss_body")[0]),o=r.y-i.y,a=r.x-i.x+r.width;n=o<0||o+r.height>i.height||a<0||a-r.width>i.width-webix.env.scrollSize}!e||n?this.$dialog.show({x:-9999,y:-9999}):this.$dialog.show(e)}}},{key:"getConditions",value:function(e){for(var t=webix.i18n.filter,n=Bs(e),r=0;r<n.length;r++)n[r].id&&(n[r].value=t[n[r].id]);return n}}])}(zl),Xs=Object.freeze({__proto__:null,DialogBox:Ws,action:"start-filter"}),Ks=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(){if(this.form=this.$dialog.$$("form"),this.list=this.$dialog.$$("list"),this.preview=this.$dialog.$$("preview"),this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;this.fillForm(this.view),this.view.$handleSelection=function(){return!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"open",value:function(e){var n,r,i;this.group=e.group,(n="open",r=this,"function"==typeof(i=mn(gn(t.prototype),n,r))?function(e){return i.apply(r,e)}:i)([])}},{key:"$init",value:function(){var e=this,t=webix.i18n.spreadsheet,n=t.labels,r=t.formats,i=Pr("int"),o=[{name:"zeros",view:"counter",css:"webix_ssheet_counter",label:n["decimal-places"],value:0,batch:"common"},{name:"separator",view:"checkbox",label:n.separator,batch:"common"},{view:"richselect",name:"symbol",label:n["currency-symbol"],options:Mr,batch:"common"},{view:"formlist",label:n.negative,height:160,name:"negative",batch:"common",css:"webix_ssheet_format_negative",template:function(t){if(e.list){var n=e.getFormat(t.id),r={css:""},i=(n=Yr(n.fmt,n.delimiters))(-1234.56789,r);return"<span class='"+r.css+"'>"+i+"</span>"}},data:[{id:1},{id:2},{id:3},{id:4}]}],a=[{view:"text",label:n["format-pattern"],name:"format",labelPosition:"top",batch:"custom",placeholder:"[>100]0"+i.groupSign+"000"+i.decimalSign+"00;[>0]None"},{id:"docs",template:"<a href='https://webix-guides.gitbook.io/spreadsheet-user-guide/formatting_numbers#custom-number-format' target='_blank' class = 'docs'>"+n["format-docs"]+"</a>",borderless:!0,batch:"custom"}],l=[{name:"date",batch:"date",view:"formlist",labelWidth:90,height:160,label:n["date-format"],css:"webix_ssheet_format_date",template:function(e){return Yr(e.value,i)(45e3)},data:[r.dateFormat,r.timeFormat,r.fullDateFormat,r.longDateFormat]}];return{view:"ssheet-dialog",position:"center",width:460,head:n["format-title"],move:!0,body:{padding:0,cols:[{view:"list",id:"list",css:"webix_ssheet_format_type",width:120,scroll:!1,data:this.getFormats(),select:!0,on:{onSelectChange:function(t){switch(e.updateForm(),t[0]){case"custom":case"date":e.form.showBatch(t[0]);break;default:var n=e.form.elements;e.form.showBatch("common"),n.separator["percent"==t[0]?"hide":"show"](),n.symbol["price"==t[0]?"show":"hide"]()}}}},{view:"form",id:"form",height:340,paddingY:0,paddingX:20,elements:[{id:"preview",template:function(e){return e.value==t.table["format-error"]?e.value:"<span class ='"+e.css+"'>"+e.value+"</span>"},css:"webix_ssheet_format_preview",autoheight:!0,borderless:!0}].concat(o,a,l),elementsConfig:{labelWidth:140},on:{onChange:function(){return e.updateForm()}}}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.closeWin()}}}}},{key:"okClick",value:function(){var e=this,t=this.list.getSelectedId(),n="custom"==t?{format:this.form.getValues().format}:this.form.getValues();n.type=t,this.group?Vr(this.view,this.group,n.format,n):Sn.set(function(){for(var t=0;t<e.cell.length;t++)Wr(e.view,e.cell[t].row,e.cell[t].column,n.format,n)}),this.view.$$("cells").refresh(),this.closeWin()}},{key:"closeWin",value:function(){var e=vr(this.view,this.cell[0].row,this.cell[0].column)||"common";ii(e)||this.view.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:e}]),this.close()}},{key:"getFormat",value:function(e){var t=this.list.getSelectedId(),n=this.form.getValues();return n.negative=e||n.negative,"custom"!=t?("date"!=t&&(n.date=""),{fmt:ai(n=oi(t,n)),delimiters:Pr(t)}):{fmt:n.format,delimiters:Pr(t)}}},{key:"fillForm",value:function(e){var t,n=webix.i18n.spreadsheet,r=vr(e,this.cell[0].row,this.cell[0].column),i={zeros:0,separator:0,negative:1,date:n.formats.dateFormat,symbol:Mr[0].value,format:""},o=r||"";i.format=Ur(e,o||"price"),"custom"!=(t=o?"string"==o?o="custom":e._formats.formatHelpers[o].values.type:o="price")&&webix.extend(i,e._formats.formatHelpers[o].values,!0);var a=this.view.$$("cells").getItem(this.cell[0].row),l=this.cell[0].column;this.value=webix.isUndefined(a[l])?"":a[l],this.form.setValues(i),this.list.select(t),this.updateForm()}},{key:"updateForm",value:function(){var e=this.form.elements,t=this.getFormat(),n=this.value,r=""===n||isNaN(n);di(this.view,t,"date")&&(r||mi(n))?n=45e3:r&&!di(this.view,t,"string")&&(n=1234.56789);var i={css:""};n=Yr(t.fmt,t.delimiters)(n,i),this.view.config.xssSafe&&(n=webix.template.escape(n)),this.preview.parse({value:n,css:i.css}),e.negative.refresh(),e.date.refresh(),e.format.setValue(t.fmt)}},{key:"getFormats",value:function(){var e=webix.i18n.spreadsheet.labels;return[{id:"price",value:e.currency},{id:"int",value:e.number},{id:"percent",value:e.percent},{id:"date",value:e.date},{id:"custom",value:e["custom-format"]}]}}])}(zl),Ys=Object.freeze({__proto__:null,DialogBox:Ks,action:"custom"});var Gs=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"_rulesToArr",value:function(){var e=this.view.conditions.handlers;return[{value:webix.i18n.spreadsheet.labels["conditional-common"],disabled:!0,$css:"webix_ssheet_cformats_type"}].concat(_n(e.date),[{value:webix.i18n.spreadsheet.labels["conditional-text"],disabled:!0,$css:"webix_ssheet_cformats_type"}],_n(e.text)).map(function(e){return e.value||(e.value=webix.i18n.filter[e.id]),e})}},{key:"_getCondition",value:function(){var e=this,t=this.view,n=this._getDatalayout().getValue(),r=[];n.forEach(function(t){var n=[t.condition];"between"!=t.condition&&"notBetween"!=t.condition?n.push(e._normalizeValue(t.value,t.condition)):n.push([e._normalizeValue(t.value,t.condition),e._normalizeValue(t.value2,t.condition)]),n.push(t.style);for(var i=0;i<n.length;i++)if(""===n[i]||webix.isArray(n[i])&&-1!=n[i].indexOf(""))return!1;r.push(n)}),t.callEvent("onConditionSet",[r])}},{key:"_safeInt",value:function(e){var t=parseFloat(e);return t==e?t:e}},{key:"_setCondition",value:function(){var e=this,t=this.view.conditions.get(this.cell.row,this.cell.column),n=[];for(t&&t.forEach(function(t){var r={};r.condition=t[0],webix.isArray(t[1])?(r.value=e._formatValue(t[1][0],r.condition),r.value2=e._formatValue(t[1][1],r.condition)):r.value=e._formatValue(t[1],r.condition),r.style=t[2],n.push(r)});n.length<3;)n.push({});this._getDatalayout().setValue(n)}},{key:"_getDatalayout",value:function(){return this.$dialog.getBody().getChildViews()[0].getChildViews()[1].getBody()}},{key:"_formatValue",value:function(e,t){return t&&this._isNotDateRule(t)||!this.editFormat||""===e||"="==e[0]?e.toString():(e=On(e),this.editFormat(e))}},{key:"_normalizeValue",value:function(e,t){this._isNotDateRule(t)||(this.editFormat?isNaN(e)?"="!=e[0]&&(e=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(e),e=isNaN(e)?"":In(e)):e=mi(e)?"":e:e=this._safeInt(e,10));return e}},{key:"_isNotDateRule",value:function(e){return"equal"!=e&&"notEqual"!=e&&rr(this.view.conditions.handlers.text,function(t){return t.id==e})}},{key:"okClick",value:function(){this._getCondition(),this.close()}},{key:"$show",value:function(){var e=this;if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var t=Ii(this.view,this.cell.row,this.cell.column);"date"==t&&(this.editFormat=gi(this.view,this.cell.row,this.cell.column)),this.$dialog.queryView("text","all").forEach(function(n){n.define({placeholder:"date"==t?e._formatValue(45e3):""}),n.refresh()}),this.view.$handleSelection=function(t,n,r,i){if(e.activeValue){var o=e.view.$$("cells").getSpan(t.row,t.column);(r==i||o&&t.row+1*o[3]-1==n.row&&t.column+1*o[2]-1==n.column)&&e.activeValue.setValue("="+r)}return!1},this._setCondition()}},{key:"$hide",value:function(){this.view.$handleSelection=null,delete this.editFormat,this._getDatalayout().clearAll()}},{key:"getRows",value:function(e){var t=this,n=this;return{view:"form",padding:0,borderless:!0,css:"webix_ssheet_cformats",elements:[{margin:10,padding:{right:4},cols:[{view:"richselect",name:"style",width:120,placeholder:webix.i18n.spreadsheet.labels["conditional-style"],css:"webix_ssheet_cformat_select",suggest:{padding:0,borderless:!0,css:"webix_ssheet_cformat_list",body:{template:function(e){var t="webix_ssheet_cformat "+e.css;return'<div class="'.concat(t,'">').concat(e.name,"</div>")},data:e}}},{view:"richselect",width:150,name:"condition",placeholder:webix.i18n.spreadsheet.labels["conditional-operator"],on:{onChange:function(e){var t=this.getFormView().elements;if(n.editFormat){if(n._isNotDateRule(e))t.value.define({placeholder:""});else{var r=n._normalizeValue(t.value.getValue(),e);t.value.setValue(n._formatValue(r,e)),t.value.define({placeholder:n._formatValue(45e3)})}t.value.refresh()}"between"==e||"notBetween"==e?t.value2.show():t.value2.hide()}},suggest:{view:"ssheet-form-suggest",body:{data:this._rulesToArr()}}},{cols:[{view:"text",on:{onFocus:function(e){t.activeValue=e},onBlur:function(e){var n=e.getValue();if(""!==n){var r=e.getFormView().elements.condition.getValue();n=t._normalizeValue(n,r),e.setValue(t._formatValue(n,r))}}},name:"value"},{view:"text",name:"value2",on:{onFocus:function(e){t.activeValue=e},onBlur:function(e){var n=e.getValue();if(""!==n){var r=e.getFormView().elements.condition.getValue();n=t._normalizeValue(n,r),e.setValue(t._formatValue(n,r))}}},hidden:!0}]},{view:"icon",css:"webix_ssheet_cformat_icon",icon:"wxi-trash",click:function(e){var n=webix.$$(e).getFormView(),r=t._getDatalayout();r.getValue();var i=r.getChildViews().indexOf(n);r.remove(r.getIdByIndex(i)),r.count()<3&&r.add({})}}]}]}}},{key:"$init",value:function(){var e,t=this,n=webix.skin.$active.layoutMargin.form;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["conditional-format"],position:"center",width:770,move:!0,margin:n,body:{margin:0,rows:[{height:36,padding:{left:12},cols:[{view:"label",width:131,label:webix.i18n.spreadsheet.labels.display},{view:"label",width:161,label:webix.i18n.spreadsheet.labels.condition},{view:"label",label:webix.i18n.spreadsheet.labels.value},{view:"icon",css:"webix_ssheet_cformat_icon",icon:"wxi-plus-circle",click:function(){var e=t._getDatalayout();e.getValue(),e.add({})}},{width:4+webix.env.scrollSize}]},{view:"scrollview",maxHeight:3*webix.skin.$active.inputHeight+4,borderless:!0,scroll:"y",body:{view:"datalayout",padding:0,borderless:!0,rows:[this.getRows((e=this.view.config.conditionStyle,e.map(function(e){return e.id=e.css,e})))]}}]},on:{onSaveClick:function(){return t.okClick()},onCancelClick:function(){return t.close()}}}}}])}(zl),Qs=Object.freeze({__proto__:null,DialogBox:Gs,action:"conditional-format"}),Zs=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e,t){this.view.$handleSelection=function(){return!1},t.elements.sheets.setValue(this.getSheets()),t.elements.filename.setValue("Data"),t.elements.filename.getInputNode().select()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["export-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"filename",placeholder:webix.i18n.spreadsheet.labels["export-name"]},{view:"multicheckbox",name:"sheets",css:"webix_ssheet_multicheckbox"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"getSheets",value:function(){for(var e=this.view,t=e._sheets,n=[],r=0;r<t.length;r++){var i=t[r].state;"veryHidden"!=i&&n.push({name:t[r].name,hidden:"hidden"==i,active:e._activeSheet===t[r].name?1:0})}return n}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();webix.toExcel(this.view,e),this.close()}}])}(zl),Js=Object.freeze({__proto__:null,DialogBox:Zs,action:"excel-export"}),eu=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e,t){if(!this.view.getSelectedId())return!1;this.restoreValue(t)||t.clear(),t.elements.name.focus(),this.view.$handleSelection=function(e,n,r){return t.elements.url.setValue("#"+r),!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"restoreValue",value:function(e){var t=this.view.getSelectedId();if(t){var n=this.view.getCellValue(t.row,t.column);if(n&&"string"==typeof n&&0===n.indexOf("=HYPERLINK")){var r=n.split('"');return e.setValues({name:r[3]||"",url:r[1]||""}),!0}}return!1}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["link-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"name",placeholder:webix.i18n.spreadsheet.labels["link-name"]},{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["link-url"]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.view.getSelectedId(),t=this.$dialog.getBody().getValues(),n="";t.url&&(t.name=t.name||t.url,/^(#|(https?:\/\/))/i.test(t.url)||(t.url="http://"+t.url),n='=HYPERLINK("'.concat(t.url,'","').concat(t.name,'")')),this.view.setCellValue(e.row,e.column,n),this.view.refresh(),this.close()}}])}(zl),tu=Object.freeze({__proto__:null,DialogBox:eu,action:"add-link"}),nu=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e,t){var n=t.elements.sheets.getList();n.clearAll(),n.parse(this.getSheets(this.view)),t.setValues({data:"full",sheets:this.view.getActiveSheet()},!0)}},{key:"$init",value:function(){var e,t=this,n=webix.i18n.spreadsheet.labels,r=webix.env.printSizes.map(function(t){return"a4"==t.id&&(e="a4"),t.value=n["page-"+t.id]||t.id,t});return e||(e=r[0].id),{view:"ssheet-dialog",head:n["print-title"],move:!0,modal:!0,width:580,position:"center",buttons:!1,on:{onHide:function(){webix.extend(t.view._printBorders,t.getValues(),!0),sa(t.view,!0)}},body:{view:"form",elementsConfig:{labelWidth:0},elements:[{type:"section",template:n["print-settings"]},{cols:[{view:"radio",name:"data",vertical:!0,options:[{id:"full",value:n.sheets},{id:"selection",value:n.selection}],on:{onChange:function(e){var t=this.getFormView().elements,n=t.sheets;"full"==e?(t.sheetnames.setValue(1),n.enable()):n.disable()}}},{padding:{right:30},rows:[{name:"sheets",view:"multiselect",width:160,stringResult:!1,suggest:{selectAll:!0,body:{data:[]}}},{}]},{rows:[{view:"checkbox",name:"sheetnames",value:1,labelRight:n["sheet-names"]},{view:"checkbox",name:"borderless",labelRight:n.borderless},{view:"checkbox",name:"skiprows",labelRight:n["skip-rows"]},{view:"checkbox",name:"margin",labelRight:n.margin},{view:"checkbox",name:"external",labelRight:n["external-ui"]}]}]},{type:"section",template:n["print-paper"]},{view:"radio",name:"paper",value:e,options:r},{type:"section",template:n["print-layout"]},{rows:[{view:"radio",name:"fit",value:"page",options:[{id:"page",value:n["page-width"]},{id:"data",value:n["page-actual"]}]},{view:"radio",name:"mode",value:"landscape",options:[{id:"portrait",value:n["page-portrait"]},{id:"landscape",value:n["page-landscape"]}]}]},{cols:[{},{view:"button",css:"ssheet_cancel_button",hotkey:"esc",value:n.cancel,autowidth:!0,click:function(){return t.close()}},{view:"button",value:n["print-borders"],autowidth:!0,click:function(){return t.printPreview()}},{view:"button",value:n.print,hotkey:"enter",autowidth:!0,click:function(){return t.okClick()}}]}]}}}},{key:"getValues",value:function(){var e=this.$dialog.getBody().getValues({disabled:!1});return e.margin=e.margin?0:{},e}},{key:"printPreview",value:function(){this.close(),this.view.showPrintBorders(!0)}},{key:"getSheets",value:function(e){return e._sheets.map(function(e){return{value:e.name,id:e.name}}).filter(function(t){return Lo(e,t.id)})}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues({disabled:!1});e.margin=e.margin?0:{},this.close(),webix.print(this.view,e)}}])}(zl),ru=Object.freeze({__proto__:null,DialogBox:nu,action:"print"}),iu=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell?e.cell:this.view.getSelectedId(),!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column)&&!e.viewonly||!this.view.callEvent("onBeforeCommentShow",[this.cell.row,this.cell.column,!e.viewonly]))return!1;this.view.comments._activeComment={editStatus:!e.viewonly,cell:this.cell},this.$dialog||(this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.view.comments.commentsView=this.$dialog,this.$dialog.attachEvent("onHide",function(){return t.$hide()}),this.view.attachEvent("onCommentHide",function(){return t.$dialog.hide()}));var n=this.$dialog.getBody(),r=this.view.$$("cells").getSpan(this.cell.row,this.cell.column),i=r?{row:this.cell.row,column:1*r[1]+r[2]-1}:this.cell;webix.delay(function(){t.$dialog.show(t.view.$$("cells").getItemNode(i)),t._setComment()}),!1===this.$show(this.$dialog,n)&&this.close()}},{key:"$show",value:function(){this.textarea=this.$dialog.queryView({view:"textarea"}),this.template=this.$dialog.queryView({view:"template"})}},{key:"$init",value:function(){var e=this;return{view:"popup",css:"ssheet_comments",minWidth:250,minHeight:150,relative:"right",resize:!0,on:{onViewResize:function(){e.$dialog.hide(),e.$dialog.show(),e.textarea.isVisible()&&e.textarea.focus()}},body:{animate:!1,cells:[{view:"template",css:"ssheet_comment_view",borderless:!0,scroll:"auto",onClick:{ssheet_comment_view:function(){e.view.config.readonly||e.view.isCellLocked(e.cell.row,e.cell.column)||e.showInput(e.view.comments.get(e.cell.row,e.cell.column))}}},{view:"textarea",on:{onChange:function(){e.addComment()},onFocus:function(){e.view.comments._activeComment={editStatus:!0,cell:e.cell}},onBlur:function(){e.view.comments._activeComment={},e.$dialog.hide()}}}]}}}},{key:"_setComment",value:function(){var e=this.view.comments.get(this.cell.row,this.cell.column);this.view.comments._activeComment.editStatus?this.showInput(e):this.showTemplate(e)}},{key:"showTemplate",value:function(e){this.template.show(),this.template.setHTML(e)}},{key:"showInput",value:function(e){var t=this;this.view._commentSel=!0,this.view.$$("cells").select(this.cell.row,this.cell.column),delete this.view._commentSel,webix.delay(function(){t.changeTextarea(e),t.textarea.show(),t.textarea.focus()})}},{key:"addComment",value:function(){this.view.comments.add(this.cell.row,this.cell.column,this.textarea.getValue())}},{key:"changeTextarea",value:function(e){this.textarea.blockEvent(),this.textarea.setValue(e||""),this.textarea.unblockEvent()}}])}(zl),ou=Object.freeze({__proto__:null,DialogBox:iu,action:"add-comment"}),au=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"open",value:function(e){this.group=e.group,this.header=e.value,zl.prototype.open.apply(this,arguments)}},{key:"$show",value:function(){var e=this.view.getSelectedId();if(!e)return!1;this.view.$handleSelection=function(){return!1};var t=this.$dialog.getBody().elements;this.type=t.type,this.size=t.size,this.$dialog.getHead().getChildViews()[0].setHTML(this.header);var n,r=this.view.$$("cells");n="row"==this.group?r.getItem(e.row).$height||r.config.rowHeight:r.getColumnConfig(e.column).width||r.config.columnWidth,n/=this.view._zoom,this.type.getOption(1).value=webix.i18n.spreadsheet.labels["row"==this.group?"height":"width"],this.type.setValue(1),this.type.refresh(),this.size.setValue(Math.ceil(n)),this.size.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"okClick",value:function(){var e=this.type.getValue(),t="auto";1==e?t=1*this.size.getValue():3==e&&(t=this.view.$$("cells").config["row"==this.group?"rowHeight":"columnWidth"]),"row"==this.group?this.view.setRowHeight(null,t):this.view.setColumnWidth(null,t),this.close()}},{key:"$init",value:function(){var e=this,t=webix.i18n.spreadsheet.labels;return{view:"ssheet-dialog",position:"center",width:300,move:!0,body:{padding:0,cols:[{view:"radio",name:"type",vertical:!0,optionHeight:40,on:{onChange:function(t){1==t?e.size.enable():e.size.disable()}},options:[{id:1,value:""},{id:2,value:t["fit-content"]},{id:3,value:t["default-size"]}]},{rows:[{view:"text",name:"size",width:120}]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}}])}(zl),lu=Object.freeze({__proto__:null,DialogBox:au,action:"resize"}),su=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e,t){var n=this,r=this.cell=this.view.getSelectedId();if(!r)return!1;this.restoreValue(t,r),this.view.$handleSelection=function(e,t,r,i){var o=n.$dialog.getBody().elements.type.getValue();if(n.activeValue&&n.activeValue.isVisible()){if("range"==o){var a=n.view.$$("cells").getSpan(e.row,e.column);a&&e.row+1*a[3]-1==t.row&&e.column+1*a[2]-1==t.column&&(i=r)}n.activeValue.setValue("="+("range"!=o?r:r+":"+i))}return!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null,this.$dialog.getBody().clear()}},{key:"restoreValue",value:function(e,t){var n=this.view.validation.get(t.row,t.column);n||(n={}),webix.extend(n,{type:"any",errorHandle:"information"}),e.setValues(n),this.formatInput(e.elements.value),this.formatInput(e.elements.value2)}},{key:"prepareConditions",value:function(){var e=this.view.validation.handlers;for(var t in e)e[t].map(function(e){return e.value||(e.value=webix.i18n.filter[e.id]),e});this.handlers=e}},{key:"handleTypeChange",value:function(e,t){var n=this.$dialog.getBody(),r=n.elements,i=r.type.getValue(),o=r.condition;switch(i){case"any":n.showBatch("any");break;case"date":case"text":case"textLength":n.showBatch("value"),n.showBatch("condition",!0);break;case"number":n.showBatch("value"),n.showBatch("condition",!0),n.showBatch("number",!0);break;case"range":n.showBatch("value")}var a=o.getValue();if(o.isVisible()){o.getList().clearAll();var l=_n(this.handlers[i]);rr(l,function(e){return e.id==a})||o.setValue(),o.getList().parse(l),"between"==a||"notBetween"==a?r.value2.show():r.value2.hide()}else r.value2.hide();var s=webix.i18n.spreadsheet.labels,u={text:s["validation-placeholder-text"]||"some text",textLength:s["validation-placeholder-number"]||123,date:s["validation-placeholder-date"]||gi(this.view,this.cell.row,this.cell.column)(new Date),number:s["validation-placeholder-number"]||123,range:s["validation-placeholder-range"]||"=A1:A7"};r.value.config.placeholder=r.value2.config.placeholder=u[i],"date"==t?(r.value.setValue(this.normalizeValue(r.value.getValue(),"date")),r.value2.setValue(this.normalizeValue(r.value2.getValue(),"date"))):"date"==e&&(this.formatInput(r.value),this.formatInput(r.value2)),r.value.refresh(),r.value2.refresh()}},{key:"normalizeValue",value:function(e,t){webix.isUndefined(e)&&(e="");var n=isNaN(e);if(n&&"="==e[0])return e;"date"==(t=t||this.$dialog.getBody().elements.type.getValue())?e=n?""===(e=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(e))||isNaN(e)?"":In(e):mi(e)?"":e:"number"!=t&&"textLength"!=t||!n||(e="");return e}},{key:"formatValue",value:function(e,t){return"date"==t&&""!==e&&"="!=e[0]?(e=On(e),gi(this.view,this.cell.row,this.cell.column)(e)):e.toString()}},{key:"formatInput",value:function(e){var t=e.getValue();if(""!==t){var n=e.getFormView().elements.type.getValue();t=this.normalizeValue(t,n),e.setValue(this.formatValue(t,n))}}},{key:"$init",value:function(){var e=this;this.prepareConditions();var t=webix.i18n.spreadsheet.labels;return{view:"ssheet-dialog",width:500,head:t["add-cell-validation"],move:!0,position:"center",body:{view:"form",elementsConfig:{labelWidth:170},rules:{value:webix.rules.isNotEmpty,value2:webix.rules.isNotEmpty,condition:webix.rules.isNotEmpty,errorHandle:webix.rules.isNotEmpty},elements:[{view:"richselect",label:t["validation-type"],name:"type",options:[{id:"any",value:t["validation-any"]},{id:"date",value:t["validation-date"]},{id:"number",value:t["validation-number"]},{id:"text",value:t["validation-text"]},{id:"textLength",value:t["validation-text-length"]},{id:"range",value:t["validation-range"]}],on:{onChange:function(t,n){return e.handleTypeChange(t,n)}}},{view:"checkbox",label:t["validation-integer"],batch:"number",name:"integer"},{view:"checkbox",label:t["validation-ignore-empty"],batch:"value",name:"ignoreEmpty"},{label:t.condition,required:!0,batch:"condition",view:"richselect",name:"condition",on:{onChange:function(e){var t=this.getFormView().elements;"between"==e||"notBetween"==e?t.value2.show():t.value2.hide(),t.condition.validate()}},suggest:{view:"ssheet-form-suggest",body:{data:[]}}},{batch:"value",cols:[{label:t.value,required:!0,view:"text",on:{onFocus:function(t){return e.activeValue=t},onBlur:function(t){e.formatInput(t),t.validate()}},name:"value"},{view:"text",required:!0,name:"value2",width:150,on:{onFocus:function(t){return e.activeValue=t},onBlur:function(t){e.formatInput(t),t.validate()}},hidden:!0}]},{name:"inputMessage",view:"textarea",label:t["validation-input-message"]},{view:"richselect",batch:"value",label:t["validation-error-handle"],name:"errorHandle",options:[{id:"information",value:t["validation-error-information"]},{id:"warning",value:t["validation-error-warning"]},{id:"stop",value:t["validation-error-stop"]}],on:{onChange:function(){this.validate()}}},{name:"errorTitle",view:"text",batch:"value",label:t["validation-error-title"]},{name:"errorMessage",view:"textarea",batch:"value",label:t["validation-error-message"]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.$dialog.getBody();if(e.validate()){var t=e.getValues({hidden:!1});t.value=this.normalizeValue(t.value),t.value2&&(t.value=[t.value,this.normalizeValue(t.value2)],delete t.value2);var n=this.view;Sn.set(function(){return n.eachSelectedCell(function(e){"any"!=t.type||t.inputMessage?n.validation.add(e.row,e.column,t):n.validation.remove(e.row,e.column)})}),n.refresh(),this.close()}}}])}(zl),uu=Object.freeze({__proto__:null,DialogBox:su,action:"add-cell-validation"}),cu=function(e){function t(){return hn(this,t),cn(this,t,arguments)}return vn(t,e),dn(t,[{key:"$show",value:function(e,t){t.setValues({within:"sheet",in:"formulas"}),t.getChildViews()[1].clearAll(),t.focus()}},{key:"$hide",value:function(){delete this.sheetUpdated,delete this.settings}},{key:"$init",value:function(){var e=this;this.view.attachEvent("onChange",function(){e.$dialog.isVisible()&&(e.sheetUpdated=!0)});var t=webix.i18n.spreadsheet.labels,n=this.view.config.readonly;return{view:"ssheet-dialog",width:700,head:t[n?"find-title":"find-replace-title"],move:!0,buttons:!1,position:"center",body:{view:"form",elementsConfig:{labelWidth:120},elements:[{cols:[{width:320,rows:[{view:"text",name:"find",label:t["find-what"]},{view:"text",name:"replace",label:t["replace-with"],hidden:n}]},{width:10},{rows:[{view:"combo",name:"within",value:"sheet",labelWidth:180,label:t["find-within"],options:[{id:"sheet",value:t["find-sheet"]},{id:"book",value:t["find-book"]}]},{view:"combo",name:"in",value:"formulas",labelWidth:180,label:t["find-look-in"],options:[{id:"formulas",value:t["find-formulas"]},{id:"values",value:t["find-values"]}]},{view:"checkbox",name:"case",labelWidth:180,label:t["find-match-case"]},{view:"checkbox",name:"same",labelWidth:180,label:t["find-match-entire-content"]}]}]},{view:"ssheet-dialog-table",id:"table",resizeColumn:!0,borderless:!0,columns:[{id:"sheet",header:t["find-all-sheet"],width:150},{id:"cell",header:t["find-all-cell"]},{id:"value",header:t["find-all-value"],fillspace:!0},{id:"formula",header:t["find-all-formula"],fillspace:!0}],height:150,scroll:"y",select:"row",on:{onAfterSelect:function(){var t=e.$dialog.$$("table").getSelectedItem();e.view.showCell(Wn(t.sheet)+"!"+t.cell)}}},{cols:[{},{view:"button",css:"ssheet_cancel_button",hotkey:"esc",value:t.cancel,autowidth:!0,click:function(){return e.close()}},{view:"button",label:t["replace-all"],hidden:n,autowidth:!0,click:function(){return e.replaceAll()}},{view:"button",label:t.replace,hidden:n,autowidth:!0,click:function(){return e.replace()}},{view:"button",label:t["find-all"],autowidth:!0,click:function(){e.findAll(!0),e.findNext()}},{view:"button",label:t["find-next"],autowidth:!0,click:function(){return e.findNext()}}]}]}}}},{key:"replaceAll",value:function(){var e=this,t=this.$dialog.getBody().getValues();this.view.groupUndo(function(){e.findAll().forEach(function(n){return e.setNewValue(n,t)}),e.view.refresh()}),this.$dialog.$$("table").clearAll()}},{key:"replace",value:function(){var e=this.$dialog.getBody().getValues(),t=this.view.getSelectedId();if(t&&e.find){var n=this.view.getActiveSheet(),r=this.findCheck(this.view.getCellValue(t.row,t.column,"formulas"==e.in),t.row,t.column,n,e,[]);if(r.length){this.setNewValue(r[0],e),this.view.refresh();var i=this.$dialog.$$("table");if(i.count()){this.findNext();var o=i.find(function(e){return e.row==t.row&&e.col==t.column&&e.sheet==n},!0);i.remove(o.id)}}}}},{key:"setNewValue",value:function(e,t){var n=new RegExp(t.find.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),t.case?"g":"ig");this.view.setCellValue(e.row,e.col,(("formulas"==t.in&&e.formula||e.value)+"").replace(n,t.replace),e.sheet)}},{key:"findAll",value:function(e){var t=this,n=this.$dialog.$$("table");e&&n.clearAll();var r=this.$dialog.getBody().getValues();if(!r.find)return[];var i=[];return"sheet"==r.within?this.view.$$("cells").eachColumn(function(e){return t.view.$$("cells").eachRow(function(n){return t.findCheck(t.view.getCellValue(n,e,"formulas"==r.in),n,e,t.view.getActiveSheet(),r,i)})}):this.view.serialize({sheets:!0,math:"formulas"==r.in}).forEach(function(e){"visible"==e.state&&e.content.data.forEach(function(n){return t.findCheck(n[2],n[0],n[1],e.name,r,i)})}),e&&n.parse(i),i}},{key:"findCheck",value:function(e,t,n,r,i,o){var a=i.find;i.case||(a=i.find.toLowerCase());var l=e+"";if(i.case||(l=l.toLowerCase()),i.same&&l==a||!i.same&&-1!=l.indexOf(a)){var s=("formulas"==i.in?e:this.view.getCellValue(t,n,!0,r))+"";0==s.indexOf("=")&&s.length>1||(s="");var u="formulas"==i.in?this.view.getCellValue(t,n,!1,r):e;o.push({row:t,col:n,sheet:r,value:u,formula:s,cell:Xn(t,n)})}return o}},{key:"findNext",value:function(){var e=this,t=this.$dialog.$$("table"),n=this.$dialog.getBody().getValues();if(delete n.replace,n=JSON.stringify(n),(this.sheetUpdated||!t.count()||this.settings&&n!=this.settings)&&(this.settings=n,this.findAll(!0)),t.count()){var r=t.getSelectedId();if(!r){var i=this.view.getSelectedId();if(i){var o=t.find(function(t){return t.row==i.row&&t.col==i.column&&t.sheet==e.view.getActiveSheet()},!0);o&&(r=o.id)}}var a=r&&t.getNextId(r)||t.getFirstId();t.select(a),t.showItem(a)}}}])}(zl),hu=Object.freeze({__proto__:null,DialogBox:cu,action:"find"}),du=[Bl,Ul,Cs,$s,Rs,Xs,Ys,Qs,Js,tu,ru,ou,lu,uu,hu];function fu(e,t){return e.map(function(e){return e.value=fo(e.id,t),!e.submenu||"format-row"!==e.id&&"format-column"!==e.id||(e.submenu=fu(e.submenu,"format")),e})}function mu(e,t,n){Gl(function(){e.$handleSelection=null,e.parse(t),n&&(n.sheet&&e.showSheet(n.sheet),e._table.scrollTo(n.x,n.y))})}var gu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",function(t,n,r){if("add"==t.id||"del"==t.id){var i=e._table.getSelectArea();!i||n&&r||(n=i.start,r=i.end),n&&r&&("column"==t.group&&"add"==t.id&&Bn(e.config.columnCount+(r.column-n.column)+1),Sn.set(function(){!function(e,t,n,r){var i=r._table.getSelectArea(),o=r._table.getScrollState(),a="del"==e.id,l=r.serialize({sheets:a,viewIds:!0}),s=webix.copy(l),u={value:l,newValue:s};a||webix.extend(u,fn(fn({},e.group,t[e.group]),"extra",{count:n.row-t.row+1}));var c=a?rr(s,function(e){return e.name==r.getActiveSheet()}).content:s,h=[],d=c.spans;for(var f in d){var m=ra(d[f],e,t,n,0,c.data,h);(m[2]<=0||m[3]<=0)&&d.splice(f,1)}var g=function(e,t,n){var r=e.group,i="add"==e.id?1:"del"==e.id?-1:0;i&&("row"==r&&(i+=i*(n.row-t.row)),"column"==r&&(i+=i*(n.column-t.column)));return{name:r,inc:i}}(e,t,n);Yl(function(){r.callEvent("onAction",["before-grid-change",{name:g.name,inc:g.inc,data:c,start:t}])},r),"column"==e.group?a?function(e,t,n,r){var i=n.column-t.column+1;if(r.config.columnCount===i){if(t.column==n.column)return;n.column--,i--}r._mPage.removeColumn(t.column-1,i),r.config.columnCount-=i,r.callEvent("onColumnOperation",[e.id,t.column,n.column,r.getActiveSheet()])}(e,t,n,r):function(e,t,n,r){var i=n.column-t.column+1;r._mPage.addColumn(t.column-1,i),r.config.columnCount+=i,r.callEvent("onColumnOperation",[e.id,t.column,n.column,r.getActiveSheet()])}(e,t,n,r):"row"==e.group&&(a?function(e,t,n,r){var i=n.row-t.row+1;if(r.config.rowCount===i){if(t.row==n.row)return;n.row--,i--}r._mPage.removeRow(t.row-1,i),r.config.rowCount-=i,r.callEvent("onRowOperation",[e.id,t.row,n.row])}(e,t,n,r):function(e,t,n,r){var i=n.row-t.row+1;r._mPage.addRow(t.row-1,i),r.config.rowCount+=i,r.callEvent("onRowOperation",[e.id,t.row,n.row])}(e,t,n,r));var v=r.serialize();c.data=v.data,c.ranges=v.ranges,c.locked=v.locked,h.forEach(function(e){c.data.push(e)}),r.callEvent("onAction",["grid-change",u]),Yl(function(){mu(r,c,o),Nr(r,e,t,n)},r),i&&(i=function(e,t){var n=t.config,r=n.rowCount,i=n.columnCount;1*e.start.row>r&&(e.start.row=r);1*e.end.row>r&&(e.end.row=r);1*e.start.column>i&&(e.start.column=i);1*e.end.column>i&&(e.end.column=i);if(t.isRowVisible(e.start.row)&&t.isRowVisible(e.end.row)&&t.isColumnVisible(e.start.column)&&t.isColumnVisible(e.end.column))return e}(i,r),i&&r.$$("cells").addSelectArea(i.start,i.end))}(t,n,r,e)}))}}),e.attachEvent("onUndo",function(t,n,r,i,o,a){if("grid-change"==t){var l=e._table.getScrollState();a?o?e._mPage[n?"addRow":"addColumn"]((n||r)-1,a.count):e._mPage[n?"removeRow":"removeColumn"]((n||r)-1,a.count):l.sheet=e.getActiveSheet(),mu(e,i,l)}})}});function vu(e){e._table._ssEditors={}}function pu(e,t,n){e._table.editStop(),Yn(t,e,function(e,t){e.getCellEditor(t.row,t.column,n)&&e.setCellEditor(t.row,t.column,null,n)})}function wu(e,t,n,r,i){var o=t.dropdown;e.setCellEditor(n,r,o),1===i&&e.setCellEditor(t.row,t.col,{})}var bu,_u,xu,yu,Cu,Su,$u,Eu=Object.freeze({__proto__:null,clearEditors:pu,init:function(e){var t=e._table;e.attachEvent("onReset",function(){return vu(e)}),vu(e),t.attachEvent("onBeforeEditStart",function(t){var n=this.getColumnConfig(t.column);if(this._ssEditors[t.row]){var r=this._ssEditors[t.row][t.column];r&&(webix.extend(n,r,!0),webix.extend(n,{row:e.getRow(t.row)},!0),r.options&&("string"==typeof r.options?n.options=ks(e,r.options,{unique:!0,order:!0,empty:r.empty}):webix.isArray(r.options)&&(n.options=ks(e,r.options,{empty:r.empty})),n.collection&&(n.collection.clearAll(),n.collection.parse(n.options))))}}),t.attachEvent("onBeforeEditStop",function(t,n,r){if(!r&&n.getFormat){var i=n.getValue(),o=n.getFormat(i);Sn.set(function(){e.setCellValue(n.row,n.column,i),o?Wr(e,n.row,n.column,Ur(e,o)):Xr(e,n.row,n.column)});var a=e.getSelectedId();a&&a.row==n.row&&a.column==n.column&&(o=ii(o=o||"common")?"custom":o,e.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:o}]))}}),t.attachEvent("onAfterEditStop",function(e,t){var n=this.getColumnConfig(t.column);n.editor="text",delete n.popup,delete n.$popup,delete n.row}),e.attachEvent("onUndo",function(t,n,r,i){"dropdown"==t&&e.setCellEditor(n,r,i)}),e.attachEvent("onAction",function(t,n){"dropdown"==t?n.page==e.getActiveSheet()&&ea(e,n.row,n.column,"ss_editor",n.newValue):"before-grid-change"==t&&function(e,t,n,r,i){var o=r.editors;if(n)for(var a=o.length-1;a>=0;a--){var l=bn(o[a],3),s=l[0],u=l[1],c=l[2];if("row"==t&&s>=i.row||"column"==t&&u>=i.column){if("row"==t){if(s<i.row-n){o.splice(a,1);continue}o[a][0]=1*s+n}else if("column"==t){if(u<i.column-n){o.splice(a,1);continue}o[a][1]=1*u+n}c.options=Jn(c.options,t,n,i)}}}(0,n.name,n.inc,n.data,n.start)})},isEditor:function(e,t,n){var r=e._table._ssEditors;return r[t]&&!!r[t][n]},load:function(e,t){var n=t.editors;if(n)for(var r=0;r<n.length;r++)e.setCellEditor.apply(e,n[r])},pasteDropdown:wu,serialize:function(e,t){var n,r,i=e._table._ssEditors,o=[];for(n in i)for(r in i[n])o.push([n,r,i[n][r]]);t.editors=o}});function Ru(e,t,n,r){var i=e.$$("cells");xu=i.getSelectArea(),bu=function(e){var t=[],n=e._mData.getCopyManager();n.copy(e._mPage.cellID(xu.start.row-1,xu.start.column-1),e._mPage.cellID(xu.end.row-1,xu.end.column-1));for(var r=xu.start.row;r<=xu.end.row;r++){for(var i=[],o=xu.start.column;o<=xu.end.column;o++){var a=e.getCellValue(r,o);a=a&&"="==a[0]&&a.length>1?a:null;var l={text:e.getCellValue(r,o,!1),math:a,style:e.getStyle(r,o)},s=e.conditions.get(r,o),u=e.getCellEditor(r,o),c=e.getCellFilter(r,o),h=e._table.getSpan(r,o),d=e.validation.get(r,o);if(u||c||s||h||d){var f={row:r,col:o};s&&(f.condition=s),u&&(f.dropdown=u),c&&(f.filter=c),h&&(f.span=h),d&&(f.validation=d),l.extra=f}i.push(l)}t.push(i)}return t}(e),$u={page:e.getActiveSheet(),view:e},r&&n&&n.writeText&&n.writeText(t.value),_u=t.value,yu&&0!==Object.keys(i._ssFilters).length&&(Cu=function(e,t){for(var n=Object.keys(e),r=Math.min.apply(null,n),i=Math.max.apply(null,n),o=t,a=1,l=r;l<=i;l++)if(e[l]){var s=Object.keys(e[l]);o=Math.min(o,Math.min.apply(null,s)),a=Math.max(a,Math.max.apply(null,s))}return xu.start.row<=r&&xu.end.row>=i&&xu.start.column<=o&&xu.end.column>=a}(i._ssFilters,e.config.columnCount))}function Au(e,t){var n=Ou(t);return webix.rules.isNumber(e)&&n&&(e=webix.Number.numToStr(n)(e)),e}function Tu(e,t,n){n||(n="");var r=t.getSelectArea();if(r){var i=r.start,o=r.end,a=n===_u,l=a?bu:webix.csv.parse(n,t.config.delimiter);a||(l=function(e,t){var n=Ou(t);if(n)for(var r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++){var o=webix.Number.parse(e[r][i],n);webix.rules.isNumber(o)&&(e[r][i]=o)}return e}(l,e.config));var s={column:0,row:0},u=$u&&$u.view==e;!Su&&a||(yu=0,Cu=0);var c=e.serialize();Yl(function(){var n=l.length,r=l[0].length,c=o.column-i.column+1,h=o.row-i.row+1;if(function(e,t,n,r){var i,o=t.column+r[0].length-1;if(n>r.length){for(var a=0,l=n%r.length,s=0;s<l;s++)for(var u=0;u<r[s].length;u++)if(r[s][u].extra&&r[s][u].extra.span){var c=r[s][u].extra.span;if(c[0]==xu.start.row+s&&c[1]==xu.start.column+u){var h=s+c[3]-l;h>0&&(a=Math.max(h,a))}}i=t.row+n+a-1}else i=t.row+r.length-1;if(i>e.config.rowCount||o>e.config.columnCount){var d={id:"add"};i>e.config.rowCount&&(d.group="row",e.callEvent("onCommand",[d,{row:e.config.rowCount+1},{row:i}])),o>e.config.columnCount&&(d.group="column",e.callEvent("onCommand",[d,{column:e.config.columnCount+1},{column:o}]))}}(e,i,h,l),a){if(s.column=i.column-xu.start.column,s.row=i.row-xu.start.row,Cu){var d=t.getSelectArea();e.removeFilters(),t.addSelectArea(d.start,d.end)}var f=yu||Cu||!(h>n||c>r)?0:2;if("conditions"!=Su)if(1==yu)u&&e._mData.getCopyManager().move(e._mPage.cellID(i.row-1,i.column-1),e._mData.getStore().getMeta().$clipboard),$u&&!$u.view.$destructed&&$u.view.groupUndo(function(){for(var e=xu.start.row;e<=xu.end.row;e++)for(var t=xu.start.column;t<=xu.end.column;t++)$u.view.setCellValue(e,t,null,$u.page),$u.view.setStyle(e,t,null,$u.page)});else if(u){var m;Su&&(m=function(e,t){switch(Su){case"formulas":return webix.extend(e,{value:t.formula||t.value},!0);case"styles":return webix.extend(e,{style:t.style,format:t.format},!0);case"values":return webix.extend(e,{value:t.value},!0);case"validation":return webix.extend(e,{validation:t.validation},!0)}}),e._mData.getCopyManager().paste(e._mPage.cellID(i.row-1,i.column-1),e._mPage.cellID(Math.max(i.row+xu.end.row-xu.start.row,o.row)-1,Math.max(i.column+xu.end.column-xu.start.column,o.column)-1),e._mData.getStore().getMeta().$clipboard,f,m)}if(2==f)for(var g=0,v=0;g<Math.max(h,n);g++,v++){v==l.length&&(v=0);for(var p=0,w=0;p<Math.max(c,r);p++,w++){w==l[0].length&&(w=0);var b={id:"move",column:s.column+Math.floor(p/r)*r,row:s.row+Math.floor(g/n)*n,cut:yu};ku(e,i.row+g,i.column+p,l[v][w],b)}}else t.mapCells(i.row,i.column,n,null,function(t,n,r,i,o){if(l[i]&&l[i].length>o){var a=l[i][o];ku(e,n,r,a,s)}},!0);1==yu&&(yu=2,Cu=!1)}else for(var _=0,x=0;_<Math.max(h,n);_++,x++){x==l.length&&(x=0);for(var y=0,C=0;y<Math.max(c,r);y++,C++)C==l[0].length&&(C=0),e.setCellValue(i.row+_,i.column+y,l[x][C])}},e),e.callEvent("onAction",["paste",{value:c,newValue:e.serialize()}]),e.callEvent("onCommand",[{id:"toolbar-update"}]),e.refresh()}}function ku(e,t,n,r,i){if("object"===yn(r)){var o=$u&&$u.view==e;if((!o||$u.page!=e.getActiveSheet())&&(o||Su&&"values"!=Su&&"formulas"!=Su||e.setCellValue(t,n,r.math&&"values"!=Su?e._mData.getStore().transposeMath(r.math,i.row,i.column):r.text),r.style&&r.style.props&&(!Su||"styles"==Su))){var a=e.addStyle(r.style.props);e.setStyle(t,n,a)}var l=r.extra;l&&(!l.condition||Su&&"conditions"!=Su||rl(e,l,t,n,yu),l.dropdown&&!Su&&wu(e,l,t,n,yu),l.filter&&Cu&&Us(e,l,t,n,0,i),!l.validation||Su&&"validation"!=Su||ml(e,l,t,n,yu)),Su||ia(e,l,t,n,yu,i),e.saveCell(t,n,e.getActiveSheet())}}function Ou(e){var t=e.clipboardNumberFormat;return!t&&e.clipboardDecimalDelimiter&&(t={decimalDelimiter:e.clipboardDecimalDelimiter,decimalOptional:!0}),t&&webix.extend(t,{minusSign:webix.i18n.minusSign,minusPosition:webix.i18n.minusPosition}),t}var Iu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onSheetRename",function(t,n){$u&&$u.page==t&&$u.view==e&&($u.page=n)}),e.attachEvent("onSheetRemove",function(t){$u&&$u.page==t&&$u.view==e&&($u=null)});var t=e.config.clipboard,n=navigator.clipboard;if(!1!==t){webix.clipbuffer.init();var r=document.querySelector(".webix_clipbuffer"),i=e.$$("cells");i.attachEvent("onSelectChange",function(){return function(e,t){if(e._loading_data)return;var n=e.$$("cells");n.getSelectedId()&&webix.delay(function(){for(var r=[],i=n.getSelectArea(),o=i.start.row;o<=i.end.row;o++){for(var a=[],l=i.start.column;l<=i.end.column;l++)a.push(Au(e.getCellValue(o,l,!1),e.config));r.push(a)}var s=webix.csv.stringify(r,n.config.delimiter);n.getEditor()?t.value=s:(t.focus(),webix.clipbuffer.set(s)),webix.UIManager.setFocus(n)})}(e,r)}),i.attachEvent("onKeyPress",function(t,n){67!==t&&88!==t||!n.ctrlKey&&!n.metaKey||!i.getSelectedId()||(yu=1*(88===t),Ru(e,r))}),e.attachEvent("onCommand",function(t){-1!=t.id.indexOf("paste")?(Su=t.id.split("-")[1],n&&n.readText?n.readText().then(function(t){webix.clipbuffer.set(t),Tu(e,i,r.value)}).catch(function(){Tu(e,i,_u)}).finally(function(){Su=null}):(Tu(e,i,_u),Su=null)):"copy"!=t.id&&"cut"!=t.id||(yu=1*("cut"==t.id),Ru(e,r,n,!0))}),e.attachEvent("onUndo",function(t,n,r,o){if("paste"==t){var a=i.getScrollState(),l=i.getSelectArea();Gl(function(){e.$handleSelection=null,e.parse(o),i.addSelectArea(l.start,l.end),i.scrollTo(a.x,a.y)})}}),e.config.readonly||i.attachEvent("onPaste",function(t){Tu(e,i,t)})}}});function Vu(e,t){t?e["_hidden_"+t+"_hash"]={}:(e._hidden_cols_hash={},e._hidden_rows_hash={},e.filterSpreadSheet())}function Nu(e,t,n){if(!n||n==e.getActiveSheet())return!e._hidden_cols_hash[t];var r=Uo(e,n);if(r){var i=r.content.table;return!(i&&i.hidden&&i.hidden.column)||!rr(i.hidden.column,function(e){return e==t})}}function Mu(e,t,n,r,i){if(!(t||i&&i!=e.getActiveSheet())){var o=e.getSelectedId(!0);if(!o.length)return;t=[o[0][r],o[o.length-1][r]]}var a,l=(a=t,webix.isArray(a)?a:[a,a]);n?("row"==r?Uu:Fu)({id:"hide"},fn({},r,l[0]),fn({},r,l[1]),e,!1,i):("row"==r?Pu:zu)({id:"hide"},fn({},r,l[0]),fn({},r,l[1]),e,!1,i)}function Du(e,t,n){if(!n||n==e.getActiveSheet())return!e._hidden_rows_hash[t];var r=Uo(e,n);if(r){var i=r.content.table;return!(i&&i.hidden&&i.hidden.row)||!rr(i.hidden.row,function(e){return e==t})}}function qu(e){"column"==e.group?"show"==e.id?zu.apply(this,arguments):"hide"==e.id&&Fu.apply(this,arguments):"row"==e.group&&("show"==e.id?Pu.apply(this,arguments):"hide"==e.id&&Uu.apply(this,arguments))}function zu(e,t,n,r,i,o){if((o=o||r.getActiveSheet())==r.getActiveSheet()){var a=r.$$("cells"),l=a.getSelectArea(),s=r._hidden_cols_hash;if(e.neighbors)if(s[t.column-1])for(;s[t.column-1];)t.column--;else for(;s[n.column+1];)n.column++;Sn.set(function(){for(var e=t.column;e<=n.column;e++)if(s[e]){delete s[e];var i=a.getColumnConfig(e-1||"rowId").header[0];i.css=i.css.replace("webix_ssheet_hide_column",""),a.showColumn(e)}var o=r._frozenColumns;o&&o>=t.column&&(r.freezeColumns(0),r.freezeColumns(o)),l&&a.addSelectArea(l.start,l.end)},r)}else{var u=Uo(r,o);if(!u)return;var c=u.content.table;if(c&&c.hidden&&c.hidden.column)for(var h=function(e){var t=ir(c.hidden.column,function(t){return t==e});-1!=t&&c.hidden.column.splice(t,1)},d=t.column;d<=n.column;d++)h(d)}i||r.callEvent("onColumnOperation",[e.id,t.column,n.column,o])}function Pu(e,t,n,r,i,o){if((o=o||r.getActiveSheet())==r.getActiveSheet()){var a=r.$$("cells"),l=a.getSelectArea(),s=r._hidden_rows_hash;if(e.neighbors)if(s[t.row-1])for(;s[t.row-1];)t.row--;else for(;s[n.row+1];)n.row++;Sn.set(function(){var e=r._frozenRows;e&&r.freezeRows(0);for(var i=t.row;i<=n.row;i++)if(s[i])if(delete s[i],i-1==0){var o=a.getColumnConfig("rowId").header[0];o.css=o.css.replace("webix_ssheet_hide_row",""),a.refreshColumns()}else a.removeCellCss(i-1,"rowId","webix_ssheet_hide_row");r.filterSpreadSheet(),e&&r.freezeRows(e),l&&a.addSelectArea(l.start,l.end)},r)}else{var u=Uo(r,o);if(!u)return;var c=u.content.table;if(c&&c.hidden&&c.hidden.row)for(var h=function(e){var t=ir(c.hidden.row,function(t){return t==e});-1!=t&&c.hidden.row.splice(t,1)},d=t.row;d<=n.row;d++)h(d)}i||r.callEvent("onRowOperation",[e.id,t.row,n.row,o])}function Fu(e,t,n,r,i,o){if((o=o||r.getActiveSheet())==r.getActiveSheet()){var a=r.$$("cells"),l=n.column;if(r.$handleSelection=null,a.unselect(),n.column<1||t.column<1)return void delete r._hidden_cols_hash[t.column];for(;l>=t.column;){if(-1!=a.getColumnIndex(l)){r._hidden_cols_hash[l]=l;var s=a.getColumnConfig(l-1||"rowId").header[0];s.css=(s.css||"")+" webix_ssheet_hide_column",a.hideColumn(l)}l--}}else{var u=Uo(r,o);if(u){var c=u.content.table;c||(c=u.content.table={}),c.hidden||(c.hidden={}),c.hidden.rows||(c.hidden.column=[]);for(var h=function(e){rr(c.hidden.column,function(t){return t==e})||c.hidden.column.push(e)},d=t.column;d<=n.column;d++)h(d)}}i||r.callEvent("onColumnOperation",[e.id,t.column,n.column,o])}function Uu(e,t,n,r,i,o){if((o=o||r.getActiveSheet())==r.getActiveSheet()){if(n.row<1||t.row<1)return void delete r._hidden_rows_hash[t.row];var a=r._frozenRows;a&&r.freezeRows(0);for(var l=r.$$("cells"),s=n.row;s>=t.row;){if(r._hidden_rows_hash[s]=s,s-1==0){var u=l.getColumnConfig("rowId").header[0];u.css=(u.css||"")+" webix_ssheet_hide_row",l.refreshColumns()}else l.addCellCss(s-1,"rowId","webix_ssheet_hide_row");s--}r.filterSpreadSheet(),a&&r.freezeRows(a)}else{var c=Uo(r,o);if(c){var h=c.content.table;h||(h=c.content.table={}),h.hidden||(h.hidden={}),h.hidden.row||(h.hidden.row=[]);for(var d=function(e){rr(h.hidden.row,function(t){return t==e})||h.hidden.row.push(e)},f=t.row;f<=n.row;f++)d(f)}}i||r.callEvent("onRowOperation",[e.id,t.row,n.row,o])}var Lu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",function(t){if("show"==t.id||"hide"==t.id){var n=e._table.getSelectArea();n&&qu(t,webix.copy(n.start),webix.copy(n.end),e)}}),Vu(e),e.attachEvent("onUndo",function(t,n,r,i,o){if(!("hide"!=t.id&&"show"!=t.id||"column"!=t.group&&"row"!=t.group)){var a=t.id;o||(a="hide"==a?"show":"hide");var l=n||r;qu({id:a,group:t.group,neighbors:t.neighbors},l.start,l.end,e,!0)}}),e.attachEvent("onHardReset",function(){return Vu(e)}),e.attachEvent("onAction",function(t,n){"before-grid-change"==t&&function(e,t,n,r,i){if(r.table&&r.table.hidden&&r.table.hidden[t]&&r.table.hidden[t].length){Vu(e,"column"==t?"cols":"rows");for(var o=i[t],a=r.table.hidden[t],l=a.length-1;l>=0;l--){var s=1*a[l];n>0&&s>=o?a[l]=n+s:n<0&&s>=o&&(s<o-n?a.splice(l,1):a[l]=n+s)}}}(e,n.name,n.inc,n.data,n.start)})},isColumnVisible:Nu,isRowVisible:Du,load:function(e,t){if(Vu(e),!webix.isUndefined(t.table)&&!webix.isUndefined(t.table.hidden)){var n=t.table.hidden;if(n.row&&n.row.length)for(var r=0;r<n.row.length;r++)Uu({id:"hide"},{row:n.row[r]},{row:n.row[r]},e,!0);if(n.column&&n.column.length)for(var i=0;i<n.column.length;i++)Fu({id:"hide"},{column:n.column[i]},{column:n.column[i]},e,!0)}},reset:Vu,serialize:function(e,t){var n=[],r=[];for(var i in e._hidden_rows_hash)n.push(i);for(var o in e._hidden_cols_hash)r.push(o);(n.length||r.length)&&(t.table.hidden={}),n.length&&(t.table.hidden.row=n),r.length&&(t.table.hidden.column=r)},setState:Mu});var Bu=Object.freeze({__proto__:null,init:function(e){var t=e._table,n=0;t.attachEvent("onAreaDrag",function(){return n=new Date}),t.attachEvent("onBeforeAreaRemove",function(){if(e.$handleSelection&&new Date-n<500)return!1}),t.attachEvent("onBeforeAreaAdd",function(n){if("rowId"==n.start.column)return!1;var r=t.getEditor();if(!r||r.row==n.start.row&&r.column==n.start.column&&r.row==n.start.row&&r.column==n.start.column||t.editStop(),!e.$handleSelection)return!0;var i=Fn[n.start.column]+n.start.row,o=Fn[n.end.column]+n.end.row,a=e.$handleSelection(n.start,n.end,i,o);return!1!==a&&(e.$handleSelection=null,t.removeSelectArea()),a}),t.attachEvent("onBeforeBlockSelect",function(n,r,i){if(!e.config.readonly&&i&&t.$handleStart){var o=t.getSelectArea(),a=o.start,l=o.end,s=n.row,u=r.row,c=n.column,h=r.column;if(a.row==s&&l.row>u)e.clearRange({start:{row:u+1,column:c},end:{row:l.row,column:h}},{values:!0});else if(a.column==c&&l.column>h)e.clearRange({start:{row:s,column:h+1},end:{row:u,column:l.column}},{values:!0});else{var d;if(s!=a.row||u!=l.row?d="row":c==a.column&&h==l.column||(d="column"),d){Sn.start();for(var f="row"==d,m=webix.i18n.calendar,g=m.dayShort,v=m.dayFull,p=m.monthShort,w=m.monthFull,b={dayShort:[g,g.map(function(e){return e.toLowerCase()})],dayFull:[v,v.map(function(e){return e.toLowerCase()})],monthShort:[p,p.map(function(e){return e.toLowerCase()})],monthFull:[w,w.map(function(e){return e.toLowerCase()})]},_=f?c:s;_<=(f?h:u);_++){for(var x=[],y=[],C=a[d];C<=l[d];C++){var S=void 0,$=void 0,E=bn("row"==d?[C,_]:[_,C],2),R=E[0],A=E[1],T=e.getCellValue(R,A);if("string"==typeof T)for(var k in b){var O=b[k][1],I=O.indexOf(T.toLowerCase());if(-1!=I){var V=O[I];T==V?$="lower":T==V.toUpperCase()&&($="upper"),S=k,T=I;break}}webix.rules.isNumber(T)?(y.type!=S&&(y=[]),y[0]?(y[1]=C,webix.isUndefined(y.inc)&&(y.inc=T-y.firstValue)):(y.firstValue=T,y.type=S,y.case=$,y[0]=y[1]=C),x[C]={value:T,border:y}):y=[]}for(var N=a[d]==(f?s:c),M=N?a[d]:l[d],D=N?1:-1,q=N?l[d]+1:a[d]-1,z=0,P=1;N?q<=(f?u:h):q>=(f?s:c);N?q++:q--,z++){z==l[d]-a[d]+1&&(P++,z=0);var F=M+z*D,U=bn(f?[F,_]:[_,F],2),L=U[0],B=U[1],H=void 0,j=x[F];if(j){if(H=j.value,H+=(0===(j=j.border).inc?0:j.inc||1)*(j[1]-j[0]+1)*P*D,j.type){var W=b[j.type][0],X=W.length;H=W[(H%X+X)%X],j.case&&(H="upper"==j.case?H.toUpperCase():H.toLowerCase())}}else"string"==typeof(H=e.getCellValue(L,B))&&"="==H[0]&&H.length>0&&(H=f?e._mData.getStore().transposeMath(H,q-M-z*D,0):e._mData.getStore().transposeMath(H,0,q-M-z*D));var K=bn(f?[q,_]:[_,q],2),Y=K[0],G=K[1];e.setCellValue(Y,G,H),e.setStyle(Y,G,e.getStyle(L,B));var Q=e.conditions.get(L,B);Q?rl(e,{condition:Q},Y,G):e.conditions.clear(Y,G)}}Sn.end()}}}}),webix.event(t.$view,"mousedown",function(t){if(e.$handleSelection)return webix.html.preventEvent(t)})}});function Hu(e,t,n){var r=n.getItem(e)[t];return void 0!==r&&""!==r}var ju={int:function(e,t){return function(n,r){var i=n[t],o=r[t];return o||0===o?i||0===i?("0"===i&&(i=0),"0"===o&&(o=0),((i="number"==typeof i?i:parseFloat(i)||e*(1/0))>(o="number"==typeof o?o:parseFloat(o)||e*(1/0))?1:i==o?0:-1)*e):1:-1}},str:function(e,t){return function(n,r){if(!r[t])return-1;if(!n[t])return 1;var i=n[t].toString().toLowerCase(),o=r[t].toString().toLowerCase();return(i>o?1:i==o?0:-1)*e}}};function Wu(e,t,n){if(t=t||e._table.getSelectArea()){var r=t=Kn(t,e);t.start.row===t.end.row&&(r=function(e,t){for(var n=t.config.rowCount,r=t.config.columnCount,i=t._table,o=e.start.row,a=e.end.row,l=e.start.column,s=e.end.column,u=o-1;u>0&&Hu(u,e.start.column,i);u--)o=u;for(var c=a+1;c<n&&Hu(c,e.end.column,i);c++)a=c;for(var h=l-1;h>0&&Hu(e.start.row,h,i);h--)l=h;for(var d=s+1;d<r&&Hu(e.end.row,d,i);d++)s=d;var f={start:{row:o,column:l},end:{row:a,column:s}};return o==e.start.row&&a==e.end.row&&l==e.start.column&&s==e.end.column||t._table.addSelectArea(f.start,f.end),f}(t,e));var i=e.getCellValue(t.start.row,t.start.column,!1),o=isNaN(parseFloat(i))?"str":"int";n=n&&"asc"!==n?-1:1,Sn.set(function(){return function(e,t,n,r,i){for(var o=e.start.column;o<=e.end.column;o++){for(var a=[],l=e.start.row;l<=e.end.row;l++)if(i.isRowVisible(l)){var s=i.getCellValue(l,o,!1),u=i.getStyle(l,o),c=i.getCellValue(l,o);c=c&&"="==c[0]?c:null;var h=i.isCellLocked(l,o);h&&i.lockCell(l,o,!1);var d=i.conditions.get(l,o);d&&il("remove",l,o,d,null,i),a.push({value:s,style:u,math:c,row:l,conditions:d,locked:h})}a.sort(ju[n](r,"value"));for(var f=e.start.row;f<=e.end.row;f++)if(i.isRowVisible(f)){var m=a.shift();if(i.setStyle(f,o,m.style||null),m.conditions&&il("update",f,o,null,m.conditions,i),m.math){var g=i._mData.getStore().transposeMath(m.math,f-m.row,0);i.setCellValue(f,o,g)}else i.setCellValue(f,o,m.value);m.locked&&i.lockCell(f,o,!0)}}i.refresh()}(r,t.start.column,o,n,e)})}}var Xu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",function(t){"sort-asc"!==t.id&&"sort-desc"!==t.id||Wu(e,null,t.id.replace("sort-",""))})},sortRange:Wu});function Ku(e,t,n,r){if(-1==t.indexOf("!"))return t;for(var i=$i(t,e,!0),o=0;o<i.length;o++)if(webix.isArray(i[o])){var a=i[o][0]===n?r:i[o][0];a=Wn(a),i[o]="".concat(a,"!").concat(i[o][1])}return i.join("")}function Yu(e){return"string"==typeof e&&"="==e[0]}var Gu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onSheetRename",function(t,n){e._sheets.forEach(function(r){var i=r.name==e.getActiveSheet();i&&(r.content=e.serialize()),r.content.editors&&r.content.editors.forEach(function(r){var i=r[2].options;if(i)if("string"==typeof i)r[2].options=Ku(e,i,t,n);else for(var o=0;o<i.length;o++){var a=i[o];"string"==typeof a?Yu(a)&&(i[o]=Ku(e,a,t,n)):Yu(a.id)&&(a.id=Ku(e,a.id,t,n))}}),r.content.conditions&&(r.content.conditions.forEach(function(r){Yu(r[3])&&(r[3]=Ku(e,r[3],t,n))}),i&&(e.conditions.clear(),e.conditions.parse(r.content.conditions)))})})}});function Qu(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;if((r=r||e.getActiveSheet())==e.getActiveSheet()){var i=e.$$("cells");t=-1!=i.$view.className.indexOf("webix_borderless"),"toggle"==n&&(n=!t),n!=t&&(n?webix.html.addCss(i.$view,"webix_borderless",!0):webix.html.removeCss(i.$view,"webix_borderless"),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-gridlines",value:n}]))}else{var o=Uo(e,r);if(!o)return;o.content.table||(o.content.table={gridlines:1}),t=!o.content.table.gridlines,"toggle"===n&&(n=!t),o.content.table.gridlines=n?0:1}n!=t&&e.callEvent("onAction",["gridlines-hide",{newValue:n,value:t,page:r}])}var Zu=Object.freeze({__proto__:null,hideGridlines:Qu,init:function(e){e.attachEvent("onUndo",function(t,n,r,i){"gridlines-hide"==t&&Qu(e,i)})},load:function(e,t){var n=!1;webix.isUndefined(t.table)||webix.isUndefined(t.table.gridlines)||(n=!t.table.gridlines),Qu(e,n)},serialize:function(e,t){t.table.gridlines=-1!=e.$$("cells").$view.className.indexOf("webix_borderless")?0:1}});function Ju(e,t,n){var r;if((n=n||e.getActiveSheet())==e.getActiveSheet()){var i=e.$$("cells"),o=!(e._loading_data?t:i.config.header);if("toggle"==t&&(t=!o),t!=o){i.config.header=!t,e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-headers",value:t}]);var a=i.isColumnVisible("rowId");(a&&t||!a&&!t)&&i.hideColumn("rowId",{},!0,!!t),i.refreshColumns()}}else{var l=Uo(e,n);if(!l)return;l.content.table||(l.content.table={headers:1}),r=!l.content.table.headers,"toggle"===t&&(t=!r),l.content.table.headers=t?0:1}t!=r&&e.callEvent("onAction",["header-hide",{newValue:t,value:r,page:n}])}var ec=Object.freeze({__proto__:null,hideHeaders:Ju,init:function(e){e.attachEvent("onUndo",function(t,n,r,i){"header-hide"==t&&Ju(e,i)})},load:function(e,t){var n;t.table&&!webix.isUndefined(t.table.headers)&&(n=!t.table.headers),Ju(e,n)},serialize:function(e,t){t.table.headers=e.$$("cells").config.header?1:0}});function tc(e,t,n,r,i){i=i||e.getActiveSheet();var o=ic(e,t,n,i);if(o){if(i!=e.getActiveSheet()){var a=Uo(e,i).content.comments,l=ir(a,function(e){return e[0]==t&&e[1]==n});a.splice(l,1)}else delete e.comments._pull[t][n],e.$$("cells").updateItem(t,n);r||e.callEvent("onAction",["comment",{row:t,column:n,newValue:null,value:o,page:i}])}}function nc(e,t,n){Sn.set(function(){Yn(t,e,function(e,t){ic(e,t.row,t.column,n)&&tc(e,t.row,t.column,!1,n)}),e.$$("cells").refresh()})}function rc(e,t,n,r,i,o){o=o||e.getActiveSheet();var a=ic(e,t,n,o)||null;if(o!=e.getActiveSheet()){var l=Uo(e,o);l.content.comments||(l.content.comments=[]),a?rr(l.content.comments,function(e){return e[0]==t&&e[1]==n})[2]=r:l.content.comments.push([t,n,r])}else"string"==typeof r&&(r=r.trim()?r:""),e.comments._pull[t]=e.comments._pull[t]?e.comments._pull[t]:{},e.comments._pull[t][n]=r,e.$$("cells").addCellCss(t,n,"ssheet_commented_cell");i||e.callEvent("onAction",["comment",{row:t,column:n,newValue:r,value:a,page:o}])}function ic(e,t,n,r){var i;if(r&&r!=e.getActiveSheet()){var o=Uo(e,r);o&&o.content.comments&&(i=rr(o.content.comments,function(e){return e[0]==t&&e[1]==n}))&&(i=i[2])}else e.comments._pull[t]&&e.comments._pull[t][n]&&(i=e.comments._pull[t][n]);return i||""}var oc=Object.freeze({__proto__:null,init:function(e){e.comments={get:function(t,n,r){return ic(e,t,n,r)},add:function(t,n,r,i){rc(e,t,n,r,!1,i)},remove:function(t,n,r){tc(e,t,n,!1,r)},_activeComment:{},_pull:{}},e.attachEvent("onReset",function(){return function(e){e.comments._pull={}}(e)}),e.attachEvent("onUndo",function(t,n,r,i){"comment"===t&&function(e,t,n,r){ic(e,t,n)&&tc(e,t,n,!0);r&&rc(e,t,n,r,!0)}(e,n,r,i)}),e.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function(e,t,n,r,i){var o=r.comments,a=o.length;if(n)for(;a--;){var l=bn(o[a],2),s=l[0],u=l[1];(s&&"row"==t&&s>=i.row||u&&"column"==t&&u>=i.column)&&("row"==t?s<i.row-n?o.splice(a,1):o[a][0]=1*s+n:"column"==t&&(u<i.column-n?o.splice(a,1):o[a][1]=1*u+n))}}(0,t.name,t.inc,t.data,t.start)})},load:function(e,t){var n,r=t.comments;if(r)for(n=0;n<r.length;n++)rc(e,r[n][0],r[n][1],r[n][2],!0)},removeCommentsRange:nc,serialize:function(e,t){var n,r,i=[];for(n in e.comments._pull)for(r in e.comments._pull[n])e.comments._pull[n][r]&&i.push([n,r,e.comments._pull[n][r]]);t.comments=i}});function ac(e,t,n){var r;if((n=n||e.getActiveSheet())==e.getActiveSheet()){var i=e.$$("cells");r=i.config.showFormulas,"toggle"==t&&(t=!r),t!=r&&(i.config.showFormulas=t,e.callEvent("onCommand",[{id:"toolbar-update",name:"show-formulas",value:t}]),i.refresh())}else{var o=Uo(e,n);if(!o)return;o.content.table||(o.content.table={showFormulas:1}),r=o.content.table.showFormulas,"toggle"==t&&(t=!r),o.content.table.showFormulas=t?1:0}t!=r&&e.callEvent("onAction",["show-formulas",{newValue:t,value:r,page:n}])}var lc=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onUndo",function(t,n,r,i){"show-formulas"==t&&ac(e,i)})},load:function(e,t){var n=!1;t.table&&t.table.showFormulas&&(n=t.table.showFormulas),ac(e,n)},serialize:function(e,t){t.table.showFormulas=e.$$("cells").config.showFormulas?1:0},showFormulas:ac});var sc=Object.freeze({__proto__:null,init:function(e){var t=[Zu,ec,xl,Eu,js,Lu,oc,lc];e.attachEvent("onDataSerialize",function(n){for(var r=0;r<t.length;r++)t[r].serialize&&t[r].serialize(e,n)}),e.attachEvent("onDataParse",function(n){for(var r=0;r<t.length;r++)t[r].load&&t[r].load(e,n)})}}),uc=[".xls",".xlt",".xla",".xlsx",".xlsm",".xltx",".xltm",".xlam",".xlsb"];var cc=Object.freeze({__proto__:null,init:function(e){var t;window.XMLHttpRequest&&(new XMLHttpRequest).upload&&((t=webix.ui({view:"uploader",apiOnly:!0,accept:uc.join()})).attachEvent("onBeforeFileAdd",webix.bind(function(t){return uc.indexOf("."+t.type.toLowerCase())>-1&&(e.reset(),t.file.options||(t.file.options={}),webix.extend(t.file.options,{cellDates:!1,sheetStubs:e.config.sheetStubs,cellStyles:e.config.loadStyles}),e.parse(t.file,"excel")),!1},this)),e._destroy_with_me.push(t)),e.attachEvent("onCommand",function(n){"excel-import"===n.id&&function(e,t){t?webix.delay(function(){return t.fileDialog()}):e.alert(webix.i18n.spreadsheet.labels["import-not-support"])}(e,t)})}});function hc(e,t){var n=webix.promise.defer();if(e.match(/data:image\/(png|jpg|jpeg);base64,/))n.resolve({data:e,position:t});else{var r=webix.html.create("img",{src:e,width:t.width+"px",height:t.height+"px"});r.crossOrigin="anonymous",r.onerror=function(){return n.resolve()},r.onload=function(){var e=webix.html.create("canvas"),i=e.getContext("2d");e.width=t.width,e.height=t.height,i.drawImage(r,0,0,t.width,t.height),n.resolve({data:e.toDataURL("png"),position:t})}}return n}function dc(e){var t=e.cloneNode(!1);if(e.tagName){for(var n=window.getComputedStyle(e),r="",i=0;i<n.length;i++){var o=n[i];"visibility"!=o&&(r+=o+":"+n.getPropertyValue(o)+";")}t.style.cssText=r}for(var a=0;a<e.childNodes.length;a++)t.appendChild(dc(e.childNodes[a]));return t}function fc(e){return 3===(e=e.substring(1)).length&&(e+=e),e}function mc(e,t,n,r){var i=t.split(";"),o={};n&&(o={font:{},alignment:{},border:{}});for(var a=0;a<i.length;a++)i[a]&&(n?gc(e,o,i,a):vc(o,i,a,r.table));return o}function gc(e,t,n,r){switch(ar[r]){case"color":t.font.color={rgb:fc(n[r])};break;case"background":var i=fc(n[r]);i&&"ffffff"!==i.toLowerCase()&&(t.fill={fgColor:{rgb:i}});break;case"text-align":t.alignment.horizontal=n[r];break;case"font-family":t.font.name=n[r].replace(/'|,.*$/g,"");break;case"font-size":t.font.sz=.75*n[r].replace("px","");break;case"font-style":t.font.italic="italic"==n[r];break;case"underline":t.font.underline="underline"==n[r];break;case"strike":t.font.strike="strike"==n[r];break;case"font-weight":t.font.bold="bold"==n[r];break;case"vertical-align":t.alignment.vertical="middle"==n[r]?"center":n[r];break;case"wrap":t.alignment.wrapText="wrap"==n[r];break;case"borders":break;case"format":t.format=Ur(e,n[r],!0)||"";break;case"border-right":case"border-bottom":case"border-left":case"border-top":t.border[ar[r].split("-")[1]]=pc(n[r],!0);break;case"indent":t.alignment.indent=n[r]}}function vc(e,t,n,r){switch(ar[n]){case"color":e.color=fc(t[n]);break;case"background":e.backgroundColor=fc(t[n]);break;case"text-align":e.textAlign=t[n];break;case"font-family":case"borders":case"format":break;case"font-size":e.fontSize=.75*t[n].replace("px","");break;case"font-style":e.italic="italic"==t[n];break;case"underline":e.underline="underline"==t[n];break;case"strike":e.strikethrough="strike"==t[n];break;case"font-weight":e.bold="bold"==t[n];break;case"vertical-align":e.vertAlign=t[n];break;case"wrap":e.whiteSpace="nowrap"!=t[n];break;case"border-right":case"border-bottom":case"border-left":case"border-top":var i=ar[n].split("-")[1];e["border".concat(i[0].toUpperCase()+i.substring(1),"Color")]=pc(t[n]);break;case"indent":if(t[n]){var o="padding".concat("right"==t[2]?"Right":"Left"),a=r&&r[o]?r[o]:10;e[o]=a+6*t[n]}}}function pc(e,t){var n=bn(e.split(","),2),r=n[0],i=n[1];return t?{color:{rgb:fc(r)},style:i}:fc(r)}function wc(e){if(!e)return{};for(var t=[],n=0;n<ar.length;n++)t.push(e[ar[n]]||"");return mc(t.join(";"),!0)}var bc=Object.freeze({__proto__:null,init:function(e){var t=e._table;e.$exportView=function(n){var r="pdf"==n.export_mode,i="excel"==n.export_mode,o={freeze:!0,stubCells:!0,header:!1,footer:!1,heights:!0,rawValues:!r,filterHTML:!0,spans:!0,styles:!0,math:!r,hidden:i,xCorrection:t.config.header||n.hidden?1:0,ignore:{rowId:!0},conditions:!0,formulasMode:"auto",gridlines:"auto",headers:"auto",zoom:"auto"};return webix.extend(n,o),i||r?function(e,t){var n=arguments,r=this,i="excel"==t.export_mode;!0===t.sheets?t.sheets=e._sheets.map(function(e){return e.name}):t.sheets&&t.sheets.length?"string"==typeof t.sheets&&(t.sheets=[t.sheets]):t.sheets=[e._activeSheet];if(i){if(e._sheets.length!=t.sheets.length)for(var o=0;o<e._sheets.length;o++){var a=e._sheets[o];"veryHidden"==a.state&&-1==t.sheets.indexOf(a.name)&&t.sheets.push(a.name)}}else t.sheets=t.sheets.filter(function(t){return Lo(e,t)});t.dataOnly=!0;for(var l=[],s=e._activeSheet,u=function(o){var a=t.sheets[o],u=a.id||a;e.showSheet(u);var c=e._zoom;e.ignoreUndo(function(){return e.zoom(1)}),t.hidden&&(t.xCorrection=1);var h=a.options?webix.extend(a.options,t):webix.copy(t),d=u!=s;d&&(h._hidden=!0),h.name||(h.name=u);var f=!i&&"image"!=h.display,m=e.serialize(),g=bn(or(m.data,m.spans,0,0),2),v=g[0],p=g[1];if(!i&&(webix.isUndefined(h.textBefore)&&(h.textBefore=h.name),f)){h.ignore=h.ignore||{};for(var w=p+1;w<=e.config.columnCount;w++)h.ignore[w]=!0;var b=h.filter||function(){return!0};h.filter=function(e){return e.id<=v&&b.apply(r,n)}}var _=webix[i?"toExcel":"toPDF"](e._table,h);if(i&&(_[0].state=Uo(e,u).state||"visible"),f&&0==_[0].scheme.length)return 1;if((i||f)&&h.styles){var x=_[0].styles=function(e,t,n,r,i){e.compactStyles();var o=[],a={},l={},s=function(e){var t=tr;return"excel"==e.export_mode?{font:{sz:.75*t["font-size"],name:t["font-family"].replace(/'|,.*$/g,"")},alignment:{horizontal:t["text-align"],vertical:"middle"==t["vertical-align"]?"center":t["vertical-align"],wrapText:"nowrap"!=t["white-space"]}}:{fontSize:.75*t["font-size"],textAlign:t["text-align"],whiteSpace:"nowrap"!=t["white-space"]}}(t);n&&t.docHeader&&(o=o.concat([{0:wc(t.docHeader.css)},{}]));t.header&&o.push({});var u=o.length,c=e.$$("cells"),h=u;c.eachRow(function(u){if(!(u>r)){var d=0;c.eachColumn(function(r){if(!(d>i)){if(d>=t.xCorrection){var c,f,m=gr(e,{row:u,column:r},null,!0),g=d-t.xCorrection;if(o[h]=o[h]||{},m)if(a[m.id])c=webix.copy(a[m.id]);else{for(var v in c=mc(e,m.text,n,t),s)n?webix.extend(c[v],s[v]):c[v]||(c[v]=s[v]);a[m.id]=webix.copy(c)}else c=webix.copy(s);if(t.conditions){var p=function(e,t,n,r){var i=El(e,t,n),o=Xa(e,t,n,i);if(o){if(r[o])return r[o];var a=webix.html.create("div",{class:o});document.body.appendChild(a);var l=window.getComputedStyle(a),s=l.backgroundColor,u=l.color;return document.body.removeChild(a),r[o]=[s,u],r[o]}}(e,u,r,l);p&&function(e,t,n){var r=t.map(function(e){return webix.color.rgbToHex(e)}),i=bn(r,2),o=i[0],a=i[1];n?(e.fill={fgColor:{rgb:o}},e.font.color={rgb:a}):(e.backgroundColor=o,e.color=a)}(c,p,n)}if(o[h][g]=c,t.math){var w=e.getCellValue(u,r);if("string"==typeof w&&"="==w[0]&&w.length>1){var b=e.getCellValue(u,r,!1);isNaN(b)&&(f="string")}}o[h][g].type=f||Ii(e,u,r)}d++}},t.hidden),h++}},t.hidden),n&&t.docFooter&&(o=o.concat([{},{0:wc(t.docFooter.css)}]));return o}(e,h,i,v,p);f&&function(e,t,n,r,i){var o=n.header?1:0;if(n.spans)for(var a=i.spans.sort(function(e,t){return e[1]<t[1]?1:e[1]>t[1]?-1:0}),l=0;l<a.length;l++)if(a[l][2]>1){var s=a[l][0]-1+o,u=a[l][1]-1,c=a[l][2];if(e[s]&&e[s][u]){e[s][u].colspan=c;var h=t[0].exportData[s-o];h&&h.splice(u+1,c-1);var d=Object.values(e[s]);d.splice(u+1,c-1),e[s]=d}}for(var f=t[0].exportData,m=0;m<f.length;m++)for(var g=0;g<f[m].length;g++){var v=r.$$("cells").config.rowHeight;if(n.heights&&i.sizes.length)for(var p=0;p<i.sizes.length;p++){var w=i.sizes[p][0];if(w&&w==m+1){v=i.sizes[p][2];break}}var b=e[m+o][g],_=b.vertAlign,x=.75*v-b.fontSize;b.paddingTop="top"==_?0:"bottom"==_?x:x/2,b.paddingBottom="bottom"==_?0:"top"==_?x:x/2}}(x,_,h,e,m)}if(l=l.concat(_),i?(l[o].ranges=[],e.ranges.serialize(u).forEach(function(e){var t=e[1].split("!");l[o].ranges.push({Sheet:e[2]?null:o,Name:e[0],Ref:t[0]+"!"+t[1].replace(/[0-9]+|[A-Z]+/gi,function(e){return"$".concat(e)})})}),t.freeze&&(m.table.frozenRows||m.table.frozenColumns)&&(l[o].freeze={rows:m.table.frozenRows,columns:m.table.frozenColumns}),l[o].sheetSettings={showFormulas:!0===t.formulasMode||"auto"==t.formulasMode&&m.table.showFormulas,showGridLines:!0===t.gridlines||"auto"==t.gridlines&&m.table.gridlines,showRowColHeaders:!0===t.headers||"auto"==t.headers&&m.table.headers,zoomScale:"auto"==t.zoom?100*c:t.zoom}):t.autowidth&&function(e,t){var n,r=t.orientation&&"landscape"==t.orientation?"height":"width";n=e.$width?e.$width:e[r];t[r]=Math.max(t[r]||0,n||0)}(h,t),!1!==t.images){var y=function(){var n,r=e.views._pull[C],i={type:"absoluteAnchor",x:r.x,y:r.y,width:r.config.width||500,height:r.config.height||300};if("image"==r.type)n=hc(r.data,i);else{n=webix.promise.defer();var a=webix.$$(C),s=d||o+1!=t.sheets.length;if(s){var u=a.getBody();(a=webix.ui({view:"window",head:!1,width:i.width,height:i.height,body:{rows:[]}})).getBody().addView(u),a.show({x:-99999,y:-99999})}webix.toPNG(a.getBody(),{download:!1}).then(function(e){s&&a.close();var t=new FileReader;t.readAsDataURL(e),t.onload=function(){n.resolve({data:t.result,position:i})},t.onerror=function(){return n.resolve()}})}e.$getExcelImage&&(n=e.$getExcelImage(n,r,i)),l[o].images.push(n)};for(var C in e.views._pull)y()}e.ignoreUndo(function(){return e.zoom(c)})},c=0;c<t.sheets.length;c++)u(c);return e.showSheet(s),delete t.dataOnly,l}(e,n):t},t.$getExportValue=function(t,n,r){var i=e.getCellValue(t,n,r.math),o=r.export_mode,a=r.math&&"="==i[0]&&i.length>1;if("pdf"!=o&&"csv"!=o||a||r.rawValues){if("excel"==o&&a){var l=i.match(/^=(image|sparkline)\((.*?)\)$/i);if(l){if(!1===r.images)return"";var s=this.getSpan(t,n),u=0,c=0;if(s){for(var h=t;h<t+s[3];h++)u+=e.getRow(h).$height;for(var d=n;d<n+s[2];d++)c+=e.getColumn(d).width}else c+=e.getColumn(n).width,u+=e.getRow(t).$height;var f={type:"twoCellAnchor",from:{col:n-1,row:t-1},to:{col:s?n+s[2]-1:n,row:s?t+s[3]-1:t},width:c,height:u},m=l[2];if("sparkline"==l[1].toLowerCase()){var g=e.getCellValue(t,n,!1),v=webix.html.create("div",{style:"height:auto;width:auto;visibility:hidden;position:absolute;top:0px;left:0px;"});v.innerHTML=g,document.body.appendChild(v);var p=dc(v.firstChild);webix.html.remove(v);var w=(new XMLSerializer).serializeToString(p);m="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(w)))}else m=e._mData.getStore().exec(m,e._mPage.getContext());var b=hc(m,f);return e.$getExcelImage&&(b=e.$getExcelImage(b,{row:t,column:n},f)),{image:b}}for(var _,x,y,C=e._mPage.cellID(t-1,n-1),S=t+1;S<=e.config.rowCount;S++){var $=e._mPage.getCell(S-1,n-1);if(!$||$.source!==C)break;_=S}for(var E=n+1;E<=e.config.columnCount;E++){var R=e._mPage.getCell(t-1,E-1);if(!R||R.source!==C)break;x=E}(x||_)&&(y=Xn(t,n,_||t,x||n));var A=e.getCellValue(t,n,!1);/^=(checkbox|radio)\(/i.test(i)&&(i=A?"=TRUE()":"=FALSE()"),i={value:A,formula:i,ref:y}}}else i=El(e,t,n);return i}}});function _c(e,t,n,r,i){var o=webix.copy(t.data),a=[],l=new Map;if(t.types){var s,u=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Cn(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}(t.types);try{for(u.s();!(s=u.n()).done;){var c=s.value;l.set("".concat(c[0],",").concat(c[1]),c[2])}}catch(e){u.e(e)}finally{u.f()}}for(var h=function(e){for(var n=function(n){var r=e+1,i=n+1,s=o[e][n];if(t.links.length){var u=rr(t.links,function(t){return t[0]==e&&t[1]==n});u&&(u="string"==typeof u[2]&&"="==u[2][0]?u[2].slice(1):'"'.concat(u[2],'"'),s="string"==typeof s&&"="==s[0]?s.slice(1):'"'.concat(s,'"'),s="=HYPERLINK(".concat(u,", ").concat(s,")"))}a.push([r,i,s,l.get("".concat(e,",").concat(n))])},r=0;r<o[0].length;r++)n(r)},d=0;d<o.length;d++)h(d);if(t.data=a,t.spans)for(var f=0;f<t.spans.length;f++)t.spans[f][0]++,t.spans[f][1]++;if(n)for(var m=0;m<n.length;m++){var g=n[m].Sheet,v=webix.isUndefined(g);(v||g===r)&&(t.ranges=t.ranges||[],t.ranges.push([n[m].Name.toUpperCase(),n[m].Ref.substring(n[m].Ref.indexOf("!")+1).replace(/\$/g,""),v]))}if(t.styles&&function(e,t,n){for(var r=1,i={},o=[],a=[],l=0;l<t.styles.length;l++){for(var s=[],u=t.styles[l][2],c=void 0,h=function(){switch(ar[d]){case"color":s[d]=u.font&&u.font.color&&xc(u.font.color.rgb)||"";break;case"background":s[d]=u.fill&&u.fill.fgColor&&xc(u.fill.fgColor.rgb)||"";break;case"text-align":s[d]=(u.alignment?u.alignment.horizontal:"")||tr["text-align"];break;case"font-family":s[d]=u.font&&u.font.name?yc(u.font.name):"";break;case"font-size":s[d]=u.font&&u.font.sz&&u.font.sz/.75+"px"||"";break;case"font-style":s[d]=u.font&&u.font.italic?"italic":"";break;case"underline":s[d]=u.font&&u.font.underline?"underline":"";break;case"strike":s[d]=u.font&&u.font.strike?"strike":"";break;case"font-weight":s[d]=u.font&&u.font.bold?"bold":"";break;case"vertical-align":var t=u.alignment&&u.alignment.vertical||"";s[d]=("center"==t?"middle":t)||tr["vertical-align"];break;case"wrap":s[d]=u.alignment&&u.alignment.wrapText?"wrap":"nowrap";break;case"borders":s[d]="";break;case"format":var r=u.numFmt,i="";r&&"General"!=r&&(r=r.replaceAll("\\",""),i=e._formats.formatCache[r]?e._formats.formatCache[r]:n.cache[r]?n.cache[r]:n.cache[r]="fmt"+n.count++,rr(a,function(e){return e[0]==i})||a.push([i,r])),s[d]=i;break;case"border-right":case"border-bottom":case"border-left":case"border-top":s[d]=Cc(ar[d],u);break;case"indent":s[d]=u.alignment&&u.alignment.indent?u.alignment.indent:""}},d=0;d<ar.length;d++)h();c=i[s=s.join(";")]||"wss"+r;for(var f=0;f<t.data.length;f++)if(t.data[f][0]===t.styles[l][0]+1&&t.data[f][1]===t.styles[l][1]+1){t.data[f][3]=c;break}i[s]||(o.push([c,s]),i[s]=c,r++)}t.formats=a,t.styles=o}(e,t,i),t.hidden&&function(e){for(var t={row:[],column:[]},n=0;n<e.hidden.length;n++){var r=e.hidden[n];"column"==r[0]?t.column.push(r[1]+1):t.row.push(r[1]+1)}e.table={hidden:t}}(t),t.sizes)for(var p=0;p<t.sizes.length;p++)"column"==t.sizes[p][0]?t.sizes[p]=[0,t.sizes[p][1]+1,t.sizes[p][2]]:t.sizes[p]=[t.sizes[p][1]+1,0,t.sizes[p][2]];var w=t.sheetSettings;return w&&(t.table.showFormulas=w.showFormulas,t.table.gridlines=w.showGridLines,t.table.headers=w.showRowColHeaders,t.table.zoom=w.zoomScale/100),t}function xc(e){return 8===(e=e||"000000").length&&(e=e.substring(2)),"#"+e}function yc(e){for(var t=tr["font-family"],n=0;n<Li.length;n++)if(Li[n].value==e){t=Li[n].id;break}return t}function Cc(e,t){if(e=e.replace("border-",""),t.border&&t.border[e]){var n=t.border[e];if(n.color){var r=xc(n.color.rgb)||"",i=n.style||"";return"".concat(r,",").concat(i)}}return""}var Sc=Object.freeze({__proto__:null,init:function(e){e._parseExcel=function(t,n){var r=t.options||{};r.math=e.config.math;for(var i={sheets:[]},o={count:e._formats.formatsCount,cache:{}},a=0;a<t.names.length;a++)r.name=t.names[a],i.sheets.push({name:r.name,state:t.states[a],content:_c(e,n.getSheet(t,r),t.ranges,a,o)});return i},e._parseCsv=function(e,t){e=t.getRecords(e);for(var n=webix.copy(e),r=[],i=0;i<n.length;i++)for(var o=n[i].split(t.cell),a=0;a<o.length;a++){var l=i+1,s=a+1;r.push([l,s,o[a]])}return{data:r}}}});var $c=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",function(t){switch(t.id){case"clear-value":e.clearRange(null,{values:!0});break;case"clear-style":e.clearRange(null,{styles:!0});break;case"clear-conditional-formats":e.clearRange(null,{conditions:!0});break;case"clear-dropdown-editors":e.clearRange(null,{editors:!0});break;case"clear-filters":e.clearRange(null,{filters:!0});break;case"clear-all":Sn.set(function(){e.clearRange(null,null)});break;case"clear-comments":e.clearRange(null,{comments:!0})}})}});function Ec(e,t,n,r){if(t)webix.isArray(t)||(t=[t,t]);else{if(r&&r!=e.getActiveSheet())return;var i=e.$$("cells").getSelectArea();i&&(t=[i.start[n],i.end[n]])}return t}function Rc(e,t,n,r){var i={},o={};(r=Ec(e,r,n))&&(i[n]=r[0],o[n]=r[1],e.callEvent("onCommand",[{id:t,group:n},i,o]))}function Ac(e,t,n,r,i){var o;if((n=Ec(e,n,t,i))&&(!i||i==e.getActiveSheet()||(o=rr(e._sheets,function(e){return e.name==i})))){var a=e.$$("cells");Sn.set(function(){for(var l=function(n){if("auto"==r)o||("row"==t?za:qa)(n,e);else if(o){o.content.sizes||(o.content.sizes=[]);var l=rr(o.content.sizes,function(e){return"row"==t?e[0]==n:e[1]==n});if(l){if(r==l[2])return 0;l[2]=r}else{if("row"==t){if(r==a.config.columnWidth)return 0}else if(r==a.config.rowHeight)return 0;var s=[0,0,r];s["row"==t?0:1]=n,o.content.sizes.push(s)}e.callEvent("onAction",[t+"-resize",fn(fn(fn({},t,n),"value",r),"page",i)])}else r*=e._zoom,a["row"==t?"setRowHeight":"setColumnWidth"](n,r)},s=n[0];s<=n[1];s++)l(s)})}}var Tc=Object.freeze({__proto__:null,deleteColumn:function(e){Rc(this,"del","column",e)},deleteRow:function(e){Rc(this,"del","row",e)},insertColumn:function(e){Rc(this,"add","column",e)},insertRow:function(e){Rc(this,"add","row",e)},setColumnWidth:function(e,t,n){Ac(this,"column",e,t,n)},setRowHeight:function(e,t,n){Ac(this,"row",e,t,n)}});var kc=Object.freeze({__proto__:null,isCellLocked:function(e,t,n){return!!_l(this,e,t,n)},lockCell:function(e,t,n,r){bl(this,e,t,n,!1,r)}});function Oc(e,t,n,r){if(r)for(var i=r.length-1;i>=0;i--){var o=r[i],a="row"==t?0:1,l="row"==t?3:2;o[a]<=n&&o[a]+o[l]-1>n&&(o[l]=n-o[a]+1),o[0]-o[3]==0&&o[1]-o[2]==0&&r.splice(i,1)}else{var s,u=e.$$("cells").getSpan();for(var c in u)if(!("row"==t&&c>n))for(var h in u[c])if(!("column"==t&&h>n)){var d=u[c][h],f="row"==t?1*c+d[1]-1:1*h+d[0]-1;f>n&&(s=!0,Ic(e,[c,h],"row"==t?d[0]:d[0]-(f-n),"row"==t?d[1]-(f-n):d[1]))}s&&e.refresh()}}function Ic(e,t,n,r){e.splitCell(t[0],t[1],null,!0),e.combineCells({cell:{row:t[0],column:t[1]},x:n,y:r},null,!0)}var Vc=Object.freeze({__proto__:null,freezeColumns:function(e,t){var n,r=this;Sn.set(function(){if(t&&t!=r.getActiveSheet()){var i=Uo(r,t);i&&(i.content.table||(i.content.table={}),n=i.content.table.frozenColumns,i.content.table.frozenColumns=e,i.content.spans&&Oc(r,"column",e,i.content.spans))}else{t||(t=r.getActiveSheet());var o=r.$$("cells");if(webix.isUndefined(e)){var a=o.getSelectArea();e=a?a.end.column:0}var l="rowId"==o.config.columns[0].id?1:0,s=l,u=!1;if(e&&e!=r._frozenColumns){for(var c=e;c>0&&!(s=o.getColumnIndex(c)+1);c--);s||(s=l)}else u=!0;Oc(r,"column",e),o.unselect(),o.define("leftSplit",s),o.refreshColumns(),n=r._frozenColumns,r._frozenColumns=u||!e?0:e}r.callEvent("onAction",["freeze-column",{value:n||0,newValue:e,page:t}])})},freezeRows:function(e,t){var n,r=this;Sn.set(function(){if(t&&t!=r.getActiveSheet()){var i=Uo(r,t);i&&(i.content.table||(i.content.table={}),n=i.content.table.frozenRows,i.content.table.frozenRows=e,i.content.spans&&Oc(r,"row",e,i.content.spans))}else{t||(t=r.getActiveSheet());var o=r.$$("cells");if(webix.isUndefined(e)){var a=o.getSelectArea();e=a?a.end.row:0}var l=0,s=!1;if(e&&e!=r._frozenRows)for(var u=e;u>0&&!(l=o.getIndexById(u)+1);u--);else s=!0;Oc(r,"row",e),o.unselect(),o.define("topSplit",l),o.refreshColumns(),n=r._frozenRows,r._frozenRows=s||!e?0:e}r.callEvent("onAction",["freeze-row",{value:n||0,newValue:e,page:t}])})}});var Nc=Object.freeze({__proto__:null,hideGridlines:function(e,t){Qu(this,e,t)}});var Mc=Object.freeze({__proto__:null,hideHeaders:function(e,t){Ju(this,e,t)}});var Dc=Object.freeze({__proto__:null,hideColumn:function(e,t,n){Mu(this,e,t,"column",n)},hideRow:function(e,t,n){Mu(this,e,t,"row",n)},isColumnVisible:function(e,t){return Nu(this,e,t)},isRowVisible:function(e,t){return Du(this,e,t)}});var qc=Object.freeze({__proto__:null,addCheckbox:function(e,t){var n=this;if(e||(e=this.$$("cells").getSelectArea()),e){var r=e.start,i=e.end;this.groupUndo(function(){for(var e=r.row;e<=i.row;e++)for(var o=r.column;o<=i.column;o++)n.setCellValue(e,o,"=checkbox()",t)}),this.refresh()}},addImage:function(e,t,n,r){this.setCellValue(e,t,function(e){return'=IMAGE("'.concat(e,'")')}(n),r),r&&r!=this.getActiveSheet()||this.refresh()},addRadio:function(e,t){var n=this;if(e||(e=this.$$("cells").getSelectArea()),e){var r=e.start,i=e.end;this.groupUndo(function(){for(var e=r.row;e<=i.row;e++)for(var o=r.column;o<=i.column;o++)n.setCellValue(e,o,"=radio(".concat(e-r.row+1,", ").concat(o-r.column+1,", ").concat(i.row-r.row+1,", ").concat(i.column-r.column+1,")"),t)}),this.refresh()}},addSparkline:function(e,t,n,r){var i=function(e){var t="bar"==(e=webix.copy(e)).type;t&&e.horizontal&&(e.type="barH");var n="=SPARKLINE(".concat(e.range,',"').concat(e.type,'"');return t?n+=',"'.concat(e.color,'","').concat(e.negativeColor,'"'):e.color&&(n+=',"'.concat(e.color,'"')),n+")"}(n);this.setCellValue(e,t,i,r),r&&r!=this.getActiveSheet()||this.refresh()},getSheetData:function(e){var t=this;if(this._mData.getPage(e))return{getValue:function(n,r,i){return t.getCellValue(n,r,i,e)},getRangeValue:function(n){return t.getRangeValue(n,e)}}},markCheckbox:function(e,t,n,r){/^=(checkbox)\(/i.test(this.getCellValue(e,t,!0,r))&&(this.setCellValue(e,t,"=checkbox(".concat(!1===n?0:1,")")),this.refresh())},markRadio:function(e,t,n,r){Tn(this,e,t,n,r)},recalculate:function(){this._mData.getStore().recalculate(),this.callEvent("onMathRefresh",[]),this.refresh()},registerMathMethod:function(e,t,n,r){kn(this,e,t,!0,n,r)},setPlaceholder:function(e,t){"object"==yn(e)&&(t=e,e="*"),this._mData.getStore().setPlaceholder(e,t),this.refresh(),this.callEvent("onMathRefresh",[])}});var zc=Object.freeze({__proto__:null,addSheet:function(e,t,n){return ko(this,e,t,n)},addStyle:function(e,t,n){return wr(this,e,t,n)},clearRange:function(e,t,n){(e||(n&&n!=this.getActiveSheet()||(e=this._table.getSelectArea()),e))&&(t||(t={styles:!0,values:!0,editors:!0,filters:!0,conditions:!0,comments:!0}),t.styles&&Tr(this,e,n),t.conditions&&nl(this,e,n),t.values&&this.setRangeValue(e,null,n),t.editors&&pu(this,e,n),t.filters&&Ns(this,e,n),t.comments&&nc(this,e,n),this.refresh())},clearSheet:function(){this.reset()},combineCells:function(e,t,n){var r=this,i=!t||t==this.getActiveSheet();if(!e){if(!i)return;var o=this.getSelectedId(!0);o.length>1&&(e=Jo(o))}Sn.set(function(){e&&Qo(r,e.cell,e.x,e.y,null,t)}),!n&&i&&this.refresh()},compactStyles:function(){return kr(this)},editSheet:function(e){Oo(this,e)},getActiveSheet:function(){return this._activeSheet},getSheetState:function(e){return Uo(this,e).state||"visible"},getStyle:function(e,t,n){return gr(this,{row:e,column:t},n)},redo:function(){Wl(this)},removeSheet:function(e){No(this,e)},renameSheet:function(e,t){Mo(this,e,t)},serialize:function(e){var t={};return this.callEvent("onDataSerialize",[t,e]),e&&(e.compactStyles&&(t.styles=Or(t)),e.sheets)?function(e,t,n){var r=Uo(e,e._activeSheet);r.content=t,r.state=r.state||"visible";var i=webix.copy(e._sheets),o=!n||!1!==n.math,a=n&&n.compactStyles;return i.forEach(function(t){if(t.name!=e._activeSheet){var n=bn(po(e,o,t.name),2);t.content.data=n[0],t.content.locked=n[1],t.state=t.state||"visible",a&&(t.content.styles=Or(t.content)),t.content.ranges=e.ranges.serialize(t.name)}}),i}(this,t,e):t},setRangeStyle:function(e,t,n){Sn.set(function(){Cr(this,e,t,n)},this)},setSheetState:function(e,t){Ao(this,e,t)},setStyle:function(e,t,n,r){return yr(this,{row:e,column:t},n,r)},showCell:function(e,t){pl(this,e,t)},showSheet:function(e){Fo(this,e)},sortRange:function(e,t){Wu(this,e,t)},splitCell:function(e,t,n,r){var i=!n||n==this.getActiveSheet();e&&t?Zo(this,{row:e,column:t},n):i&&Sn.set(function(){this.eachSelectedCell(function(e){Zo(this,e)})},this),!r&&i&&this.refresh()},undo:function(){jl(this)}});function Pc(e,t,n,r,i){e._validation_restore=!0,i?(e.setStyle(t,n,r.style,i),e.setCellEditor(t,n,r.editor,i),e.setCellValue(t,n,r.value,i)):(e.undo(),e._ssUndoHistory.splice(e._ssUndoCursor+1)),delete e._validation_restore}function Fc(e,t){var n=t.errorHandle||"information",r="stop"==n?"alert-error":("warning"==n?"confirm-":"alert-")+n,i=webix.i18n.spreadsheet.labels;return e["warning"==n?"confirm":"alert"]({type:r,ok:i["validation-error-"+("stop"==n?"restore":"save")],cancel:i["validation-error-restore"],title:t.errorTitle||i["validation-error-title-text"],text:t.errorMessage||i["validation-error-message-text"]})}function Uc(e){return"boolean"==typeof e&&(e*=1),e||0===e?e:""}var Lc=Object.freeze({__proto__:null,_resetTable:function(){$l(this)},eachSelectedCell:function(e){for(var t=this.getSelectedId(!0),n=0;n<t.length;n++)e.call(this,t[n])},getCellType:function(e,t,n){return Ii(this,e,t,n)},getCellValue:function(e,t,n,r){if(r=r?this._mData.getPage(r):this._mPage)return Uc(r.getValue(e-1,t-1,!1!==n))},getColumn:function(e,t){if(!t||t==this.getActiveSheet())return this._table.getColumnConfig(e);var n,r=Uo(this,t);return r?(r.content.sizes&&(n=rr(r.content.sizes,function(t){return t[1]==e})),n=n?n[2]:this.$$("cells").config.columnWidth,{id:e,width:n}):void 0},getRangeValue:function(e,t){t||(t=this.getActiveSheet());var n=jn(e,this,t),r=this._mData.getPage(n[4]);return n&&r?r.getRange(n[0]-1,n[1]-1,n[2]-1,n[3]-1).map(Uc):[]},getRow:function(e,t){var n,r,i=this,o=!t||t==this.getActiveSheet();if(o)n=webix.copy(this._table.getItem(e)),r=this.config.columnCount;else{var a,l=Uo(this,t);if(!l)return;l.content.sizes&&(a=rr(l.content.sizes,function(t){return t[0]==e})),a=a?a[2]:this.$$("cells").config.rowHeight,n={id:e,$height:a},r=or(l.content.data,l.content.spans,1,1,l.content.filters)[1]}for(var s=function(r){var a=(o?i._mPage:i._mData.getPage(t)).getCell(e-1,r-1);if(a){n[r]=a.value,[["style","$cellCss"],["type","$cellType"],["format","$cellFormat"]].forEach(function(e){var t=a[e[0]];t&&(n[e[1]]||(n[e[1]]={}),n[e[1]][r]=t)});var l=i.getCellValue(e,r,!0,t);l&&"="==l[0]&&(n["$"+r]=l)}},u=1;u<=r;u++)s(u);return n},getSelectedId:function(e){var t=this._table.getSelectArea();if(!e)return t&&t.start.row?t.start:null;var n=[];if(t)for(var r=t.start,i=t.end,o=r.row;o<=i.row;o++)for(var a=r.column;a<=i.column;a++)n.push({row:o,column:a});return n},getSelectedRange:function(e){var t=this._table.getSelectArea();return t?(e&&(e=this.getActiveSheet()),Xn(t.start.row,t.start.column,t.end.row,t.end.column,e)):""},posToRef:function(e,t,n,r,i){return Xn(e,t,n,r,i)},refToPos:function(e){return jn(e)},refresh:function(e){e?this._table.refreshColumns():this._table.refresh()},reset:function(e){var t={data:[]};e&&e.sheets&&(t=Po(t)),this.parse(t)},setCellValue:function(e,t,n,r){var i=this;r||(r=this.getActiveSheet());var o=this._mData.getPage(r);if(o){n=Uc(n);var a,l,s,u=this.getCellValue(e,t,!0,r),c=Ii(this,e,t,r);if(this._type_change||r==this.getActiveSheet()||(a=this.getStyle(e,t,r),l=this.getCellEditor(e,t,r)),"date"==c){var h,d=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime);if(isNaN(n)){var f=d(n);h=""===f?n:In(f)}else h=n;s=u==h}else"string"==c||""===n||isNaN(n)||u!=n||0===n||(s=!0,n*=1);s||u===n||Sn.set(function(){if(i.callEvent("onBeforeValueChange",[e,t,n,u,r])){if(r!=i.getActiveSheet()){var s=Uo(i,r).content,h=rr(s.data,function(n){return n[0]==e&&n[1]==t});h||(h=[e,t],s.data.push(h)),h[2]=n,i._page_value_set=!0,h[4]=null;var d=Ai(i,s,h);delete i._page_value_set;var f=o.getCell(e-1,t-1,!0);if(f.$format=di(i,{fmt:vi(i,s,h)},"string")?1:0,o.setValue(e-1,t-1,d.value),h[2]=d.value,h[4]=f.type=d.type,i._type_change=!0,qo(h,s,!0),f.style=h[3],delete i._type_change,i._validation_restore||i._type_change||!hl(i,e,t,null,r))i.callEvent("onCellChange",[e,t,n,r]);else{var m=i.validation.get(e,t,r),g={value:u,style:a,editor:l};Fc(i,m).then(function(){"stop"==m.errorHandle?Pc(i,e,t,g,r):i.callEvent("onCellChange",[e,t,n,r])}).fail(function(){Pc(i,e,t,g,r)})}}else{var v=i.getSelectedId();Nl(i,v,!0),i._mPage.setValue(e-1,t-1,n),i._type_change||(i._type_change=!0,Ti(i,e,t,n),delete i._type_change);var p=Ii(i,e,t);if(c!=p&&"string"==p&&"="==n[0]&&n.length>1&&i._mPage.setValue(e-1,t-1,n),Nl(i,v),/^=hyperlink\(/i.test(n)){var w=i.getStyle(e,t),b=i.addStyle({color:"#0000ff",underline:"underline"},w);i.setStyle(e,t,b)}if(i._validation_restore||i._type_change||!hl(i,e,t,El(i,e,t)))i._type_change||i.callEvent("onCellChange",[e,t,n,r]);else{var _=i.validation.get(e,t);Fc(i,_).then(function(){"stop"==_.errorHandle?Pc(i):i.callEvent("onCellChange",[e,t,n,r])}).fail(function(){Pc(i)})}}i._type_change||i.saveCell(e,t,r)}})}},setRangeValue:function(e,t,n){Sn.set(function(){for(var r=Kn(e,this),i=0,o=r.start.row;o<=r.end.row;o++)for(var a=r.start.column;a<=r.end.column;a++,i++)this.setCellValue(o,a,webix.isArray(t)?t[i]:t,n)},this)}});var Bc=Object.freeze({__proto__:null,saveCell:function(e,t,n){var r=(n?this._mData.getPage(n):this._mPage).getCell(e-1,t-1);qn(this,"data",{row:e,column:t,value:this.getCellValue(e,t,null,n),page:n||this.getActiveSheet(),style:(r?r.style:"")||""})}});var Hc=Object.freeze({__proto__:null,getCellEditor:function(e,t,n){if(!n||n==this.getActiveSheet())return(this._table._ssEditors[e]||{})[t]||null;var r=Uo(this,n);if(r&&r.content.editors){var i=rr(r.content.editors,function(n){return n[0]==e&&n[1]==t});return i?i[2]:null}},setCellEditor:function(e,t,n,r){var i;if((r=r||this.getActiveSheet())==this.getActiveSheet()){var o=this._table._ssEditors[e]=this._table._ssEditors[e]||{};i=o[t]||null,o[t]=n,n&&n.editor?this._table.addCellCss(e,t,"ss_editor"):(delete this._table._ssEditors[e][t],this._table.removeCellCss(e,t,"ss_editor"))}else{var a=Uo(this,r);if(!a)return;a.content.editors||(a.content.editors=[]);var l=ir(a.content.editors,function(n){return n[0]==e&&n[1]==t});if(-1!=l)i=a.content.editors[l][2],a.content.editors.splice(l,1);else if(!n)return;n&&a.content.editors.push([e,t,n])}this.callEvent("onAction",["dropdown",{row:e,column:t,value:i,newValue:n,page:r}])}});var jc=Object.freeze({__proto__:null,filterSpreadSheet:function(){var e=this,t=this._table;t.data.silent(function(){t.data.filter(function(t){return e.isRowVisible(t.id)});for(var n=Vs(t),r=function(){var r=n[i],o=r.row,a=r.column,l=r.handler,s=r.lastRow,u=!1;t.data.filter(function(n){var r=n.id;if(r<=o||"function"!=typeof l)return!0;var i=t.getSpan(r,a);if(i){if(i[0]==o&&i[1]==a)return!0;r=i[0]}var c=String(e.getCellValue(r,a,!1));if(s){if(r>s)return!0}else if(u||!c)return u=!0;return l(c)},1,!0)},i=0;i<n.length;i++)r()}),t.callEvent("onAfterFilter",[]),t.refresh()},getCellFilter:function(e,t,n){if(!n||n==this.getActiveSheet())return(this._table._ssFilters[e]||{})[t];var r=Uo(this,n);return r&&r.content.filters&&rr(r.content.filters,function(n){return n[0]==e&&n[1]==t})||null},removeFilters:function(e){var t=this;if(e&&e!=this.getActiveSheet()){var n=Uo(this,e);if(n&&n.content.filters){for(var r=0;r<n.content.filters.length;r++){var i=n.content.filters[r];this.callEvent("onAction",["filter",{row:i[0],column:i[1],value:i[2],newValue:null,page:e||this.getActiveSheet()}])}n.content.filters=[]}}else{for(var o=Vs(this._table),a=0;a<o.length;a++){var l=o[a],s=l.row,u=l.column;this.setCellFilter(s,u,null)}this._table._ssFilters={},this._table.data.filter(function(e){return t.isRowVisible(e.id)})}},setCellFilter:function(e,t,n,r){var i;if((r=r||this.getActiveSheet())==this.getActiveSheet()||(i=Uo(this,r))){var o;if(n=function(e,t,n,r,i){r&&((webix.isArray(r)||"string"==typeof r)&&(r={options:r}),r.options=Ms(e,t,n,r.options,null,i));return r}(this,e,t,n,i),i){i.content.filters||(i.content.filters=[]);var a=ir(i.content.filters,function(n){return n[0]==e&&n[1]==t});if(-1!=a)o=i.content.filters[a][2],i.content.filters.splice(a,1);else if(!n)return;n&&i.content.filters.push([e,t,n])}else{var l=this._table._ssFilters[e]=this._table._ssFilters[e]||{};if(o=l[t]||null,l[t]=n,n&&"object"==yn(n)){if(this._table.addCellCss(e,t,"ss_filter"),n.value&&Ds(n.value)&&this._table.addCellCss(e,t,"ss_filter_active"),webix.extend(n,{row:e,column:t},!0),!n.handler&&n.value&&n.value.condition){var s=n.mode||Fs(this,e,t);n.handler=Hs(s,n.value)}}else delete this._table._ssFilters[e][t],this._table.removeCellCss(e,t,"ss_filter"),this._table.removeCellCss(e,t,"ss_filter_active")}this.callEvent("onAction",["filter",{row:e,column:t,value:o,newValue:n,page:r}])}}});var Wc=Object.freeze({__proto__:null,alert:function(e){return webix.alert(webix.extend({container:this.$view,css:"webix_ssheet_alert",ok:webix.i18n.spreadsheet.labels.ok},e,!0))},confirm:function(e){return webix.confirm(webix.extend({container:this.$view,css:"webix_ssheet_confirm",ok:webix.i18n.spreadsheet.labels.ok,cancel:webix.i18n.spreadsheet.labels.cancel},e,!0))}});var Xc=Object.freeze({__proto__:null,groupUndo:function(e){Sn.set(e,this)},ignoreUndo:function(e){Yl(e,this)},resetUndo:function(){Xl(this)}});var Kc=Object.freeze({__proto__:null,addFormat:function(e){return Br(this,e)},changeDecimals:function(e,t,n,r){ni(this,n,e,t,r)},getFormat:function(e,t,n){var r=fi(this,e,t,n);return r?{name:r,format:Ur(this,r)}:null},removeFormat:function(e,t,n){Xr(this,e,t,n)},setFormat:function(e,t,n,r){return Wr(this,e,t,n,null,r)},setFormatName:function(e,t,n,r){Hr(this,e,t,n,r)}});var Yc=Object.freeze({__proto__:null,showFormulas:function(e,t){ac(this,e,t)}});var Gc=Object.freeze({__proto__:null,showPrintBorders:function(e){var t=!!this._printBorders.$render;"toggle"==e&&(e=!t),e!=t&&(e?sa(this):(delete this._printBorders.$render,this.refresh()),this.callEvent("onCommand",[{id:"toolbar-update",name:"print-borders",value:e}]),this.callEvent("onAction",["print-borders",{newValue:e,value:t}]))}});var Qc=Object.freeze({__proto__:null,zoom:function(e,t){ma(this,e,!1,t)}});var Zc=webix.copy(Xi),Jc=webix.copy(Ki);function eh(e){"format-row"!=e&&"format-column"!=e||(e="format");return{"font-family":!0,"font-size":!0,borders:!0,format:!0,"text-align":!0,"vertical-align":!0}[e]?e:null}var th={getMenuData:function(e,t,n){e=e.filter(function(e){return!1!==e.menu});for(var r=0;r<e.length;r++)if("string"==typeof e[r]&&(e[r]={id:e[r]}),"resize-column"!=e[r].id&&"resize-row"!=e[r].id||t.resizeCell){if(n&&(e[r].action=n),e[r].value||(isNaN(parseInt(e[r].id))?e[r].value=fo(e[r].id,e[r].action):e[r].value=e[r].id),e[r].submenu){var i=eh(e[r].id);e[r].submenu={data:this.getMenuData(e[r].submenu,t,i)}}}else e.splice(r,1),r--;return e.sort(function(e,t){return e.menuOrder-t.menuOrder})}};function nh(e){e.attachEvent("onComponentInit",function(){return function(e){e.$$("menu")&&e.$$("menu").attachEvent("onMenuItemClick",function(t){return function(e,t){if(e.callEvent("onMenuItemClick",[t]))if(ba[t])ba[t](e);else{var n=e.$$("menu").getMenuItem(t),r=n.action;if(!r&&function(e){return{"font-weight":!0,"font-style":!0,underline:!0,strike:!0,wrap:!0}[e]||!1}(t)&&(r=t,t=void 0),"format"==r&&"common"==t&&(t=""),r&&("format"!=r||"custom"!=t))return void e.callEvent("onStyleSet",[r,t]);if(!n.submenu){var i={id:t,value:n.value,group:n.group};ho(i),e.callEvent("onCommand",[i])}}}(e,t)})}(e)});var t=e.config,n={view:"menu",borderless:!0,css:"webix_ssheet_menu",id:"menu",autowidth:!0,type:{height:40},data:th.getMenuData(webix.isArray(t.menu)?t.menu:webix.copy(t.readonly?Jc:Zc),t)};return e.callEvent("onViewInit",["menu",n]),n}var rh={name:"spreadsheet",_base_index:{count:1},defaults:{spans:!0,liveEditor:!0,rowCount:50,math:!0,columnCount:20,resizeCell:!0,sheetTabWidth:90,conditionStyle:[{name:Ua("normal"),css:"webix_ssheet_condition_regular"},{name:Ua("neutral"),css:"webix_ssheet_condition_neutral"},{name:Ua("bad"),css:"webix_ssheet_condition_bad"},{name:Ua("good"),css:"webix_ssheet_condition_good"}]},$init:function(){var e=this;this.$index=this._base_index.count++,this.$view.className+=" webix_ssheet",this.$ready.unshift(this._sub_init),this.$ready.unshift(function(){return zr(e)}),this.$ready.push(this._set_handlers),this._destroy_with_me=[],this.attachEvent("onDestruct",function(){e._destroy_with_me.forEach(function(e){return e.destructor()})})},$skin:function(){!function(){var e=webix.skin.$name;if(er.width=webix.skin.$active.inputHeight+2,er.titleHeight="mini"==e||"compact"==e?18:20,webix.skin.$active.spreadsheet)return tr=webix.skin.$active.spreadsheet;tr["font-family"]=nr[e],"contrast"==e?(tr.background="#393939",tr.color="#ffffff"):"material"==e||"mini"==e?tr.color="#475466":"willow"==e?tr.color="#2C2F3C":"dark"==e&&(tr.background="#2A2B2D",tr.color="#ffffff")}()},_sub_init:function(){var e=this.config,t=e.readonly,n=[];Rn(e.methods),e.menu&&n.push(nh(this)),(t&&(e.toolbar||e.buttons)||!t&&!1!==e.toolbar)&&n.push(Ea(this)),e.subbar&&n.push(e.subbar),!t&&e.liveEditor&&n.push(Il(this));var r={editable:!t,liveEditor:e.liveEditor};e.rowHeight&&(r.rowHeight=e.rowHeight),e.columnWidth&&(r.columnWidth=e.columnWidth),t?n.push(yl(this,r)):n.push({cols:[yl(this,r),ps(this)]});var i=!0===e.bottombar?Co(this):e.bottombar;i&&n.push(i),xo(this),t||function(e){e.attachEvent("onComponentInit",function(){e.$$("context").attachTo(e._table.$view),e.$$("cells").attachEvent("onSelectChange",function(){return e.$$("context").hide()})});var t=[];!1!==e.config.clipboard&&(t=[{id:"cut"},{id:"copy"},{id:"paste"},{id:"special-paste",submenu:[{id:"paste-values"},{id:"paste-formulas"},{id:"paste-styles"},{id:"paste-conditions"},{id:"paste-validation"}]}]);var n={data:fu(t.concat(Wi().sort(function(e,t){return e.menuOrder-t.menuOrder}))),column:fu(Bi()),row:fu(Hi())},r={view:"contextmenu",id:"context",padding:0,submenuConfig:{template:function(t){return t.example?Ji(e,t):t.value},padding:0,on:{onBeforeShow:function(){this.sizeToContent()}}},data:[],on:{onMenuItemClick:function(t){var n=webix.copy(this.getMenuItem(t));ho(n),e.callEvent("onCommand",[n])},onShow:function(){delete e._context},onBeforeShow:function(t){e._context=!0,webix.callEvent("onClick",[]);var r=e._table.locate(t);if(!r)return!1;var i="";if(r.header&&"rowId"!==r.column?(Ia(r.column,e)||Oa(r.column,e),i="column"):r.row&&("rowId"===r.column?(Na(r.row,e)||Ta(r.row,e),i="row"):(Va(r.row,r.column,e)||e._table.addSelectArea(r,r),i="data")),i){var o=function(e,t,n){var r={area:t,data:n};return e.callEvent("onContextMenuConfig",[r])?r&&r.data:null}(e,i,n[i]);if(o)return this.clearAll(),this.parse(o),this.sizeToContent(),webix.html.preventEvent(t),!0}return!1}}};e.callEvent("onViewInit",["context",r]);var i=e.ui(r);e._destroy_with_me.push(i)}(this),function(e){for(var t={},n=e.config.readonly?[ou,Js,ru,Xs,hu]:du,r=0;r<n.length;r++)t[n[r].action]=new n[r].DialogBox(e);e.attachEvent("onCommand",function(e){var n=t[e.id];n&&n.open(e)}),e.attachEvent("onAction",function(e,n){if("add-view"==e&&!n.newValue){var r=t["add-image-top"];r&&r.viewid==n.row&&r.close()}})}(this),this.rows_setter(n)},_set_handlers:function(){var e=this;this._table||(this._table=this.$$("cells"),function(e){for(var t=[wa,gu,al,Ir,Iu,Bu,Xu,Jl,Fa,Lu,xl,oa,Ko,pi,wo,Nn,Os,Gu,Eu,sc,Ni,cc,js,da,bc,Sc,$c,oc,zn,ec,Zu,gs,lc,gl],n=0;n<t.length;n++)t[n].init&&t[n].init(e)}(this),this._loading_data=!0,$l(this,this.config.columnCount,this.config.rowCount),Rl(this),delete this._loading_data,this._table.attachEvent("onAfterAreaAdd",function(){return e.callEvent("onAfterSelect",[e.getSelectedId(!0)])}),this.callEvent("onComponentInit",[]))},$onLoad:function(e,t){this._set_handlers();var n=e.excel;n?e=this._parseExcel(e,t):e.data||"string"!=typeof e||!t.cell&&!t.row||(e=this._parseCsv(e,t)),function(e,t,n){e._loading_data=!0,t=webix.isArray(t)?{sheets:t}:t;var r=e.config.prepareData||n;if(!t.sheets&&e._activeSheet){var i=e._activeSheet;Uo(e,i).content=t,Do(e,i,t,r),Bo(e,t)}else zo(e,t,r);e._loading_data=!1}(this,e,n)}};!function(e){for(var t=[Tc,kc,Vc,Nc,Mc,Dc,qc,zc,Lc,Bc,Hc,jc,Wc,Xc,Kc,Yc,Gc,Qc],n=0;n<t.length;n++)webix.extend(e,t[n])}(rh),webix.protoUI(rh,webix.AtomDataLoader,webix.IdSpace,webix.ui.layout)});
//# sourceMappingURL=spreadsheet.js.map
